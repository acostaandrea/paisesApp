(self.webpackChunkpaisesApp=self.webpackChunkpaisesApp||[]).push([[179],{7048:(Hn,Gt,ye)=>{"use strict";ye.r(Gt),ye.d(Gt,{PaisModule:()=>Xs});var W=ye(6895),I=ye(8256),Tt=(ye(2076),ye(9751),ye(4742),ye(8421),ye(7669),ye(5403));ye(3268),ye(1810);var Ht=ye(4004);let Ha=(()=>{class j{}return j.\u0275fac=function(R){return new(R||j)},j.\u0275mod=I.oAB({type:j}),j.\u0275inj=I.cJS({}),j})(),Da=(()=>{class j{}return j.\u0275fac=function(R){return new(R||j)},j.\u0275mod=I.oAB({type:j}),j.\u0275inj=I.cJS({imports:[Ha]}),j})(),Ds=(()=>{class j{}return j.\u0275fac=function(R){return new(R||j)},j.\u0275mod=I.oAB({type:j}),j.\u0275inj=I.cJS({imports:[Da]}),j})();var Xr=ye(5649),Yo=ye(529),Ni=ye(262),Qi=ye(9646),xo=ye(8505);let us=(()=>{class j{constructor(R){this.http=R,this.apiUrl="https://restcountries.com/v3.1",this.cacheStore={byCapital:{term:"",countries:[]},byCountries:{term:"",countries:[]},byRegion:{region:"",countries:[]}},this.loadFromLocalStorage()}saveToLocalStorage(){localStorage.setItem("cacheStore",JSON.stringify(this.cacheStore))}loadFromLocalStorage(){localStorage.getItem("cacheStore")&&(this.cacheStore=JSON.parse(localStorage.getItem("cacheStore")))}getCountriesRequest(R){return this.http.get(R).pipe((0,Ni.K)(()=>(0,Qi.of)([])))}buscarPais(R){return this.getCountriesRequest(`${this.apiUrl}/name/${R}`).pipe((0,xo.b)(Ve=>this.cacheStore.byCountries={term:R,countries:Ve}),(0,xo.b)(()=>this.saveToLocalStorage()))}buscarCapital(R){return this.getCountriesRequest(`${this.apiUrl}/capital/${R}`).pipe((0,xo.b)(Ve=>this.cacheStore.byCapital={term:R,countries:Ve}),(0,xo.b)(()=>this.saveToLocalStorage()))}getPaisPorId(R){return this.http.get(`${this.apiUrl}/alpha/${R}`).pipe((0,Ht.U)(Ve=>Ve.length>0?Ve[0]:null),(0,Ni.K)(()=>(0,Qi.of)(null)))}buscarRegion(R){return this.getCountriesRequest(`${this.apiUrl}/region/${R}`).pipe((0,xo.b)(Ve=>this.cacheStore.byRegion={region:R,countries:Ve}),(0,xo.b)(()=>this.saveToLocalStorage()))}get httpParams(){return(new Yo.LE).set("field","name").set("field","capital").set("field","population").set("field","flags").set("field","cca2")}}return j.\u0275fac=function(R){return new(R||j)(I.LFG(Yo.eN))},j.\u0275prov=I.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"}),j})();function _c(j,F){1&j&&(I.TgZ(0,"div",2),I._uU(1," No hay pa\xedses que mostrar\n"),I.qZA())}const Vl=function(j){return["/countries/pais",j]};function Zc(j,F){if(1&j&&(I.TgZ(0,"tr")(1,"td"),I._uU(2),I.qZA(),I.TgZ(3,"td"),I._uU(4),I.qZA(),I.TgZ(5,"td"),I._UZ(6,"img",5),I.qZA(),I.TgZ(7,"td"),I._uU(8),I.qZA(),I.TgZ(9,"td"),I._uU(10),I.qZA(),I.TgZ(11,"td"),I._uU(12),I.ALo(13,"number"),I.qZA(),I.TgZ(14,"td")(15,"a",6),I._uU(16,"Info"),I.qZA()()()),2&j){const R=F.$implicit,Q=F.index;I.xp6(2),I.Oqu(Q+1),I.xp6(2),I.hij(" ",R.flag," "),I.xp6(2),I.Q6J("src",R.flags.svg,I.LSH)("alt",R.name.common),I.xp6(2),I.Oqu(R.name.common),I.xp6(2),I.Oqu(R.capital),I.xp6(2),I.Oqu(I.lcZ(13,8,R.population)),I.xp6(3),I.Q6J("routerLink",I.VKq(10,Vl,R.cca3))}}function Ta(j,F){if(1&j&&(I.TgZ(0,"table",3)(1,"thead")(2,"tr")(3,"th"),I._uU(4,"#"),I.qZA(),I.TgZ(5,"th"),I._uU(6,"Icon"),I.qZA(),I.TgZ(7,"th"),I._uU(8,"Bandera"),I.qZA(),I.TgZ(9,"th"),I._uU(10,"Nombre"),I.qZA(),I.TgZ(11,"th"),I._uU(12,"Capital"),I.qZA(),I.TgZ(13,"th"),I._uU(14,"Poblaci\xf3n"),I.qZA(),I._UZ(15,"th"),I.qZA()(),I.TgZ(16,"tbody"),I.YNc(17,Zc,17,12,"tr",4),I.qZA()()),2&j){const R=I.oxw();I.xp6(17),I.Q6J("ngForOf",R.countries)}}let ui=(()=>{class j{constructor(){this.countries=[]}ngOnInit(){}}return j.\u0275fac=function(R){return new(R||j)},j.\u0275cmp=I.Xpm({type:j,selectors:[["app-pais-table"]],inputs:{countries:"countries"},decls:3,vars:2,consts:[["class","alert alert-warning text-center",4,"ngIf","ngIfElse"],["table",""],[1,"alert","alert-warning","text-center"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[3,"src","alt"],[3,"routerLink"]],template:function(R,Q){if(1&R&&(I.YNc(0,_c,2,0,"div",0),I.YNc(1,Ta,18,1,"ng-template",null,1,I.W1O)),2&R){const Ve=I.MAs(2);I.Q6J("ngIf",0===Q.countries.length)("ngIfElse",Ve)}},dependencies:[W.sg,W.O5,Xr.yS,W.JJ],styles:["img[_ngcontent-%COMP%]{width:25px}"]}),j})();const bo=function(j){return{"btn-outline-primary":j}};function Ko(j,F){if(1&j){const R=I.EpF();I.TgZ(0,"button",5),I.NdJ("click",function(){const Jt=I.CHM(R).$implicit,fr=I.oxw();return I.KtG(fr.searchByRegion(Jt))}),I._uU(1),I.qZA()}if(2&j){const R=F.$implicit,Q=I.oxw();I.Q6J("ngClass",I.VKq(2,bo,Q.selectedRegion===R)),I.xp6(1),I.hij(" ",R," ")}}let wo=(()=>{class j{constructor(R){this.paisService=R,this.regions=["Africa","Americas","Asia","Europe","Oceania"],this.countries=[]}ngOnInit(){this.countries=this.paisService.cacheStore.byRegion.countries,this.selectedRegion=this.paisService.cacheStore.byRegion.region}searchByRegion(R){this.selectedRegion=R,this.paisService.buscarRegion(R).subscribe(Q=>{this.countries=Q})}}return j.\u0275fac=function(R){return new(R||j)(I.Y36(us))},j.\u0275cmp=I.Xpm({type:j,selectors:[["app-por-region"]],decls:10,vars:2,consts:[[1,"row"],[1,"col","text-center"],["class","btn mx-2",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"col"],[3,"countries"],[1,"btn","mx-2",3,"ngClass","click"]],template:function(R,Q){1&R&&(I.TgZ(0,"h2"),I._uU(1,"Por Regi\xf3n"),I.qZA(),I._UZ(2,"hr"),I.TgZ(3,"div",0)(4,"div",1),I.YNc(5,Ko,2,4,"button",2),I.qZA()(),I.TgZ(6,"div",0)(7,"div",3),I._UZ(8,"hr")(9,"app-pais-table",4),I.qZA()()),2&R&&(I.xp6(5),I.Q6J("ngForOf",Q.regions),I.xp6(4),I.Q6J("countries",Q.countries))},dependencies:[W.mk,W.sg,ui],styles:["button[_ngcontent-%COMP%]{margin-right:5px;margin-bottom:5px}"]}),j})();var Ei=ye(7579),Ma=ye(727);class Xa extends Ma.w0{constructor(F,R){super()}schedule(F,R=0){return this}}const Ws={setInterval(j,F,...R){const{delegate:Q}=Ws;return Q?.setInterval?Q.setInterval(j,F,...R):setInterval(j,F,...R)},clearInterval(j){const{delegate:F}=Ws;return(F?.clearInterval||clearInterval)(j)},delegate:void 0};var Ul=ye(8737);const Ya={now:()=>(Ya.delegate||Date).now(),delegate:void 0};class B{constructor(F,R=B.now){this.schedulerActionCtor=F,this.now=R}schedule(F,R=0,Q){return new this.schedulerActionCtor(this,F).schedule(Q,R)}}B.now=Ya.now;const $=new class J extends B{constructor(F,R=B.now){super(F,R),this.actions=[],this._active=!1}flush(F){const{actions:R}=this;if(this._active)return void R.push(F);let Q;this._active=!0;do{if(Q=F.execute(F.state,F.delay))break}while(F=R.shift());if(this._active=!1,Q){for(;F=R.shift();)F.unsubscribe();throw Q}}}(class Sa extends Xa{constructor(F,R){super(F,R),this.scheduler=F,this.work=R,this.pending=!1}schedule(F,R=0){var Q;if(this.closed)return this;this.state=F;const Ve=this.id,Jt=this.scheduler;return null!=Ve&&(this.id=this.recycleAsyncId(Jt,Ve,R)),this.pending=!0,this.delay=R,this.id=null!==(Q=this.id)&&void 0!==Q?Q:this.requestAsyncId(Jt,this.id,R),this}requestAsyncId(F,R,Q=0){return Ws.setInterval(F.flush.bind(F,this),Q)}recycleAsyncId(F,R,Q=0){if(null!=Q&&this.delay===Q&&!1===this.pending)return R;null!=R&&Ws.clearInterval(R)}execute(F,R){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const Q=this._execute(F,R);if(Q)return Q;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(F,R){let Ve,Q=!1;try{this.work(F)}catch(Jt){Q=!0,Ve=Jt||new Error("Scheduled action threw falsy error")}if(Q)return this.unsubscribe(),Ve}unsubscribe(){if(!this.closed){const{id:F,scheduler:R}=this,{actions:Q}=R;this.work=this.state=this.scheduler=null,this.pending=!1,(0,Ul.P)(Q,this),null!=F&&(this.id=this.recycleAsyncId(R,F,null)),this.delay=null,super.unsubscribe()}}});var Ae=ye(4482);let At=(()=>{class j{constructor(){this.debouncer=new Ei.x,this.placeholder="",this.initialValue="",this.onValue=new I.vpe,this.onDebounce=new I.vpe}ngOnInit(){this.debouncerSuscription=this.debouncer.pipe(function it(j,F=$){return(0,Ae.e)((R,Q)=>{let Ve=null,Jt=null,fr=null;const Ri=()=>{if(Ve){Ve.unsubscribe(),Ve=null;const Ci=Jt;Jt=null,Q.next(Ci)}};function jo(){const Ci=fr+j,Jn=F.now();if(Jn<Ci)return Ve=this.schedule(void 0,Ci-Jn),void Q.add(Ve);Ri()}R.subscribe((0,Tt.x)(Q,Ci=>{Jt=Ci,fr=F.now(),Ve||(Ve=F.schedule(jo,j),Q.add(Ve))},()=>{Ri(),Q.complete()},void 0,()=>{Jt=Ve=null}))})}(300)).subscribe(R=>{this.onDebounce.emit(R)})}ngOnDestroy(){this.debouncerSuscription?.unsubscribe()}emitValue(R){this.onValue.emit(R)}onKeyPress(R){this.debouncer.next(R)}}return j.\u0275fac=function(R){return new(R||j)},j.\u0275cmp=I.Xpm({type:j,selectors:[["app-search-box"]],inputs:{placeholder:"placeholder",initialValue:"initialValue"},outputs:{onValue:"onValue",onDebounce:"onDebounce"},decls:2,vars:2,consts:[["type","text",1,"form-control",3,"value","placeholder","keyup"],["txtInput",""]],template:function(R,Q){if(1&R){const Ve=I.EpF();I.TgZ(0,"input",0,1),I.NdJ("keyup",function(){I.CHM(Ve);const fr=I.MAs(1);return I.KtG(Q.onKeyPress(fr.value))}),I.qZA()}2&R&&I.Q6J("value",Q.initialValue)("placeholder",Q.placeholder)}}),j})(),un=(()=>{class j{constructor(){}ngOnInit(){}}return j.\u0275fac=function(R){return new(R||j)},j.\u0275cmp=I.Xpm({type:j,selectors:[["shared-loading-spinner"]],decls:15,vars:0,consts:[[1,"spinner-conteiner","bg-dark"],["width","30","height","45","viewBox","0 0 45 45","xmlns","http://www.w3.org/2000/svg","stroke","#fff"],["fill","none","fill-rule","evenodd","transform","translate(1 1)","stroke-width","2"],["cx","22","cy","22","r","6","stroke-opacity","0"],["attributeName","r","begin","1.5s","dur","3s","values","6;22","calcMode","linear","repeatCount","indefinite"],["attributeName","stroke-opacity","begin","1.5s","dur","3s","values","1;0","calcMode","linear","repeatCount","indefinite"],["attributeName","stroke-width","begin","1.5s","dur","3s","values","2;0","calcMode","linear","repeatCount","indefinite"],["attributeName","r","begin","3s","dur","3s","values","6;22","calcMode","linear","repeatCount","indefinite"],["attributeName","stroke-opacity","begin","3s","dur","3s","values","1;0","calcMode","linear","repeatCount","indefinite"],["attributeName","stroke-width","begin","3s","dur","3s","values","2;0","calcMode","linear","repeatCount","indefinite"],["cx","22","cy","22","r","8"],["attributeName","r","begin","0s","dur","1.5s","values","6;1;2;3;4;5;6","calcMode","linear","repeatCount","indefinite"]],template:function(R,Q){1&R&&(I.TgZ(0,"div",0)(1,"span"),I._uU(2,"Buscando"),I.qZA(),I.O4$(),I.TgZ(3,"svg",1)(4,"g",2)(5,"circle",3),I._UZ(6,"animate",4)(7,"animate",5)(8,"animate",6),I.qZA(),I.TgZ(9,"circle",3),I._UZ(10,"animate",7)(11,"animate",8)(12,"animate",9),I.qZA(),I.TgZ(13,"circle",10),I._UZ(14,"animate",11),I.qZA()()()())},styles:[".spinner-conteiner[_ngcontent-%COMP%]{position:fixed;bottom:15px;right:15px;background-color:#000;color:#fff;padding:5px 10px;border-radius:20px;display:flex;align-items:center;box-shadow:0 3px 5px #0003}span[_ngcontent-%COMP%]{margin-left:5px}"]}),j})();function yr(j,F){1&j&&I._UZ(0,"shared-loading-spinner")}let wr=(()=>{class j{constructor(R){this.paisService=R,this.termino="",this.hayError=!1,this.countries=[],this.initialValue="",this.isLoading=!1}ngOnInit(){this.countries=this.paisService.cacheStore.byCapital.countries,this.initialValue=this.paisService.cacheStore.byCapital.term}searchByCapital(R){this.isLoading=!0,this.paisService.buscarCapital(R).subscribe(Q=>{this.countries=Q,this.isLoading=!1})}}return j.\u0275fac=function(R){return new(R||j)(I.Y36(us))},j.\u0275cmp=I.Xpm({type:j,selectors:[["app-por-capital"]],decls:11,vars:3,consts:[[1,"row"],[1,"col"],["placeholder","Buscar por capital",3,"initialValue","onDebounce"],[4,"ngIf"],[3,"countries"]],template:function(R,Q){1&R&&(I.TgZ(0,"h2"),I._uU(1,"Por Capital"),I.qZA(),I._UZ(2,"hr"),I.TgZ(3,"div",0)(4,"div",1)(5,"app-search-box",2),I.NdJ("onDebounce",function(Jt){return Q.searchByCapital(Jt)}),I.qZA()()(),I.TgZ(6,"div",0)(7,"div",1),I._UZ(8,"hr"),I.YNc(9,yr,1,0,"shared-loading-spinner",3),I._UZ(10,"app-pais-table",4),I.qZA()()),2&R&&(I.xp6(5),I.Q6J("initialValue",Q.initialValue),I.xp6(4),I.Q6J("ngIf",Q.isLoading),I.xp6(1),I.Q6J("countries",Q.countries))},dependencies:[W.O5,At,un,ui]}),j})();var Dr=ye(3900),dr=ye(9898);const nr=["mapa"];function br(j,F){1&j&&(I.TgZ(0,"div",4),I._uU(1,"Espere por favor"),I.qZA())}function ar(j,F){if(1&j&&(I.TgZ(0,"div")(1,"div",5)(2,"div",6)(3,"h2"),I._uU(4," Pa\xeds: "),I.TgZ(5,"strong"),I._uU(6),I.qZA()()(),I.TgZ(7,"div",7)(8,"a",8)(9,"button",9),I._uU(10," Ver en Google Maps "),I.qZA()()(),I._UZ(11,"hr"),I.qZA(),I.TgZ(12,"div",5)(13,"div",10)(14,"h3"),I._uU(15,"Bandera"),I.qZA(),I._UZ(16,"img",11),I.qZA(),I.TgZ(17,"div",12)(18,"h3"),I._uU(19,"Informaci\xf3n"),I.qZA(),I.TgZ(20,"ul",13)(21,"li",14)(22,"strong"),I._uU(23,"Poblaci\xf3n:"),I.qZA(),I._uU(24),I.ALo(25,"number"),I.qZA(),I.TgZ(26,"li",14)(27,"strong"),I._uU(28,"Capital: "),I.qZA(),I._uU(29),I.qZA(),I.TgZ(30,"li",14)(31,"strong"),I._uU(32,"C\xf3digo:"),I.qZA(),I._uU(33),I.qZA()()()(),I.TgZ(34,"div",15)(35,"div",12)(36,"h3"),I._uU(37,"Traducciones"),I.qZA(),I.TgZ(38,"div",16)(39,"span",17),I._uU(40),I.qZA(),I.TgZ(41,"span",17),I._uU(42),I.qZA(),I.TgZ(43,"span",17),I._uU(44),I.qZA(),I.TgZ(45,"span",17),I._uU(46),I.qZA(),I.TgZ(47,"span",17),I._uU(48),I.qZA(),I.TgZ(49,"span",17),I._uU(50),I.qZA(),I.TgZ(51,"span",17),I._uU(52),I.qZA(),I.TgZ(53,"span",17),I._uU(54),I.qZA(),I.TgZ(55,"span",17),I._uU(56),I.qZA(),I.TgZ(57,"span",17),I._uU(58),I.qZA()()()(),I._UZ(59,"div",18),I.qZA()),2&j){const R=I.oxw();I.xp6(6),I.Oqu(R.country.name.common),I.xp6(2),I.Q6J("href",R.country.maps.googleMaps,I.LSH),I.xp6(8),I.Q6J("src",R.country.flags.svg,I.LSH)("alt",R.country.flags.alt),I.xp6(8),I.hij(" ",I.lcZ(25,17,R.country.population)," "),I.xp6(5),I.hij(" ",R.country.capital," "),I.xp6(4),I.hij(" ",R.country.cca3," "),I.xp6(7),I.Oqu(R.country.translations.ara.common),I.xp6(2),I.Oqu(R.country.translations.bre.common),I.xp6(2),I.Oqu(R.country.translations.ces.common),I.xp6(2),I.Oqu(R.country.translations.cym.common),I.xp6(2),I.Oqu(R.country.translations.deu.common),I.xp6(2),I.Oqu(R.country.translations.est.common),I.xp6(2),I.Oqu(R.country.translations.fin.common),I.xp6(2),I.Oqu(R.country.translations.ita.common),I.xp6(2),I.Oqu(R.country.translations.kor.common),I.xp6(2),I.Oqu(R.country.translations.per.common)}}let Oo=(()=>{class j{constructor(R,Q,Ve){this.activatedRoute=R,this.paisService=Q,this.router=Ve,this.googleMapsImageUrl=""}ngOnInit(){this.activatedRoute.params.pipe((0,Dr.w)(({id:R})=>this.paisService.getPaisPorId(R)),(0,xo.b)(console.log)).subscribe(R=>{if(!R)return this.router.navigateByUrl("/");this.country=R,this.googleMapsImageUrl=`https://maps.googleapis.com/maps/api/staticmap?center=${R.latlng[0]},${R.latlng[1]}`,this.cargarMapa()})}cargarMapa(){if(this.country){const R=this.country.latlng[0],Q=this.country.latlng[1],Ve=new dr.Map({container:this.divMap?.nativeElement,style:"mapbox://styles/mapbox/streets-v12",center:[Q,R],zoom:3});(new dr.Marker).setLngLat([Q,R]).addTo(Ve)}}}return j.\u0275fac=function(R){return new(R||j)(I.Y36(Xr.gz),I.Y36(us),I.Y36(Xr.F0))},j.\u0275cmp=I.Xpm({type:j,selectors:[["app-ver-pais"]],viewQuery:function(R,Q){if(1&R&&I.Gf(nr,5),2&R){let Ve;I.iGM(Ve=I.CRH())&&(Q.divMap=Ve.first)}},decls:5,vars:2,consts:[["loading",""],[4,"ngIf","ngIfElse"],["id","map",1,"mt-3"],["mapa",""],[1,"alert","alert-info","text-center"],[1,"row"],[1,"col-9"],[1,"col-3"],["target","_blank",3,"href"],["type","button",1,"btn","btn-outline-secondary","btn-sm"],[1,"col-4"],[1,"img-thumbnail",3,"src","alt"],[1,"col"],[1,"list-group"],[1,"list-group-item"],[1,"row","mt-3"],[1,"d-flex","flex-wrap"],[1,"badge","bg-primary","m-1"],[1,"mt-3"]],template:function(R,Q){if(1&R&&(I.YNc(0,br,2,0,"ng-template",null,0,I.W1O),I.YNc(2,ar,60,19,"div",1),I._UZ(3,"div",2,3)),2&R){const Ve=I.MAs(1);I.xp6(2),I.Q6J("ngIf",Q.country)("ngIfElse",Ve)}},dependencies:[W.O5,W.JJ],styles:["#map[_ngcontent-%COMP%]{width:50rem;height:30rem}"]}),j})();function lo(j,F){1&j&&I._UZ(0,"shared-loading-spinner")}const co=[{path:"region",component:wo},{path:"capital",component:wr},{path:"paises",component:(()=>{class j{constructor(R){this.paisService=R,this.countries=[],this.isLoading=!1,this.initialValue="",this.mostrarSugerencia=!1}ngOnInit(){this.countries=this.paisService.cacheStore.byCountries.countries,this.initialValue=this.paisService.cacheStore.byCountries.term}searchByCountry(R){this.isLoading=!0,this.paisService.buscarPais(R).subscribe(Q=>{this.countries=Q,this.isLoading=!1})}}return j.\u0275fac=function(R){return new(R||j)(I.Y36(us))},j.\u0275cmp=I.Xpm({type:j,selectors:[["app-por-pais"]],decls:11,vars:3,consts:[[1,"row"],[1,"col"],["placeholder","Buscar por pa\xeds",3,"initialValue","onDebounce"],[4,"ngIf"],[3,"countries"]],template:function(R,Q){1&R&&(I.TgZ(0,"h2"),I._uU(1,"Por Pa\xeds"),I.qZA(),I._UZ(2,"hr"),I.TgZ(3,"div",0)(4,"div",1)(5,"app-search-box",2),I.NdJ("onDebounce",function(Jt){return Q.searchByCountry(Jt)}),I.qZA()()(),I.TgZ(6,"div",0)(7,"div",1),I._UZ(8,"hr"),I.YNc(9,lo,1,0,"shared-loading-spinner",3),I._UZ(10,"app-pais-table",4),I.qZA()()),2&R&&(I.xp6(5),I.Q6J("initialValue",Q.initialValue),I.xp6(4),I.Q6J("ngIf",Q.isLoading),I.xp6(1),I.Q6J("countries",Q.countries))},dependencies:[W.O5,At,un,ui],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),j})()},{path:"pais/:id",component:Oo},{path:"**",redirectTo:"countries/paises"}];let hs=(()=>{class j{}return j.\u0275fac=function(R){return new(R||j)},j.\u0275mod=I.oAB({type:j}),j.\u0275inj=I.cJS({imports:[Xr.Bz.forChild(co),Xr.Bz]}),j})();var ds=ye(4466);let Xs=(()=>{class j{}return j.\u0275fac=function(R){return new(R||j)},j.\u0275mod=I.oAB({type:j}),j.\u0275inj=I.cJS({imports:[W.ez,Ds,Xr.Bz,hs,ds.m]}),j})()},4466:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{m:()=>u});var W=ye(6895),I=ye(5649),nt=ye(8256);let u=(()=>{class Te{}return Te.\u0275fac=function(Vt){return new(Vt||Te)},Te.\u0275mod=nt.oAB({type:Te}),Te.\u0275inj=nt.cJS({imports:[W.ez,I.Bz]}),Te})()},8914:(Hn,Gt,ye)=>{"use strict";var W=ye(1481),I=ye(8256),nt=ye(529),u=ye(9898);var Yt=ye(5649);let Vt=(()=>{class It{constructor(){}ngOnInit(){}}return It.\u0275fac=function(on){return new(on||It)},It.\u0275cmp=I.Xpm({type:It,selectors:[["app-sidebar"]],decls:10,vars:0,consts:[[1,"list-group"],["routerLink","countries/paises","routerLinkActive","active",1,"list-group-item"],["routerLink","countries/region","routerLinkActive","active",1,"list-group-item"],["routerLink","countries/capital","routerLinkActive","active",1,"list-group-item"]],template:function(on,or){1&on&&(I.TgZ(0,"h2"),I._uU(1,"Pa\xedses"),I.qZA(),I._UZ(2,"hr"),I.TgZ(3,"ul",0)(4,"li",1),I._uU(5," Buscar pa\xeds "),I.qZA(),I.TgZ(6,"li",2),I._uU(7," Por region "),I.qZA(),I.TgZ(8,"li",3),I._uU(9," Por capital "),I.qZA()())},dependencies:[Yt.rH,Yt.Od],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),It})(),Tt=(()=>{class It{constructor(){this.title="paisesApp"}ngOnInit(){u.accessToken="pk.eyJ1IjoiYWNvc3RhYW5kcmVhZGV2IiwiYSI6ImNsam4wY20xbDEwcm0zbHFtZGs0NHlheGcifQ.kQjKZHr__wV-Q5sD0iLFSw"}}return It.\u0275fac=function(on){return new(on||It)},It.\u0275cmp=I.Xpm({type:It,selectors:[["app-root"]],decls:5,vars:0,consts:[[1,"row","container","mt-4"],[1,"col-3"],[1,"col"]],template:function(on,or){1&on&&(I.TgZ(0,"div",0)(1,"div",1),I._UZ(2,"app-sidebar"),I.qZA(),I.TgZ(3,"div",2),I._UZ(4,"router-outlet"),I.qZA()())},dependencies:[Yt.lC,Vt]}),It})();var gt=ye(7048),vt=ye(4466);const Cn=[{path:"about",component:(()=>{class It{constructor(){}ngOnInit(){}}return It.\u0275fac=function(on){return new(on||It)},It.\u0275cmp=I.Xpm({type:It,selectors:[["shared-about-page"]],decls:2,vars:0,template:function(on,or){1&on&&(I.TgZ(0,"p"),I._uU(1,"about-page works!"),I.qZA())}}),It})()},{path:"contact",component:(()=>{class It{constructor(){}ngOnInit(){}}return It.\u0275fac=function(on){return new(on||It)},It.\u0275cmp=I.Xpm({type:It,selectors:[["app-contact-page"]],decls:2,vars:0,template:function(on,or){1&on&&(I.TgZ(0,"p"),I._uU(1,"contact-page works!"),I.qZA())}}),It})()},{path:"countries",loadChildren:()=>Promise.resolve().then(ye.bind(ye,7048)).then(It=>It.PaisModule)}];let bt=(()=>{class It{}return It.\u0275fac=function(on){return new(on||It)},It.\u0275mod=I.oAB({type:It}),It.\u0275inj=I.cJS({imports:[Yt.Bz.forRoot(Cn),Yt.Bz]}),It})(),nn=(()=>{class It{}return It.\u0275fac=function(on){return new(on||It)},It.\u0275mod=I.oAB({type:It,bootstrap:[Tt]}),It.\u0275inj=I.cJS({imports:[W.b2,bt,nt.JF,gt.PaisModule,vt.m]}),It})();(0,I.G48)(),W.q6().bootstrapModule(nn).catch(It=>console.error(It))},9898:function(Hn){Hn.exports=function(){"use strict";var Gt,ye,W;function I(u,Te){if(Gt)if(ye){var Yt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Gt+")(sharedChunk); ("+ye+")(sharedChunk); self.onerror = null;",Vt={};Gt(Vt),W=Te(Vt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(W.workerUrl=window.URL.createObjectURL(new Blob([Yt],{type:"text/javascript"})))}else ye=Te;else Gt=Te}return I(0,function(u){var Te=typeof self<"u"?self:{},Yt="2.15.0";let Vt;const Tt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Vt){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Vt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{Vt=n}}return Vt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Tt.API_URL)return null;try{const n=new URL(Tt.API_URL);return"api.mapbox.cn"===n.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===n.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},gt={supported:!1,testSupport:function(n){!Ht&&dt&&(Cn?bt(n):vt=n)}};let vt,dt,Ht=!1,Cn=!1;function bt(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,dt),n.isContextLost())return;gt.supported=!0}catch{}n.deleteTexture(e),Ht=!0}Te.document&&(dt=Te.document.createElement("img"),dt.onload=function(){vt&&bt(vt),vt=null,Cn=!0},dt.onerror=function(){Ht=!0,vt=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const nn="01";function It(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pn=on;function on(n,e,r,s){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=s}on.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(void 0===e&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,s=0;s<8;s++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<e)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=h/p}var m=0,y=1;for(r=n,s=0;s<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<e));s++)n>h?m=r:y=r,r=.5*(y-m)+m;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var or=It(pn),sn=tn;function tn(n,e){this.x=n,this.y=e}tn.prototype={clone:function(){return new tn(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(n,e){var r=Math.cos(n),s=Math.sin(n),h=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},tn.convert=function(n){return n instanceof tn?n:Array.isArray(n)?new tn(n[0],n[1]):n};var Ge=It(sn);const kt=Math.PI/180,lr=180/Math.PI;function tt(n){return n*kt}function ft(n){return n*lr}const rn=[[0,0],[1,0],[1,1],[0,1]];function Xe(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function He(n,e,r,s){const h=new or(n,e,r,s);return function(p){return h.solve(p)}}const lt=He(.25,.1,.25,1);function Be(n,e,r){return Math.min(r,Math.max(e,n))}function Wt(n,e,r){return(r=Be((r-n)/(e-n),0,1))*r*(3-2*r)}function ht(n,e,r){const s=r-e,h=((n-e)%s+s)%s+e;return h===e?r:h}function fn(n,e,r){if(!n.length)return r(null,[]);let s=n.length;const h=new Array(n.length);let p=null;n.forEach((m,y)=>{e(m,(b,w)=>{b&&(p=b),h[y]=w,0==--s&&r(p,h)})})}function kn(n){const e=[];for(const r in n)e.push(n[r]);return e}function gr(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}let Dn=1;function vr(){return Dn++}function li(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function xr(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Mi(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Zr(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Ar(n,e){return-1!==n.indexOf(e,n.length-e.length)}function ln(n,e,r){const s={};for(const h in n)s[h]=e.call(r||this,n[h],h,n);return s}function Zn(n,e,r){const s={};for(const h in n)e.call(r||this,n[h],h,n)&&(s[h]=n[h]);return s}function Si(n){return Array.isArray(n)?n.map(Si):"object"==typeof n&&n?ln(n,Si):n}const Wo={};function Cr(n){Wo[n]||(typeof console<"u"&&console.warn(n),Wo[n]=!0)}function _r(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function Mo(n){let e=0;for(let r,s,h=0,p=n.length,m=p-1;h<p;m=h++)r=n[h],s=n[m],e+=(s.x-r.x)*(r.y+s.y);return e}function fi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Nr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,h,p)=>{const m=h||p;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ho=null;function vn(n){if(null==ho){const e=n.navigator?n.navigator.userAgent:null;ho=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ho}function Fi(n){try{const e=Te[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function zr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const si="mapbox-tiles";let kr,Et,fo=500,vs=50;function ve(){try{return Te.caches}catch{}}function we(){ve()&&!kr&&(kr=Te.caches.open(si))}function ct(n){const e=n.indexOf("?");if(e<0)return n;const s=function(h){const p=h.indexOf("?");return p>0?h.slice(p+1).split("&"):[]}(n).filter(h=>{const p=h.split("=");return"language"===p[0]||"worldview"===p[0]});return s.length?`${n.slice(0,e)}?${s.join("&")}`:n.slice(0,e)}let pt=1/0;const mn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(mn);class In extends Error{constructor(e,r,s){401===r&&Fe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const cr=fi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Te.location.protocol?Te.parent:Te).location.href,gn=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(cr())&&!/^\w+:/.test(r))){if(Te.fetch&&Te.Request&&Te.AbortController&&Te.Request.prototype.hasOwnProperty("signal"))return function(s,h){const p=new Te.AbortController,m=new Te.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:cr(),referrerPolicy:s.referrerPolicy,signal:p.signal});let y=!1,b=!1;const w=(A=m.url).indexOf("sku=")>0&&Fe(A);var A;"json"===s.type&&m.headers.set("Accept","application/json");const k=(G,H,K)=>{if(b)return;if(G&&"SecurityError"!==G.message&&Cr(G.toString()),H&&K)return z(H);const ie=Date.now();Te.fetch(m).then(ue=>{if(ue.ok){const be=w?ue.clone():null;return z(ue,be,ie)}return h(new In(ue.statusText,ue.status,s.url))}).catch(ue=>{"AbortError"!==ue.name&&h(new Error(`${ue.message} ${s.url}`))})},z=(G,H,K)=>{("arrayBuffer"===s.type?G.arrayBuffer():"json"===s.type?G.json():G.text()).then(ie=>{b||(H&&K&&function(ue,be,de){if(we(),!kr)return;const xe={status:be.status,statusText:be.statusText,headers:new Te.Headers};be.headers.forEach((Ke,Ze)=>xe.headers.set(Ze,Ke));const Se=Nr(be.headers.get("Cache-Control")||"");if(Se["no-store"])return;Se["max-age"]&&xe.headers.set("Expires",new Date(de+1e3*Se["max-age"]).toUTCString());const Me=xe.headers.get("Expires");Me&&(new Date(Me).getTime()-de<42e4||function(Ke,Ze){if(void 0===Et)try{new Response(new ReadableStream),Et=!0}catch{Et=!1}Et?Ze(Ke.body):Ke.blob().then(Ze)}(be,Ke=>{const Ze=new Te.Response(Ke,xe);we(),kr&&kr.then(st=>st.put(ct(ue.url),Ze)).catch(st=>Cr(st.message))}))}(m,H,K),y=!0,h(null,ie,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(ie=>{b||h(new Error(ie.message))})};return w?function(G,H){if(we(),!kr)return H(null);const K=ct(G.url);kr.then(ie=>{ie.match(K).then(ue=>{const be=function(de){if(!de)return!1;const xe=new Date(de.headers.get("Expires")||0),Se=Nr(de.headers.get("Cache-Control")||"");return xe>Date.now()&&!Se["no-cache"]}(ue);ie.delete(K),be&&ie.put(K,ue.clone()),H(null,ue,be)}).catch(H)}).catch(H)}(m,k):k(null,null),{cancel:()=>{b=!0,y||p.abort()}}}(n,e);if(fi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(s,h){const p=new Te.XMLHttpRequest;p.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(p.responseType="arraybuffer");for(const m in s.headers)p.setRequestHeader(m,s.headers[m]);return"json"===s.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===s.credentials,p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let m=p.response;if("json"===s.type)try{m=JSON.parse(p.response)}catch(y){return h(y)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new In(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}}(n,e)},Vr=function(n,e){return gn(gr(n,{type:"arrayBuffer"}),e)};function Tr(n){const e=Te.document.createElement("a");return e.href=n,e.protocol===Te.document.location.protocol&&e.host===Te.document.location.host}const _e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let X,ee;X=[],ee=0;const he=function(n,e){if(gt.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ee>=Tt.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return X.push(p),p}ee++;let r=!1;const s=()=>{if(!r)for(r=!0,ee--;X.length&&ee<Tt.MAX_PARALLEL_IMAGE_REQUESTS;){const p=X.shift(),{requestParameters:m,callback:y,cancelled:b}=p;b||(p.cancel=he(m,y).cancel)}},h=Vr(n,(p,m,y,b)=>{s(),p?e(p):m&&(Te.createImageBitmap?function(w,A){const k=new Te.Blob([new Uint8Array(w)],{type:"image/png"});Te.createImageBitmap(k).then(z=>{A(null,z)}).catch(z=>{A(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(w,A)=>e(w,A,y,b)):function(w,A){const k=new Te.Image,z=Te.URL;k.onload=()=>{A(null,k),z.revokeObjectURL(k.src),k.onload=null,Te.requestAnimationFrame(()=>{k.src=_e})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new Te.Blob([new Uint8Array(w)],{type:"image/png"});k.src=w.byteLength?z.createObjectURL(G):_e}(m,(w,A)=>e(w,A,y,b)))});return{cancel:()=>{h.cancel(),s()}}},Ee="NO_ACCESS_TOKEN";function Ce(n){return 0===n.indexOf("mapbox:")}function Fe(n){return Tt.API_URL_REGEX.test(n)}function Le(n){return Tt.API_CDN_URL_REGEX.test(n)}function Ie(n){return Tt.API_STYLE_REGEX.test(n)&&!$e(n)}function $e(n){return Tt.API_SPRITE_REGEX.test(n)}const xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ut(n){const e=n.match(xt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function St(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const Tn="mapbox.eventData";function $n(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Te.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Mn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=$n(Tt.ACCESS_TOKEN);let s="";return s=r&&r.u?Te.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(Number("0x"+p)))):Tt.ACCESS_TOKEN||"",e?`${Tn}.${e}:${s}`:`${Tn}:${s}`}fetchEventData(){const e=Fi("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const h=Te.localStorage.getItem(r);h&&(this.eventData=JSON.parse(h));const p=Te.localStorage.getItem(s);p&&(this.anonId=p)}catch{Cr("Unable to read from LocalStorage")}}saveEventData(){const e=Fi("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Te.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Te.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Cr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,h){if(!Tt.EVENTS_URL)return;const p=Ut(Tt.EVENTS_URL);p.params.push(`access_token=${h||Tt.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},y=r?gr(m,r):m,b={url:St(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};var A;this.pendingRequest=(A=w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(h)},gn(gr(b,{method:"POST"}),A))}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Rn=new class extends Mn{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Tt.EVENTS_URL&&Tt.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>Ce(r)||Fe(r))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=$n(Tt.ACCESS_TOKEN),r=e?e.u:Tt.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;Mi(this.anonId)||(this.anonId=li(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),y=(h-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||p.getDate()!==m.getDate()}else s=!0;s?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Yt,skuId:nn,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=r)},n):this.processRequests()}},Bn=Rn.postTurnstileEvent.bind(Rn),Mr=new class extends Mn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,r,s){this.skuToken=e,this.errorCb=s,Tt.EVENTS_URL&&(r||Tt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Ee)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Mi(this.anonId)||(this.anonId=li()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Yt,skuId:nn,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},Ur=Mr.postMapLoadEvent.bind(Mr),je=new class extends Mn{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){Tt.EVENTS_URL&&(n||Tt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:r}=this.queue.shift(),s=function(h){const p=Te.performance.getEntriesByType("resource"),m=Te.performance.getEntriesByType("mark"),y=function(z){const G={};if(z)for(const H in z)if("other"!==H)for(const K of z[H]){const ie=`${H}ResolveRangeMin`,ue=`${H}ResolveRangeMax`,be=`${H}RequestCount`,de=`${H}RequestCachedCount`;G[ie]=Math.min(G[ie]||1/0,K.startTime),G[ue]=Math.max(G[ue]||-1/0,K.responseEnd);const xe=Se=>{void 0===G[Se]&&(G[Se]=0),++G[Se]};void 0!==K.transferSize&&0===K.transferSize&&xe(de),xe(be)}return G}(function(z,G){const H={};if(z)for(const K of z){const ie=G(K);void 0===H[ie]&&(H[ie]=[]),H[ie].push(K)}return H}(p,hr)),b=Te.devicePixelRatio,w=Te.navigator.connection||Te.navigator.mozConnection||Te.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},k=(z,G,H)=>{null!=H&&z.push({name:G,value:H.toString()})};for(const z in y)k(A.counters,z,y[z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(k(A.counters,"interactionRangeMin",h.interactionRange[0]),k(A.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const z of Object.keys(En)){const G=En[z],H=m.find(K=>K.name===G);H&&k(A.counters,G,H.startTime)}return k(A.counters,"visibilityHidden",h.visibilityHidden),k(A.attributes,"style",function(z){if(z)for(const G of z){const H=G.name.split("?")[0];if(Ie(H)){const K=H.split("/").slice(-2);if(2===K.length)return`mapbox://styles/${K[0]}/${K[1]}`}}}(p)),k(A.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),k(A.attributes,"fogEnabled",h.fogEnabled?"true":"false"),k(A.attributes,"projection",h.projection),k(A.attributes,"zoom",h.zoom),k(A.metadata,"devicePixelRatio",b),k(A.metadata,"connectionEffectiveType",w?w.effectiveType:void 0),k(A.metadata,"navigatorUserAgent",Te.navigator.userAgent),k(A.metadata,"screenWidth",Te.screen.width),k(A.metadata,"screenHeight",Te.screen.height),k(A.metadata,"windowWidth",Te.innerWidth),k(A.metadata,"windowHeight",Te.innerHeight),k(A.metadata,"mapWidth",h.width/b),k(A.metadata,"mapHeight",h.height/b),k(A.metadata,"webglRenderer",h.renderer),k(A.metadata,"webglVendor",h.vendor),k(A.metadata,"sdkVersion",Yt),k(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(r);for(const h of s.metadata);for(const h of s.counters);for(const h of s.attributes);this.postEvent(e,s,()=>{},n)}},ke=je.postPerformanceEvent.bind(je),ge=new class extends Mn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,r,s){if(!Tt.API_URL||!Tt.SESSION_PATH)return;const h=Ut(Tt.API_URL+Tt.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||Tt.ACCESS_TOKEN||""}`);const p={url:St(h),headers:{"Content-Type":"text/plain"}};var y;this.pendingRequest=(y=m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(s)},gn(gr(p,{method:"GET"}),y))}getSessionAPI(n,e,r,s){this.skuToken=e,this.errorCb=s,Tt.SESSION_PATH&&Tt.API_URL&&(r||Tt.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Ee)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},Ue=ge.getSessionAPI.bind(ge),at=new Set,En={create:"create",load:"load",fullLoad:"fullLoad"},Ln={mark(n){Te.performance.mark(n)},measure(n,e,r){Te.performance.measure(n,e,r)}};function hr(n){const e=n.name.split("?")[0];return Le(e)&&e.includes("mapbox-gl.js")?"javascript":Le(e)&&e.includes("mapbox-gl.css")?"css":Tt.API_FONTS_REGEX.test(e)?"fontRange":$e(e)?"sprite":Ie(e)?"style":Tt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const wt=Te.performance;function On(n){const e=n?n.url.toString():void 0;return wt.getEntriesByName(e)}let Sr,_i,ro,Lr;const xi={now:()=>void 0!==ro?ro:Te.performance.now(),setNow(n){ro=n},restoreNow(){ro=void 0},frame(n){const e=Te.requestAnimationFrame(n);return{cancel:()=>Te.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:s}=n;Lr||(Lr=Te.document.createElement("canvas"));const h=Lr.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(r>Lr.width||s>Lr.height)&&(Lr.width=r,Lr.height=s),h.clearRect(-e,-e,r+2*e,s+2*e),h.drawImage(n,0,0,r,s),h.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:n=>(Sr||(Sr=Te.document.createElement("a")),Sr.href=n,Sr.href),get devicePixelRatio(){return Te.devicePixelRatio},get prefersReducedMotion(){return!!Te.matchMedia&&(null==_i&&(_i=Te.matchMedia("(prefers-reduced-motion: reduce)")),_i.matches)}};function Or(n,e,r){r[n]&&-1!==r[n].indexOf(e)||(r[n]=r[n]||[],r[n].push(e))}function $i(n,e,r){if(r&&r[n]){const s=r[n].indexOf(e);-1!==s&&r[n].splice(s,1)}}class Gi{constructor(e,r={}){gr(this,r),this.type=e}}class zn extends Gi{constructor(e,r={}){super("error",gr({error:e},r))}}class zs{on(e,r){return this._listeners=this._listeners||{},Or(e,r,this._listeners),this}off(e,r){return $i(e,r,this._listeners),$i(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Or(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){"string"==typeof e&&(e=new Gi(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of h)y.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of p)$i(s,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(gr(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof zn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function io(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}function Ir(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function rr(n){if(Array.isArray(n))return n.map(rr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=rr(n[r]);return e}return Ir(n)}class po extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Ai=po;class Ii{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,h]of r)this.bindings[s]=h}concat(e){return new Ii(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Xo=Ii;const So={kind:"null"},Rt={kind:"number"},Gn={kind:"string"},Vn={kind:"boolean"},yi={kind:"color"},bi={kind:"object"},Pn={kind:"value"},Hi={kind:"collator"},mo={kind:"formatted"},qr={kind:"resolvedImage"};function go(n,e){return{kind:"array",itemType:n,N:e}}function sr(n){if("array"===n.kind){const e=sr(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const vi=[So,Rt,Gn,Vn,yi,mo,bi,go(Pn),qr];function Ao(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ao(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const r of vi)if(!Ao(r,e))return null}return`Expected ${sr(n)} but found ${sr(e)} instead.`}function Wr(n,e){return e.some(r=>r.kind===n.kind)}function _o(n,e){return e.some(r=>"null"===r?null===n:"array"===r?Array.isArray(n):"object"===r?n&&!Array.isArray(n)&&"object"==typeof n:r===typeof n)}var Yi,Ga={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ra(n){return(n=Math.round(n))<0?0:n>255?255:n}function ia(n){return ra("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function xa(n){return(e="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function Vs(n,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(e-n)*r*6:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n}try{Yi={}.parseCSSColor=function(n){var e,r=n.replace(/ /g,"").toLowerCase();if(r in Ga)return Ga[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),h=r.indexOf(")");if(-1!==s&&h+1===r.length){var p=r.substr(0,s),m=r.substr(s+1,h-(s+1)).split(","),y=1;switch(p){case"rgba":if(4!==m.length)return null;y=xa(m.pop());case"rgb":return 3!==m.length?null:[ia(m[0]),ia(m[1]),ia(m[2]),y];case"hsla":if(4!==m.length)return null;y=xa(m.pop());case"hsl":if(3!==m.length)return null;var b=(parseFloat(m[0])%360+360)%360/360,w=xa(m[1]),A=xa(m[2]),k=A<=.5?A*(w+1):A+w-A*w,z=2*A-k;return[ra(255*Vs(z,k,b+1/3)),ra(255*Vs(z,k,b)),ra(255*Vs(z,k,b-1/3)),y];default:return null}}return null}}catch{}class oo{constructor(e,r,s,h=1){this.r=e,this.g=r,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof oo)return e;if("string"!=typeof e)return;const r=Yi(e);return r?new oo(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${h})`}toArray(){const{r:e,g:r,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*r/h,255*s/h,h]}toArray01(){const{r:e,g:r,b:s,a:h}=this;return 0===h?[0,0,0,0]:[e/h,r/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:h}=this;return[e,r,s,h]}}oo.black=new oo(0,0,0,1),oo.white=new oo(1,1,1,1),oo.transparent=new oo(0,0,0,0),oo.red=new oo(1,0,0,1),oo.blue=new oo(0,0,1,1);var pi=oo;class Ha{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ml{constructor(e,r,s,h,p){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=h,this.textColor=p}}class Ki{constructor(e){this.sections=e}static fromString(e){return new Ki([new ml(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Ki?e:Ki.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class Io{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Io({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Za(n,e,r,s){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[n,e,r,s]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oa(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof pi||n instanceof Ha||n instanceof Ki||n instanceof Io)return!0;if(Array.isArray(n)){for(const e of n)if(!oa(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!oa(n[e]))return!1;return!0}return!1}function ti(n){if(null===n)return So;if("string"==typeof n)return Gn;if("boolean"==typeof n)return Vn;if("number"==typeof n)return Rt;if(n instanceof pi)return yi;if(n instanceof Ha)return Hi;if(n instanceof Ki)return mo;if(n instanceof Io)return qr;if(Array.isArray(n)){const e=n.length;let r;for(const s of n){const h=ti(s);if(r){if(r===h)continue;r=Pn;break}r=h}return go(r||Pn,e)}return bi}function xs(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof pi||n instanceof Ki||n instanceof Io?n.toString():JSON.stringify(n)}class sa{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(2!==e.length)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!oa(e[1]))return r.error("invalid value");const s=e[1];let h=ti(s);const p=r.expectedType;return"array"!==h.kind||0!==h.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(h=p),new sa(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof pi?["rgba"].concat(this.value.toArray()):this.value instanceof Ki?this.value.serialize():this.value}}var Pi=sa,ci=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const bs={string:Gn,number:Rt,boolean:Vn,object:bi};class os{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,h=1;const p=e[0];if("array"===p){let y,b;if(e.length>2){const w=e[1];if("string"!=typeof w||!(w in bs)||"object"===w)return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=bs[w],h++}else y=Pn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}s=go(y,b)}else s=bs[p];const m=[];for(;h<e.length;h++){const y=r.parse(e[h],h,Pn);if(!y)return null;m.push(y)}return new os(s,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!Ao(this.type,ti(s)))return s;if(r===this.args.length-1)throw new ci(`Expected value to be of type ${sr(this.type)}, but found ${sr(ti(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){r.push(s.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&r.push(h)}}return r.concat(this.args.map(s=>s.serialize()))}}var yo=os;class Zi{constructor(e){this.type=mo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return r.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(p&&"object"==typeof y&&!Array.isArray(y)){p=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,Rt),!b))return null;let w=null;if(y["text-font"]&&(w=r.parse(y["text-font"],1,go(Gn)),!w))return null;let A=null;if(y["text-color"]&&(A=r.parse(y["text-color"],1,yi),!A))return null;const k=h[h.length-1];k.scale=b,k.font=w,k.textColor=A}else{const b=r.parse(e[m],1,Pn);if(!b)return null;const w=b.type.kind;if("string"!==w&&"value"!==w&&"null"!==w&&"resolvedImage"!==w)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Zi(h)}evaluate(e){return new Ki(this.sections.map(r=>{const s=r.content.evaluate(e);return ti(s)===qr?new ml("",s,null,null,null):new ml(xs(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class qa{constructor(e){this.type=qr,this.input=e}static parse(e,r){if(2!==e.length)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Gn);return s?new qa(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=Io.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ss={"to-boolean":Vn,"to-color":yi,"to-number":Rt,"to-string":Gn};class ws{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return r.error("Expected one argument.");const h=ss[s],p=[];for(let m=1;m<e.length;m++){const y=r.parse(e[m],m,Pn);if(!y)return null;p.push(y)}return new ws(h,p)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let r,s;for(const h of this.args){if(r=h.evaluate(e),s=null,r instanceof pi)return r;if("string"==typeof r){const p=e.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Za(r[0],r[1],r[2],r[3]),!s))return new pi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ci(s||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const s of this.args){if(r=s.evaluate(e),null===r)return 0;const h=Number(r);if(!isNaN(h))return h}throw new ci(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?Ki.fromString(xs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Io.fromString(xs(this.args[0].evaluate(e))):xs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Zi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new qa(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var zo=ws;const so=["Unknown","Point","LineString","Polygon"];var Us=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?so[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=pi.parse(n)),e}};class as{constructor(e,r,s,h){this.name=e,this.type=r,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],h=as.definitions[s];if(!h)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=m.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let b=null;for(const[w,A]of y){b=new Nn(r.registry,r.path,null,r.scope);const k=[];let z=!1;for(let G=1;G<e.length;G++){const H=e[G],K=Array.isArray(w)?w[G-1]:w.type,ie=b.parse(H,1+k.length,K);if(!ie){z=!0;break}k.push(ie)}if(!z)if(Array.isArray(w)&&w.length!==k.length)b.error(`Expected ${w.length} arguments, but found ${k.length} instead.`);else{for(let G=0;G<k.length;G++){const H=Array.isArray(w)?w[G]:w.type,K=k[G];b.concat(G+1).checkSubtype(H,K.type)}if(0===b.errors.length)return new as(s,p,A,k)}}if(1===y.length)r.errors.push(...b.errors);else{const w=(y.length?y:m).map(([k])=>{return z=k,Array.isArray(z)?`(${z.map(sr).join(", ")})`:`(${sr(z.type)}...)`;var z}).join(" | "),A=[];for(let k=1;k<e.length;k++){const z=r.parse(e[k],1+A.length);if(!z)return null;A.push(sr(z.type))}r.error(`Expected arguments of type ${w}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){as.definitions=r;for(const s in r)e[s]=as}}var Po=as;class js{constructor(e,r,s){this.type=Hi,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(2!==e.length)return r.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return r.error("Collator options argument must be an object.");const h=r.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Vn);if(!h)return null;const p=r.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Vn);if(!p)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,Gn),!m)?null:new js(h,p,m)}evaluate(e){return new Ha(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const vo=8192;function ba(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function ls(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function wi(n,e){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*vo),Math.round(s*h*vo)]}function Es(n,e,r){const s=n[0]-e[0],h=n[1]-e[1],p=n[0]-r[0],m=n[1]-r[1];return s*m-p*h==0&&s*p<=0&&h*m<=0}function $s(n,e){let r=!1;for(let m=0,y=e.length;m<y;m++){const b=e[m];for(let w=0,A=b.length;w<A-1;w++){if(Es(n,b[w],b[w+1]))return!1;(h=b[w])[1]>(s=n)[1]!=(p=b[w+1])[1]>s[1]&&s[0]<(p[0]-h[0])*(s[1]-h[1])/(p[1]-h[1])+h[0]&&(r=!r)}}var s,h,p;return r}function Ro(n,e){for(let r=0;r<e.length;r++)if($s(n,e[r]))return!0;return!1}function wa(n,e,r,s){const h=s[0]-r[0],p=s[1]-r[1],m=(n[0]-r[0])*p-h*(n[1]-r[1]),y=(e[0]-r[0])*p-h*(e[1]-r[1]);return m>0&&y<0||m<0&&y>0}function aa(n,e,r){for(const w of r)for(let A=0;A<w.length-1;++A)if((y=[(m=w[A+1])[0]-(p=w[A])[0],m[1]-p[1]])[0]*(b=[(h=e)[0]-(s=n)[0],h[1]-s[1]])[1]-y[1]*b[0]!=0&&wa(s,h,p,m)&&wa(p,m,s,h))return!0;var s,h,p,m,y,b;return!1}function cn(n,e){for(let r=0;r<n.length;++r)if(!$s(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(aa(n[r],n[r+1],e))return!1;return!0}function Ea(n,e){for(let r=0;r<e.length;r++)if(cn(n,e[r]))return!0;return!1}function Gs(n,e,r){const s=[];for(let h=0;h<n.length;h++){const p=[];for(let m=0;m<n[h].length;m++){const y=wi(n[h][m],r);ba(e,y),p.push(y)}s.push(p)}return s}function Ca(n,e,r){const s=[];for(let h=0;h<n.length;h++){const p=Gs(n[h],e,r);s.push(p)}return s}function Bi(n,e,r,s){if(n[0]<r[0]||n[0]>r[2]){const h=.5*s;let p=n[0]-r[0]>h?-s:r[0]-n[0]>h?s:0;0===p&&(p=n[0]-r[2]>h?-s:r[2]-n[0]>h?s:0),n[0]+=p}ba(e,n)}function la(n,e,r,s){const h=Math.pow(2,s.z)*vo,p=[s.x*vo,s.y*vo],m=[];if(!n)return m;for(const y of n)for(const b of y){const w=[b.x+p[0],b.y+p[1]];Bi(w,e,r,h),m.push(w)}return m}function Hs(n,e,r,s){const h=Math.pow(2,s.z)*vo,p=[s.x*vo,s.y*vo],m=[];if(!n)return m;for(const b of n){const w=[];for(const A of b){const k=[A.x+p[0],A.y+p[1]];ba(e,k),w.push(k)}m.push(w)}if(e[2]-e[0]<=h/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const w of b)Bi(w,e,r,h)}var y;return m}class Vo{constructor(e,r){this.type=Vn,this.geojson=e,this.geometries=r}static parse(e,r){if(2!==e.length)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(oa(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const p=s.features[h].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new Vo(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Vo(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Vo(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(r,s){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if("Polygon"===s.type){const y=Gs(s.coordinates,p,m),b=la(r.geometry(),h,p,m);if(!ls(h,p))return!1;for(const w of b)if(!$s(w,y))return!1}if("MultiPolygon"===s.type){const y=Ca(s.coordinates,p,m),b=la(r.geometry(),h,p,m);if(!ls(h,p))return!1;for(const w of b)if(!Ro(w,y))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(r,s){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if("Polygon"===s.type){const y=Gs(s.coordinates,p,m),b=Hs(r.geometry(),h,p,m);if(!ls(h,p))return!1;for(const w of b)if(!cn(w,y))return!1}if("MultiPolygon"===s.type){const y=Ca(s.coordinates,p,m),b=Hs(r.geometry(),h,p,m);if(!ls(h,p))return!1;for(const w of b)if(!Ea(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ji=Vo;function ca(n){if(n instanceof Po&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Ji)return!1;let e=!0;return n.eachChild(r=>{e&&!ca(r)&&(e=!1)}),e}function Lo(n){if(n instanceof Po&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(r=>{e&&!Lo(r)&&(e=!1)}),e}function Uo(n,e){if(n instanceof Po&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!Uo(s,e)&&(r=!1)}),r}class ko{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(2!==e.length||"string"!=typeof e[1])return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new ko(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Cs=ko;class Zs{constructor(e,r=[],s,h=new Xo,p=[]){this.registry=e,this.path=r,this.key=r.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=p,this.expectedType=s}parse(e,r,s,h,p={}){return r?this.concat(r,s,h)._parse(e,p):this._parse(e,p)}_parse(e,r){function s(h,p,m){return"assert"===m?new yo(p,[h]):"coerce"===m?new zo(p,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let m=p.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,b=m.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else m=s(m,y,r.typeAnnotation||"coerce");else m=s(m,y,r.typeAnnotation||"assert")}if(!(m instanceof Pi)&&"resolvedImage"!==m.type.kind&&ao(m)){const y=new Us;try{m=new Pi(m.type,m.evaluate(y))}catch(b){return this.error(b.message),null}}return m}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const h="number"==typeof e?this.path.concat(e):this.path,p=s?this.scope.concat(s):this.scope;return new Zs(this.registry,h,r||null,p,this.errors)}error(e,...r){const s=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ai(s,e))}checkSubtype(e,r){const s=Ao(e,r);return s&&this.error(s),s}}var Nn=Zs;function ao(n){if(n instanceof Cs)return ao(n.boundExpression);if(n instanceof Po&&"error"===n.name||n instanceof js||n instanceof Ji)return!1;const e=n instanceof zo||n instanceof yo;let r=!0;return n.eachChild(s=>{r=e?r&&ao(s):r&&s instanceof Pi}),!!r&&ca(n)&&Uo(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Da(n,e){const r=n.length-1;let s,h,p=0,m=r,y=0;for(;p<=m;)if(y=Math.floor((p+m)/2),s=n[y],h=n[y+1],s<=e){if(y===r||e<h)return y;p=y+1}else{if(!(s>e))throw new ci("Input is not a number.");m=y-1}return 0}class Ds{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,p]of s)this.labels.push(h),this.outputs.push(p)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Rt);if(!s)return null;const h=[];let p=null;r.expectedType&&"value"!==r.expectedType.kind&&(p=r.expectedType);for(let m=1;m<e.length;m+=2){const y=1===m?-1/0:e[m],b=e[m+1],w=m,A=m+1;if("number"!=typeof y)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(h.length&&h[h.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const k=r.parse(b,A,p);if(!k)return null;p=p||k.type,h.push([y,k])}return new Ds(p,s,h)}evaluate(e){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return s[0].evaluate(e);const p=r.length;return h>=r[p-1]?s[p-1].evaluate(e):s[Da(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var gl=Ds;function mr(n,e,r){return n*(1-r)+e*r}var qs=Object.freeze({__proto__:null,array:function(n,e,r){return n.map((s,h)=>mr(s,e[h],r))},color:function(n,e,r){return new pi(mr(n.r,e.r,r),mr(n.g,e.g,r),mr(n.b,e.b,r),mr(n.a,e.a,r))},number:mr});const Nt=4/29,Wn=6/29,cs=3*Wn*Wn,Xr=Math.PI/180,Yo=180/Math.PI;function Ni(n){return n>.008856451679035631?Math.pow(n,1/3):n/cs+Nt}function Qi(n){return n>Wn?n*n*n:cs*(n-Nt)}function xo(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function us(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function _c(n){const e=us(n.r),r=us(n.g),s=us(n.b),h=Ni((.4124564*e+.3575761*r+.1804375*s)/.95047),p=Ni((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Ni((.0193339*e+.119192*r+.9503041*s)/1.08883)),alpha:n.a}}function Vl(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*Qi(e),r=.95047*Qi(r),s=1.08883*Qi(s),new pi(xo(3.2404542*r-1.5371385*e-.4985314*s),xo(-.969266*r+1.8760108*e+.041556*s),xo(.0556434*r-.2040259*e+1.0572252*s),n.alpha)}function Zc(n,e,r){const s=e-n;return n+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ta={forward:_c,reverse:Vl,interpolate:function(n,e,r){return{l:mr(n.l,e.l,r),a:mr(n.a,e.a,r),b:mr(n.b,e.b,r),alpha:mr(n.alpha,e.alpha,r)}}},ui={forward:function(n){const{l:e,a:r,b:s}=_c(n),h=Math.atan2(s,r)*Yo;return{h:h<0?h+360:h,c:Math.sqrt(r*r+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Xr,r=n.c;return Vl({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:Zc(n.h,e.h,r),c:mr(n.c,e.c,r),l:mr(n.l,e.l,r),alpha:mr(n.alpha,e.alpha,r)}}};var bo=Object.freeze({__proto__:null,hcl:ui,lab:Ta});class Ko{constructor(e,r,s,h,p){this.type=e,this.operator=r,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[m,y]of p)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,r,s,h){let p=0;if("exponential"===e.name)p=wo(r,e.base,s,h);else if("linear"===e.name)p=wo(r,1,s,h);else if("cubic-bezier"===e.name){const m=e.controlPoints;p=new or(m[0],m[1],m[2],m[3]).solve(wo(r,1,s,h))}return p}static parse(e,r){let[s,h,p,...m]=e;if(!Array.isArray(h)||0===h.length)return r.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const w=h[1];if("number"!=typeof w)return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:w}}else{if("cubic-bezier"!==h[0])return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const w=h.slice(1);if(4!==w.length||w.some(A=>"number"!=typeof A||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,Rt),!p)return null;const y=[];let b=null;"interpolate-hcl"===s||"interpolate-lab"===s?b=yi:r.expectedType&&"value"!==r.expectedType.kind&&(b=r.expectedType);for(let w=0;w<m.length;w+=2){const A=m[w],k=m[w+1],z=w+3,G=w+4;if("number"!=typeof A)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const H=r.parse(k,G,b);if(!H)return null;b=b||H.type,y.push([A,H])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new Ko(b,s,h,p,y):r.error(`Type ${sr(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return s[0].evaluate(e);const p=r.length;if(h>=r[p-1])return s[p-1].evaluate(e);const m=Da(r,h),y=Ko.interpolationFactor(this.interpolation,h,r[m],r[m+1]),b=s[m].evaluate(e),w=s[m+1].evaluate(e);return"interpolate"===this.operator?qs[this.type.kind.toLowerCase()](b,w,y):"interpolate-hcl"===this.operator?ui.reverse(ui.interpolate(ui.forward(b),ui.forward(w),y)):Ta.reverse(Ta.interpolate(Ta.forward(b),Ta.forward(w),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function wo(n,e,r,s){const h=s-r,p=n-r;return 0===h?0:1===e?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}var Ei=Ko;class Ma{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const h=r.expectedType;h&&"value"!==h.kind&&(s=h);const p=[];for(const y of e.slice(1)){const b=r.parse(y,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,p.push(b)}const m=h&&p.some(y=>Ao(h,y.type));return new Ma(m?Pn:s,p)}evaluate(e){let r,s=null,h=0;for(const p of this.args){if(h++,s=p.evaluate(e),s&&s instanceof Io&&!s.available&&(r||(r=s),s=null,h===this.args.length))return r;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Xa=Ma;class Ws{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if("string"!=typeof m)return r.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const y=r.parse(e[p+1],p+1);if(!y)return null;s.push([m,y])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return h?new Ws(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}var Ul=Ws;class Sa{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Rt),h=r.parse(e[2],2,go(r.expectedType||Pn));return s&&h?new Sa(h.type.itemType,s,h):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new ci(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new ci(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new ci(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ya=Sa;class B{constructor(e,r){this.type=Vn,this.needle=e,this.haystack=r}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Pn),h=r.parse(e[2],2,Pn);return s&&h?Wr(s.type,[Vn,Gn,Rt,So,Pn])?new B(s,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!_o(r,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${sr(ti(r))} instead.`);if(!_o(s,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${sr(ti(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var J=B;class ${constructor(e,r,s){this.type=Rt,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Pn),h=r.parse(e[2],2,Pn);if(!s||!h)return null;if(!Wr(s.type,[Vn,Gn,Rt,So,Pn]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${sr(s.type)} instead`);if(4===e.length){const p=r.parse(e[3],3,Rt);return p?new $(s,h,p):null}return new $(s,h)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!_o(r,["boolean","string","number","null"]))throw new ci(`Expected first argument to be of type boolean, string, number or null, but found ${sr(ti(r))} instead.`);if(!_o(s,["string","array"]))throw new ci(`Expected second argument to be of type array or string, but found ${sr(ti(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(r,h)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var re=$;class Ae{constructor(e,r,s,h,p,m){this.inputType=e,this.type=r,this.input=s,this.cases=h,this.outputs=p,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,h;r.expectedType&&"value"!==r.expectedType.kind&&(h=r.expectedType);const p={},m=[];for(let w=2;w<e.length-1;w+=2){let A=e[w];const k=e[w+1];Array.isArray(A)||(A=[A]);const z=r.concat(w);if(0===A.length)return z.error("Expected at least one branch label.");for(const H of A){if("number"!=typeof H&&"string"!=typeof H)return z.error("Branch labels must be numbers or strings.");if("number"==typeof H&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof H&&Math.floor(H)!==H)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,ti(H)))return null}else s=ti(H);if(void 0!==p[String(H)])return z.error("Branch labels must be unique.");p[String(H)]=m.length}const G=r.parse(k,w,h);if(!G)return null;h=h||G.type,m.push(G)}const y=r.parse(e[1],1,Pn);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,h);return b?"value"!==y.type.kind&&r.concat(1).checkSubtype(s,y.type)?null:new Ae(s,h,y,p,m,b):null}evaluate(e){const r=this.input.evaluate(e);return(ti(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],h={};for(const m of r){const y=h[this.cases[m]];void 0===y?(h[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[y][1].push(m)}const p=m=>"number"===this.inputType.kind?Number(m):m;for(const[m,y]of s)e.push(1===y.length?p(y[0]):y.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var it=Ae;class At{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&"value"!==r.expectedType.kind&&(s=r.expectedType);const h=[];for(let m=1;m<e.length-1;m+=2){const y=r.parse(e[m],m,Vn);if(!y)return null;const b=r.parse(e[m+1],m+1,s);if(!b)return null;h.push([y,b]),s=s||b.type}const p=r.parse(e[e.length-1],e.length-1,s);return p?new At(s,h,p):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var un=At;class yr{constructor(e,r,s,h){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Pn),h=r.parse(e[2],2,Rt);if(!s||!h)return null;if(!Wr(s.type,[go(Pn),Gn,Pn]))return r.error(`Expected first argument to be of type array or string, but found ${sr(s.type)} instead`);if(4===e.length){const p=r.parse(e[3],3,Rt);return p?new yr(s.type,s,h,p):null}return new yr(s.type,s,h)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!_o(r,["string","array"]))throw new ci(`Expected first argument to be of type array or string, but found ${sr(ti(r))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return r.slice(s,h)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var wr=yr;function Dr(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function dr(n,e,r,s){return 0===s.compare(e,r)}function nr(n,e,r){const s="=="!==n&&"!="!==n;return class Cx{constructor(p,m,y){this.type=Vn,this.lhs=p,this.rhs=m,this.collator=y,this.hasUntypedArgument="value"===p.type.kind||"value"===m.type.kind}static parse(p,m){if(3!==p.length&&4!==p.length)return m.error("Expected two or three arguments.");const y=p[0];let b=m.parse(p[1],1,Pn);if(!b)return null;if(!Dr(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${sr(b.type)}'.`);let w=m.parse(p[2],2,Pn);if(!w)return null;if(!Dr(y,w.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${sr(w.type)}'.`);if(b.type.kind!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return m.error(`Cannot compare types '${sr(b.type)}' and '${sr(w.type)}'.`);s&&("value"===b.type.kind&&"value"!==w.type.kind?b=new yo(w.type,[b]):"value"!==b.type.kind&&"value"===w.type.kind&&(w=new yo(b.type,[w])));let A=null;if(4===p.length){if("string"!==b.type.kind&&"string"!==w.type.kind&&"value"!==b.type.kind&&"value"!==w.type.kind)return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(p[3],3,Hi),!A)return null}return new Cx(b,w,A)}evaluate(p){const m=this.lhs.evaluate(p),y=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const b=ti(m),w=ti(y);if(b.kind!==w.kind||"string"!==b.kind&&"number"!==b.kind)throw new ci(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=ti(m),w=ti(y);if("string"!==b.kind||"string"!==w.kind)return e(p,m,y)}return this.collator?r(p,m,y,this.collator.evaluate(p)):e(p,m,y)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[n];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const br=nr("==",function(n,e,r){return e===r},dr),ar=nr("!=",function(n,e,r){return e!==r},function(n,e,r,s){return!dr(0,e,r,s)}),Oo=nr("<",function(n,e,r){return e<r},function(n,e,r,s){return s.compare(e,r)<0}),lo=nr(">",function(n,e,r){return e>r},function(n,e,r,s){return s.compare(e,r)>0}),Ts=nr("<=",function(n,e,r){return e<=r},function(n,e,r,s){return s.compare(e,r)<=0}),co=nr(">=",function(n,e,r){return e>=r},function(n,e,r,s){return s.compare(e,r)>=0});class hs{constructor(e,r,s,h,p,m){this.type=Gn,this.number=e,this.locale=r,this.currency=s,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,r){if(3!==e.length)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Rt);if(!s)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=r.parse(h.locale,1,Gn),!p))return null;let m=null;if(h.currency&&(m=r.parse(h.currency,1,Gn),!m))return null;let y=null;if(h.unit&&(y=r.parse(h.unit,1,Gn),!y))return null;let b=null;if(h["min-fraction-digits"]&&(b=r.parse(h["min-fraction-digits"],1,Rt),!b))return null;let w=null;return h["max-fraction-digits"]&&(w=r.parse(h["max-fraction-digits"],1,Rt),!w)?null:new hs(s,p,m,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ds{constructor(e){this.type=Rt,this.input=e}static parse(e,r){if(2!==e.length)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?r.error(`Expected argument of type string or array, but found ${sr(s.type)} instead.`):new ds(s):null}evaluate(e){const r=this.input.evaluate(e);if("string"==typeof r||Array.isArray(r))return r.length;throw new ci(`Expected value to be of type string or array, but found ${sr(ti(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const Xs={"==":br,"!=":ar,">":lo,"<":Oo,">=":co,"<=":Ts,array:yo,at:Ya,boolean:yo,case:un,coalesce:Xa,collator:js,format:Zi,image:qa,in:J,"index-of":re,interpolate:Ei,"interpolate-hcl":Ei,"interpolate-lab":Ei,length:ds,let:Ul,literal:Pi,match:it,number:yo,"number-format":hs,object:yo,slice:wr,step:gl,string:yo,"to-boolean":zo,"to-color":zo,"to-number":zo,"to-string":zo,var:Cs,within:Ji};function j(n,[e,r,s,h]){e=e.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const p=h?h.evaluate(n):1,m=Za(e,r,s,p);if(m)throw new ci(m);return new pi(e/255*p,r/255*p,s/255*p,p)}function F(n,e){return n in e}function R(n,e){const r=e[n];return void 0===r?null:r}function Q(n){return{type:n}}Po.register(Xs,{error:[{kind:"error"},[Gn],(n,[e])=>{throw new ci(e.evaluate(n))}],typeof:[Gn,[Pn],(n,[e])=>sr(ti(e.evaluate(n)))],"to-rgba":[go(Rt,4),[yi],(n,[e])=>e.evaluate(n).toArray()],rgb:[yi,[Rt,Rt,Rt],j],rgba:[yi,[Rt,Rt,Rt,Rt],j],has:{type:Vn,overloads:[[[Gn],(n,[e])=>F(e.evaluate(n),n.properties())],[[Gn,bi],(n,[e,r])=>F(e.evaluate(n),r.evaluate(n))]]},get:{type:Pn,overloads:[[[Gn],(n,[e])=>R(e.evaluate(n),n.properties())],[[Gn,bi],(n,[e,r])=>R(e.evaluate(n),r.evaluate(n))]]},"feature-state":[Pn,[Gn],(n,[e])=>R(e.evaluate(n),n.featureState||{})],properties:[bi,[],n=>n.properties()],"geometry-type":[Gn,[],n=>n.geometryType()],id:[Pn,[],n=>n.id()],zoom:[Rt,[],n=>n.globals.zoom],pitch:[Rt,[],n=>n.globals.pitch||0],"distance-from-center":[Rt,[],n=>n.distanceFromCenter()],"heatmap-density":[Rt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Rt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[Rt,[],n=>n.globals.skyRadialProgress||0],accumulated:[Pn,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[Rt,Q(Rt),(n,e)=>{let r=0;for(const s of e)r+=s.evaluate(n);return r}],"*":[Rt,Q(Rt),(n,e)=>{let r=1;for(const s of e)r*=s.evaluate(n);return r}],"-":{type:Rt,overloads:[[[Rt,Rt],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[Rt],(n,[e])=>-e.evaluate(n)]]},"/":[Rt,[Rt,Rt],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[Rt,[Rt,Rt],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[Rt,[],()=>Math.LN2],pi:[Rt,[],()=>Math.PI],e:[Rt,[],()=>Math.E],"^":[Rt,[Rt,Rt],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[Rt,[Rt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Rt,[Rt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Rt,[Rt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Rt,[Rt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Rt,[Rt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Rt,[Rt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Rt,[Rt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Rt,[Rt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Rt,[Rt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Rt,[Rt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Rt,Q(Rt),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[Rt,Q(Rt),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[Rt,[Rt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Rt,[Rt],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[Rt,[Rt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Rt,[Rt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Vn,[Gn,Pn],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[Vn,[Pn],(n,[e])=>n.id()===e.value],"filter-type-==":[Vn,[Gn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Vn,[Gn,Pn],(n,[e,r])=>{const s=n.properties()[e.value],h=r.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Vn,[Pn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Vn,[Gn,Pn],(n,[e,r])=>{const s=n.properties()[e.value],h=r.value;return typeof s==typeof h&&s>h}],"filter-id->":[Vn,[Pn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Vn,[Gn,Pn],(n,[e,r])=>{const s=n.properties()[e.value],h=r.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Vn,[Pn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Vn,[Gn,Pn],(n,[e,r])=>{const s=n.properties()[e.value],h=r.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Vn,[Pn],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Vn,[Pn],(n,[e])=>e.value in n.properties()],"filter-has-id":[Vn,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[Vn,[go(Gn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Vn,[go(Pn)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Vn,[Gn,go(Pn)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Vn,[Gn,go(Pn)],(n,[e,r])=>function(s,h,p,m){for(;p<=m;){const y=p+m>>1;if(h[y]===s)return!0;h[y]>s?m=y-1:p=y+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Vn,overloads:[[[Vn,Vn],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[Q(Vn),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Vn,overloads:[[[Vn,Vn],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[Q(Vn),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[Vn,[Vn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Vn,[Gn],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[Gn,[Gn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Gn,[Gn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Gn,Q(Pn),(n,e)=>e.map(r=>xs(r.evaluate(n))).join("")],"resolved-locale":[Gn,[Hi],(n,[e])=>e.evaluate(n).resolvedLocale()]});var Ve=Xs;function Jt(n){return{result:"success",value:n}}function fr(n){return{result:"error",value:n}}function Ri(n){return"data-driven"===n["property-type"]}function jo(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ci(n){return!!n.expression&&n.expression.interpolated}function Jn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function Ys(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function yc(n){return n}function vc(n,e){const r="color"===e.type,s=n.stops&&"object"==typeof n.stops[0][0],h=s||!(s||void 0!==n.property),p=n.type||(Ci(e)?"exponential":"interval");if(r&&((n=io({},n)).stops&&(n.stops=n.stops.map(w=>[w[0],pi.parse(w[1])])),n.default=pi.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!bo[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,y,b;if("exponential"===p)m=Ms;else if("interval"===p)m=xl;else if("categorical"===p){m=vl,y=Object.create(null);for(const w of n.stops)y[w[0]]=w[1];b=typeof n.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);m=jl}if(s){const w={},A=[];for(let G=0;G<n.stops.length;G++){const H=n.stops[G],K=H[0].zoom;void 0===w[K]&&(w[K]={zoom:K,type:n.type,property:n.property,default:n.default,stops:[]},A.push(K)),w[K].stops.push([H[0].value,H[1]])}const k=[];for(const G of A)k.push([w[G].zoom,vc(w[G],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Ei.interpolationFactor.bind(void 0,z),zoomStops:k.map(G=>G[0]),evaluate:({zoom:G},H)=>Ms({stops:k,base:n.base},e,G).evaluate(G,H)}}if(h){const w="exponential"===p?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:Ei.interpolationFactor.bind(void 0,w),zoomStops:n.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(n,e,A,y,b)}}return{kind:"source",evaluate(w,A){const k=A&&A.properties?A.properties[n.property]:void 0;return void 0===k?yl(n.default,e.default):m(n,e,k,y,b)}}}function yl(n,e,r){return void 0!==n?n:void 0!==e?e:void 0!==r?r:void 0}function vl(n,e,r,s,h){return yl(typeof r===h?s[r]:void 0,n.default,e.default)}function xl(n,e,r){if("number"!==Jn(r))return yl(n.default,e.default);const s=n.stops.length;if(1===s||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const h=Da(n.stops.map(p=>p[0]),r);return n.stops[h][1]}function Ms(n,e,r){const s=void 0!==n.base?n.base:1;if("number"!==Jn(r))return yl(n.default,e.default);const h=n.stops.length;if(1===h||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const p=Da(n.stops.map(A=>A[0]),r),m=function(A,k,z,G){const H=G-z,K=A-z;return 0===H?0:1===k?K/H:(Math.pow(k,K)-1)/(Math.pow(k,H)-1)}(r,s,n.stops[p][0],n.stops[p+1][0]),y=n.stops[p][1],b=n.stops[p+1][1];let w=qs[e.type]||yc;if(n.colorSpace&&"rgb"!==n.colorSpace){const A=bo[n.colorSpace];w=(k,z)=>A.reverse(A.interpolate(A.forward(k),A.forward(z),m))}return"function"==typeof y.evaluate?{evaluate(...A){const k=y.evaluate.apply(void 0,A),z=b.evaluate.apply(void 0,A);if(void 0!==k&&void 0!==z)return w(k,z,m)}}:w(y,b,m)}function jl(n,e,r){return"color"===e.type?r=pi.parse(r):"formatted"===e.type?r=Ki.fromString(r.toString()):"resolvedImage"===e.type?r=Io.fromString(r.toString()):Jn(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),yl(r,n.default,e.default)}class $l{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new Us,this._defaultValue=r?"color"===(s=r).type&&(Ys(s.default)||Array.isArray(s.default))?new pi(0,0,0,0):"color"===s.type?pi.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(e,r,s,h,p,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,h,p,m,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const w=this.expression.evaluate(this._evaluator);if(null==w||"number"==typeof w&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ci(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Ka(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in Ve}function Ss(n,e){const r=new Nn(Ve,[],e?function(h){const p={color:yi,string:Gn,number:Rt,enum:Gn,boolean:Vn,formatted:mo,resolvedImage:qr};return"array"===h.type?go(p[h.value]||Pn,h.length):p[h.type]}(e):void 0),s=r.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Jt(new $l(s,e)):fr(r.errors)}class qc{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent="constant"!==e&&!Lo(r.expression)}evaluateWithoutErrorHandling(e,r,s,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,h,p,m)}evaluate(e,r,s,h,p,m){return this._styleExpression.evaluate(e,r,s,h,p,m)}}class Ks{constructor(e,r,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent="camera"!==e&&!Lo(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,s,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,h,p,m)}evaluate(e,r,s,h,p,m){return this._styleExpression.evaluate(e,r,s,h,p,m)}interpolationFactor(e,r,s){return this.interpolationType?Ei.interpolationFactor(this.interpolationType,e,r,s):0}}function Aa(n,e){if("error"===(n=Ss(n,e)).result)return n;const r=n.value.expression,s=ca(r);if(!s&&!Ri(e))return fr([new Ai("","data expressions not supported")]);const h=Uo(r,["zoom","pitch","distance-from-center"]);if(!h&&!jo(e))return fr([new Ai("","zoom expressions not supported")]);const p=xc(r);return p||h?p instanceof Ai?fr([p]):p instanceof Ei&&!Ci(e)?fr([new Ai("",'"interpolate" expressions cannot be used with this property')]):Jt(p?new Ks(s?"camera":"composite",n.value,p.labels,p instanceof Ei?p.interpolation:void 0):new qc(s?"constant":"source",n.value)):fr([new Ai("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ua{constructor(e,r){this._parameters=e,this._specification=r,io(this,vc(this._parameters,this._specification))}static deserialize(e){return new ua(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function xc(n){let e=null;if(n instanceof Ul)e=xc(n.result);else if(n instanceof Xa){for(const r of n.args)if(e=xc(r),e)break}else(n instanceof gl||n instanceof Ei)&&n.input instanceof Po&&"zoom"===n.input.name&&(e=n);return e instanceof Ai||n.eachChild(r=>{const s=xc(r);s instanceof Ai?e=s:!e&&s?e=new Ai("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Ai("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class en{constructor(e,r,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),null!=r&&r.__line__&&(this.line=r.__line__)}}function As(n){const e=n.key,r=n.value,s=n.valueSpec||{},h=n.objectElementValidators||{},p=n.style,m=n.styleSpec;let y=[];const b=Jn(r);if("object"!==b)return[new en(e,r,`object expected, ${b} found`)];for(const w in r){const A=w.split(".")[0];let k;h[A]?k=h[A]:s[A]?k=ki:h["*"]?k=h["*"]:s["*"]&&(k=ki),k?y=y.concat(k({key:(e&&`${e}.`)+w,value:r[w],valueSpec:s[A]||s["*"],style:p,styleSpec:m,object:r,objectKey:w},r)):y.push(new en(e,r[w],`unknown property "${w}"`))}for(const w in s)h[w]||s[w].required&&void 0===s[w].default&&void 0===r[w]&&y.push(new en(e,r,`missing required property "${w}"`));return y}function Cu(n){const e=n.value,r=n.valueSpec,s=n.style,h=n.styleSpec,p=n.key,m=n.arrayElementValidator||ki;if("array"!==Jn(e))return[new en(p,e,`array expected, ${Jn(e)} found`)];if(r.length&&e.length!==r.length)return[new en(p,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new en(p,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};h.$version<7&&(y.function=r.function),"object"===Jn(r.value)&&(y=r.value);let b=[];for(let w=0;w<e.length;w++)b=b.concat(m({array:e,arrayIndex:w,value:e[w],valueSpec:y,style:s,styleSpec:h,key:`${p}[${w}]`}));return b}function $o(n){const e=n.key,r=n.value,s=n.valueSpec;let h=Jn(r);if("number"===h&&r!=r&&(h="NaN"),"number"!==h)return[new en(e,r,`number expected, ${h} found`)];if("minimum"in s){let p=s.minimum;if("array"===Jn(s.minimum)&&(p=s.minimum[n.arrayIndex]),r<p)return[new en(e,r,`${r} is less than the minimum value ${p}`)]}if("maximum"in s){let p=s.maximum;if("array"===Jn(s.maximum)&&(p=s.maximum[n.arrayIndex]),r>p)return[new en(e,r,`${r} is greater than the maximum value ${p}`)]}return[]}function Gl(n){const e=n.valueSpec,r=Ir(n.value.type);let s,h,p,m={};const y="categorical"!==r&&void 0===n.value.property,b=!y,w="array"===Jn(n.value.stops)&&"array"===Jn(n.value.stops[0])&&"object"===Jn(n.value.stops[0][0]),A=As({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(G){if("identity"===r)return[new en(G.key,G.value,'identity function may not have a "stops" property')];let H=[];const K=G.value;return H=H.concat(Cu({key:G.key,value:K,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:k})),"array"===Jn(K)&&0===K.length&&H.push(new en(G.key,K,"array must have at least one stop")),H},default:function(G){return ki({key:G.key,value:G.value,valueSpec:e,style:G.style,styleSpec:G.styleSpec})}}});return"identity"===r&&y&&A.push(new en(n.key,n.value,'missing required property "property"')),"identity"===r||n.value.stops||A.push(new en(n.key,n.value,'missing required property "stops"')),"exponential"===r&&n.valueSpec.expression&&!Ci(n.valueSpec)&&A.push(new en(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(b&&!Ri(n.valueSpec)?A.push(new en(n.key,n.value,"property functions not supported")):y&&!jo(n.valueSpec)&&A.push(new en(n.key,n.value,"zoom functions not supported"))),"categorical"!==r&&!w||void 0!==n.value.property||A.push(new en(n.key,n.value,'"property" property is required')),A;function k(G){let H=[];const K=G.value,ie=G.key;if("array"!==Jn(K))return[new en(ie,K,`array expected, ${Jn(K)} found`)];if(2!==K.length)return[new en(ie,K,`array length 2 expected, length ${K.length} found`)];if(w){if("object"!==Jn(K[0]))return[new en(ie,K,`object expected, ${Jn(K[0])} found`)];if(void 0===K[0].zoom)return[new en(ie,K,"object stop key must have zoom")];if(void 0===K[0].value)return[new en(ie,K,"object stop key must have value")];const ue=Ir(K[0].zoom);if("number"!=typeof ue)return[new en(ie,K[0].zoom,"stop zoom values must be numbers")];if(p&&p>ue)return[new en(ie,K[0].zoom,"stop zoom values must appear in ascending order")];ue!==p&&(p=ue,h=void 0,m={}),H=H.concat(As({key:`${ie}[0]`,value:K[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:$o,value:z}}))}else H=H.concat(z({key:`${ie}[0]`,value:K[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},K));return Ka(rr(K[1]))?H.concat([new en(`${ie}[1]`,K[1],"expressions are not allowed in function stops.")]):H.concat(ki({key:`${ie}[1]`,value:K[1],valueSpec:e,style:G.style,styleSpec:G.styleSpec}))}function z(G,H){const K=Jn(G.value),ie=Ir(G.value),ue=null!==G.value?G.value:H;if(s){if(K!==s)return[new en(G.key,ue,`${K} stop domain type must match previous stop domain type ${s}`)]}else s=K;if("number"!==K&&"string"!==K&&"boolean"!==K&&"number"!=typeof ie&&"string"!=typeof ie&&"boolean"!=typeof ie)return[new en(G.key,ue,"stop domain value must be a number, string, or boolean")];if("number"!==K&&"categorical"!==r){let be=`number expected, ${K} found`;return Ri(e)&&void 0===r&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new en(G.key,ue,be)]}return"categorical"!==r||"number"!==K||"number"==typeof ie&&isFinite(ie)&&Math.floor(ie)===ie?"categorical"!==r&&"number"===K&&"number"==typeof ie&&"number"==typeof h&&void 0!==h&&ie<h?[new en(G.key,ue,"stop domain values must appear in ascending order")]:(h=ie,"categorical"===r&&ie in m?[new en(G.key,ue,"stop domain values must be unique")]:(m[ie]=!0,[])):[new en(G.key,ue,`integer expected, found ${String(ie)}`)]}}function Di(n){const e=("property"===n.expressionContext?Aa:Ss)(rr(n.value),n.valueSpec);if("error"===e.result)return e.value.map(s=>new en(`${n.key}${s.key}`,n.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!r.outputDefined())return[new en(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!Lo(r))return[new en(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return Js(r,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Uo(r,["zoom","feature-state"]))return[new en(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!ca(r))return[new en(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Js(n,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)r.delete(h);if(0===r.size)return[];const s=[];return n instanceof Po&&r.has(n.name)?[new en(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(h=>{s.push(...Js(h,e))}),s)}function Ja(n){const e=n.key,r=n.value,s=n.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(Ir(r))&&h.push(new en(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(s.values).indexOf(Ir(r))&&h.push(new en(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Ia(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ia(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ha(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ia(n)||(n=da(n));const r=n;let s=!0;try{s=function(w){if(!Qs(w))return w;let A=rr(w);return Hl(A),A=Du(A),A}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const h=rt[`filter_${e}`],p=Ss(s,h);let m=null;if("error"===p.result)throw new Error(p.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,A,k)=>p.value.evaluate(w,A,{},k);let y=null,b=null;if(s!==r){const w=Ss(r,h);if("error"===w.result)throw new Error(w.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,k,z,G,H)=>w.value.evaluate(A,k,{},z,void 0,void 0,G,H),b=!ca(w.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:Mu(s),needFeature:!!b}}function Du(n){if(!Array.isArray(n))return n;const e=function(r){if(bc.has(r[0]))for(let s=1;s<r.length;s++)if(Qs(r[s]))return!0;return r}(n);return!0===e?e:e.map(r=>Du(r))}function Hl(n){let e=!1;const r=[];if("case"===n[0]){for(let s=1;s<n.length-1;s+=2)e=e||Qs(n[s]),r.push(n[s+1]);r.push(n[n.length-1])}else if("match"===n[0]){e=e||Qs(n[1]);for(let s=2;s<n.length-1;s+=2)r.push(n[s+1]);r.push(n[n.length-1])}else if("step"===n[0]){e=e||Qs(n[1]);for(let s=1;s<n.length-1;s+=2)r.push(n[s+1])}e&&(n.length=0,n.push("any",...r));for(let s=1;s<n.length;s++)Hl(n[s])}function Qs(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let r=1;r<n.length;r++)if(Qs(n[r]))return!0;return!1}const bc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Tu(n,e){return n<e?-1:n>e?1:0}function Mu(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(Mu(n[e]))return!0;return!1}function da(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?Qa(n[1],n[2],"=="):"!="===e?Zl(Qa(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Qa(n[1],n[2],e):"any"===e?(r=n.slice(1),["any"].concat(r.map(da))):"all"===e?["all"].concat(n.slice(1).map(da)):"none"===e?["all"].concat(n.slice(1).map(da).map(Zl)):"in"===e?wc(n[1],n.slice(2)):"!in"===e?Zl(wc(n[1],n.slice(2))):"has"===e?Li(n[1]):"!has"===e?Zl(Li(n[1])):"within"!==e||n;var r}function Qa(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function wc(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Tu)]]:["filter-in-small",n,["literal",e]]}}function Li(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Zl(n){return["!",n]}function Is(n){return Ia(rr(n.value))?Di(io({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Pa(n)}function Pa(n){const e=n.value,r=n.key;if("array"!==Jn(e))return[new en(r,e,`array expected, ${Jn(e)} found`)];const s=n.styleSpec;let h,p=[];if(e.length<1)return[new en(r,e,"filter array must have at least 1 element")];switch(p=p.concat(Ja({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Ir(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Ir(e[1])&&p.push(new en(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&p.push(new en(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Jn(e[1]),"string"!==h&&p.push(new en(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let m=2;m<e.length;m++)h=Jn(e[m]),"$type"===Ir(e[1])?p=p.concat(Ja({key:`${r}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&p.push(new en(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)p=p.concat(Pa({key:`${r}[${m}]`,value:e[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Jn(e[1]),2!==e.length?p.push(new en(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&p.push(new en(`${r}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Jn(e[1]),2!==e.length?p.push(new en(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&p.push(new en(`${r}[1]`,e[1],`object expected, ${h} found`))}return p}function el(n,e){const r=n.key,s=n.style,h=n.styleSpec,p=n.value,m=n.objectKey,y=h[`${e}_${n.layerType}`];if(!y)return[];const b=m.match(/^(.*)-transition$/);if("paint"===e&&b&&y[b[1]]&&y[b[1]].transition)return ki({key:r,value:p,valueSpec:h.transition,style:s,styleSpec:h});const w=n.valueSpec||y[m];if(!w)return[new en(r,p,`unknown property "${m}"`)];let A;if("string"===Jn(p)&&Ri(w)&&!w.tokens&&(A=/^{([^}]+)}$/.exec(p))){const z=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new en(r,p,`"${m}" does not support interpolation syntax\nUse an identity property function instead: ${z}.`)]}const k=[];return"symbol"===n.layerType&&("text-field"===m&&s&&!s.glyphs&&k.push(new en(r,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===m&&Ys(rr(p))&&"identity"===Ir(p.type)&&k.push(new en(r,p,'"text-font" does not support identity functions'))),k.concat(ki({key:n.key,value:p,valueSpec:w,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:m}))}function ql(n){return el(n,"paint")}function Wc(n){return el(n,"layout")}function Ec(n){let e=[];const r=n.value,s=n.key,h=n.style,p=n.styleSpec;r.type||r.ref||e.push(new en(s,r,'either "type" or "ref" is required'));let m=Ir(r.type);const y=Ir(r.ref);if(r.id){const b=Ir(r.id);for(let w=0;w<n.arrayIndex;w++){const A=h.layers[w];Ir(A.id)===b&&e.push(new en(s,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(w=>{w in r&&e.push(new en(s,r[w],`"${w}" is prohibited for ref layers`))}),h.layers.forEach(w=>{Ir(w.id)===y&&(b=w)}),b?b.ref?e.push(new en(s,r.ref,"ref cannot reference another ref layer")):m=Ir(b.type):"string"==typeof y&&e.push(new en(s,r.ref,`ref layer "${y}" not found`))}else if("background"!==m&&"sky"!==m)if(r.source){const b=h.sources&&h.sources[r.source],w=b&&Ir(b.type);b?"vector"===w&&"raster"===m?e.push(new en(s,r.source,`layer "${r.id}" requires a raster source`)):"raster"===w&&"raster"!==m?e.push(new en(s,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==w||r["source-layer"]?"raster-dem"===w&&"hillshade"!==m?e.push(new en(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==m||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===w&&b.lineMetrics||e.push(new en(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new en(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new en(s,r.source,`source "${r.source}" not found`))}else e.push(new en(s,r,'missing required property "source"'));return e=e.concat(As({key:s,value:r,valueSpec:p.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ki({key:`${s}.type`,value:r.type,valueSpec:p.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:b=>Is(io({layerType:m},b)),layout:b=>As({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>Wc(io({layerType:m},w))}}),paint:b=>As({layer:r,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":w=>ql(io({layerType:m},w))}})}})),e}function fa(n){const e=n.value,r=n.key,s=Jn(e);return"string"!==s?[new en(r,e,`string expected, ${s} found`)]:[]}const bl={promoteId:function({key:n,value:e}){if("string"===Jn(e))return fa({key:n,value:e});{const r=[];for(const s in e)r.push(...fa({key:`${n}.${s}`,value:e[s]}));return r}}};function tl(n){const e=n.value,r=n.key,s=n.styleSpec,h=n.style;if(!e.type)return[new en(r,e,'"type" is required')];const p=Ir(e.type);let m;switch(p){case"vector":case"raster":case"raster-dem":return m=As({key:r,value:e,valueSpec:s[`source_${p.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:bl}),m;case"geojson":if(m=As({key:r,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:bl}),e.cluster)for(const y in e.clusterProperties){const[b,w]=e.clusterProperties[y],A="string"==typeof b?[b,["accumulated"],["get",y]]:b;m.push(...Di({key:`${r}.${y}.map`,value:w,expressionContext:"cluster-map"})),m.push(...Di({key:`${r}.${y}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return m;case"video":return As({key:r,value:e,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return As({key:r,value:e,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new en(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ja({key:`${r}.type`,value:e.type,valueSpec:{values:Ra(s)},style:h,styleSpec:s})}}function Ra(n){return n.source.reduce((e,r)=>{const s=n[r];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function Cc(n){const e=n.value,r=n.styleSpec,s=r.light,h=n.style;let p=[];const m=Jn(e);if(void 0===e)return p;if("object"!==m)return p=p.concat([new en("light",e,`object expected, ${m} found`)]),p;for(const y in e){const b=y.match(/^(.*)-transition$/);p=p.concat(b&&s[b[1]]&&s[b[1]].transition?ki({key:y,value:e[y],valueSpec:r.transition,style:h,styleSpec:r}):s[y]?ki({key:y,value:e[y],valueSpec:s[y],style:h,styleSpec:r}):[new en(y,e[y],`unknown property "${y}"`)])}return p}function La(n){const e=n.value,r=n.key,s=n.style,h=n.styleSpec,p=h.terrain;let m=[];const y=Jn(e);if(void 0===e)return m;if("object"!==y)return m=m.concat([new en("terrain",e,`object expected, ${y} found`)]),m;for(const b in e){const w=b.match(/^(.*)-transition$/);m=m.concat(w&&p[w[1]]&&p[w[1]].transition?ki({key:b,value:e[b],valueSpec:h.transition,style:s,styleSpec:h}):p[b]?ki({key:b,value:e[b],valueSpec:p[b],style:s,styleSpec:h}):[new en(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=s.sources&&s.sources[e.source],w=b&&Ir(b.type);b?"raster-dem"!==w&&m.push(new en(r,e.source,`terrain cannot be used with a source of type ${String(w)}, it only be used with a "raster-dem" source type`)):m.push(new en(r,e.source,`source "${e.source}" not found`))}else m.push(new en(r,e,'terrain is missing required property "source"'));return m}function wl(n){const e=n.value,r=n.style,s=n.styleSpec,h=s.fog;let p=[];const m=Jn(e);if(void 0===e)return p;if("object"!==m)return p=p.concat([new en("fog",e,`object expected, ${m} found`)]),p;for(const y in e){const b=y.match(/^(.*)-transition$/);p=p.concat(b&&h[b[1]]&&h[b[1]].transition?ki({key:y,value:e[y],valueSpec:s.transition,style:r,styleSpec:s}):h[y]?ki({key:y,value:e[y],valueSpec:h[y],style:r,styleSpec:s}):[new en(y,e[y],`unknown property "${y}"`)])}return p}const Su={"*":()=>[],array:Cu,boolean:function(n){const e=n.value,r=n.key,s=Jn(e);return"boolean"!==s?[new en(r,e,`boolean expected, ${s} found`)]:[]},number:$o,color:function(n){const e=n.key,r=n.value,s=Jn(r);return"string"!==s?[new en(e,r,`color expected, ${s} found`)]:null===Yi(r)?[new en(e,r,`color expected, "${r}" found`)]:[]},enum:Ja,filter:Is,function:Gl,layer:Ec,object:As,source:tl,light:Cc,terrain:La,fog:wl,string:fa,formatted:function(n){return 0===fa(n).length?[]:Di(n)},resolvedImage:function(n){return 0===fa(n).length?[]:Di(n)},projection:function(n){const e=n.value,r=n.styleSpec,s=r.projection,h=n.style;let p=[];const m=Jn(e);if("object"===m)for(const y in e)p=p.concat(ki({key:y,value:e[y],valueSpec:s[y],style:h,styleSpec:r}));else"string"!==m&&(p=p.concat([new en("projection",e,`object or string expected, ${m} found`)]));return p}};function ki(n){const e=n.value,r=n.valueSpec,s=n.styleSpec;return r.expression&&Ys(Ir(e))?Gl(n):r.expression&&Ka(rr(e))?Di(n):r.type&&Su[r.type]?Su[r.type](n):As(io({},n,{valueSpec:r.type?s[r.type]:r}))}function jr(n){const e=n.value,r=n.key,s=fa(n);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new en(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new en(r,e,'"glyphs" url must include a "{range}" token'))),s}function ad(n,e=rt){return Jo(ki({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:jr,"*":()=>[]}}))}const fh=n=>Jo(ql(n)),ph=n=>Jo(Wc(n));function Jo(n){return n.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function mh(n,e){let r=!1;if(e&&e.length)for(const s of e)n.fire(new zn(new Error(s.message))),r=!0;return r}var ld=Fo;function Fo(n,e,r){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(e=h[1])+2*(r=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[3+p],y=h[3+p+1];s.push(m===y?null:h.subarray(m,y))}var b=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=r,this.scale=e/n,this.uid=0;var A=r/e*n;this.min=-A,this.max=n+A}Fo.prototype.insert=function(n,e,r,s,h){this._forEachCell(e,r,s,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(h)},Fo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Fo.prototype._insertCell=function(n,e,r,s,h,p){this.cells[h].push(p)},Fo.prototype.query=function(n,e,r,s,h){var p=this.min,m=this.max;if(n<=p&&e<=p&&m<=r&&m<=s&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,r,s,this._queryCell,y,{},h),y},Fo.prototype._queryCell=function(n,e,r,s,h,p,m,y){var b=this.cells[h];if(null!==b)for(var w=this.keys,A=this.bboxes,k=0;k<b.length;k++){var z=b[k];if(void 0===m[z]){var G=4*z;(y?y(A[G+0],A[G+1],A[G+2],A[G+3]):n<=A[G+2]&&e<=A[G+3]&&r>=A[G+0]&&s>=A[G+1])?(m[z]=!0,p.push(w[z])):m[z]=!1}}},Fo.prototype._forEachCell=function(n,e,r,s,h,p,m,y){for(var b=this._convertToCellCoord(n),w=this._convertToCellCoord(e),A=this._convertToCellCoord(r),k=this._convertToCellCoord(s),z=b;z<=A;z++)for(var G=w;G<=k;G++){var H=this.d*G+z;if((!y||y(this._convertFromCellCoord(z),this._convertFromCellCoord(G),this._convertFromCellCoord(z+1),this._convertFromCellCoord(G+1)))&&h.call(this,n,e,r,s,H,p,m,y))return}},Fo.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Fo.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Fo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var h=new Int32Array(e+r+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=e,m=0;m<n.length;m++){var y=n[m];h[3+m]=p,h.set(y,p),p+=y.length}return h[3+n.length]=p,h.set(this.keys,p),h[3+n.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var El=It(ld);const Au={};function Zt(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Au[e]={klass:n,omit:r.omit||[]}}Zt(Object,"Object"),El.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.push(r),{buffer:r}},El.deserialize=function(n){return new El(n.buffer)},Object.defineProperty(El,"name",{value:"Grid"}),Zt(El,"Grid"),Zt(pi,"Color"),Zt(Error,"Error"),Zt(In,"AJAXError"),Zt(Io,"ResolvedImage"),Zt(ua,"StylePropertyFunction"),Zt($l,"StyleExpression",{omit:["_evaluator"]}),Zt(Ks,"ZoomDependentExpression"),Zt(qc,"ZoomConstantExpression"),Zt(Po,"CompoundExpression",{omit:["_evaluate"]});for(const n in Ve)Au[Ve[n]._classRegistryKey]||Zt(Ve[n],`Expression${n}`);function Dc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function ka(n){return Te.ImageBitmap&&n instanceof Te.ImageBitmap}function Wl(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Dc(n)||ka(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof Te.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const s of n)r.push(Wl(s,e));return r}if("object"==typeof n){const r=n.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const p in n)n.hasOwnProperty(p)&&(Au[s].omit.indexOf(p)>=0||(h[p]=Wl(n[p],e)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof n)}function nl(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Dc(n)||ka(n)||ArrayBuffer.isView(n)||n instanceof Te.ImageData)return n;if(Array.isArray(n))return n.map(nl);if("object"==typeof n){const e=n.$name||"Object",{klass:r}=Au[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const h of Object.keys(n))"$name"!==h&&(s[h]=nl(n[h]));return s}throw new Error("can't deserialize object of type "+typeof n)}const qt_Latin_1_Supplement=n=>n>=128&&n<=255,qt_Arabic=n=>n>=1536&&n<=1791,qt_Arabic_Supplement=n=>n>=1872&&n<=1919,qt_Arabic_Extended_A=n=>n>=2208&&n<=2303,qt_Hangul_Jamo=n=>n>=4352&&n<=4607,qt_Unified_Canadian_Aboriginal_Syllabics=n=>n>=5120&&n<=5759,qt_Khmer=n=>n>=6016&&n<=6143,qt_Unified_Canadian_Aboriginal_Syllabics_Extended=n=>n>=6320&&n<=6399,qt_General_Punctuation=n=>n>=8192&&n<=8303,qt_Letterlike_Symbols=n=>n>=8448&&n<=8527,qt_Number_Forms=n=>n>=8528&&n<=8591,qt_Miscellaneous_Technical=n=>n>=8960&&n<=9215,qt_Control_Pictures=n=>n>=9216&&n<=9279,qt_Optical_Character_Recognition=n=>n>=9280&&n<=9311,qt_Enclosed_Alphanumerics=n=>n>=9312&&n<=9471,qt_Geometric_Shapes=n=>n>=9632&&n<=9727,qt_Miscellaneous_Symbols=n=>n>=9728&&n<=9983,qt_Miscellaneous_Symbols_and_Arrows=n=>n>=11008&&n<=11263,qt_CJK_Radicals_Supplement=n=>n>=11904&&n<=12031,qt_Kangxi_Radicals=n=>n>=12032&&n<=12255,qt_Ideographic_Description_Characters=n=>n>=12272&&n<=12287,qt_CJK_Symbols_and_Punctuation=n=>n>=12288&&n<=12351,qt_Hiragana=n=>n>=12352&&n<=12447,qt_Katakana=n=>n>=12448&&n<=12543,qt_Bopomofo=n=>n>=12544&&n<=12591,qt_Hangul_Compatibility_Jamo=n=>n>=12592&&n<=12687,qt_Kanbun=n=>n>=12688&&n<=12703,qt_Bopomofo_Extended=n=>n>=12704&&n<=12735,qt_CJK_Strokes=n=>n>=12736&&n<=12783,qt_Katakana_Phonetic_Extensions=n=>n>=12784&&n<=12799,qt_Enclosed_CJK_Letters_and_Months=n=>n>=12800&&n<=13055,qt_CJK_Compatibility=n=>n>=13056&&n<=13311,qt_CJK_Unified_Ideographs_Extension_A=n=>n>=13312&&n<=19903,qt_Yijing_Hexagram_Symbols=n=>n>=19904&&n<=19967,qt_CJK_Unified_Ideographs=n=>n>=19968&&n<=40959,qt_Yi_Syllables=n=>n>=40960&&n<=42127,qt_Yi_Radicals=n=>n>=42128&&n<=42191,qt_Hangul_Jamo_Extended_A=n=>n>=43360&&n<=43391,qt_Hangul_Syllables=n=>n>=44032&&n<=55215,qt_Hangul_Jamo_Extended_B=n=>n>=55216&&n<=55295,qt_Private_Use_Area=n=>n>=57344&&n<=63743,qt_CJK_Compatibility_Ideographs=n=>n>=63744&&n<=64255,qt_Arabic_Presentation_Forms_A=n=>n>=64336&&n<=65023,qt_Vertical_Forms=n=>n>=65040&&n<=65055,qt_CJK_Compatibility_Forms=n=>n>=65072&&n<=65103,qt_Small_Form_Variants=n=>n>=65104&&n<=65135,qt_Arabic_Presentation_Forms_B=n=>n>=65136&&n<=65279,qt_Halfwidth_and_Fullwidth_Forms=n=>n>=65280&&n<=65519;function Ps(n){for(const e of n)if(rl(e.charCodeAt(0)))return!0;return!1}function Iu(n){for(const e of n)if(!Xl(e.charCodeAt(0)))return!1;return!0}function Xl(n){return!(qt_Arabic(n)||qt_Arabic_Supplement(n)||qt_Arabic_Extended_A(n)||qt_Arabic_Presentation_Forms_A(n)||qt_Arabic_Presentation_Forms_B(n))}function rl(n){return!(746!==n&&747!==n&&(n<4352||!(qt_Bopomofo_Extended(n)||qt_Bopomofo(n)||qt_CJK_Compatibility_Forms(n)&&!(n>=65097&&n<=65103)||qt_CJK_Compatibility_Ideographs(n)||qt_CJK_Compatibility(n)||qt_CJK_Radicals_Supplement(n)||qt_CJK_Strokes(n)||!(!qt_CJK_Symbols_and_Punctuation(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||qt_CJK_Unified_Ideographs_Extension_A(n)||qt_CJK_Unified_Ideographs(n)||qt_Enclosed_CJK_Letters_and_Months(n)||qt_Hangul_Compatibility_Jamo(n)||qt_Hangul_Jamo_Extended_A(n)||qt_Hangul_Jamo_Extended_B(n)||qt_Hangul_Jamo(n)||qt_Hangul_Syllables(n)||qt_Hiragana(n)||qt_Ideographic_Description_Characters(n)||qt_Kanbun(n)||qt_Kangxi_Radicals(n)||qt_Katakana_Phonetic_Extensions(n)||qt_Katakana(n)&&12540!==n||!(!qt_Halfwidth_and_Fullwidth_Forms(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!qt_Small_Form_Variants(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||qt_Unified_Canadian_Aboriginal_Syllabics(n)||qt_Unified_Canadian_Aboriginal_Syllabics_Extended(n)||qt_Vertical_Forms(n)||qt_Yijing_Hexagram_Symbols(n)||qt_Yi_Syllables(n)||qt_Yi_Radicals(n))))}function Xc(n){return!(rl(n)||(e=n,qt_Latin_1_Supplement(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||qt_General_Punctuation(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||qt_Letterlike_Symbols(e)||qt_Number_Forms(e)||qt_Miscellaneous_Technical(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||qt_Control_Pictures(e)&&9251!==e||qt_Optical_Character_Recognition(e)||qt_Enclosed_Alphanumerics(e)||qt_Geometric_Shapes(e)||qt_Miscellaneous_Symbols(e)&&!(e>=9754&&e<=9759)||qt_Miscellaneous_Symbols_and_Arrows(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||qt_CJK_Symbols_and_Punctuation(e)||qt_Katakana(e)||qt_Private_Use_Area(e)||qt_CJK_Compatibility_Forms(e)||qt_Small_Form_Variants(e)||qt_Halfwidth_and_Fullwidth_Forms(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Yc(n){return n>=1424&&n<=2303||qt_Arabic_Presentation_Forms_A(n)||qt_Arabic_Presentation_Forms_B(n)}function gh(n,e){return!(!e&&Yc(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||qt_Khmer(n))}function Cf(n){for(const e of n)if(Yc(e.charCodeAt(0)))return!0;return!1}const M="deferred",S="loading",D="loaded";let O=null,c="unavailable",t=null;const a=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(c="error"),O&&O(n)};function d(){g.fire(new Gi("pluginStateChange",{pluginStatus:c,pluginURL:t}))}const g=new zs,v=function(){return c},E=function(){if(c!==M||!t)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");c=S,d(),t&&Vr({url:t},n=>{n?a(n):(c=D,d())})},C={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>c===D||null!=C.applyArabicShaping,isLoading:()=>c===S,setState(n){c=n.pluginStatus,t=n.pluginURL},isParsed:()=>null!=C.applyArabicShaping&&null!=C.processBidirectionalText&&null!=C.processStyledBidirectionalText,getPluginURL:()=>t};class P{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,s){for(const h of r)if(!gh(h.charCodeAt(0),s))return!1;return!0}(e,C.isLoaded())}}class U{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,h){if(Ys(s))return new ua(s,h);if(Ka(s)){const p=Aa(s,h);if("error"===p.result)throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));return p.value}{let p=s;return"string"==typeof s&&"color"===h.type&&(p=pi.parse(s)),{kind:"constant",evaluate:()=>p}}}(void 0===r?e.specification.default:r,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class V{constructor(e){this.property=e,this.value=new U(e,void 0)}transitioned(e,r){return new te(this.property,this.value,r,gr({},e.transition,this.transition),e.now)}untransitioned(){return new te(this.property,this.value,null,{},0)}}class q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Si(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new V(this._values[e].property)),this._values[e].value=new U(this._values[e].property,null===r?void 0:Si(r))}getTransition(e){return Si(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new V(this._values[e].property)),this._values[e].transition=Si(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(e[r]=s);const h=this.getTransition(r);void 0!==h&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const s=new oe(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,r._values[h]);return s}untransitioned(){const e=new oe(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class te{constructor(e,r,s,h,p){const m=h.delay||0,y=h.duration||0;p=p||0,this.property=e,this.value=r,this.begin=p+m,this.end=this.begin+y,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const h=e.now||0,p=this.value.possiblyEvaluate(e,r,s),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(e,r,s);{const y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,s),p,Xe(y))}}return p}}class oe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const h=new ce(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,r,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Si(this._values[e].value)}setValue(e,r){this._values[e]=new U(this._values[e].property,null===r?void 0:Si(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const h=new ce(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,r,s);return h}}class le{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,r,s,h){return this.property.evaluate(this.value,this.parameters,e,r,s,h)}}class ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Y{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const h=qs[this.specification.type];return h?h(e,r,s):e}}class se{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,h){return new le(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(r,null,{},s,h)}:e.expression,r)}interpolate(e,r,s){if("constant"!==e.value.kind||"constant"!==r.value.kind)return e;if(void 0===e.value.value||void 0===r.value.value)return new le(this,{kind:"constant",value:void 0},e.parameters);const h=qs[this.specification.type];return h?new le(this,{kind:"constant",value:h(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,h,p,m){return"constant"===e.kind?e.value:e.evaluate(r,s,h,p,m)}}class fe{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,h){return!!e.expression.evaluate(r,null,{},s,h)}interpolate(){return!1}}class me{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new P(0,{});for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new U(h,void 0),m=this.defaultTransitionablePropertyValues[s]=new V(h);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(r)}}}function Pe(n,e){return 256*(n=Be(Math.floor(n),0,255))+Be(Math.floor(e),0,255)}Zt(se,"DataDrivenProperty"),Zt(Y,"DataConstantProperty"),Zt(fe,"ColorRampProperty");const De={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Re{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ze{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ne(n,e=1){let r=0,s=0;return{members:n.map(h=>{const p=De[h.type].BYTES_PER_ELEMENT,m=r=We(r,Math.max(e,p)),y=h.components||1;return s=Math.max(s,p),r+=p*y,{name:h.name,type:h.type,components:y,offset:m}}),size:We(r,Math.max(s,e)),alignment:e}}function We(n,e){return Math.ceil(n/e)*e}class Bt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=s,e}}Bt.prototype.bytesPerElement=4,Zt(Bt,"StructArrayLayout2i4");class qe extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s)}emplace(e,r,s,h){const p=3*e;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=h,e}}qe.prototype.bytesPerElement=6,Zt(qe,"StructArrayLayout3i6");class mt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,h)}emplace(e,r,s,h,p){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=h,this.int16[m+3]=p,e}}mt.prototype.bytesPerElement=8,Zt(mt,"StructArrayLayout4i8");class Qe extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,h,p,m,y)}emplace(e,r,s,h,p,m,y,b){const w=6*e,A=12*e,k=3*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.uint8[A+4]=h,this.uint8[A+5]=p,this.uint8[A+6]=m,this.uint8[A+7]=y,this.float32[k+2]=b,e}}Qe.prototype.bytesPerElement=12,Zt(Qe,"StructArrayLayout2i4ub1f12");class Lt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,h)}emplace(e,r,s,h,p){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=h,this.float32[m+3]=p,e}}Lt.prototype.bytesPerElement=16,Zt(Lt,"StructArrayLayout4f16");class Ye extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,h,p)}emplace(e,r,s,h,p,m){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=s,this.uint16[y+2]=h,this.uint16[y+3]=p,this.float32[b+2]=m,e}}Ye.prototype.bytesPerElement=12,Zt(Ye,"StructArrayLayout4ui1f12");class ut extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,h)}emplace(e,r,s,h,p){const m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=s,this.uint16[m+2]=h,this.uint16[m+3]=p,e}}ut.prototype.bytesPerElement=8,Zt(ut,"StructArrayLayout4ui8");class zt extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,h,p,m)}emplace(e,r,s,h,p,m,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=y,e}}zt.prototype.bytesPerElement=12,Zt(zt,"StructArrayLayout6i12");class Ct extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m,y,b,w,A,k,z){const G=this.length;return this.resize(G+1),this.emplace(G,e,r,s,h,p,m,y,b,w,A,k,z)}emplace(e,r,s,h,p,m,y,b,w,A,k,z,G){const H=12*e;return this.int16[H+0]=r,this.int16[H+1]=s,this.int16[H+2]=h,this.int16[H+3]=p,this.uint16[H+4]=m,this.uint16[H+5]=y,this.uint16[H+6]=b,this.uint16[H+7]=w,this.int16[H+8]=A,this.int16[H+9]=k,this.int16[H+10]=z,this.int16[H+11]=G,e}}Ct.prototype.bytesPerElement=24,Zt(Ct,"StructArrayLayout4i4ui4i24");class Ot extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,s,h,p,m)}emplace(e,r,s,h,p,m,y){const b=10*e,w=5*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=h,this.float32[w+2]=p,this.float32[w+3]=m,this.float32[w+4]=y,e}}Ot.prototype.bytesPerElement=20,Zt(Ot,"StructArrayLayout3i3f20");class _n extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}_n.prototype.bytesPerElement=4,Zt(_n,"StructArrayLayout1ul4");class Un extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m,y,b,w,A,k,z,G){const H=this.length;return this.resize(H+1),this.emplace(H,e,r,s,h,p,m,y,b,w,A,k,z,G)}emplace(e,r,s,h,p,m,y,b,w,A,k,z,G,H){const K=20*e,ie=10*e;return this.int16[K+0]=r,this.int16[K+1]=s,this.int16[K+2]=h,this.int16[K+3]=p,this.int16[K+4]=m,this.float32[ie+3]=y,this.float32[ie+4]=b,this.float32[ie+5]=w,this.float32[ie+6]=A,this.int16[K+14]=k,this.uint32[ie+8]=z,this.uint16[K+18]=G,this.uint16[K+19]=H,e}}Un.prototype.bytesPerElement=40,Zt(Un,"StructArrayLayout5i4f1i1ul2ui40");class hn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,h,p,m,y)}emplace(e,r,s,h,p,m,y,b){const w=8*e;return this.int16[w+0]=r,this.int16[w+1]=s,this.int16[w+2]=h,this.int16[w+4]=p,this.int16[w+5]=m,this.int16[w+6]=y,this.int16[w+7]=b,e}}hn.prototype.bytesPerElement=16,Zt(hn,"StructArrayLayout3i2i2i16");class Sn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,h,p)}emplace(e,r,s,h,p,m){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=h,this.int16[b+6]=p,this.int16[b+7]=m,e}}Sn.prototype.bytesPerElement=16,Zt(Sn,"StructArrayLayout2f1f2i16");class Qn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,h)}emplace(e,r,s,h,p){const m=12*e,y=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=s,this.float32[y+1]=h,this.float32[y+2]=p,e}}Qn.prototype.bytesPerElement=12,Zt(Qn,"StructArrayLayout2ub2f12");class er extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s)}emplace(e,r,s,h){const p=3*e;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=h,e}}er.prototype.bytesPerElement=12,Zt(er,"StructArrayLayout3f12");class yn extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,s)}emplace(e,r,s,h){const p=3*e;return this.uint16[p+0]=r,this.uint16[p+1]=s,this.uint16[p+2]=h,e}}yn.prototype.bytesPerElement=6,Zt(yn,"StructArrayLayout3ui6");class Fr extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie,ue,be,de,xe,Se){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie,ue,be,de,xe,Se)}emplace(e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie,ue,be,de,xe,Se,Me){const Ke=30*e,Ze=15*e,st=60*e;return this.int16[Ke+0]=r,this.int16[Ke+1]=s,this.int16[Ke+2]=h,this.float32[Ze+2]=p,this.float32[Ze+3]=m,this.uint16[Ke+8]=y,this.uint16[Ke+9]=b,this.uint32[Ze+5]=w,this.uint32[Ze+6]=A,this.uint32[Ze+7]=k,this.uint16[Ke+16]=z,this.uint16[Ke+17]=G,this.uint16[Ke+18]=H,this.float32[Ze+10]=K,this.float32[Ze+11]=ie,this.uint8[st+48]=ue,this.uint8[st+49]=be,this.uint8[st+50]=de,this.uint32[Ze+13]=xe,this.int16[Ke+28]=Se,this.uint8[st+58]=Me,e}}Fr.prototype.bytesPerElement=60,Zt(Fr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $r extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie,ue,be,de,xe,Se,Me,Ke,Ze,st,Ft,et,_t,yt,Pt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie,ue,be,de,xe,Se,Me,Ke,Ze,st,Ft,et,_t,yt,Pt)}emplace(e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie,ue,be,de,xe,Se,Me,Ke,Ze,st,Ft,et,_t,yt,Pt,jt){const ot=38*e,Kt=19*e;return this.int16[ot+0]=r,this.int16[ot+1]=s,this.int16[ot+2]=h,this.float32[Kt+2]=p,this.float32[Kt+3]=m,this.int16[ot+8]=y,this.int16[ot+9]=b,this.int16[ot+10]=w,this.int16[ot+11]=A,this.int16[ot+12]=k,this.int16[ot+13]=z,this.uint16[ot+14]=G,this.uint16[ot+15]=H,this.uint16[ot+16]=K,this.uint16[ot+17]=ie,this.uint16[ot+18]=ue,this.uint16[ot+19]=be,this.uint16[ot+20]=de,this.uint16[ot+21]=xe,this.uint16[ot+22]=Se,this.uint16[ot+23]=Me,this.uint16[ot+24]=Ke,this.uint16[ot+25]=Ze,this.uint16[ot+26]=st,this.uint16[ot+27]=Ft,this.uint16[ot+28]=et,this.uint32[Kt+15]=_t,this.float32[Kt+16]=yt,this.float32[Kt+17]=Pt,this.float32[Kt+18]=jt,e}}$r.prototype.bytesPerElement=76,Zt($r,"StructArrayLayout3i2f6i15ui1ul3f76");class Yr extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Yr.prototype.bytesPerElement=4,Zt(Yr,"StructArrayLayout1f4");class ni extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,h,p)}emplace(e,r,s,h,p,m){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=h,this.float32[y+3]=p,this.float32[y+4]=m,e}}ni.prototype.bytesPerElement=20,Zt(ni,"StructArrayLayout5f20");class Go extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,r,s,h)}emplace(e,r,s,h,p){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=h,this.uint16[m+4]=p,e}}Go.prototype.bytesPerElement=12,Zt(Go,"StructArrayLayout1ul3ui12");class Eo extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=s,e}}Eo.prototype.bytesPerElement=4,Zt(Eo,"StructArrayLayout2ui4");class ta extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}ta.prototype.bytesPerElement=2,Zt(ta,"StructArrayLayout1ui2");class Rs extends ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=s,e}}Rs.prototype.bytesPerElement=8,Zt(Rs,"StructArrayLayout2f8");class hi extends Re{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}hi.prototype.size=40;class Kr extends Un{get(e){return new hi(this,e)}}Zt(Kr,"CollisionBoxArray");class Pr extends Re{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Pr.prototype.size=60;class eo extends Fr{get(e){return new Pr(this,e)}}Zt(eo,"PlacedSymbolArray");class Ho extends Re{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ho.prototype.size=76;class mi extends $r{get(e){return new Ho(this,e)}}Zt(mi,"SymbolInstanceArray");class Zo extends Yr{getoffsetX(e){return this.float32[1*e+0]}}Zt(Zo,"GlyphOffsetArray");class Pu extends Bt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zt(Pu,"SymbolLineVertexArray");class Cl extends Re{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Cl.prototype.size=12;class Dl extends Go{get(e){return new Cl(this,e)}}Zt(Dl,"FeatureIndexArray");class pa extends Eo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zt(pa,"FillExtrusionCentroidArray");const Ls=Ne([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Yl=Ne([{name:"a_dash",components:4,type:"Uint16"}]);var Ru={exports:{}},Df=function(n,e){var r,s,h,p,m,y,b,w;for(s=n.length-(r=3&n.length),h=e,m=3432918353,y=461845907,w=0;w<s;)b=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24,++w,h=27492+(65535&(p=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,r){case 3:b^=(255&n.charCodeAt(w+2))<<16;case 2:b^=(255&n.charCodeAt(w+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&n.charCodeAt(w)))*m+(((b>>>16)*m&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0},im=function(n,e){for(var r,s=n.length,h=e^s,p=0;s>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(p)|(255&n.charCodeAt(++p))<<8|(255&n.charCodeAt(++p))<<16|(255&n.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:h^=(255&n.charCodeAt(p+2))<<16;case 2:h^=(255&n.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};Ru.exports=Df,Ru.exports.murmur3=Df,Ru.exports.murmur2=im;var ud=It(Ru.exports);class _h{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,h){this.ids.push(om(e)),this.positions.push(r,s,h)}getPositions(e){const r=om(e);let s=0,h=this.ids.length-1;for(;s<h;){const m=s+h>>1;this.ids[m]>=r?h=m:s=m+1}const p=[];for(;this.ids[s]===r;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(e,r){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Tf(s,h,0,s.length-1),r&&r.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const r=new _h;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function om(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ud(String(n))}function Tf(n,e,r,s){for(;r<s;){const h=n[r+s>>1];let p=r-1,m=s+1;for(;;){do{p++}while(n[p]<h);do{m--}while(n[m]>h);if(p>=m)break;hd(n,p,m),hd(e,3*p,3*m),hd(e,3*p+1,3*m+1),hd(e,3*p+2,3*m+2)}m-r<s-m?(Tf(n,e,r,m),r=m+1):(Tf(n,e,m+1,s),s=m)}}function hd(n,e,r){const s=n[e];n[e]=n[r],n[r]=s}Zt(_h,"FeaturePositionMap");class Kl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class dd extends Kl{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Jl extends Kl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class ku extends Kl{constructor(e){super(e),this.current=pi.transparent}set(e,r,s){this.fetchUniformLocation(e,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Hg=new Float32Array(16),Hy=new Float32Array(9),Zy=new Float32Array(4);function sm(n){return[Pe(255*n.r,255*n.g),Pe(255*n.b,255*n.a)]}class fd{constructor(e,r,s){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=s}setUniform(e,r,s,h,p){r.set(e,p,h.constantOr(this.value))}getBinding(e,r){return"color"===this.type?new ku(e):new dd(e)}}class yh{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,s,h,p){const m="u_pattern"===p||"u_dash"===p?this.pattern:"u_pixel_ratio"===p?this.pixelRatio:null;m&&r.set(e,p,m)}getBinding(e,r){return"u_pattern"===r||"u_dash"===r?new Jl(e):new dd(e)}}class Tl{constructor(e,r,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,s,h,p,m){const y=this.paintVertexArray.length,b=this.expression.evaluate(new P(0),r,{},p,h,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,s,h,p){const m=this.expression.evaluate({zoom:0},s,h,void 0,p);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if("color"===this.type){const h=sm(s);for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class il{constructor(e,r,s,h,p,m){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,s,h,p,m){const y=this.expression.evaluate(new P(this.zoom),r,{},p,h,m),b=this.expression.evaluate(new P(this.zoom+1),r,{},p,h,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,b)}updatePaintArray(e,r,s,h,p){const m=this.expression.evaluate({zoom:this.zoom},s,h,void 0,p),y=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,p);this._setPaintValue(e,r,m,y)}_setPaintValue(e,r,s,h){if("color"===this.type){const p=sm(s),m=sm(h);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,p[0],p[1],m[0],m[1])}else{for(let p=e;p<r;p++)this.paintVertexArray.emplace(p,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,s,h,p){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=Be(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);r.set(e,p,y)}getBinding(e,r){return new dd(e)}}class Mc{constructor(e,r,s,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=("array"===s?Yl:Ls).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new h}populatePaintArray(e,r,s){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,h,p,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,h){if(!h||!s)return;const p=h[s];if(!p)return;const{tl:m,br:y,pixelRatio:b}=p;for(let w=e;w<r;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sc{constructor(e,r,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){if(!s(p))continue;const m=e.paint.get(p);if(!(m instanceof le&&Ri(m.property.specification)))continue;const y=Ql(p,e.type),b=m.value,w=m.property.specification.type,A=!!m.property.useIntegerZoom,k="line-dasharray"===p||p.endsWith("pattern"),z="line-dasharray"===p&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||z)if("source"===b.kind||z||k){const G=Sf(p,w,"source");this.binders[p]=k?new Mc(b,y,w,G,e.id):new Tl(b,y,w,G),h.push(`/a_${p}`)}else{const G=Sf(p,w,"composite");this.binders[p]=new il(b,y,w,A,r,G),h.push(`/z_${p}`)}else this.binders[p]=k?new yh(b.value,y):new fd(b.value,y,w),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Tl||r instanceof il?r.maxValue:0}populatePaintArrays(e,r,s,h,p,m){for(const y in this.binders){const b=this.binders[y];(b instanceof Tl||b instanceof il||b instanceof Mc)&&b.populatePaintArray(e,r,s,h,p,m)}}setConstantPatternPositions(e){for(const r in this.binders){const s=this.binders[r];s instanceof yh&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,r,s,h,p,m){let y=!1;for(const b in e){const w=r.getPositions(b);for(const A of w){const k=s.feature(A.index);for(const z in this.binders){const G=this.binders[z];if((G instanceof Tl||G instanceof il||G instanceof Mc)&&!0===G.expression.isStateDependent){const H=h.paint.get(z);G.expression=H.value,G.updatePaintArray(A.start,A.end,k,e[b],p,m),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof fd||s instanceof yh)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Tl||s instanceof il||s instanceof Mc)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof fd||s instanceof yh||s instanceof il)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof fd||h instanceof yh||h instanceof il)for(const p of h.uniformNames)r.push({name:p,property:s,binding:h.getBinding(e,p)})}return r}setUniforms(e,r,s,h,p){for(const{name:m,property:y,binding:b}of s)this.binders[y].setUniform(e,b,p,h.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Tl||r instanceof il||r instanceof Mc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof Tl||s instanceof il||s instanceof Mc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Tl||r instanceof il||r instanceof Mc)&&r.destroy()}}}class Kc{constructor(e,r,s=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Sc(h,r,s);this.needsUpload=!1,this._featureMap=new _h,this._bufferOffset=0}populatePaintArrays(e,r,s,h,p,m,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,h,p,m,y);void 0!==r.id&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,h,p){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,h,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Mf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ql(n,e){return Mf[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const vh={"line-pattern":{source:Ye,composite:Ye},"fill-pattern":{source:Ye,composite:Ye},"fill-extrusion-pattern":{source:Ye,composite:Ye},"line-dasharray":{source:ut,composite:ut}},am={color:{source:Rs,composite:Lt},number:{source:Yr,composite:Rs}};function Sf(n,e,r){const s=vh[n];return s&&s[r]||am[e][r]}Zt(fd,"ConstantBinder"),Zt(yh,"PatternConstantBinder"),Zt(Tl,"SourceExpressionBinder"),Zt(Mc,"PatternCompositeBinder"),Zt(il,"CompositeExpressionBinder"),Zt(Sc,"ProgramConfiguration",{omit:["_buffers"]}),Zt(Kc,"ProgramConfigurationSet");const Af="-transition";class Ml extends zs{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ae(r.layout)),r.paint)){this._transitionablePaint=new q(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ce(r.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){null!=r&&this._validate(ph,`layers.${this.id}.layout.${e}`,e,r,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Ar(e,Af)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(null!=r&&this._validate(fh,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(Ar(e,Af))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[e],p=h.value.isDataDriven(),m=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,b=y.isDataDriven(),w=Ar(e,"pattern")||"line-dasharray"===e;return b||p||w||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Zn(e,(r,s)=>!(void 0===r||"layout"===s&&!Object.keys(r).length||"paint"===s&&!Object.keys(r).length))}_validate(e,r,s,h,p={}){return(!p||!1!==p.validate)&&mh(this,e.call(ad,{key:r,layerType:this.type,objectKey:s,value:h,styleSpec:rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof le&&Ri(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ha(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const qy=Ne([{name:"a_pos",components:2,type:"Int16"}],4),Wy=Ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Oi{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,h){let p=this.segments[this.segments.length-1];return e>Oi.MAX_VERTEX_ARRAY_LENGTH&&Cr(`Max vertices per segment is ${Oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Oi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,h){return new Oi([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}Oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(Oi,"SegmentVector");var bn=8192;class Jc{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Gr?new Gr(e.lng,e.lat):Gr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Gr?new Gr(e.lng,e.lat):Gr.convert(e),this}extend(e){const r=this._sw,s=this._ne;let h,p;if(e instanceof Gr)h=e,p=e;else{if(!(e instanceof Jc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Jc.convert(e)):this.extend(Gr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Gr.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return r||s?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new Gr(h.lng,h.lat),this._ne=new Gr(p.lng,p.lat)),this}getCenter(){return new Gr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Gr(this.getWest(),this.getNorth())}getSouthEast(){return new Gr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Gr.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof Jc?e:new Jc(e)}}var If=1e-6,ks=typeof Float32Array<"u"?Float32Array:Array;function lm(){var n=new ks(9);return ks!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function cm(n,e,r){var s=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],w=e[6],A=e[7],k=e[8],z=r[0],G=r[1],H=r[2],K=r[3],ie=r[4],ue=r[5],be=r[6],de=r[7],xe=r[8];return n[0]=z*s+G*m+H*w,n[1]=z*h+G*y+H*A,n[2]=z*p+G*b+H*k,n[3]=K*s+ie*m+ue*w,n[4]=K*h+ie*y+ue*A,n[5]=K*p+ie*b+ue*k,n[6]=be*s+de*m+xe*w,n[7]=be*h+de*y+xe*A,n[8]=be*p+de*b+xe*k,n}function ol(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Pf(n,e){var r=e[0],s=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],w=e[7],A=e[8],k=e[9],z=e[10],G=e[11],H=e[12],K=e[13],ie=e[14],ue=e[15],be=r*y-s*m,de=r*b-h*m,xe=r*w-p*m,Se=s*b-h*y,Me=s*w-p*y,Ke=h*w-p*b,Ze=A*K-k*H,st=A*ie-z*H,Ft=A*ue-G*H,et=k*ie-z*K,_t=k*ue-G*K,yt=z*ue-G*ie,Pt=be*yt-de*_t+xe*et+Se*Ft-Me*st+Ke*Ze;return Pt?(n[0]=(y*yt-b*_t+w*et)*(Pt=1/Pt),n[1]=(h*_t-s*yt-p*et)*Pt,n[2]=(K*Ke-ie*Me+ue*Se)*Pt,n[3]=(z*Me-k*Ke-G*Se)*Pt,n[4]=(b*Ft-m*yt-w*st)*Pt,n[5]=(r*yt-h*Ft+p*st)*Pt,n[6]=(ie*xe-H*Ke-ue*de)*Pt,n[7]=(A*Ke-z*xe+G*de)*Pt,n[8]=(m*_t-y*Ft+w*Ze)*Pt,n[9]=(s*Ft-r*_t-p*Ze)*Pt,n[10]=(H*Me-K*xe+ue*be)*Pt,n[11]=(k*xe-A*Me-G*be)*Pt,n[12]=(y*st-m*et-b*Ze)*Pt,n[13]=(r*et-s*st+h*Ze)*Pt,n[14]=(K*de-H*Se-ie*be)*Pt,n[15]=(A*Se-k*de+z*be)*Pt,n):null}function Ac(n,e,r){var s=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],w=e[6],A=e[7],k=e[8],z=e[9],G=e[10],H=e[11],K=e[12],ie=e[13],ue=e[14],be=e[15],de=r[0],xe=r[1],Se=r[2],Me=r[3];return n[0]=de*s+xe*y+Se*k+Me*K,n[1]=de*h+xe*b+Se*z+Me*ie,n[2]=de*p+xe*w+Se*G+Me*ue,n[3]=de*m+xe*A+Se*H+Me*be,n[4]=(de=r[4])*s+(xe=r[5])*y+(Se=r[6])*k+(Me=r[7])*K,n[5]=de*h+xe*b+Se*z+Me*ie,n[6]=de*p+xe*w+Se*G+Me*ue,n[7]=de*m+xe*A+Se*H+Me*be,n[8]=(de=r[8])*s+(xe=r[9])*y+(Se=r[10])*k+(Me=r[11])*K,n[9]=de*h+xe*b+Se*z+Me*ie,n[10]=de*p+xe*w+Se*G+Me*ue,n[11]=de*m+xe*A+Se*H+Me*be,n[12]=(de=r[12])*s+(xe=r[13])*y+(Se=r[14])*k+(Me=r[15])*K,n[13]=de*h+xe*b+Se*z+Me*ie,n[14]=de*p+xe*w+Se*G+Me*ue,n[15]=de*m+xe*A+Se*H+Me*be,n}function Ic(n,e,r){var s,h,p,m,y,b,w,A,k,z,G,H,K=r[0],ie=r[1],ue=r[2];return e===n?(n[12]=e[0]*K+e[4]*ie+e[8]*ue+e[12],n[13]=e[1]*K+e[5]*ie+e[9]*ue+e[13],n[14]=e[2]*K+e[6]*ie+e[10]*ue+e[14],n[15]=e[3]*K+e[7]*ie+e[11]*ue+e[15]):(h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],w=e[6],A=e[7],k=e[8],z=e[9],G=e[10],H=e[11],n[0]=s=e[0],n[1]=h,n[2]=p,n[3]=m,n[4]=y,n[5]=b,n[6]=w,n[7]=A,n[8]=k,n[9]=z,n[10]=G,n[11]=H,n[12]=s*K+y*ie+k*ue+e[12],n[13]=h*K+b*ie+z*ue+e[13],n[14]=p*K+w*ie+G*ue+e[14],n[15]=m*K+A*ie+H*ue+e[15]),n}function Qc(n,e,r){var s=r[0],h=r[1],p=r[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*p,n[9]=e[9]*p,n[10]=e[10]*p,n[11]=e[11]*p,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function xh(n,e,r){var s=Math.sin(r),h=Math.cos(r),p=e[4],m=e[5],y=e[6],b=e[7],w=e[8],A=e[9],k=e[10],z=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=p*h+w*s,n[5]=m*h+A*s,n[6]=y*h+k*s,n[7]=b*h+z*s,n[8]=w*h-p*s,n[9]=A*h-m*s,n[10]=k*h-y*s,n[11]=z*h-b*s,n}function pd(n,e,r){var s=Math.sin(r),h=Math.cos(r),p=e[0],m=e[1],y=e[2],b=e[3],w=e[8],A=e[9],k=e[10],z=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h-w*s,n[1]=m*h-A*s,n[2]=y*h-k*s,n[3]=b*h-z*s,n[8]=p*s+w*h,n[9]=m*s+A*h,n[10]=y*s+k*h,n[11]=b*s+z*h,n}function uo(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function um(n,e,r){var s,h,p,m=r[0],y=r[1],b=r[2],w=Math.hypot(m,y,b);return w<If?null:(m*=w=1/w,y*=w,b*=w,s=Math.sin(e),h=Math.cos(e),n[0]=m*m*(p=1-h)+h,n[1]=y*m*p+b*s,n[2]=b*m*p-y*s,n[3]=0,n[4]=m*y*p-b*s,n[5]=y*y*p+h,n[6]=b*y*p+m*s,n[7]=0,n[8]=m*b*p+y*s,n[9]=y*b*p-m*s,n[10]=b*b*p+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Zg=Ac;function bh(){var n=new ks(3);return ks!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Rf(n){var e=new ks(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function wh(n){return Math.hypot(n[0],n[1],n[2])}function Ou(n,e,r){var s=new ks(3);return s[0]=n,s[1]=e,s[2]=r,s}function ec(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function Lf(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function hm(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function md(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function gd(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function Qo(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function eu(n,e,r,s){return n[0]=e[0]+r[0]*s,n[1]=e[1]+r[1]*s,n[2]=e[2]+r[2]*s,n}function es(n,e){var r=e[0],s=e[1],h=e[2],p=r*r+s*s+h*h;return p>0&&(p=1/Math.sqrt(p)),n[0]=e[0]*p,n[1]=e[1]*p,n[2]=e[2]*p,n}function ma(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function _d(n,e,r){var s=e[0],h=e[1],p=e[2],m=r[0],y=r[1],b=r[2];return n[0]=h*b-p*y,n[1]=p*m-s*b,n[2]=s*y-h*m,n}function zi(n,e,r){var s=e[0],h=e[1],p=e[2],m=r[3]*s+r[7]*h+r[11]*p+r[15];return n[0]=(r[0]*s+r[4]*h+r[8]*p+r[12])/(m=m||1),n[1]=(r[1]*s+r[5]*h+r[9]*p+r[13])/m,n[2]=(r[2]*s+r[6]*h+r[10]*p+r[14])/m,n}function kf(n,e,r){var s=r[0],h=r[1],p=r[2],m=e[0],y=e[1],b=e[2],w=h*b-p*y,A=p*m-s*b,k=s*y-h*m,z=h*k-p*A,G=p*w-s*k,H=s*A-h*w,K=2*r[3];return A*=K,k*=K,G*=2,H*=2,n[0]=m+(w*=K)+(z*=2),n[1]=y+A+G,n[2]=b+k+H,n}var Fu,ga=Lf,Xy=hm,qg=wh;function yd(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function Of(n,e){var r=e[0],s=e[1],h=e[2],p=e[3],m=r*r+s*s+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),n[0]=r*m,n[1]=s*m,n[2]=h*m,n[3]=p*m,n}function Pc(n,e,r){var s=e[0],h=e[1],p=e[2],m=e[3];return n[0]=r[0]*s+r[4]*h+r[8]*p+r[12]*m,n[1]=r[1]*s+r[5]*h+r[9]*p+r[13]*m,n[2]=r[2]*s+r[6]*h+r[10]*p+r[14]*m,n[3]=r[3]*s+r[7]*h+r[11]*p+r[15]*m,n}function Rc(){var n=new ks(4);return ks!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function dm(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function vd(n,e,r){r*=.5;var s=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return n[0]=s*b+m*y,n[1]=h*b+p*y,n[2]=p*b-h*y,n[3]=m*b-s*y,n}function Eh(n,e,r){r*=.5;var s=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return n[0]=s*b-p*y,n[1]=h*b+m*y,n[2]=p*b+s*y,n[3]=m*b-h*y,n}bh(),Fu=new ks(4),ks!=Float32Array&&(Fu[0]=0,Fu[1]=0,Fu[2]=0,Fu[3]=0);var Wg=Of;bh(),Ou(1,0,0),Ou(0,1,0),Rc(),Rc(),lm();const Ff=Ne([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ch}=Ff,Lc=Ne([{name:"a_pos_3",components:3,type:"Int16"}]);var Bu=Ne([{name:"a_pos",type:"Int16",components:2}]);class Dh{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const h=ma(r,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/h;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,r,s){if(K=(G=this.pos)[0],ie=G[1],ue=G[2],be=(H=e)[0],de=H[1],xe=H[2],Math.abs(K-be)<=If*Math.max(1,Math.abs(K),Math.abs(be))&&Math.abs(ie-de)<=If*Math.max(1,Math.abs(ie),Math.abs(de))&&Math.abs(ue-xe)<=If*Math.max(1,Math.abs(ue),Math.abs(xe))||0===r)return s[0]=s[1]=s[2]=0,!1;var G,H,K,ie,ue,be,de,xe;const[h,p,m]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],A=h*h+p*p+m*m,k=2*(y*h+b*p+w*m),z=k*k-4*A*(y*y+b*b+w*w-r*r);if(z<0){const G=Math.max(-k/2,0),H=y+h*G,K=b+p*G,ie=w+m*G,ue=Math.hypot(H,K,ie);return s[0]=H*r/ue,s[1]=K*r/ue,s[2]=ie*r/ue,!1}{const G=(-k-Math.sqrt(z))/(2*A);if(G<0){const H=Math.hypot(y,b,w);return s[0]=y*r/H,s[1]=b*r/H,s[2]=w*r/H,!1}return s[0]=y+h*G,s[1]=b+p*G,s[2]=w+m*G,!0}}}class Bf{constructor(e,r,s,h,p){this.TL=e,this.TR=r,this.BR=s,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,r,s){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],y=[-1,-1,1],b=zi(h,h,e),w=zi(p,p,e),A=zi(m,m,e),k=zi(y,y,e);return new Bf(b,w,A,k,r/s)}}class Nf{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,s,h){const p=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const w=Pc([],b,e),A=1/w[3]/r*p;return(k=w)[0]=(z=w)[0]*(G=[A,A,h?1/w[3]:A,A])[0],k[1]=z[1]*G[1],k[2]=z[2]*G[2],k[3]=z[3]*G[3],k;var k,z,G}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const w=es([],_d([],ga([],m[b[0]],m[b[1]]),ga([],m[b[2]],m[b[1]]))),A=-ma(w,m[b[1]]);return w.concat(A)});return new Nf(m,y)}}class ts{static fromPoints(e){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const h of e)md(r,r,h),gd(s,s,h);return new ts(r,s)}static applyTransform(e,r){const s=e.getCorners();for(let h=0;h<s.length;++h)zi(s[h],s[h],r);return ts.fromPoints(s)}constructor(e,r){this.min=e,this.max=r,this.center=Qo([],ec([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=Rf(this.min),h=Rf(this.max);for(let p=0;p<r.length;p++)s[p]=r[p]?this.min[p]:this.center[p],h[p]=r[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ts(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let s=!0;for(let h=0;h<e.planes.length;h++){const p=e.planes[h];let m=0;for(let y=0;y<r.length;y++)m+=ma(p,r[y])+p[3]>=0;if(0===m)return 0;m!==r.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][h]-this.min[h];p=Math.min(p,b),m=Math.max(m,b)}if(m<0||p>this.max[h]-this.min[h])return 0}return 1}}const Sl=bn/Math.PI/2,nu=[64,32,16],Oa=-Sl,_a=Sl,Yg=[new ts([Oa,Oa,Oa],[_a,_a,_a]),new ts([Oa,Oa,Oa],[0,0,_a]),new ts([0,Oa,Oa],[_a,0,_a]),new ts([Oa,0,Oa],[0,_a,_a]),new ts([0,0,Oa],[_a,_a,_a])];function Th(n){return n*Sl/Ed}function Kg(n,e,r,s=!0){const h=Qo([],n._camera.position,n.worldSize),p=[e,r,1,1];Pc(p,p,n.pixelMatrixInverse),yd(p,p,1/p[3]);const m=es([],ga([],p,h)),y=n.globeMatrix,b=[y[12],y[13],y[14]],w=ga([],b,h),A=wh(w),k=es([],w),z=n.worldSize/(2*Math.PI),G=ma(k,m),H=Math.asin(z/A);if(H<Math.acos(G)){if(!s)return null;const Ft=[],et=[];Qo(Ft,m,A/G),es(et,ga(et,Ft,w)),es(m,ec(m,w,Qo(m,et,Math.tan(H)*A)))}const K=[];new Dh(h,m).closestPointOnSphere(b,z,K);const ie=es([],zr(y,0)),ue=es([],zr(y,1)),be=es([],zr(y,2)),de=ma(ie,K),xe=ma(ue,K),Se=ma(be,K),Me=ft(Math.asin(-xe/z));let Ke=ft(Math.atan2(de,Se));Ke=n.center.lng+function(Ft,et){const _t=(et-Ft+180)%360-180;return _t<-180?_t+360:_t}(n.center.lng,Ke);const Ze=sl(Ke),st=Be(al(Me),0,1);return new ju(Ze,st)}class Jg{constructor(e,r,s){this.a=ga([],e,s),this.b=ga([],r,s),this.center=s;const h=es([],this.a),p=es([],this.b);this.angle=Math.acos(ma(h,p))}}function ru(n,e){if(0===n.angle)return null;let r;return r=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(s,h,p,m){const y=Math.sin(p);return s*(Math.sin((1-m)*p)/y)+h*(Math.sin(m*p)/y)}(n.a[e],n.b[e],n.angle,Be(r,0,1))+n.center[e]}function Al(n){if(n.z<=1)return Yg[n.z+2*n.y+n.x];const e=zf(Mh(n));return ts.fromPoints(e)}function Fa(n,e,r){return Qo(n,n,1-r),eu(n,n,e,r)}function Nu(n,e){const r=Ah(e.zoom);if(0===r)return Al(n);const s=Mh(n),h=zf(s),p=sl(s.getWest())*e.worldSize,m=sl(s.getEast())*e.worldSize,y=al(s.getNorth())*e.worldSize,b=al(s.getSouth())*e.worldSize,w=[p,y,0],A=[m,y,0],k=[p,b,0],z=[m,b,0],G=Pf([],e.globeMatrix);return zi(w,w,G),zi(A,A,G),zi(k,k,G),zi(z,z,G),h[0]=Fa(h[0],k,r),h[1]=Fa(h[1],z,r),h[2]=Fa(h[2],A,r),h[3]=Fa(h[3],w,r),ts.fromPoints(h)}function pm(n,e,r){for(const s of n)zi(s,s,e),Qo(s,s,r)}function Mh({x:n,y:e,z:r}){const s=1/(1<<r),h=new Gr(Os(n*s),qo((e+1)*s)),p=new Gr(Os((n+1)*s),qo(e*s));return new Jc(h,p)}function zf(n){const e=tt(n.getNorth()),r=tt(n.getSouth()),s=Math.cos(e),h=Math.cos(r),p=Math.sin(e),m=Math.sin(r),y=n.getWest(),b=n.getEast();return[zu(h,m,y),zu(h,m,b),zu(s,p,b),zu(s,p,y)]}function zu(n,e,r,s=Sl){return r=tt(r),[n*Math.sin(r)*s,-e*s,n*Math.cos(r)*s]}function Vu(n,e,r){return zu(Math.cos(tt(n)),Math.sin(tt(n)),e,r)}function Uu(n,e,r,s){const h=1<<r.z,p=(n/bn+r.x)/h;return Vu(qo((e/bn+r.y)/h),Os(p),s)}function xd({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const bd=new Float64Array(16);function Sh(n){const e=xd(n),r=uo(bd,[e,e,e]);return Ic(r,r,((s=[])[0]=-(h=n.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function Vf(n){const e=(s=n.min,(r=bd)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=s[0],r[13]=s[1],r[14]=s[2],r[15]=1,r);var r,s;const h=1/xd(n);return Qc(e,e,[h,h,h])}function wd(n,e,r,s,h){const p=function(b){const w=bn/(2*Math.PI);return b/(2*Math.PI)/w}(r),m=[n,e,-r/(2*Math.PI)],y=ol(new Float64Array(16));return Ic(y,y,m),Qc(y,y,[p,p,p]),xh(y,y,tt(-h)),pd(y,y,tt(-s)),y}function Ah(n){return Wt(5,6,n)}function Qg(n,e){const r=Vu(e.lat,e.lng);return m=(h=Lf([],function(H){const K=Vu(H._center.lat,H._center.lng);let ie=_d([],Ou(0,1,0),K);const ue=um([],-H.angle,K);ie=zi(ie,ie,ue),um(ue,-H._pitch,ie);const be=es([],K);return Qo(be,be,Th(H.cameraToCenterDistance/H.pixelsPerMeter)),zi(be,be,ue),ec([],K,be)}(n),r))[0],y=h[1],b=h[2],w=(p=r)[0],A=p[1],k=p[2],G=(z=Math.sqrt(m*m+y*y+b*b)*Math.sqrt(w*w+A*A+k*k))&&ma(h,p)/z,Math.acos(Math.min(Math.max(G,-1),1));var h,p,m,y,b,w,A,k,z,G}function Ih(n,e){return Qg(n,e)>Math.PI/2*1.01}const e_=tt(85),Ky=Math.cos(e_),Jy=Math.sin(e_),Ed=6371008.8,t_=2*Math.PI*Ed;class Oc{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oc(ht(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,h=e.lat*r,p=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return Ed*Math.acos(Math.min(p,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new Jc(new Oc(this.lng-s,this.lat-r),new Oc(this.lng+s,this.lat+r))}toEcef(e){const r=Th(e);return Vu(this.lat,this.lng,Sl+r)}static convert(e){if(e instanceof Oc)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Oc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Oc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Gr=Oc;function Ph(n){return t_*Math.cos(n*Math.PI/180)}function sl(n){return(180+n)/360}function al(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ba(n,e){return n/Ph(e)}function Os(n){return 360*n-180}function qo(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Cd(n,e){return n*Ph(qo(e))}const to=85.051129;function mm(n){return 1/Math.cos(n*Math.PI/180)}class ju{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Gr.convert(e);return new ju(sl(s.lng),al(s.lat),Ba(r,s.lat))}toLngLat(){return new Gr(Os(this.x),qo(this.y))}toAltitude(){return Cd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t_*mm(qo(this.y))}}function Uf(n,e,r,s,h,p,m,y,b){const w=(e+s)/2,A=(r+h)/2,k=new Ge(w,A);y(k),function(z,G,H,K,ie,ue){const be=H-ie,de=K-ue;return Math.abs((K-G)*be-(H-z)*de)/Math.hypot(be,de)}(k.x,k.y,p.x,p.y,m.x,m.y)>=b?(Uf(n,e,r,w,A,p,k,y,b),Uf(n,w,A,s,h,k,m,y,b)):n.push(m)}function jf(n,e,r){let s=n[0],h=s.x,p=s.y;e(s);const m=[s];for(let y=1;y<n.length;y++){const b=n[y],{x:w,y:A}=b;e(b),Uf(m,h,p,w,A,s,b,e,r),h=w,p=A,s=b}return m}function $f(n,e,r,s){if(s(e,r)){const h=e.add(r)._mult(.5);$f(n,e,h,s),$f(n,h,r,s)}else n.push(r)}function n_(n,e){let r=n[0];const s=[r];for(let h=1;h<n.length;h++){const p=n[h];$f(s,r,p,e),r=p}return s}const Gf=Math.pow(2,14)-1,gm=-Gf-1;function Hf(n,e){const r=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=Be(r,gm,Gf),n.y=Be(s,gm,Gf),(r<n.x||r>n.x+1||s<n.y||s>n.y+1)&&Cr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function tc(n,e,r){const s=n.loadGeometry(),h=n.extent,p=bn/h;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:w,projection:A}=r,k=z=>{const G=Os((e.x+z.x/h)/m),H=qo((e.y+z.y/h)/m),K=A.project(G,H);z.x=(K.x*y-b)*h,z.y=(K.y*y-w)*h};for(let z=0;z<s.length;z++)if(1!==n.type)s[z]=jf(s[z],k,1);else{const G=[];for(const H of s[z])H.x<0||H.x>=h||H.y<0||H.y>=h||(k(H),G.push(H));s[z]=G}}for(const m of s)for(const y of m)Hf(y,p);return s}function iu(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?tc(n):[]}}function Dd(n,e,r,s,h){n.emplaceBack(2*e+(s+1)/2,2*r+(h+1)/2)}function Rh(n,e,r){n.emplaceBack(e.x,e.y,e.z,16384*r[0],16384*r[1],16384*r[2])}class Zf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Bt,this.indexArray=new yn,this.segments=new Oi,this.programConfigurations=new Kc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,h){const p=this.layers[0],m=[];let y=null;"circle"===p.type&&(y=p.layout.get("circle-sort-key"));for(const{feature:w,id:A,index:k,sourceLayerIndex:z}of e){const G=this.layers[0]._featureFilter.needGeometry,H=iu(w,G);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),H,s))continue;const K=y?y.evaluate(H,{},s):void 0,ie={id:A,properties:w.properties,type:w.type,sourceLayerIndex:z,index:k,geometry:G?H.geometry:tc(w,s,h),patterns:{},sortKey:K};m.push(ie)}y&&m.sort((w,A)=>w.sortKey-A.sortKey);let b=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new zt,b=h.projection);for(const w of m){const{geometry:A,index:k,sourceLayerIndex:z}=w,G=e[k].feature;this.addFeature(w,A,k,r.availableImages,s,b),r.featureIndex.insert(G,A,k,z,this.index)}}update(e,r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Wy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,h,p,m){for(const y of r)for(const b of y){const w=b.x,A=b.y;if(w<0||w>=bn||A<0||A>=bn)continue;if(m){const G=m.projectTilePoint(w,A,p),H=m.upVector(p,w,A),K=this.globeExtVertexArray;Rh(K,G,H),Rh(K,G,H),Rh(K,G,H),Rh(K,G,H)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=k.vertexLength;Dd(this.layoutVertexArray,w,A,-1,-1),Dd(this.layoutVertexArray,w,A,1,-1),Dd(this.layoutVertexArray,w,A,1,1),Dd(this.layoutVertexArray,w,A,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,p)}}function _m(n,e){for(let r=0;r<n.length;r++)if(su(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(su(n,e[r]))return!0;return!!Lh(n,e)}function Fs(n,e,r){return!!su(n,e)||!!ou(e,n,r)}function Td(n,e){if(1===n.length)return vm(e,n[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let h=0;h<s.length;h++)if(su(n,s[h]))return!0}for(let r=0;r<n.length;r++)if(vm(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Lh(n,e[r]))return!0;return!1}function ym(n,e,r){if(n.length>1){if(Lh(n,e))return!0;for(let s=0;s<e.length;s++)if(ou(e[s],n,r))return!0}for(let s=0;s<n.length;s++)if(ou(n[s],e,r))return!0;return!1}function Lh(n,e){if(0===n.length||0===e.length)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],h=n[r+1];for(let p=0;p<e.length-1;p++)if(fs(s,h,e[p],e[p+1]))return!0}return!1}function fs(n,e,r,s){return _r(n,r,s)!==_r(e,r,s)&&_r(n,e,r)!==_r(n,e,s)}function ou(n,e,r){const s=r*r;if(1===e.length)return n.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(qf(n,e[h-1],e[h])<s)return!0;return!1}function qf(n,e,r){const s=e.distSqr(r);if(0===s)return n.distSqr(e);const h=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/s;return n.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function vm(n,e){let r,s,h,p=!1;for(let m=0;m<n.length;m++){r=n[m];for(let y=0,b=r.length-1;y<r.length;b=y++)s=r[y],h=r[b],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(p=!p)}return p}function su(n,e){let r=!1;for(let s=0,h=n.length-1;s<n.length;h=s++){const p=n[s],m=n[h];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(r=!r)}return r}function Wf(n,e,r,s,h){for(const m of n)if(e<=m.x&&r<=m.y&&s>=m.x&&h>=m.y)return!0;const p=[new Ge(e,r),new Ge(e,h),new Ge(s,h),new Ge(s,r)];if(n.length>2)for(const m of p)if(su(n,m))return!0;for(let m=0;m<n.length-1;m++)if(r_(n[m],n[m+1],p))return!0;return!1}function r_(n,e,r){const s=r[0],h=r[2];if(n.x<s.x&&e.x<s.x||n.x>h.x&&e.x>h.x||n.y<s.y&&e.y<s.y||n.y>h.y&&e.y>h.y)return!1;const p=_r(n,e,r[0]);return p!==_r(n,e,r[1])||p!==_r(n,e,r[2])||p!==_r(n,e,r[3])}function au(n,e,r){const s=e.paint.get(n).value;return"constant"===s.kind?s.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Md(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Xf(n,e,r,s,h){if(!e[0]&&!e[1])return n;const p=Ge.convert(e)._mult(h);"viewport"===r&&p._rotate(-s);const m=[];for(let y=0;y<n.length;y++)m.push(n[y].sub(p));return m}function xm(n,e,r,s){const h=Ge.convert(n)._mult(s);return"viewport"===e&&h._rotate(-r),h}Zt(Zf,"CircleBucket",{omit:["layers"]});const i_=new me({"circle-sort-key":new se(rt.layout_circle["circle-sort-key"])});var o_={paint:new me({"circle-radius":new se(rt.paint_circle["circle-radius"]),"circle-color":new se(rt.paint_circle["circle-color"]),"circle-blur":new se(rt.paint_circle["circle-blur"]),"circle-opacity":new se(rt.paint_circle["circle-opacity"]),"circle-translate":new Y(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new Y(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Y(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Y(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new se(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new se(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new se(rt.paint_circle["circle-stroke-opacity"])}),layout:i_};function bm(n,e,r,s,h,p,m,y,b){if(p&&n.queryGeometry.isAboveHorizon)return!1;p&&(b*=n.pixelToTileUnitsFactor);const w=n.tileID.canonical,A=r.projection.upVectorScale(w,r.center.lat,r.worldSize).metersToTile;for(const k of e)for(const z of k){const G=z.add(y),H=h&&r.elevation?r.elevation.exaggeration()*h.getElevationAt(G.x,G.y,!0):0,K=r.projection.projectTilePoint(G.x,G.y,w);if(H>0){const de=r.projection.upVector(w,G.x,G.y);K.x+=de[0]*A*H,K.y+=de[1]*A*H,K.z+=de[2]*A*H}const ie=p?G:s_(K.x,K.y,K.z,s),ue=p?n.tilespaceRays.map(de=>a_(de,H)):n.queryGeometry.screenGeometry,be=Pc([],[K.x,K.y,K.z,1],s);if(!m&&p?b*=be[3]/r.cameraToCenterDistance:m&&!p&&(b*=r.cameraToCenterDistance/be[3]),p){const de=qo((z.y/bn+w.y)/(1<<w.z));b/=r.projection.pixelsPerMeter(de,1)/Ba(1,de)}if(Fs(ue,ie,b))return!0}return!1}function s_(n,e,r,s){const h=Pc([],[n,e,r,1],s);return new Ge(h[0]/h[3],h[1]/h[3])}const lu=Ou(0,0,0),nc=Ou(0,0,1);function a_(n,e){const r=bh();return lu[2]=e,n.intersectsPlane(lu,nc,r),new Ge(r[0],r[1])}class wm extends Zf{}function l_(n,{width:e,height:r},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*r*s);return n.width=e,n.height=r,n.data=h,n}function c_(n,e,r){const{width:s,height:h}=e;s===n.width&&h===n.height||(Sd(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,h)},r),n.width=s,n.height=h,n.data=e.data)}function Sd(n,e,r,s,h,p){if(0===h.width||0===h.height)return e;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,y=e.data;for(let b=0;b<h.height;b++){const w=((r.y+b)*n.width+r.x)*p,A=((s.y+b)*e.width+s.x)*p;for(let k=0;k<h.width*p;k++)y[A+k]=m[w+k]}return e}Zt(wm,"HeatmapBucket",{omit:["layers"]});class Fc{constructor(e,r){l_(this,e,1,r)}resize(e){c_(this,new Fc(e),1)}clone(){return new Fc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,h,p){Sd(e,r,s,h,p,1)}}class qi{constructor(e,r){l_(this,e,4,r)}resize(e){c_(this,new qi(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new qi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,h,p){Sd(e,r,s,h,p,4)}}Zt(Fc,"AlphaImage"),Zt(qi,"RGBAImage");var Yf={paint:new me({"heatmap-radius":new se(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new se(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Y(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fe(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Y(rt.paint_heatmap["heatmap-opacity"])})};function kh(n){const e={},r=n.resolution||256,s=n.clips?n.clips.length:1,h=n.image||new qi({width:r,height:s}),p=(m,y,b)=>{e[n.evaluationKey]=b;const w=n.expression.evaluate(e);h.data[m+y+0]=Math.floor(255*w.r/w.a),h.data[m+y+1]=Math.floor(255*w.g/w.a),h.data[m+y+2]=Math.floor(255*w.b/w.a),h.data[m+y+3]=Math.floor(255*w.a)};if(n.clips)for(let m=0,y=0;m<s;++m,y+=4*r)for(let b=0,w=0;b<r;b++,w+=4){const A=b/(r-1),{start:k,end:z}=n.clips[m];p(y,w,k*(1-A)+z*A)}else for(let m=0,y=0;m<r;m++,y+=4)p(0,y,m/(r-1));return h}var u_={paint:new me({"hillshade-illumination-direction":new Y(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Y(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Y(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Y(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Y(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Y(rt.paint_hillshade["hillshade-accent-color"])})};const Em=Ne([{name:"a_pos",components:2,type:"Int16"}],4),{members:h_}=Em;var cu={exports:{}};function Ad(n,e,r){r=r||2;var s,h,p,m,y,b,w,A=e&&e.length,k=A?e[0]*r:n.length,z=Cm(n,0,k,r,!0),G=[];if(!z||z.next===z.prev)return G;if(A&&(z=function(K,ie,ue,be){var de,xe,Se,Me=[];for(de=0,xe=ie.length;de<xe;de++)(Se=Cm(K,ie[de]*be,de<xe-1?ie[de+1]*be:K.length,be,!1))===Se.next&&(Se.steiner=!0),Me.push(f_(Se));for(Me.sort(Tm),de=0;de<Me.length;de++)ue=d_(Me[de],ue);return ue}(n,e,z,r)),n.length>80*r){s=p=n[0],h=m=n[1];for(var H=r;H<k;H+=r)(y=n[H])<s&&(s=y),(b=n[H+1])<h&&(h=b),y>p&&(p=y),b>m&&(m=b);w=0!==(w=Math.max(p-s,m-h))?32767/w:0}return uu(z,G,r,s,h,w,0),G}function Cm(n,e,r,s,h){var p,m;if(h===ic(n,e,r,s)>0)for(p=e;p<r;p+=s)m=Sm(p,n[p],n[p+1],m);else for(p=r-s;p>=e;p-=s)m=Sm(p,n[p],n[p+1],m);return m&&Id(m,m.next)&&(Zu(m),m=m.next),m}function rc(n,e){if(!n)return n;e||(e=n);var r,s=n;do{if(r=!1,s.steiner||!Id(s,s.next)&&0!==Wi(s.prev,s,s.next))s=s.next;else{if(Zu(s),(s=e=s.prev)===s.next)break;r=!0}}while(r||s!==e);return e}function uu(n,e,r,s,h,p,m){if(n){!m&&p&&function(A,k,z,G){var H=A;do{0===H.z&&(H.z=Qf(H.x,H.y,k,z,G)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next}while(H!==A);H.prevZ.nextZ=null,H.prevZ=null,function(K){var ie,ue,be,de,xe,Se,Me,Ke,Ze=1;do{for(ue=K,K=null,xe=null,Se=0;ue;){for(Se++,be=ue,Me=0,ie=0;ie<Ze&&(Me++,be=be.nextZ);ie++);for(Ke=Ze;Me>0||Ke>0&&be;)0!==Me&&(0===Ke||!be||ue.z<=be.z)?(de=ue,ue=ue.nextZ,Me--):(de=be,be=be.nextZ,Ke--),xe?xe.nextZ=de:K=de,de.prevZ=xe,xe=de;ue=be}xe.nextZ=null,Ze*=2}while(Se>1)}(H)}(n,s,h,p);for(var y,b,w=n;n.prev!==n.next;)if(y=n.prev,b=n.next,p?Qy(n,s,h,p):Dm(n))e.push(y.i/r|0),e.push(n.i/r|0),e.push(b.i/r|0),Zu(n),n=b.next,w=b.next;else if((n=b)===w){m?1===m?uu(n=$u(rc(n),e,r),e,r,s,h,p,2):2===m&&Kf(n,e,r,s,h,p):uu(rc(n),e,r,s,h,p,1);break}}}function Dm(n){var e=n.prev,r=n,s=n.next;if(Wi(e,r,s)>=0)return!1;for(var h=e.x,p=r.x,m=s.x,y=e.y,b=r.y,w=s.y,A=h<p?h<m?h:m:p<m?p:m,k=y<b?y<w?y:w:b<w?b:w,z=h>p?h>m?h:m:p>m?p:m,G=y>b?y>w?y:w:b>w?b:w,H=s.next;H!==e;){if(H.x>=A&&H.x<=z&&H.y>=k&&H.y<=G&&Gu(h,y,p,b,m,w,H.x,H.y)&&Wi(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Qy(n,e,r,s){var h=n.prev,p=n,m=n.next;if(Wi(h,p,m)>=0)return!1;for(var y=h.x,b=p.x,w=m.x,A=h.y,k=p.y,z=m.y,G=y<b?y<w?y:w:b<w?b:w,H=A<k?A<z?A:z:k<z?k:z,K=y>b?y>w?y:w:b>w?b:w,ie=A>k?A>z?A:z:k>z?k:z,ue=Qf(G,H,e,r,s),be=Qf(K,ie,e,r,s),de=n.prevZ,xe=n.nextZ;de&&de.z>=ue&&xe&&xe.z<=be;){if(de.x>=G&&de.x<=K&&de.y>=H&&de.y<=ie&&de!==h&&de!==m&&Gu(y,A,b,k,w,z,de.x,de.y)&&Wi(de.prev,de,de.next)>=0||(de=de.prevZ,xe.x>=G&&xe.x<=K&&xe.y>=H&&xe.y<=ie&&xe!==h&&xe!==m&&Gu(y,A,b,k,w,z,xe.x,xe.y)&&Wi(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;de&&de.z>=ue;){if(de.x>=G&&de.x<=K&&de.y>=H&&de.y<=ie&&de!==h&&de!==m&&Gu(y,A,b,k,w,z,de.x,de.y)&&Wi(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;xe&&xe.z<=be;){if(xe.x>=G&&xe.x<=K&&xe.y>=H&&xe.y<=ie&&xe!==h&&xe!==m&&Gu(y,A,b,k,w,z,xe.x,xe.y)&&Wi(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function $u(n,e,r){var s=n;do{var h=s.prev,p=s.next.next;!Id(h,p)&&ep(h,s,s.next,p)&&hu(h,p)&&hu(p,h)&&(e.push(h.i/r|0),e.push(s.i/r|0),e.push(p.i/r|0),Zu(s),Zu(s.next),s=n=p),s=s.next}while(s!==n);return rc(s)}function Kf(n,e,r,s,h,p){var m=n;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&p_(m,y)){var b=Mm(m,y);return m=rc(m,m.next),b=rc(b,b.next),uu(m,e,r,s,h,p,0),void uu(b,e,r,s,h,p,0)}y=y.next}m=m.next}while(m!==n)}function Tm(n,e){return n.x-e.x}function d_(n,e){var r=function(h,p){var m,y=p,b=h.x,w=h.y,A=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var k=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(k<=b&&k>A&&(A=k,m=y.x<y.next.x?y:y.next,k===b))return m}y=y.next}while(y!==p);if(!m)return null;var z,G=m,H=m.x,K=m.y,ie=1/0;y=m;do{b>=y.x&&y.x>=H&&b!==y.x&&Gu(w<K?b:A,w,H,K,w<K?A:b,w,y.x,y.y)&&(z=Math.abs(w-y.y)/(b-y.x),hu(y,h)&&(z<ie||z===ie&&(y.x>m.x||y.x===m.x&&Jf(m,y)))&&(m=y,ie=z)),y=y.next}while(y!==G);return m}(n,e);if(!r)return e;var s=Mm(r,n);return rc(s,s.next),rc(r,r.next)}function Jf(n,e){return Wi(n.prev,n,e.prev)<0&&Wi(e.next,n,n.next)<0}function Qf(n,e,r,s,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f_(n){var e=n,r=n;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==n);return r}function Gu(n,e,r,s,h,p,m,y){return(h-m)*(e-y)>=(n-m)*(p-y)&&(n-m)*(s-y)>=(r-m)*(e-y)&&(r-m)*(p-y)>=(h-m)*(s-y)}function p_(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,s){var h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==s.i&&h.next.i!==s.i&&ep(h,h.next,r,s))return!0;h=h.next}while(h!==r);return!1}(n,e)&&(hu(n,e)&&hu(e,n)&&function(r,s){var h=r,p=!1,m=(r.x+s.x)/2,y=(r.y+s.y)/2;do{h.y>y!=h.next.y>y&&h.next.y!==h.y&&m<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next}while(h!==r);return p}(n,e)&&(Wi(n.prev,n,e.prev)||Wi(n,e.prev,e))||Id(n,e)&&Wi(n.prev,n,n.next)>0&&Wi(e.prev,e,e.next)>0)}function Wi(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Id(n,e){return n.x===e.x&&n.y===e.y}function ep(n,e,r,s){var h=Oh(Wi(n,e,r)),p=Oh(Wi(n,e,s)),m=Oh(Wi(r,s,n)),y=Oh(Wi(r,s,e));return h!==p&&m!==y||!(0!==h||!Hu(n,r,e))||!(0!==p||!Hu(n,s,e))||!(0!==m||!Hu(r,n,s))||!(0!==y||!Hu(r,e,s))}function Hu(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Oh(n){return n>0?1:n<0?-1:0}function hu(n,e){return Wi(n.prev,n,n.next)<0?Wi(n,e,n.next)>=0&&Wi(n,n.prev,e)>=0:Wi(n,e,n.prev)<0||Wi(n,n.next,e)<0}function Mm(n,e){var r=new Pd(n.i,n.x,n.y),s=new Pd(e.i,e.x,e.y),h=n.next,p=e.prev;return n.next=e,e.prev=n,r.next=h,h.prev=r,s.next=r,r.prev=s,p.next=s,s.prev=p,s}function Sm(n,e,r,s){var h=new Pd(n,e,r);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Zu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Pd(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ic(n,e,r,s){for(var h=0,p=e,m=r-s;p<r;p+=s)h+=(n[m]-n[p])*(n[p+1]+n[m+1]),m=p;return h}cu.exports=Ad,cu.exports.default=Ad,Ad.deviation=function(n,e,r,s){var h=e&&e.length,p=Math.abs(ic(n,0,h?e[0]*r:n.length,r));if(h)for(var m=0,y=e.length;m<y;m++)p-=Math.abs(ic(n,e[m]*r,m<y-1?e[m+1]*r:n.length,r));var b=0;for(m=0;m<s.length;m+=3){var w=s[m]*r,A=s[m+1]*r,k=s[m+2]*r;b+=Math.abs((n[w]-n[k])*(n[A+1]-n[w+1])-(n[w]-n[A])*(n[k+1]-n[w+1]))}return 0===p&&0===b?0:Math.abs((b-p)/p)},Ad.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,h=0;h<n.length;h++){for(var p=0;p<n[h].length;p++)for(var m=0;m<e;m++)r.vertices.push(n[h][p][m]);h>0&&r.holes.push(s+=n[h-1].length)}return r};var Rd=It(cu.exports);function Am(n,e,r,s,h){Im(n,e,r||0,s||n.length-1,h||kd)}function Im(n,e,r,s,h){for(;s>r;){if(s-r>600){var p=s-r+1,m=e-r+1,y=Math.log(p),b=.5*Math.exp(2*y/3),w=.5*Math.sqrt(y*b*(p-b)/p)*(m-p/2<0?-1:1);Im(n,e,Math.max(r,Math.floor(e-m*b/p+w)),Math.min(s,Math.floor(e+(p-m)*b/p+w)),h)}var A=n[e],k=r,z=s;for(Ld(n,r,e),h(n[s],A)>0&&Ld(n,r,s);k<z;){for(Ld(n,k,z),k++,z--;h(n[k],A)<0;)k++;for(;h(n[z],A)>0;)z--}0===h(n[r],A)?Ld(n,r,z):Ld(n,++z,s),z<=e&&(r=z+1),e<=z&&(s=z-1)}}function Ld(n,e,r){var s=n[e];n[e]=n[r],n[r]=s}function kd(n,e){return n<e?-1:n>e?1:0}function tp(n,e){const r=n.length;if(r<=1)return[n];const s=[];let h,p;for(let m=0;m<r;m++){const y=Mo(n[m]);0!==y&&(n[m].area=Math.abs(y),void 0===p&&(p=y<0),p===y<0?(h&&s.push(h),h=[n[m]]):h.push(n[m]))}if(h&&s.push(h),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(Am(s[m],e,1,s[m].length-1,Pm),s[m]=s[m].slice(0,e));return s}function Pm(n,e){return e.area-n.area}function Od(n,e,r){const s=r.patternDependencies;let h=!1;for(const p of e){const m=p.paint.get(`${n}-pattern`);m.isConstant()||(h=!0);const y=m.constantOr(null);y&&(h=!0,s[y]=!0)}return h}function Fd(n,e,r,s,h){const p=h.patternDependencies;for(const m of e){const y=m.paint.get(`${n}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:s},r,{},h.availableImages);b=b&&b.name?b.name:b,p[b]=!0,r.patterns[m.id]=b}}return r}class qu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bt,this.indexArray=new yn,this.indexArray2=new Eo,this.programConfigurations=new Kc(e.layers,e.zoom),this.segments=new Oi,this.segments2=new Oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,s,h){this.hasPattern=Od("fill",this.layers,r);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:w,sourceLayerIndex:A}of e){const k=this.layers[0]._featureFilter.needGeometry,z=iu(y,k);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),z,s))continue;const G=p?p.evaluate(z,{},s,r.availableImages):void 0,H={id:b,properties:y.properties,type:y.type,sourceLayerIndex:A,index:w,geometry:k?z.geometry:tc(y,s,h),patterns:{},sortKey:G};m.push(H)}p&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:w,sourceLayerIndex:A}=y;if(this.hasPattern){const k=Fd("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(y,b,w,s,{},r.availableImages);r.featureIndex.insert(e[w].feature,b,w,A,this.index)}}update(e,r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,h)}addFeatures(e,r,s,h,p){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,h,p,m=[]){for(const y of tp(r,500)){let b=0;for(const H of y)b+=H.length;const w=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),A=w.vertexLength,k=[],z=[];for(const H of y){if(0===H.length)continue;H!==y[0]&&z.push(k.length/2);const K=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ie=K.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ie+H.length-1,ie),k.push(H[0].x),k.push(H[0].y);for(let ue=1;ue<H.length;ue++)this.layoutVertexArray.emplaceBack(H[ue].x,H[ue].y),this.indexArray2.emplaceBack(ie+ue-1,ie+ue),k.push(H[ue].x),k.push(H[ue].y);K.vertexLength+=H.length,K.primitiveLength+=H.length}const G=Rd(k,z);for(let H=0;H<G.length;H+=3)this.indexArray.emplaceBack(A+G[H],A+G[H+1],A+G[H+2]);w.vertexLength+=b,w.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,m,h)}}Zt(qu,"FillBucket",{omit:["layers","patternFeatures"]});const Rm=new me({"fill-sort-key":new se(rt.layout_fill["fill-sort-key"])});var Bd={paint:new me({"fill-antialias":new Y(rt.paint_fill["fill-antialias"]),"fill-opacity":new se(rt.paint_fill["fill-opacity"]),"fill-color":new se(rt.paint_fill["fill-color"]),"fill-outline-color":new se(rt.paint_fill["fill-outline-color"]),"fill-translate":new Y(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new Y(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new se(rt.paint_fill["fill-pattern"])}),layout:Rm};const Nd=Ne([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Lm=Ne([{name:"a_centroid_pos",components:2,type:"Uint16"}]),np=Ne([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:km}=Nd;var Wu={},Fh=sn,Om=du;function du(n,e,r,s,h){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=h,n.readFields(m_,this,e)}function m_(n,e,r){1==n?e.id=r.readVarint():2==n?function(s,h){for(var p=s.readVarint()+s.pos;s.pos<p;){var m=h._keys[s.readVarint()],y=h._values[s.readVarint()];h.properties[m]=y}}(r,e):3==n?e.type=r.readVarint():4==n&&(e._geometry=r.pos)}function g_(n){for(var e,r,s=0,h=0,p=n.length,m=p-1;h<p;m=h++)s+=((r=n[m]).x-(e=n[h]).x)*(e.y+r.y);return s}du.types=["Unknown","Point","LineString","Polygon"],du.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,s=1,h=0,p=0,m=0,y=[];n.pos<r;){if(h<=0){var b=n.readVarint();s=7&b,h=b>>3}if(h--,1===s||2===s)p+=n.readSVarint(),m+=n.readSVarint(),1===s&&(e&&y.push(e),e=[]),e.push(new Fh(p,m));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},du.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,s=0,h=0,p=0,m=1/0,y=-1/0,b=1/0,w=-1/0;n.pos<e;){if(s<=0){var A=n.readVarint();r=7&A,s=A>>3}if(s--,1===r||2===r)(h+=n.readSVarint())<m&&(m=h),h>y&&(y=h),(p+=n.readSVarint())<b&&(b=p),p>w&&(w=p);else if(7!==r)throw new Error("unknown command "+r)}return[m,b,y,w]},du.prototype.toGeoJSON=function(n,e,r){var s,h,p=this.extent*Math.pow(2,r),m=this.extent*n,y=this.extent*e,b=this.loadGeometry(),w=du.types[this.type];function A(G){for(var H=0;H<G.length;H++){var K=G[H];G[H]=[360*(K.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+y)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(s=0;s<b.length;s++)k[s]=b[s][0];A(b=k);break;case 2:for(s=0;s<b.length;s++)A(b[s]);break;case 3:for(b=function(G){var H=G.length;if(H<=1)return[G];for(var K,ie,ue=[],be=0;be<H;be++){var de=g_(G[be]);0!==de&&(void 0===ie&&(ie=de<0),ie===de<0?(K&&ue.push(K),K=[G[be]]):K.push(G[be]))}return K&&ue.push(K),ue}(b),s=0;s<b.length;s++)for(h=0;h<b[s].length;h++)A(b[s][h])}1===b.length?b=b[0]:w="Multi"+w;var z={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(z.id=this.id),z};var Fm=Om,zd=rp;function rp(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(ev,this,e),this.length=this._features.length}function ev(n,e,r){15===n?e.version=r.readVarint():1===n?e.name=r.readString():5===n?e.extent=r.readVarint():2===n?e._features.push(r.pos):3===n?e._keys.push(r.readString()):4===n&&e._values.push(function(s){for(var h=null,p=s.readVarint()+s.pos;s.pos<p;){var m=s.readVarint()>>3;h=1===m?s.readString():2===m?s.readFloat():3===m?s.readDouble():4===m?s.readVarint64():5===m?s.readVarint():6===m?s.readSVarint():7===m?s.readBoolean():null}return h}(r))}rp.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new Fm(this._pbf,e,this.extent,this._keys,this._values)};var Bm=zd;function __(n,e,r){if(3===n){var s=new Bm(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}var Vd=Wu.VectorTile=function(n,e){this.layers=n.readFields(__,{},e)},Ud=Wu.VectorTileFeature=Om;function jd(n,e,r,s){const h=[],p=0===s?(m,y,b,w,A,k)=>{m.push(new Ge(k,b+(k-y)/(w-y)*(A-b)))}:(m,y,b,w,A,k)=>{m.push(new Ge(y+(k-b)/(A-b)*(w-y),k))};for(const m of n){const y=[];for(const b of m){if(b.length<=2)continue;const w=[];for(let z=0;z<b.length-1;z++){const G=b[z].x,H=b[z].y,K=b[z+1].x,ie=b[z+1].y,ue=0===s?G:H,be=0===s?K:ie;ue<e?be>e&&p(w,G,H,K,ie,e):ue>r?be<r&&p(w,G,H,K,ie,r):w.push(b[z]),be<e&&ue>=e&&p(w,G,H,K,ie,e),be>r&&ue<=r&&p(w,G,H,K,ie,r)}let A=b[b.length-1];const k=0===s?A.x:A.y;k>=e&&k<=r&&w.push(A),w.length&&(A=w[w.length-1],w[0].x===A.x&&w[0].y===A.y||w.push(w[0]),y.push(w))}y.length&&h.push(y)}return h}Wu.VectorTileLayer=zd;const ll=Ud.types,y_=Math.pow(2,13);function Xu(n,e,r,s,h,p,m,y){n.emplaceBack((e<<1)+m,(r<<1)+p,(Math.floor(s*y_)<<1)+h,Math.round(y))}function Bh(n,e,r){n.emplaceBack(e.x,e.y,e.z,16384*r[0],16384*r[1],16384*r[2])}class Nm{constructor(){this.acc=new Ge(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ge(e.x,e.y),this.max=new Ge(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,h=this.max;e.x<s.x?s.x=e.x:e.x>h.x&&(h.x=e.x),e.y<s.y?s.y=e.y:e.y>h.y&&(h.y=e.y),((0===e.x||e.x===bn)&&e.x===r.x)!=((0===e.y||e.y===bn)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,mr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>bn!=e.x>bn&&this.addBorderIntersection(1,mr(r.y,e.y,(bn-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,mr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>bn!=e.y>bn&&this.addBorderIntersection(3,mr(r.x,e.x,(bn-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((r,s)=>r+s.edges,0);return 0!==e?this.acc.div(e)._round():new Ge(0,0)}span(){return new Ge(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Nh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new mt,this.centroidVertexArray=new pa,this.indexArray=new yn,this.programConfigurations=new Kc(e.layers,e.zoom),this.segments=new Oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,s,h){this.features=[],this.hasPattern=Od("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const m=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*m/(m*m+1)/bn/(1<<p.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:m,index:y,sourceLayerIndex:b}of e){const w=this.layers[0]._featureFilter.needGeometry,A=iu(p,w);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),A,s))continue;const k={id:m,sourceLayerIndex:b,index:y,geometry:w?A.geometry:tc(p,s,h),properties:p.properties,type:p.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Fd("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,y,s,{},r.availableImages,h),r.featureIndex.insert(p,k.geometry,y,b,this.index,z)}this.sortBorders()}addFeatures(e,r,s,h,p){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,r,s,h,p)}this.sortBorders()}update(e,r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,km),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,np.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Lm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,h,p,m,y){const b=[new Ge(0,0),new Ge(bn,bn)],w=y.projection,A="globe"===w.name,k=this.enableTerrain&&!A?new Nm:null,z="Polygon"===ll[e.type];A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new zt);const G=tp(r,500);for(let ue=G.length-1;ue>=0;ue--){const be=G[ue];(0===be.length||(H=be[0]).every(de=>de.x<=0)||H.every(de=>de.x>=bn)||H.every(de=>de.y<=0)||H.every(de=>de.y>=bn))&&G.splice(ue,1)}var H;let K;if(A)K=op(G,b,h);else{K=[];for(const ue of G)K.push({polygon:ue,bounds:b})}const ie=z?this.edgeRadius:0;for(const{polygon:ue,bounds:be}of K){let de=0,xe=0;for(const Me of ue)z&&!Me[0].equals(Me[Me.length-1])&&Me.push(Me[0]),xe+=z?Me.length-1:Me.length;const Se=this.segments.prepareSegment((z?5:4)*xe,this.layoutVertexArray,this.indexArray);if(z){const Me=[],Ke=[];de=Se.vertexLength;for(const st of ue){let Ft,et;st.length&&st!==ue[0]&&Ke.push(Me.length/2),Ft=st[1].sub(st[0])._perp()._unit();for(let _t=1;_t<st.length;_t++){const yt=st[_t],Pt=st[_t===st.length-1?1:_t+1];let{x:jt,y:ot}=yt;if(ie){et=Pt.sub(yt)._perp()._unit();const Kt=Ft.add(et)._unit(),dn=ie*Math.min(4,1/(Ft.x*Kt.x+Ft.y*Kt.y));jt+=dn*Kt.x,ot+=dn*Kt.y,Ft=et}Xu(this.layoutVertexArray,jt,ot,0,0,1,1,0),Se.vertexLength++,Me.push(yt.x,yt.y),A&&Bh(this.layoutVertexExtArray,w.projectTilePoint(jt,ot,h),w.upVector(h,jt,ot))}}const Ze=Rd(Me,Ke);for(let st=0;st<Ze.length;st+=3)this.indexArray.emplaceBack(de+Ze[st],de+Ze[st+2],de+Ze[st+1]),Se.primitiveLength++}for(const Me of ue){k&&Me.length&&k.startRing(Me[0]);let Ke,Ze,st,Ft=Me.length>4&&$m(Me[Me.length-2],Me[0],Me[1]),et=ie?Vm(Me[Me.length-2],Me[0],Me[1],ie):0;Ze=Me[1].sub(Me[0])._perp()._unit();let _t=!0;for(let yt=1,Pt=0;yt<Me.length;yt++){let jt=Me[yt-1],ot=Me[yt];const Kt=Me[yt===Me.length-1?1:yt+1];if(k&&z&&k.currentPolyCount.top++,jm(ot,jt,be)){ie&&(Ze=Kt.sub(ot)._perp()._unit(),_t=!_t);continue}k&&k.append(ot,jt);const dn=ot.sub(jt)._perp(),Qt=dn.x/(Math.abs(dn.x)+Math.abs(dn.y)),Xn=dn.y>0?1:0,Dt=jt.dist(ot);if(Pt+Dt>32768&&(Pt=0),ie){st=Kt.sub(ot)._perp()._unit();let qn=Um(jt,ot,Kt,zm(Ze,st),ie);isNaN(qn)&&(qn=0);const An=ot.sub(jt)._unit();jt=jt.add(An.mult(et))._round(),ot=ot.add(An.mult(-qn))._round(),et=qn,Ze=st}const xn=Se.vertexLength,Yn=Me.length>4&&$m(jt,ot,Kt);let Rr=pr(Pt,Ft,_t);if(Xu(this.layoutVertexArray,jt.x,jt.y,Qt,Xn,0,0,Rr),Xu(this.layoutVertexArray,jt.x,jt.y,Qt,Xn,0,1,Rr),Pt+=Dt,Rr=pr(Pt,Yn,!_t),Ft=Yn,Xu(this.layoutVertexArray,ot.x,ot.y,Qt,Xn,0,0,Rr),Xu(this.layoutVertexArray,ot.x,ot.y,Qt,Xn,0,1,Rr),Se.vertexLength+=4,this.indexArray.emplaceBack(xn+0,xn+1,xn+2),this.indexArray.emplaceBack(xn+1,xn+3,xn+2),Se.primitiveLength+=2,ie){const qn=de+(1===yt?Me.length-2:yt-2),An=1===yt?de:qn+1;if(this.indexArray.emplaceBack(xn+1,qn,xn+3),this.indexArray.emplaceBack(qn,An,xn+3),Se.primitiveLength+=2,void 0===Ke&&(Ke=xn),!jm(Kt,Me[yt],be)){const ri=yt===Me.length-1?Ke:Se.vertexLength;this.indexArray.emplaceBack(xn+2,xn+3,ri),this.indexArray.emplaceBack(xn+3,ri+1,ri),this.indexArray.emplaceBack(xn+3,An,ri+1),Se.primitiveLength+=3}_t=!_t}if(A){const qn=this.layoutVertexExtArray,An=w.projectTilePoint(jt.x,jt.y,h),ri=w.projectTilePoint(ot.x,ot.y,h),Kn=w.upVector(h,jt.x,jt.y),jn=w.upVector(h,ot.x,ot.y);Bh(qn,An,Kn),Bh(qn,An,Kn),Bh(qn,ri,jn),Bh(qn,ri,jn)}}z&&(de+=Me.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const ue=k.borders,be=this.featuresOnBorder.push(k)-1;for(let de=0;de<4;de++)ue[de][0]!==Number.MAX_VALUE&&this.borders[de].push(be)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,m,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,r,s=!0){let h,p;if(e)if(0!==e.y){const y=r.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else h=Math.ceil(7*(e.x+450)),p=0;else h=0,p=+s;let m=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(m++,h,p);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(m++,0,p),this.centroidVertexArray.emplace(m++,h,p)}}}function zm(n,e){const r=n.add(e)._unit();return n.x*r.x+n.y*r.y}function Vm(n,e,r,s){const h=e.sub(n)._perp()._unit(),p=r.sub(e)._perp()._unit();return Um(n,e,r,zm(h,p),s)}function Um(n,e,r,s,h){const p=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(r)/3,h*p/s)}function jm(n,e,r){return n.x<r[0].x&&e.x<r[0].x||n.x>r[1].x&&e.x>r[1].x||n.y<r[0].y&&e.y<r[0].y||n.y>r[1].y&&e.y>r[1].y}function $m(n,e,r){if(n.x<0||n.x>=bn||e.x<0||e.x>=bn||r.x<0||r.x>=bn)return!1;const s=r.sub(e),h=s.perp(),p=n.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function pr(n,e,r){const s=e?2|n:-3&n;return r?1|s:-2&s}function ip(){const n=Math.PI/32,e=Math.tan(n),r=Ed;return r*Math.sqrt(1+2*e*e)-r}function op(n,e,r){const s=1<<r.z,h=Os(r.x/s),p=Os((r.x+1)/s),m=qo(r.y/s),y=qo((r.y+1)/s);return function(b,w,A,k,z=0,G){const H=[];if(!b.length||!A||!k)return H;const K=(Me,Ke)=>{for(const Ze of Me)H.push({polygon:Ze,bounds:Ke})},ie=Math.ceil(Math.log2(A)),ue=Math.ceil(Math.log2(k)),be=ie-ue,de=[];for(let Me=0;Me<Math.abs(be);Me++)de.push(be>0?0:1);for(let Me=0;Me<Math.min(ie,ue);Me++)de.push(0),de.push(1);let xe=b;if(xe=jd(xe,w[0].y-z,w[1].y+z,1),xe=jd(xe,w[0].x-z,w[1].x+z,0),!xe.length)return H;const Se=[];for(de.length?Se.push({polygons:xe,bounds:w,depth:0}):K(xe,w);Se.length;){const Me=Se.pop(),Ke=Me.depth,Ze=de[Ke],st=Me.bounds[0],Ft=Me.bounds[1],et=0===Ze?st.x:st.y,_t=0===Ze?Ft.x:Ft.y,yt=G?G(Ze,et,_t):.5*(et+_t),Pt=jd(Me.polygons,et-z,yt+z,Ze),jt=jd(Me.polygons,yt-z,_t+z,Ze);if(Pt.length){const ot=[st,new Ge(0===Ze?yt:Ft.x,1===Ze?yt:Ft.y)];de.length>Ke+1?Se.push({polygons:Pt,bounds:ot,depth:Ke+1}):K(Pt,ot)}if(jt.length){const ot=[new Ge(0===Ze?yt:st.x,1===Ze?yt:st.y),Ft];de.length>Ke+1?Se.push({polygons:jt,bounds:ot,depth:Ke+1}):K(jt,ot)}}return H}(n,e,Math.ceil((p-h)/11.25),Math.ceil((m-y)/11.25),1,(b,w,A)=>{if(0===b)return.5*(w+A);{const k=qo((r.y+w/bn)/s);return(al(.5*(qo((r.y+A/bn)/s)+k))*s-r.y)*bn}})}Zt(Nh,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(Nm,"PartMetadata");const Gm=new me({"fill-extrusion-edge-radius":new Y(rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var v_={paint:new me({"fill-extrusion-opacity":new Y(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new se(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Y(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Y(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new se(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new se(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new se(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Y(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Y(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Y(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Y(rt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Gm};function Hm(n,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class zh{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=Vh(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=(m=this.y,y=this.z,b=Hm(256*(p=this.x),256*(m=Math.pow(2,y)-m-1),y),w=Hm(256*(p+1),256*(m+1),y),b[0]+","+b[1]+","+w[0]+","+w[1]),h=function(p,m,y){let b,w="";for(let A=p;A>0;A--)b=1<<A-1,w+=(m&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);var p,m,y,b,w;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Zm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Vh(e,r.z,r.z,r.x,r.y)}}class ns{constructor(e,r,s,h,p){this.overscaledZ=e,this.wrap=r,this.canonical=new zh(s,+h,+p),this.key=0===r&&e===s?this.canonical.key:Vh(r,e,s,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new ns(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ns(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Vh(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Vh(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new ns(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new ns(r,this.wrap,r,s,h),new ns(r,this.wrap,r,s+1,h),new ns(r,this.wrap,r,s,h+1),new ns(r,this.wrap,r,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ns(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ns(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Zm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vh(n,e,r,s,h){const p=1<<Math.min(r,22);let m=p*(h%p)+s%p;return n&&r<22&&(m+=p*p*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}Zt(zh,"CanonicalTileID"),Zt(ns,"OverscaledTileID",{omit:["projMatrix"]});class Yu extends Ge{constructor(e,r,s){super(e,r),this.z=s}}function $d(n,e){return n.x*e.x+n.y*e.y}function sp(n,e){if(1===n.length){let r=0;const s=e[r++];let h;for(;!h||s.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const p=e[r],m=n[0],y=h.sub(s),b=p.sub(s),w=m.sub(s),A=$d(y,y),k=$d(y,b),z=$d(b,b),G=$d(w,y),H=$d(w,b),K=A*z-k*k,ie=(z*G-k*H)/K,ue=(A*H-k*G)/K,be=s.z*(1-ie-ue)+h.z*ie+p.z*ue;if(isFinite(be))return be}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function ap(n,e,r,s,h,p,m,y){const b=m*h.getElevationAt(n,e,!0,!0),w=0!==p[0],A=w?0===p[1]?m*(p[0]/7-450):m*function(k,z,G){const H=Math.floor(z[0]/8),K=Math.floor(z[1]/8),ie=10*(z[0]-8*H),ue=10*(z[1]-8*K),be=k.getElevationAt(H,K,!0,!0),de=k.getMeterToDEM(G),xe=Math.floor(.5*(ie*de-1)),Se=Math.floor(.5*(ue*de-1)),Me=k.tileCoordToPixel(H,K),Ke=2*xe+1,Ze=2*Se+1,st=(dn=Ke,Qt=Ze,[(jt=k).getElevationAtPixel(ot=Me.x-xe,Kt=Me.y-Se,!0),jt.getElevationAtPixel(ot+Qt,Kt,!0),jt.getElevationAtPixel(ot,Kt+Qt,!0),jt.getElevationAtPixel(ot+dn,Kt+Qt,!0)]),Ft=Math.abs(st[0]-st[1]),et=Math.abs(st[2]-st[3]),_t=Math.abs(st[0]-st[2])+Math.abs(st[1]-st[3]),yt=Math.min(.25,.5*de*(Ft+et)/Ke),Pt=Math.min(.25,.5*de*_t/Ze);var jt,ot,Kt,dn,Qt;return be+Math.max(yt*ie,Pt*ue)}(h,p,y):b;return{base:b+(0===r)?-1:r,top:w?Math.max(A+s,b+r+2):b+s}}const fu=Ne([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:x_}=fu,lp=Ne([{name:"a_packed",components:4,type:"Float32"}]),{members:cp}=lp,b_=Ud.types,tv=Math.cos(Math.PI/180*37.5);class up{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Qe,this.layoutVertexArray2=new Lt,this.indexArray=new yn,this.programConfigurations=new Kc(e.layers,e.zoom),this.segments=new Oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,h){this.hasPattern=Od("line",this.layers,r);const p=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:A,id:k,index:z,sourceLayerIndex:G}of e){const H=this.layers[0]._featureFilter.needGeometry,K=iu(A,H);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),K,s))continue;const ie=p?p.evaluate(K,{},s):void 0,ue={id:k,properties:A.properties,type:A.type,sourceLayerIndex:G,index:z,geometry:H?K.geometry:tc(A,s,h),patterns:{},sortKey:ie};m.push(ue)}p&&m.sort((A,k)=>A.sortKey-k.sortKey);const{lineAtlas:y,featureIndex:b}=r,w=this.addConstantDashes(y);for(const A of m){const{geometry:k,index:z,sourceLayerIndex:G}=A;if(w&&this.addFeatureDashes(A,y),this.hasPattern){const H=Fd("line",this.layers,A,this.zoom,r);this.patternFeatures.push(H)}else this.addFeature(A,k,z,s,y.positions,r.availableImages);b.insert(e[z].feature,k,z,G,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==p.kind)r=!0;else{const m=p.value,y=h.value;if(!y)continue;e.addDash(y,m)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===m.kind)continue;let y,b;if("constant"===p.kind){if(y=p.value,!y)continue}else y=p.evaluate({zoom:s},e);b="constant"===m.kind?m.value:m.evaluate({zoom:s},e),r.addDash(y,b),e.patterns[h.id]=r.getKey(y,b)}}update(e,r,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,h)}addFeatures(e,r,s,h,p){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,cp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,x_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,h,p,m){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),A=y.get("line-miter-limit"),k=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of r)this.addLine(z,e,b,w,A,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,m,h)}addLine(e,r,s,h,p,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<e.length-1;ue++)this.totalDistance+=e[ue].dist(e[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===b_[r.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let w=0;for(;w<b-1&&e[w].equals(e[w+1]);)w++;if(b<(y?3:2))return;"bevel"===s&&(p=1.05);const A=this.overscaling<=16?15*bn/(512*this.overscaling):0,k=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let z,G,H,K,ie;this.e1=this.e2=-1,y&&(z=e[b-2],ie=e[w].sub(z)._unit()._perp());for(let ue=w;ue<b;ue++){if(H=ue===b-1?y?e[w+1]:void 0:e[ue+1],H&&e[ue].equals(H))continue;ie&&(K=ie),z&&(G=z),z=e[ue],ie=H?H.sub(z)._unit()._perp():K,K=K||ie;let be=K.add(ie);0===be.x&&0===be.y||be._unit();const de=K.x*ie.x+K.y*ie.y,xe=be.x*ie.x+be.y*ie.y,Se=0!==xe?1/xe:1/0,Me=2*Math.sqrt(2-2*xe),Ke=xe<tv&&G&&H,Ze=K.x*ie.y-K.y*ie.x>0;if(Ke&&ue>w){const et=z.dist(G);if(et>2*A){const _t=z.sub(z.sub(G)._mult(A/et)._round());this.updateDistance(G,_t),this.addCurrentVertex(_t,K,0,0,k),G=_t}}const st=G&&H;let Ft=st?s:y?"butt":h;if(st&&"round"===Ft&&(Se<m?Ft="miter":Se<=2&&(Ft="fakeround")),"miter"===Ft&&Se>p&&(Ft="bevel"),"bevel"===Ft&&(Se>2&&(Ft="flipbevel"),Se<p&&(Ft="miter")),G&&this.updateDistance(G,z),"miter"===Ft)be._mult(Se),this.addCurrentVertex(z,be,0,0,k);else if("flipbevel"===Ft){if(Se>100)be=ie.mult(-1);else{const et=Se*K.add(ie).mag()/K.sub(ie).mag();be._perp()._mult(et*(Ze?-1:1))}this.addCurrentVertex(z,be,0,0,k),this.addCurrentVertex(z,be.mult(-1),0,0,k)}else if("bevel"===Ft||"fakeround"===Ft){const et=-Math.sqrt(Se*Se-1),_t=Ze?et:0,yt=Ze?0:et;if(G&&this.addCurrentVertex(z,K,_t,yt,k),"fakeround"===Ft){const Pt=Math.round(180*Me/Math.PI/20);for(let jt=1;jt<Pt;jt++){let ot=jt/Pt;if(.5!==ot){const dn=ot-.5;ot+=ot*dn*(ot-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*dn*dn+(.848013+de*(.215638*de-1.06021)))}const Kt=ie.sub(K)._mult(ot)._add(K)._unit()._mult(Ze?-1:1);this.addHalfVertex(z,Kt.x,Kt.y,!1,Ze,0,k)}}H&&this.addCurrentVertex(z,ie,-_t,-yt,k)}else if("butt"===Ft)this.addCurrentVertex(z,be,0,0,k);else if("square"===Ft){const et=G?1:-1;G||this.addCurrentVertex(z,be,et,et,k),this.addCurrentVertex(z,be,0,0,k),G&&this.addCurrentVertex(z,be,et,et,k)}else"round"===Ft&&(G&&(this.addCurrentVertex(z,K,0,0,k),this.addCurrentVertex(z,K,1,1,k,!0)),H&&(this.addCurrentVertex(z,ie,-1,-1,k,!0),this.addCurrentVertex(z,ie,0,0,k)));if(Ke&&ue<b-1){const et=z.dist(H);if(et>2*A){const _t=z.add(H.sub(z)._mult(A/et)._round());this.updateDistance(z,_t),this.addCurrentVertex(_t,ie,0,0,k),z=_t}}}}addCurrentVertex(e,r,s,h,p,m=!1){const y=r.y*h-r.x,b=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,m,!1,s,p),this.addHalfVertex(e,y,b,m,!0,-h,p)}addHalfVertex({x:e,y:r},s,h,p,m,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),m?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}Zt(up,"LineBucket",{omit:["layers","patternFeatures"]});const nv=new me({"line-cap":new se(rt.layout_line["line-cap"]),"line-join":new se(rt.layout_line["line-join"]),"line-miter-limit":new Y(rt.layout_line["line-miter-limit"]),"line-round-limit":new Y(rt.layout_line["line-round-limit"]),"line-sort-key":new se(rt.layout_line["line-sort-key"])});var qm={paint:new me({"line-opacity":new se(rt.paint_line["line-opacity"]),"line-color":new se(rt.paint_line["line-color"]),"line-translate":new Y(rt.paint_line["line-translate"]),"line-translate-anchor":new Y(rt.paint_line["line-translate-anchor"]),"line-width":new se(rt.paint_line["line-width"]),"line-gap-width":new se(rt.paint_line["line-gap-width"]),"line-offset":new se(rt.paint_line["line-offset"]),"line-blur":new se(rt.paint_line["line-blur"]),"line-dasharray":new se(rt.paint_line["line-dasharray"]),"line-pattern":new se(rt.paint_line["line-pattern"]),"line-gradient":new fe(rt.paint_line["line-gradient"]),"line-trim-offset":new Y(rt.paint_line["line-trim-offset"])}),layout:nv};const hp=new class extends se{possiblyEvaluate(n,e){return e=new P(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,r,s){return e=gr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,r,s)}}(qm.paint.properties["line-width"].specification);function w_(n,e){return e>0?e+2*n:n}hp.useIntegerZoom=!0;const E_=Ne([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ku=Ne([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),C_=Ne([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ne([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wm=Ne([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Gd=Ne([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Xm=Ne([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ym=Ne([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ne([{name:"triangle",components:3,type:"Uint16"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ne([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ne([{type:"Float32",name:"offsetX"}]),Ne([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const cl=128;function dp(n,e){const{expression:r}=e;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new P(n+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=r;let p=0;for(;p<s.length&&s[p]<=n;)p++;p=Math.max(0,p-1);let m=p;for(;m<s.length&&s[m]<n+1;)m++;m=Math.min(s.length-1,m);const y=s[p],b=s[m];return"composite"===r.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new P(y)),maxSize:r.evaluate(new P(b)),interpolationType:h}}}function Hd(n,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:h}){return"source"===n.kind?s/cl:"composite"===n.kind?mr(s/cl,h/cl,r):e}function Ju(n,e){let r=0,s=0;if("constant"===n.kind)s=n.layoutSize;else if("source"!==n.kind){const{interpolationType:h,minZoom:p,maxZoom:m}=n,y=h?Be(Ei.interpolationFactor(h,e,p,m),0,1):0;"camera"===n.kind?s=mr(n.minSize,n.maxSize,y):r=y}return{uSizeT:r,uSize:s}}var Km=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:cl,evaluateSizeForFeature:Hd,evaluateSizeForZoom:Ju,getSizeData:dp});function D_(n,e,r){return n.sections.forEach(s=>{s.text=function(h,p,m){const y=p.layout.get("text-transform").evaluate(m,{});return"uppercase"===y?h=h.toLocaleUpperCase():"lowercase"===y&&(h=h.toLocaleLowerCase()),C.applyArabicShaping&&(h=C.applyArabicShaping(h)),h}(s.text,e,r)}),n}const Qu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Jm(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function fp(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var T_=ai,Zd=function(n,e,r,s,h){var p,m,y=8*h-s-1,b=(1<<y)-1,w=b>>1,A=-7,k=r?h-1:0,z=r?-1:1,G=n[e+k];for(k+=z,p=G&(1<<-A)-1,G>>=-A,A+=y;A>0;p=256*p+n[e+k],k+=z,A-=8);for(m=p&(1<<-A)-1,p>>=-A,A+=s;A>0;m=256*m+n[e+k],k+=z,A-=8);if(0===p)p=1-w;else{if(p===b)return m?NaN:1/0*(G?-1:1);m+=Math.pow(2,s),p-=w}return(G?-1:1)*m*Math.pow(2,p-s)},Qm=function(n,e,r,s,h,p){var m,y,b,w=8*p-h-1,A=(1<<w)-1,k=A>>1,z=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,G=s?0:p-1,H=s?1:-1,K=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=A):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+k>=1?z/b:z*Math.pow(2,1-k))*b>=2&&(m++,b/=2),m+k>=A?(y=0,m=A):m+k>=1?(y=(e*b-1)*Math.pow(2,h),m+=k):(y=e*Math.pow(2,k-1)*Math.pow(2,h),m=0));h>=8;n[r+G]=255&y,G+=H,y/=256,h-=8);for(m=m<<h|y,w+=h;w>0;n[r+G]=255&m,G+=H,m/=256,w-=8);n[r+G-H]|=128*K};function ai(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}ai.Varint=0,ai.Fixed64=1,ai.Bytes=2,ai.Fixed32=5;var Bc=4294967296,pp=1/Bc,mp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Na(n){return n.type===ai.Bytes?n.readVarint()+n.pos:n.pos+1}function gp(n,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var h=r.pos-1;h>=n;h--)r.buf[h+s]=r.buf[h]}function M_(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function _p(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function oc(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function yp(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function eg(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function vp(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function rv(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function tg(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function iv(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function pu(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function sc(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function qd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}ai.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),h=s>>3,p=this.pos;this.type=7&s,n(h,e,this),this.pos===p&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=pu(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=qd(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=pu(this.buf,this.pos)+pu(this.buf,this.pos+4)*Bc;return this.pos+=8,n},readSFixed64:function(){var n=pu(this.buf,this.pos)+qd(this.buf,this.pos+4)*Bc;return this.pos+=8,n},readFloat:function(){var n=Zd(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Zd(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(h,p,m){var y,b,w=m.buf;if(y=(112&(b=w[m.pos++]))>>4,b<128||(y|=(127&(b=w[m.pos++]))<<3,b<128)||(y|=(127&(b=w[m.pos++]))<<10,b<128)||(y|=(127&(b=w[m.pos++]))<<17,b<128)||(y|=(127&(b=w[m.pos++]))<<24,b<128)||(y|=(1&(b=w[m.pos++]))<<31,b<128))return function ps(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(h,y,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&mp?mp.decode(this.buf.subarray(e,n)):function(r,s,h){for(var p="",m=s;m<h;){var y,b,w,A=r[m],k=null,z=A>239?4:A>223?3:A>191?2:1;if(m+z>h)break;1===z?A<128&&(k=A):2===z?128==(192&(y=r[m+1]))&&(k=(31&A)<<6|63&y)<=127&&(k=null):3===z?(b=r[m+2],128==(192&(y=r[m+1]))&&128==(192&b)&&((k=(15&A)<<12|(63&y)<<6|63&b)<=2047||k>=55296&&k<=57343)&&(k=null)):4===z&&(b=r[m+2],w=r[m+3],128==(192&(y=r[m+1]))&&128==(192&b)&&128==(192&w)&&((k=(15&A)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||k>=1114112)&&(k=null)),null===k?(k=65533,z=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),m+=z}return p}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==ai.Bytes)return n.push(this.readVarint(e));var r=Na(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==ai.Bytes)return n.push(this.readSVarint());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==ai.Bytes)return n.push(this.readBoolean());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==ai.Bytes)return n.push(this.readFloat());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==ai.Bytes)return n.push(this.readDouble());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==ai.Bytes)return n.push(this.readFixed32());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==ai.Bytes)return n.push(this.readSFixed32());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==ai.Bytes)return n.push(this.readFixed64());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==ai.Bytes)return n.push(this.readSFixed64());var e=Na(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===ai.Varint)for(;this.buf[this.pos++]>127;);else if(e===ai.Bytes)this.pos=this.readVarint()+this.pos;else if(e===ai.Fixed32)this.pos+=4;else{if(e!==ai.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),sc(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),sc(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),sc(this.buf,-1&n,this.pos),sc(this.buf,Math.floor(n*pp),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),sc(this.buf,-1&n,this.pos),sc(this.buf,Math.floor(n*pp),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var s,h,p,y;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),p=s,(y=r).buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,y.buf[y.pos]=127&(p>>>=7),function(p,m){var y=(7&p)<<4;m.buf[m.pos++]|=y|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,h,p){for(var m,y,b=0;b<h.length;b++){if((m=h.charCodeAt(b))>55295&&m<57344){if(!y){m>56319||b+1===h.length?(s[p++]=239,s[p++]=191,s[p++]=189):y=m;continue}if(m<56320){s[p++]=239,s[p++]=191,s[p++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(s[p++]=239,s[p++]=191,s[p++]=189,y=null);m<128?s[p++]=m:(m<2048?s[p++]=m>>6|192:(m<65536?s[p++]=m>>12|224:(s[p++]=m>>18|240,s[p++]=m>>12&63|128),s[p++]=m>>6&63|128),s[p++]=63&m|128)}return p}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&gp(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Qm(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Qm(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var s=this.pos-r;s>=128&&gp(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,r){this.writeTag(n,ai.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,M_,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,_p,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,eg,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,oc,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,yp,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,vp,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,rv,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,tg,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,iv,e)},writeBytesField:function(n,e){this.writeTag(n,ai.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,ai.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,ai.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,ai.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,ai.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,ai.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,ai.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,ai.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,ai.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,ai.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};var eh=It(T_);function ov(n,e,r){e.glyphs=[],1===n&&r.readMessage(S_,e)}function S_(n,e,r){if(3===n){const{id:s,bitmap:h,width:p,height:m,left:y,top:b,advance:w}=r.readMessage(A_,{});e.glyphs.push({id:s,bitmap:new Fc({width:p+6,height:m+6},h),metrics:{width:p,height:m,left:y,top:b,advance:w}})}else 4===n?e.ascender=r.readSVarint():5===n&&(e.descender=r.readSVarint())}function A_(n,e,r){1===n?e.id=r.readVarint():2===n?e.bitmap=r.readBytes():3===n?e.width=r.readVarint():4===n?e.height=r.readVarint():5===n?e.left=r.readSVarint():6===n?e.top=r.readSVarint():7===n&&(e.advance=r.readVarint())}function xp(n){let e=0,r=0;for(const m of n)e+=m.w*m.h,r=Math.max(r,m.w);n.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,p=0;for(const m of n)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===b.w&&m.h===b.h){const w=s.pop();y<s.length&&(s[y]=w)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(s.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}class rg{constructor(e,{pixelRatio:r,version:s,stretchX:h,stretchY:p,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=p,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ig{constructor(e,r){const s={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,s,p),this.addImages(r,h,p);const{w:m,h:y}=xp(p),b=new qi({width:m||1,height:y||1});for(const w in e){const A=e[w],k=s[w].paddedRect;qi.copy(A.data,b,{x:0,y:0},{x:k.x+1,y:k.y+1},A.data)}for(const w in r){const A=r[w],k=h[w].paddedRect,z=k.x+1,G=k.y+1,H=A.data.width,K=A.data.height;qi.copy(A.data,b,{x:0,y:0},{x:z,y:G},A.data),qi.copy(A.data,b,{x:0,y:K-1},{x:z,y:G-1},{width:H,height:1}),qi.copy(A.data,b,{x:0,y:0},{x:z,y:G+K},{width:H,height:1}),qi.copy(A.data,b,{x:H-1,y:0},{x:z-1,y:G},{width:1,height:K}),qi.copy(A.data,b,{x:0,y:0},{x:z+H,y:G},{width:1,height:K})}this.image=b,this.iconPositions=s,this.patternPositions=h}addImages(e,r,s){for(const h in e){const p=e[h],m={x:0,y:0,w:p.data.width+2,h:p.data.height+2};s.push(m),r[h]=new rg(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,p]=e.tl;s.update(r.data,void 0,{x:h,y:p})}}Zt(rg,"ImagePosition"),Zt(ig,"ImageAtlas");const za={horizontal:1,vertical:2,horizontalOnly:3};class th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new th;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new th;return r.imageName=e,r}}class nh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new nh;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?s.addImageSection(p):s.addTextSection(p,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,s){let h="";for(let p=0;p<r.length;p++){const m=r.charCodeAt(p+1)||null,y=r.charCodeAt(p-1)||null;h+=!s&&(m&&Xc(m)&&!Qu[r[p+1]]||y&&Xc(y)&&!Qu[r[p-1]])||!Qu[r[p]]?r[p]:Qu[r[p]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&wp[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&wp[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new nh;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(th.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(0===r.length)return void Cr("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(th.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Cr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jh(n,e,r,s,h,p,m,y,b,w,A,k,z,G,H){const K=nh.fromFeature(n,h);k===za.vertical&&K.verticalizePunctuation(z);let ie=[];const ue=function(Me,Ke,Ze,st,Ft,et){if(!Me)return[];const _t=[],yt=function(Kt,dn,Qt,Xn,Dt,xn){let Yn=0;for(let Rr=0;Rr<Kt.length();Rr++){const qn=Kt.getSection(Rr);Yn+=I_(Kt.getCharCode(Rr),qn,Xn,Dt,dn,xn)}return Yn/Math.max(1,Math.ceil(Yn/Qt))}(Me,Ke,Ze,st,Ft,et),Pt=Me.text.indexOf("\u200b")>=0;let jt=0;for(let Kt=0;Kt<Me.length();Kt++){const dn=Me.getSection(Kt),Qt=Me.getCharCode(Kt);if(wp[Qt]||(jt+=I_(Qt,dn,st,Ft,Ke,et)),Kt<Me.length()-1){const Xn=!((ot=Qt)<11904||!(qt_Bopomofo_Extended(ot)||qt_Bopomofo(ot)||qt_CJK_Compatibility_Forms(ot)||qt_CJK_Compatibility_Ideographs(ot)||qt_CJK_Compatibility(ot)||qt_CJK_Radicals_Supplement(ot)||qt_CJK_Strokes(ot)||qt_CJK_Symbols_and_Punctuation(ot)||qt_CJK_Unified_Ideographs_Extension_A(ot)||qt_CJK_Unified_Ideographs(ot)||qt_Enclosed_CJK_Letters_and_Months(ot)||qt_Halfwidth_and_Fullwidth_Forms(ot)||qt_Hiragana(ot)||qt_Ideographic_Description_Characters(ot)||qt_Kangxi_Radicals(ot)||qt_Katakana_Phonetic_Extensions(ot)||qt_Katakana(ot)||qt_Vertical_Forms(ot)||qt_Yi_Radicals(ot)||qt_Yi_Syllables(ot)));(sv[Qt]||Xn||dn.imageName)&&_t.push(R_(Kt+1,jt,yt,_t,av(Qt,Me.getCharCode(Kt+1),Xn&&Pt),!1))}}var ot;return L_(R_(Me.length(),jt,yt,_t,0,!0))}(K,w,p,e,s,G),{processBidirectionalText:be,processStyledBidirectionalText:de}=C;if(be&&1===K.sections.length){const Me=be(K.toString(),ue);for(const Ke of Me){const Ze=new nh;Ze.text=Ke,Ze.sections=K.sections;for(let st=0;st<Ke.length;st++)Ze.sectionIndex.push(0);ie.push(Ze)}}else if(de){const Me=de(K.text,K.sectionIndex,ue);for(const Ke of Me){const Ze=new nh;Ze.text=Ke[0],Ze.sectionIndex=Ke[1],Ze.sections=K.sections,ie.push(Ze)}}else ie=function(Me,Ke){const Ze=[],st=Me.text;let Ft=0;for(const et of Ke)Ze.push(Me.substring(Ft,et)),Ft=et;return Ft<st.length&&Ze.push(Me.substring(Ft,st.length)),Ze}(K,ue);const xe=[],Se={positionedLines:xe,text:K.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Me,Ke,Ze,st,Ft,et,_t,yt,Pt,jt,ot,Kt){let dn=0,Qt=0,Xn=0;const Dt="right"===yt?1:"left"===yt?0:.5;let xn=!1;for(const Kn of Ft){const jn=Kn.getSections();for(const Jr of jn){if(Jr.imageName)continue;const ii=Ke[Jr.fontStack];if(ii&&(xn=void 0!==ii.ascender&&void 0!==ii.descender,!xn))break}if(!xn)break}let Yn=0;for(const Kn of Ft){Kn.trim();const jn=Kn.getMaxScale(),Jr=24*(jn-1),ii={positionedGlyphs:[],lineOffset:0};Me.positionedLines[Yn]=ii;const Qr=ii.positionedGlyphs;let ei=0;if(!Kn.length()){Qt+=et,++Yn;continue}let gi=0,Vi=0;for(let Br=0;Br<Kn.length();Br++){const oi=Kn.getSection(Br),Xi=Kn.getSectionIndex(Br),Ti=Kn.getCharCode(Br);let ur=oi.scale,Hr=null,Er=null,is=null,ji=24,No=0;const Co=!(Pt===za.horizontal||!ot&&!rl(Ti)||ot&&(wp[Ti]||(Rr=Ti,qt_Arabic(Rr)||qt_Arabic_Supplement(Rr)||qt_Arabic_Extended_A(Rr)||qt_Arabic_Presentation_Forms_A(Rr)||qt_Arabic_Presentation_Forms_B(Rr))));if(oi.imageName){const ys=st[oi.imageName];if(!ys)continue;is=oi.imageName,Me.iconsInText=Me.iconsInText||!0,Er=ys.paddedRect;const Do=ys.displaySize;ur=24*ur/Kt,Hr={width:Do[0],height:Do[1],left:1,top:-3,advance:Co?Do[1]:Do[0],localGlyph:!1},No=xn?-Hr.height*ur:24*jn-17-Do[1]*ur,ji=Hr.advance;const ya=(Co?Do[0]:Do[1])*ur-24*jn;ya>0&&ya>ei&&(ei=ya)}else{const ys=Ze[oi.fontStack];if(!ys)continue;ys[Ti]&&(Er=ys[Ti]);const Do=Ke[oi.fontStack];if(!Do)continue;const ya=Do.glyphs[Ti];if(!ya)continue;if(Hr=ya.metrics,ji=8203!==Ti?24:0,xn){const Fl=void 0!==Do.ascender?Math.abs(Do.ascender):0,nd=void 0!==Do.descender?Math.abs(Do.descender):0,uh=(Fl+nd)*ur;gi<uh&&(gi=uh,Vi=(Fl-nd)/2*ur),No=-Fl*ur}else No=24*(jn-ur)-17}Co?(Me.verticalizable=!0,Qr.push({glyph:Ti,imageName:is,x:dn,y:Qt+No,vertical:Co,scale:ur,localGlyph:Hr.localGlyph,fontStack:oi.fontStack,sectionIndex:Xi,metrics:Hr,rect:Er}),dn+=ji*ur+jt):(Qr.push({glyph:Ti,imageName:is,x:dn,y:Qt+No,vertical:Co,scale:ur,localGlyph:Hr.localGlyph,fontStack:oi.fontStack,sectionIndex:Xi,metrics:Hr,rect:Er}),dn+=Hr.advance*ur+jt)}0!==Qr.length&&(Xn=Math.max(dn-jt,Xn),xn?k_(Qr,Dt,ei,Vi,et*jn/2):k_(Qr,Dt,ei,0,et/2)),dn=0;const Ui=et*jn+ei;ii.lineOffset=Math.max(ei,Jr),Qt+=Ui,++Yn}var Rr;const qn=Qt,{horizontalAlign:An,verticalAlign:ri}=og(_t);(function(Kn,jn,Jr,ii,Qr,ei){const gi=(jn-Jr)*Qr,Vi=-ei*ii;for(const Ui of Kn)for(const Br of Ui.positionedGlyphs)Br.x+=gi,Br.y+=Vi})(Me.positionedLines,Dt,An,ri,Xn,qn),Me.top+=-ri*qn,Me.bottom=Me.top+qn,Me.left+=-An*Xn,Me.right=Me.left+Xn,Me.hasBaseline=xn}(Se,e,r,s,ie,m,y,b,k,w,z,H),!function(Me){for(const Ke of Me)if(0!==Ke.positionedGlyphs.length)return!1;return!0}(xe)&&Se}const wp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function I_(n,e,r,s,h,p){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*24/p+h:0}{const m=r[e.fontStack],y=m&&m.glyphs[n];return y?y.metrics.advance*e.scale+h:0}}function P_(n,e,r,s){const h=Math.pow(n-e,2);return s?n<e?h/2:2*h:h+Math.abs(r)*r}function av(n,e,r){let s=0;return 10===n&&(s-=1e4),r&&(s+=150),40!==n&&65288!==n||(s+=50),41!==e&&65289!==e||(s+=50),s}function R_(n,e,r,s,h,p){let m=null,y=P_(e,r,h,p);for(const b of s){const w=P_(e-b.x,r,h,p)+b.badness;w<=y&&(m=b,y=w)}return{index:n,x:e,priorBreak:m,badness:y}}function L_(n){return n?L_(n.priorBreak).concat(n.index):[]}function og(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function k_(n,e,r,s,h){if(!(e||r||s||h))return;const p=n.length-1,m=n[p],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=p;b++)n[b].x-=y,n[b].y+=r+s+h}function lv(n,e,r){const{horizontalAlign:s,verticalAlign:h}=og(r),p=e[0]-n.displaySize[0]*s,m=e[1]-n.displaySize[1]*h;return{image:n,top:m,bottom:m+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function ac(n,e,r,s,h,p){const m=n.image;let y;if(m.content){const ie=m.content,ue=m.pixelRatio||1;y=[ie[0]/ue,ie[1]/ue,m.displaySize[0]-ie[2]/ue,m.displaySize[1]-ie[3]/ue]}const b=e.left*p,w=e.right*p;let A,k,z,G;"width"===r||"both"===r?(G=h[0]+b-s[3],k=h[0]+w+s[1]):(G=h[0]+(b+w-m.displaySize[0])/2,k=G+m.displaySize[0]);const H=e.top*p,K=e.bottom*p;return"height"===r||"both"===r?(A=h[1]+H-s[0],z=h[1]+K+s[2]):(A=h[1]+(H+K-m.displaySize[1])/2,z=A+m.displaySize[1]),{image:m,top:A,right:k,bottom:z,left:G,collisionPadding:y}}class ul extends Ge{constructor(e,r,s,h,p){super(e,r),this.angle=h,this.z=s,void 0!==p&&(this.segment=p)}clone(){return new ul(this.x,this.y,this.z,this.angle,this.segment)}}function sg(n,e,r,s,h){if(void 0===e.segment)return!0;let p=e,m=e.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=n[m].dist(p),p=n[m]}y+=n[m].dist(n[m+1]),m++;const b=[];let w=0;for(;y<r/2;){const A=n[m],k=n[m+1];if(!k)return!1;let z=n[m-1].angleTo(A)-A.angleTo(k);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:z}),w+=z;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>h)return!1;m++,y+=A.dist(k)}return!0}function Ep(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Wd(n,e,r){return n?.6*e*r:0}function Cp(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Dp(n,e,r,s,h,p){const m=Wd(r,h,p),y=Cp(r,s)*p;let b=0;const w=Ep(n)/2;for(let A=0;A<n.length-1;A++){const k=n[A],z=n[A+1],G=k.dist(z);if(b+G>w){const H=(w-b)/G,K=mr(k.x,z.x,H),ie=mr(k.y,z.y,H),ue=new ul(K,ie,0,z.angleTo(k),A);return!m||sg(n,ue,y,m,e)?ue:void 0}b+=G}}function O_(n,e,r,s,h,p,m,y,b){const w=Wd(s,p,m),A=Cp(s,h),k=A*m,z=0===n[0].x||n[0].x===b||0===n[0].y||n[0].y===b;return e-k<e/4&&(e=k+e/4),lc(n,z?e/2*y%e:(A/2+2*p)*m*y%e,e,w,r,k,z,!1,b)}function lc(n,e,r,s,h,p,m,y,b){const w=p/2,A=Ep(n);let k=0,z=e-r,G=[];for(let H=0;H<n.length-1;H++){const K=n[H],ie=n[H+1],ue=K.dist(ie),be=ie.angleTo(K);for(;z+r<k+ue;){z+=r;const de=(z-k)/ue,xe=mr(K.x,ie.x,de),Se=mr(K.y,ie.y,de);if(xe>=0&&xe<b&&Se>=0&&Se<b&&z-w>=0&&z+w<=A){const Me=new ul(xe,Se,0,be,H);Me._round(),s&&!sg(n,Me,p,s,h)||G.push(Me)}}k+=ue}return y||G.length||m||(G=lc(n,k/2,r,s,h,p,m,!0,b)),G}function Tp(n,e,r,s,h){const p=[];for(let m=0;m<n.length;m++){const y=n[m];let b;for(let w=0;w<y.length-1;w++){let A=y[w],k=y[w+1];A.x<e&&k.x<e||(A.x<e?A=new Ge(e,A.y+(e-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<e&&(k=new Ge(e,A.y+(e-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<r&&k.y<r||(A.y<r?A=new Ge(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round():k.y<r&&(k=new Ge(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round()),A.x>=s&&k.x>=s||(A.x>=s?A=new Ge(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=s&&(k=new Ge(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=h&&k.y>=h||(A.y>=h?A=new Ge(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round():k.y>=h&&(k=new Ge(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round()),b&&A.equals(b[b.length-1])||(b=[A],p.push(b)),b.push(k)))))}}return p}Zt(ul,"Anchor");const $h=1e20;function ag(n,e,r,s,h,p,m,y,b){for(let w=e;w<e+s;w++)Mp(n,r*p+w,p,h,m,y,b);for(let w=r;w<r+h;w++)Mp(n,w*p+e,1,s,m,y,b)}function Mp(n,e,r,s,h,p,m){p[0]=0,m[0]=-$h,m[1]=$h,h[0]=n[e];for(let y=1,b=0,w=0;y<s;y++){h[y]=n[e+y*r];const A=y*y;do{const k=p[b];w=(h[y]-h[k]+A-k*k)/(y-k)/2}while(w<=m[b]&&--b>-1);b++,p[b]=y,m[b]=w,m[b+1]=$h}for(let y=0,b=0;y<s;y++){for(;m[b+1]<y;)b++;const w=p[b],A=y-w;n[e+y*r]=h[w]+A*A}}const Sp={none:0,ideographs:1,all:2};class cc{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const h in e)for(const p of e[h])s.push({stack:h,id:p});fn(s,({stack:h,id:p},m)=>{let y=this.entries[h];y||(y=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[p];if(void 0!==b)return void m(null,{stack:h,id:p,glyph:b});if(b=this._tinySDF(y,h,p),b)return y.glyphs[p]=b,void m(null,{stack:h,id:p,glyph:b});const w=Math.floor(p/256);if(256*w>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[w])return void m(null,{stack:h,id:p,glyph:b});let A=y.requests[w];A||(A=y.requests[w]=[],cc.loadGlyphRange(h,w,this.url,this.requestManager,(k,z)=>{if(z){y.ascender=z.ascender,y.descender=z.descender;for(const G in z.glyphs)this._doesCharSupportLocalGlyph(+G)||(y.glyphs[+G]=z.glyphs[+G]);y.ranges[w]=!0}for(const G of A)G(k,z);delete y.requests[w]})),A.push((k,z)=>{k?m(k):z&&m(null,{stack:h,id:p,glyph:z.glyphs[p]||null})})},(h,p)=>{if(h)r(h);else if(p){const m={};for(const{stack:y,id:b,glyph:w}of p)void 0===m[y]&&(m[y]={}),void 0===m[y].glyphs&&(m[y].glyphs={}),m[y].glyphs[b]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;r(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Sp.none&&(this.localGlyphMode===Sp.all?!!this.localFontFamily:!!this.localFontFamily&&(qt_CJK_Unified_Ideographs(e)||qt_Hangul_Syllables(e)||qt_Hiragana(e)||qt_Katakana(e)||qt_CJK_Symbols_and_Punctuation(e)))}_tinySDF(e,r,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let K="400";/bold/i.test(r)?K="900":/medium/i.test(r)?K="500":/light/i.test(r)&&(K="200"),p=e.tinySDF=new cc.TinySDF({fontFamily:h,fontWeight:K,fontSize:48,buffer:6,radius:16}),p.fontWeight=K}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const m=String.fromCharCode(s),{data:y,width:b,height:w,glyphWidth:A,glyphHeight:k,glyphLeft:z,glyphTop:G,glyphAdvance:H}=p.draw(m);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new Fc({width:b,height:w},y),metrics:{width:A/2,height:k/2,left:z/2,top:G/2-27,advance:H/2,localGlyph:!0}}}}cc.loadGlyphRange=function(n,e,r,s,h){const p=256*e,m=p+255,y=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${p}-${m}`),mn.Glyphs);Vr(y,(b,w)=>{if(b)h(b);else if(w){const A={},k=new eh(w).readFields(ov,{});for(const z of k.glyphs)A[z.id]=z;h(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}})},cc.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const y=this.size=n+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${m} ${p} ${n}px ${h}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(n),m=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),b=Math.min(this.size-this.buffer,m+Math.ceil(s)),w=y+2*this.buffer,A=b+2*this.buffer,k=Math.max(w*A,0),z=new Uint8ClampedArray(k),G={data:z,width:w,height:A,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(0===y||0===b)return G;const{ctx:H,buffer:K,gridInner:ie,gridOuter:ue}=this;H.clearRect(K,K,y,b),H.fillText(n,K,K+m);const be=H.getImageData(K,K,y,b);ue.fill($h,0,k),ie.fill(0,0,k);for(let de=0;de<b;de++)for(let xe=0;xe<y;xe++){const Se=be.data[4*(de*y+xe)+3]/255;if(0===Se)continue;const Me=(de+K)*w+xe+K;if(1===Se)ue[Me]=0,ie[Me]=$h;else{const Ke=.5-Se;ue[Me]=Ke>0?Ke*Ke:0,ie[Me]=Ke<0?Ke*Ke:0}}ag(ue,0,0,w,A,w,this.f,this.v,this.z),ag(ie,K,K,y,b,w,this.f,this.v,this.z);for(let de=0;de<k;de++){const xe=Math.sqrt(ue[de])-Math.sqrt(ie[de]);z[de]=Math.round(255-255*(xe/this.radius+this.cutoff))}return G}};function Xd(n,e,r,s){const h=[],p=n.image,m=p.pixelRatio,y=p.paddedRect.w-2,b=p.paddedRect.h-2,w=n.right-n.left,A=n.bottom-n.top,k=p.stretchX||[[0,y]],z=p.stretchY||[[0,b]],G=(et,_t)=>et+_t[1]-_t[0],H=k.reduce(G,0),K=z.reduce(G,0),ie=y-H,ue=b-K;let be=0,de=H,xe=0,Se=K,Me=0,Ke=ie,Ze=0,st=ue;if(p.content&&s){const et=p.content;be=uc(k,0,et[0]),xe=uc(z,0,et[1]),de=uc(k,et[0],et[2]),Se=uc(z,et[1],et[3]),Me=et[0]-be,Ze=et[1]-xe,Ke=et[2]-et[0]-de,st=et[3]-et[1]-Se}const Ft=(et,_t,yt,Pt)=>{const jt=mu(et.stretch-be,de,w,n.left),ot=Gh(et.fixed-Me,Ke,et.stretch,H),Kt=mu(_t.stretch-xe,Se,A,n.top),dn=Gh(_t.fixed-Ze,st,_t.stretch,K),Qt=mu(yt.stretch-be,de,w,n.left),Xn=Gh(yt.fixed-Me,Ke,yt.stretch,H),Dt=mu(Pt.stretch-xe,Se,A,n.top),xn=Gh(Pt.fixed-Ze,st,Pt.stretch,K),Yn=new Ge(jt,Kt),Rr=new Ge(Qt,Kt),qn=new Ge(Qt,Dt),An=new Ge(jt,Dt),ri=new Ge(ot/m,dn/m),Kn=new Ge(Xn/m,xn/m),jn=e*Math.PI/180;if(jn){const Qr=Math.sin(jn),ei=Math.cos(jn),gi=[ei,-Qr,Qr,ei];Yn._matMult(gi),Rr._matMult(gi),An._matMult(gi),qn._matMult(gi)}const Jr=et.stretch+et.fixed,ii=_t.stretch+_t.fixed;return{tl:Yn,tr:Rr,bl:An,br:qn,tex:{x:p.paddedRect.x+1+Jr,y:p.paddedRect.y+1+ii,w:yt.stretch+yt.fixed-Jr,h:Pt.stretch+Pt.fixed-ii},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ri,pixelOffsetBR:Kn,minFontScaleX:Ke/m/w,minFontScaleY:st/m/A,isSDF:r}};if(s&&(p.stretchX||p.stretchY)){const et=Yd(k,ie,H),_t=Yd(z,ue,K);for(let yt=0;yt<et.length-1;yt++){const Pt=et[yt],jt=et[yt+1];for(let ot=0;ot<_t.length-1;ot++)h.push(Ft(Pt,_t[ot],jt,_t[ot+1]))}}else h.push(Ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return h}function uc(n,e,r){let s=0;for(const h of n)s+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return s}function Yd(n,e,r){const s=[{fixed:-1,stretch:0}];for(const[h,p]of n){const m=s[s.length-1];s.push({fixed:h-m.stretch,stretch:m.stretch}),s.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return s.push({fixed:e+1,stretch:r}),s}function mu(n,e,r,s){return n/e*r+s}function Gh(n,e,r,s){return n-e*r/s}function lg(n,e,r,s){const h=e+n.positionedLines[s].lineOffset;return 0===s?r+h/2:r+(h+(e+n.positionedLines[s-1].lineOffset))/2}class Ap{constructor(e=[],r=Ip){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,h=r[e];for(;e>0;){const p=e-1>>1,m=r[p];if(s(h,m)>=0)break;r[e]=m,e=p}r[e]=h}_down(e){const{data:r,compare:s}=this,h=this.length>>1,p=r[e];for(;e<h;){let m=1+(e<<1),y=r[m];const b=m+1;if(b<this.length&&s(r[b],y)<0&&(m=b,y=r[b]),s(y,p)>=0)break;r[e]=y,e=m}r[e]=p}}function Ip(n,e){return n<e?-1:n>e?1:0}function cg(n,e=1,r=!1){let s=1/0,h=1/0,p=-1/0,m=-1/0;const y=n[0];for(let G=0;G<y.length;G++){const H=y[G];(!G||H.x<s)&&(s=H.x),(!G||H.y<h)&&(h=H.y),(!G||H.x>p)&&(p=H.x),(!G||H.y>m)&&(m=H.y)}const b=Math.min(p-s,m-h);let w=b/2;const A=new Ap([],Pp);if(0===b)return new Ge(s,h);for(let G=s;G<p;G+=b)for(let H=h;H<m;H+=b)A.push(new rh(G+w,H+w,w,n));let k=function(G){let H=0,K=0,ie=0;const ue=G[0];for(let be=0,de=ue.length,xe=de-1;be<de;xe=be++){const Se=ue[be],Me=ue[xe],Ke=Se.x*Me.y-Me.x*Se.y;K+=(Se.x+Me.x)*Ke,ie+=(Se.y+Me.y)*Ke,H+=3*Ke}return new rh(K/H,ie/H,0,G)}(n),z=A.length;for(;A.length;){const G=A.pop();(G.d>k.d||!k.d)&&(k=G,r&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,z)),G.max-k.d<=e||(w=G.h/2,A.push(new rh(G.p.x-w,G.p.y-w,w,n)),A.push(new rh(G.p.x+w,G.p.y-w,w,n)),A.push(new rh(G.p.x-w,G.p.y+w,w,n)),A.push(new rh(G.p.x+w,G.p.y+w,w,n)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${k.d}`)),k.p}function Pp(n,e){return e.max-n.max}class rh{constructor(e,r,s,h){this.p=new Ge(e,r),this.h=s,this.d=function(p,m){let y=!1,b=1/0;for(let w=0;w<m.length;w++){const A=m[w];for(let k=0,z=A.length,G=z-1;k<z;G=k++){const H=A[k],K=A[G];H.y>p.y!=K.y>p.y&&p.x<(K.x-H.x)*(p.y-H.y)/(K.y-H.y)+H.x&&(y=!y),b=Math.min(b,qf(p,H,K))}}return(y?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Rp=Number.POSITIVE_INFINITY,ug=Math.sqrt(2);function hg(n,[e,r]){let s=0,h=0;if(r===Rp){e<0&&(e=0);const p=e/ug;switch(n){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(n){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),n){case"top-right":case"top-left":case"top":h=r-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-r}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function dg(n,e,r,s,h,p,m,y,b,w){n.createArrays(),n.tilePixelRatio=bn/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const A=n.layers[0].layout,k=n.layers[0]._unevaluatedLayout._values,z={};if("composite"===n.textSizeData.kind){const{minZoom:K,maxZoom:ie}=n.textSizeData;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new P(K),y),k["text-size"].possiblyEvaluate(new P(ie),y)]}if("composite"===n.iconSizeData.kind){const{minZoom:K,maxZoom:ie}=n.iconSizeData;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new P(K),y),k["icon-size"].possiblyEvaluate(new P(ie),y)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new P(b+1),y),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new P(b+1),y),z.textMaxSize=k["text-size"].possiblyEvaluate(new P(18),y);const G="map"===A.get("text-rotation-alignment")&&"point"!==A.get("symbol-placement"),H=A.get("text-size");for(const K of n.features){const ie=A.get("text-font").evaluate(K,{},y).join(","),ue=H.evaluate(K,{},y),be=z.layoutTextSize.evaluate(K,{},y),de=(z.layoutIconSize.evaluate(K,{},y),{horizontal:{},vertical:void 0}),xe=K.text;let Se,Me=[0,0];if(xe){const st=xe.toString(),Ft=24*A.get("text-letter-spacing").evaluate(K,{},y),et=24*A.get("text-line-height").evaluate(K,{},y),_t=Iu(st)?Ft:0,yt=A.get("text-anchor").evaluate(K,{},y),Pt=A.get("text-variable-anchor");if(!Pt){const Qt=A.get("text-radial-offset").evaluate(K,{},y);Me=Qt?hg(yt,[24*Qt,Rp]):A.get("text-offset").evaluate(K,{},y).map(Xn=>24*Xn)}let jt=G?"center":A.get("text-justify").evaluate(K,{},y);const ot="point"===A.get("symbol-placement"),Kt=ot?24*A.get("text-max-width").evaluate(K,{},y):1/0,dn=Qt=>{n.allowVerticalPlacement&&Ps(st)&&(de.vertical=jh(xe,e,r,h,ie,Kt,et,yt,Qt,_t,Me,za.vertical,!0,be,ue))};if(!G&&Pt){const Qt="auto"===jt?Pt.map(Dt=>Kd(Dt)):[jt];let Xn=!1;for(let Dt=0;Dt<Qt.length;Dt++){const xn=Qt[Dt];if(!de.horizontal[xn])if(Xn)de.horizontal[xn]=de.horizontal[0];else{const Yn=jh(xe,e,r,h,ie,Kt,et,"center",xn,_t,Me,za.horizontal,!1,be,ue);Yn&&(de.horizontal[xn]=Yn,Xn=1===Yn.positionedLines.length)}}dn("left")}else{if("auto"===jt&&(jt=Kd(yt)),ot||A.get("text-writing-mode").indexOf("horizontal")>=0||!Ps(st)){const Qt=jh(xe,e,r,h,ie,Kt,et,yt,jt,_t,Me,za.horizontal,!1,be,ue);Qt&&(de.horizontal[jt]=Qt)}dn(ot?"left":jt)}}let Ke=!1;if(K.icon&&K.icon.name){const st=s[K.icon.name];st&&(Se=lv(h[K.icon.name],A.get("icon-offset").evaluate(K,{},y),A.get("icon-anchor").evaluate(K,{},y)),Ke=st.sdf,void 0===n.sdfIcons?n.sdfIcons=st.sdf:n.sdfIcons!==st.sdf&&Cr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(st.pixelRatio!==n.pixelRatio||0!==A.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Ze=B_(de.horizontal)||de.vertical;n.iconsInText||(n.iconsInText=!!Ze&&Ze.iconsInText),(Ze||Se)&&F_(n,K,de,Se,s,z,be,0,Me,Ke,m,y,w)}p&&n.generateCollisionDebugBuffers(b,n.collisionBoxArray)}function Kd(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function F_(n,e,r,s,h,p,m,y,b,w,A,k,z){let G=p.textMaxSize.evaluate(e,{},k);void 0===G&&(G=m);const H=n.layers[0].layout,K=H.get("icon-offset").evaluate(e,{},k),ie=B_(r.horizontal)||r.vertical,ue="globe"===z.name,de=m/24,xe=n.tilePixelRatio*G/24,Se=(yt=n.overscaling,n.zoom>18&&yt>2&&(yt>>=1),Math.max(bn/(512*yt),1)*H.get("symbol-spacing")),Me=H.get("text-padding")*n.tilePixelRatio,Ke=H.get("icon-padding")*n.tilePixelRatio,Ze=tt(H.get("text-max-angle")),st="map"===H.get("text-rotation-alignment")&&"point"!==H.get("symbol-placement"),Ft="map"===H.get("icon-rotation-alignment")&&"point"!==H.get("symbol-placement"),et=H.get("symbol-placement"),_t=Se/2;var yt;const Pt=H.get("icon-text-fit");let jt;s&&"none"!==Pt&&(n.allowVerticalPlacement&&r.vertical&&(jt=ac(s,r.vertical,Pt,H.get("icon-text-fit-padding"),K,de)),ie&&(s=ac(s,ie,Pt,H.get("icon-text-fit-padding"),K,de)));const ot=(Kt,dn,Qt)=>{if(dn.x<0||dn.x>=bn||dn.y<0||dn.y>=bn)return;let Xn=null;if(ue){const{x:Dt,y:xn,z:Yn}=z.projectTilePoint(dn.x,dn.y,Qt);Xn={anchor:new ul(Dt,xn,Yn,0,void 0),up:z.upVector(Qt,dn.x,dn.y)}}!function(Dt,xn,Yn,Rr,qn,An,ri,Kn,jn,Jr,ii,Qr,ei,gi,Vi,Ui,Br,oi,Xi,Ti,ur,Hr,Er,is,ji){const No=Dt.addToLineVertexArray(xn,Rr);let Co,ys,Do,ya,Fl,nd,uh,Sg=0,Hp=0,Zp=0,rd=0,qp=-1,pf=-1;const pl={};let mf=ud("");const Bl=Yn?Yn.anchor:xn;let gf=0,_f=0;if(void 0===jn._unevaluatedLayout.getValue("text-radial-offset")?[gf,_f]=jn.layout.get("text-offset").evaluate(ur,{},ji).map(Bs=>24*Bs):(gf=24*jn.layout.get("text-radial-offset").evaluate(ur,{},ji),_f=Rp),Dt.allowVerticalPlacement&&qn.vertical){const Bs=qn.vertical;if(Vi)nd=Zh(Bs),Kn&&(uh=Zh(Kn));else{const Ns=jn.layout.get("text-rotate").evaluate(ur,{},ji)+90;Do=Jd(Jr,Bl,xn,ii,Qr,ei,Bs,gi,Ns,Ui),Kn&&(ya=Jd(Jr,Bl,xn,ii,Qr,ei,Kn,oi,Ns))}}if(An){const Bs=jn.layout.get("icon-rotate").evaluate(ur,{},ji),Ns="none"!==jn.layout.get("icon-text-fit"),hh=Xd(An,Bs,Er,Ns),Wp=Kn?Xd(Kn,Bs,Er,Ns):void 0;ys=Jd(Jr,Bl,xn,ii,Qr,ei,An,oi,Bs),Sg=4*hh.length;const Ig=Dt.iconSizeData;let wu=null;"source"===Ig.kind?(wu=[cl*jn.layout.get("icon-size").evaluate(ur,{},ji)],wu[0]>hc&&Cr(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${rs}. Reduce your "icon-size".`)):"composite"===Ig.kind&&(wu=[cl*Hr.compositeIconSizes[0].evaluate(ur,{},ji),cl*Hr.compositeIconSizes[1].evaluate(ur,{},ji)],(wu[0]>hc||wu[1]>hc)&&Cr(`${Dt.layerIds[0]}: Value for "icon-size" is >= ${rs}. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,hh,wu,Ti,Xi,ur,!1,Yn,xn,No.lineStartIndex,No.lineLength,-1,is,ji),qp=Dt.icon.placedSymbolArray.length-1,Wp&&(Hp=4*Wp.length,Dt.addSymbols(Dt.icon,Wp,wu,Ti,Xi,ur,za.vertical,Yn,xn,No.lineStartIndex,No.lineLength,-1,is,ji),pf=Dt.icon.placedSymbolArray.length-1)}for(const Bs in qn.horizontal){const Ns=qn.horizontal[Bs];Co||(mf=ud(Ns.text),Vi?Fl=Zh(Ns):Co=Jd(Jr,Bl,xn,ii,Qr,ei,Ns,gi,jn.layout.get("text-rotate").evaluate(ur,{},ji),Ui));const hh=1===Ns.positionedLines.length;if(Zp+=fg(Dt,Yn,xn,Ns,ri,jn,Vi,ur,Ui,No,qn.vertical?za.horizontal:za.horizontalOnly,hh?Object.keys(qn.horizontal):[Bs],pl,qp,Hr,is,ji),hh)break}qn.vertical&&(rd+=fg(Dt,Yn,xn,qn.vertical,ri,jn,Vi,ur,Ui,No,za.vertical,["vertical"],pl,pf,Hr,is,ji));let mc=-1;const yf=(Bs,Ns)=>Bs?Math.max(Bs,Ns):Ns;mc=yf(Fl,mc),mc=yf(nd,mc),mc=yf(uh,mc);const Ag=mc>-1?1:0;Dt.glyphOffsetArray.length>=fc.MAX_GLYPHS&&Cr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ur.sortKey&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,ur.sortKey),Dt.symbolInstances.emplaceBack(Bl.x,Bl.y,Bl.z,xn.x,xn.y,pl.right>=0?pl.right:-1,pl.center>=0?pl.center:-1,pl.left>=0?pl.left:-1,pl.vertical>=0?pl.vertical:-1,qp,pf,mf,void 0!==Co?Co:Dt.collisionBoxArray.length,void 0!==Co?Co+1:Dt.collisionBoxArray.length,void 0!==Do?Do:Dt.collisionBoxArray.length,void 0!==Do?Do+1:Dt.collisionBoxArray.length,void 0!==ys?ys:Dt.collisionBoxArray.length,void 0!==ys?ys+1:Dt.collisionBoxArray.length,ya||Dt.collisionBoxArray.length,ya?ya+1:Dt.collisionBoxArray.length,ii,Zp,rd,Sg,Hp,Ag,0,gf,_f,mc)}(n,dn,Xn,Kt,r,s,h,jt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Me,st,b,0,Ke,Ft,K,e,p,w,A,k)};if("line"===et)for(const Kt of Tp(e.geometry,0,0,bn,bn)){const dn=O_(Kt,Se,Ze,r.vertical||ie,s,24,xe,n.overscaling,bn);for(const Qt of dn)ie&&pg(n,ie.text,_t,Qt)||ot(Kt,Qt,k)}else if("line-center"===et){for(const Kt of e.geometry)if(Kt.length>1){const dn=Dp(Kt,Ze,r.vertical||ie,s,24,xe);dn&&ot(Kt,dn,k)}}else if("Polygon"===e.type)for(const Kt of tp(e.geometry,0)){const dn=cg(Kt,16);ot(Kt[0],new ul(dn.x,dn.y,0,0,void 0),k)}else if("LineString"===e.type)for(const Kt of e.geometry)ot(Kt,new ul(Kt[0].x,Kt[0].y,0,0,void 0),k);else if("Point"===e.type)for(const Kt of e.geometry)for(const dn of Kt)ot([dn],new ul(dn.x,dn.y,0,0,void 0),k)}const rs=255,hc=rs*cl;function fg(n,e,r,s,h,p,m,y,b,w,A,k,z,G,H,K,ie){const ue=function(xe,Se,Me,Ke,Ze,st,Ft,et){const _t=[];if(0===Se.positionedLines.length)return _t;const yt=Ke.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,Pt=function(Qt){const Xn=Qt[0],Dt=Qt[1],xn=Xn*Dt;return xn>0?[Xn,-Dt]:xn<0?[-Xn,Dt]:0===Xn?[Dt,Xn]:[Dt,-Xn]}(Me);let jt=Math.abs(Se.top-Se.bottom);for(const Qt of Se.positionedLines)jt-=Qt.lineOffset;const ot=Se.positionedLines.length,Kt=jt/ot;let dn=Se.top-Me[1];for(let Qt=0;Qt<ot;++Qt){const Xn=Se.positionedLines[Qt];dn=lg(Se,Kt,dn,Qt);for(const Dt of Xn.positionedGlyphs){if(!Dt.rect)continue;const xn=Dt.rect||{};let Yn=4,Rr=!0,qn=1,An=0;if(Dt.imageName){const Er=Ft[Dt.imageName];if(!Er)continue;if(Er.sdf){Cr("SDF images are not supported in formatted text and will be ignored.");continue}Rr=!1,qn=Er.pixelRatio,Yn=1/qn}const ri=(Ze||et)&&Dt.vertical,Kn=Dt.metrics.advance*Dt.scale/2,jn=Dt.metrics,Jr=Dt.rect;if(null===Jr)continue;et&&Se.verticalizable&&(An=Dt.imageName?Kn-Dt.metrics.width*Dt.scale/2:0);const ii=Ze?[Dt.x+Kn,Dt.y]:[0,0];let Qr=[0,0],ei=[0,0],gi=!1;Ze||(ri?(ei=[Dt.x+Kn+Pt[0],Dt.y+Pt[1]-An],gi=!0):Qr=[Dt.x+Kn+Me[0],Dt.y+Me[1]-An]);const Vi=Jr.w*Dt.scale/(qn*(Dt.localGlyph?2:1)),Ui=Jr.h*Dt.scale/(qn*(Dt.localGlyph?2:1));let Br,oi,Xi,Ti;if(ri){const Er=Dt.y-dn,is=new Ge(-Kn,Kn-Er),ji=-Math.PI/2,No=new Ge(...ei);Br=new Ge(-Kn+Qr[0],Qr[1]),Br._rotateAround(ji,is)._add(No),Br.x+=-Er+Kn,Br.y-=(jn.left-Yn)*Dt.scale;const Co=Dt.imageName?jn.advance*Dt.scale:24*Dt.scale,ys=String.fromCharCode(Dt.glyph);Jm(ys)?Br.x+=(1-Yn)*Dt.scale:fp(ys)?Br.x+=Co-jn.height*Dt.scale+(-Yn-1)*Dt.scale:Br.x+=Dt.imageName||jn.width+2*Yn===Jr.w&&jn.height+2*Yn===Jr.h?(Co-Ui)/2:(Co-(jn.height+2*Yn)*Dt.scale)/2,oi=new Ge(Br.x,Br.y-Vi),Xi=new Ge(Br.x+Ui,Br.y),Ti=new Ge(Br.x+Ui,Br.y-Vi)}else{const Er=(jn.left-Yn)*Dt.scale-Kn+Qr[0],is=(-jn.top-Yn)*Dt.scale+Qr[1],ji=Er+Vi,No=is+Ui;Br=new Ge(Er,is),oi=new Ge(ji,is),Xi=new Ge(Er,No),Ti=new Ge(ji,No)}if(yt){let Er;Er=Ze?new Ge(0,0):gi?new Ge(Pt[0],Pt[1]):new Ge(Me[0],Me[1]),Br._rotateAround(yt,Er),oi._rotateAround(yt,Er),Xi._rotateAround(yt,Er),Ti._rotateAround(yt,Er)}const ur=new Ge(0,0),Hr=new Ge(0,0);_t.push({tl:Br,tr:oi,bl:Xi,br:Ti,tex:xn,writingMode:Se.writingMode,glyphOffset:ii,sectionIndex:Dt.sectionIndex,isSDF:Rr,pixelOffsetTL:ur,pixelOffsetBR:Hr,minFontScaleX:0,minFontScaleY:0})}}return _t}(0,s,b,p,m,y,h,n.allowVerticalPlacement),be=n.textSizeData;let de=null;"source"===be.kind?(de=[cl*p.layout.get("text-size").evaluate(y,{},ie)],de[0]>hc&&Cr(`${n.layerIds[0]}: Value for "text-size" is >= ${rs}. Reduce your "text-size".`)):"composite"===be.kind&&(de=[cl*H.compositeTextSizes[0].evaluate(y,{},ie),cl*H.compositeTextSizes[1].evaluate(y,{},ie)],(de[0]>hc||de[1]>hc)&&Cr(`${n.layerIds[0]}: Value for "text-size" is >= ${rs}. Reduce your "text-size".`)),n.addSymbols(n.text,ue,de,b,m,y,A,e,r,w.lineStartIndex,w.lineLength,G,K,ie);for(const xe of k)z[xe]=n.text.placedSymbolArray.length-1;return 4*ue.length}function B_(n){for(const e in n)return n[e];return null}function Jd(n,e,r,s,h,p,m,y,b,w){let A=m.top,k=m.bottom,z=m.left,G=m.right;const H=m.collisionPadding;if(H&&(z-=H[0],A-=H[1],G+=H[2],k+=H[3]),b){const K=new Ge(z,A),ie=new Ge(G,A),ue=new Ge(z,k),be=new Ge(G,k),de=tt(b);let xe=new Ge(0,0);w&&(xe=new Ge(w[0],w[1])),K._rotateAround(de,xe),ie._rotateAround(de,xe),ue._rotateAround(de,xe),be._rotateAround(de,xe),z=Math.min(K.x,ie.x,ue.x,be.x),G=Math.max(K.x,ie.x,ue.x,be.x),A=Math.min(K.y,ie.y,ue.y,be.y),k=Math.max(K.y,ie.y,ue.y,be.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,z,A,G,k,y,s,h,p),n.length-1}function Zh(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function pg(n,e,r,s){const h=n.compareText;if(e in h){const p=h[e];for(let m=p.length-1;m>=0;m--)if(s.dist(p[m])<r)return!0}else h[e]=[];return h[e].push(s),!1}function mg(n,e){const r=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,h=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),p=Math.sin(r)*h/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),m=Math.sin(n._pitch)*p+h;return Math.min(1.01*m,h*(1/n._horizonShift))}function gu(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),s=n.x*r,h=(n.x+1)*r,p=n.y*r,m=(n.y+1)*r,y=Os(s),b=Os(h),w=qo(p),A=qo(m),k=e.project(y,w),z=e.project(b,w),G=e.project(b,A),H=e.project(y,A);let K=Math.min(k.x,z.x,G.x,H.x),ie=Math.min(k.y,z.y,G.y,H.y),ue=Math.max(k.x,z.x,G.x,H.x),be=Math.max(k.y,z.y,G.y,H.y);const de=r/16;function xe(Me,Ke,Ze,st,Ft,et){const _t=(Ze+Ft)/2,yt=(st+et)/2,Pt=e.project(Os(_t),qo(yt)),jt=Math.max(0,K-Pt.x,ie-Pt.y,Pt.x-ue,Pt.y-be);K=Math.min(K,Pt.x),ue=Math.max(ue,Pt.x),ie=Math.min(ie,Pt.y),be=Math.max(be,Pt.y),jt>de&&(xe(Me,Pt,Ze,st,_t,yt),xe(Pt,Ke,_t,yt,Ft,et))}xe(k,z,s,p,h,p),xe(z,G,h,p,h,m),xe(G,H,h,m,s,m),xe(H,k,s,m,s,p),K-=de,ie-=de,ue+=de,be+=de;const Se=1/Math.max(ue-K,be-ie);return{scale:Se,x:K*Se,y:ie*Se,x2:ue*Se,y2:be*Se,projection:e}}const N_=ol(new Float32Array(16));class dc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Gr(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return Ba(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return mg(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,h){const p=e.horizonLineFromTop(!1),m=new Ge(r,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,h))}pointCoordinate3D(e,r,s){const h=new Ge(r,s);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return N_}createTileMatrix(e,r,s){let h,p,m;const y=s.canonical,b=ol(new Float64Array(16));if(this.isReprojectedInTileSpace){const w=gu(y,this);h=1,p=w.x+s.wrap*w.scale,m=w.y,Qc(b,b,[h/w.scale,h/w.scale,e.pixelsPerMeter/r])}else h=r/e.zoomScale(y.z),p=(y.x+Math.pow(2,y.z)*s.wrap)*h,m=y.y*h;return Ic(b,b,[p,m,0]),Qc(b,b,[h/bn,h/bn,1]),b}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class z_ extends dc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(tt(r));this.n=(h+Math.sin(tt(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c:h,r0:p}=this,m=tt(e-this.center[0]),y=tt(r),b=Math.sqrt(h-2*s*Math.sin(y))/s;return{x:b*Math.sin(m*s),y:b*Math.cos(m*s)-p,z:0}}unproject(e,r){const{n:s,c:h,r0:p}=this,m=p+r;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const b=tt(this.center[0])*s;y=ht(y,-Math.PI-b,Math.PI-b);const w=Be(ft(y/s)+this.center[0],-180,180),A=Math.asin(Be((h-(e*e+m*m)*s*s)/(2*s),-1,1)),k=Be(ft(A),-to,to);return new Gr(w,k)}}const ih=1.340264,qh=-.081106,Wh=893e-6,oh=.003796,Xh=Math.sqrt(3)/2;class V_ extends dc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Xh*Math.sin(r)),h=s*s,p=h*h*h;return{x:.5*(e*Math.cos(s)/(Xh*(ih+3*qh*h+p*(7*Wh+9*oh*h)))/Math.PI+.5),y:1-.5*(s*(ih+qh*h+p*(Wh+oh*h))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,h=s*s,p=h*h*h;for(let A,k,z,G=0;G<12&&(k=s*(ih+qh*h+p*(Wh+oh*h))-r,z=ih+3*qh*h+p*(7*Wh+9*oh*h),A=k/z,s=Be(s-A,-Math.PI/3,Math.PI/3),h=s*s,p=h*h*h,!(Math.abs(A)<1e-12));++G);const m=Xh*e*(ih+3*qh*h+p*(7*Wh+9*oh*h))/Math.cos(s),y=Math.asin(Math.sin(s)/Xh),b=Be(180*m/Math.PI,-180,180),w=Be(180*y/Math.PI,-to,to);return new Gr(b,w)}}class Il extends dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),h=Be(360*(.5-r),-to,to);return new Gr(s,h)}}const Nc=Math.PI/2;function Qd(n){return Math.tan((Nc+n)/2)}class U_ extends dc{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30];let h=tt(r),p=tt(s);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),y=Qd(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(Qd(p)/y),this.f=m*Math.pow(Qd(h),this.n)/this.n}project(e,r){r=tt(r),this.southernCenter&&(r=-r),e=tt(e-this.center[0]);const s=1e-6,{n:h,f:p}=this;p>0?r<-Nc+s&&(r=-Nc+s):r>Nc-s&&(r=Nc-s);const m=p/Math.pow(Qd(r),h);let y=m*Math.sin(h*e),b=p-m*Math.cos(h*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:h}=this,p=h-r,m=Math.sign(p),y=Math.sign(s)*Math.sqrt(e*e+p*p);let b=Math.atan2(e,Math.abs(p))*m;p*s<0&&(b-=Math.PI*Math.sign(e)*m);const w=Be(ft(b/s)+this.center[0],-180,180),A=Be(ft(2*Math.atan(Math.pow(h/y,1/s))-Nc),-to,to);return new Gr(w,this.southernCenter?-A:A)}}class j_ extends dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:sl(e),y:al(r),z:0}}unproject(e,r){const s=Os(e),h=qo(r);return new Gr(s,h)}}const Lp=tt(to);class $_ extends dc{project(e,r){const s=(r=tt(r))*r,h=s*s;return{x:.5*((e=tt(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,h=25,p=0,m=s*s;do{m=s*s;const w=m*m;p=(s*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-r)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),s=Be(s-p,-Lp,Lp)}while(Math.abs(p)>1e-6&&--h>0);m=s*s;const y=Be(ft(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=ft(s);return new Gr(y,b)}}const gg=tt(to);class G_ extends dc{project(e,r){r=tt(r),e=tt(e);const s=Math.cos(r),h=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),m=Math.sin(p)/p,y=.5*(e*h+2*s*Math.sin(e/2)/m)||0,b=.5*(r+Math.sin(r)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,h=r=(2*(1-r)-1)*Math.PI,p=25;const m=1e-6;let y=0,b=0;do{const w=Math.cos(h),A=Math.sin(h),k=2*A*w,z=A*A,G=w*w,H=Math.cos(s/2),K=Math.sin(s/2),ie=2*H*K,ue=K*K,be=1-G*H*H,de=be?1/be:0,xe=be?Math.acos(w*H)*Math.sqrt(1/be):0,Se=.5*(2*xe*w*K+2*s/Math.PI)-e,Me=.5*(xe*A+h)-r,Ke=.5*de*(G*ue+xe*w*H*z)+1/Math.PI,Ze=de*(ie*k/4-xe*A*K),st=.125*de*(k*K-xe*A*G*ie),Ft=.5*de*(z*H+xe*ue*w)+.5,et=Ze*st-Ft*Ke;y=(Me*Ze-Se*Ft)/et,b=(Se*st-Me*Ke)/et,s=Be(s-y,-Math.PI,Math.PI),h=Be(h-b,-gg,gg)}while((Math.abs(y)>m||Math.abs(b)>m)&&--p>0);return new Gr(ft(s),ft(h))}}class ef extends dc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:h}=this;return{x:tt(e)*h*s+.5,y:-Math.sin(tt(r))/h*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:h}=this,p=-(r-.5)/s,m=Be(ft((e-.5)/s)/h,-180,180),y=Math.asin(Be(p*h,-1,1)),b=Be(ft(y),-to,to);return new Gr(m,b)}}class H_ extends j_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,s){const h=Uu(e,r,s);return zi(h,h,Sh(Al(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,r){const s=Vu(r.lat,r.lng),h=es([],s),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;eu(s,s,h,Ba(1,0)*bn*p);const m=ol(new Float64Array(16));return Ac(m,e.pixelMatrix,e.globeMatrix),zi(s,s,m),new Ge(s[0],s[1])}pixelsPerMeter(e,r){return Ba(1,0)*r}pixelSpaceConversion(e,r,s){const h=Ba(1,e)*r,p=mr(Ba(1,45)*r,h,s);return this.pixelsPerMeter(e,r)/p}createTileMatrix(e,r,s){const h=Vf(Al(s.canonical));return Ac(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,r){const{center:s}=e,h=Sh(Al(r));return pd(h,h,tt(s.lng)),xh(h,h,tt(s.lat)),Qc(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,r,s,h){return Kg(e,r,s,!0)||new ju(0,0)}pointCoordinate3D(e,r,s){const h=this.pointCoordinate(e,r,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,r){return!Kg(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(h,p){const m=h.cameraToCenterDistance,y=h._centerAltitude*p,b=h._camera,w=h._camera.forward(),A=ec([],Qo([],w,-m),[0,0,y]),k=h.worldSize/(2*Math.PI),z=[0,0,-k],G=h.width/h.height,H=Math.tan(h.fovAboveCenter),K=Qo([],b.up(),H),ie=Qo([],b.right(),H*G),ue=es([],ec([],ec([],w,K),ie)),be=[];let de;if(new Dh(A,ue).closestPointOnSphere(z,k,be)){const xe=ec([],be,z),Se=ga([],xe,A);de=Math.cos(h.fovAboveCenter)*wh(Se)}else{const xe=ga([],A,z),Se=ga([],z,A);es(Se,Se);const Me=wh(xe)-k;de=Math.sqrt(Me*(Me+2*k));const Ke=Math.acos(de/(k+Me))-Math.acos(ma(w,Se));de*=Math.cos(Ke)}return 1.01*de}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Ah(e.zoom);if(s>0){const h=mg(e,Ba(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return mr(r,h+p*(1-Math.cos(m)),Math.pow(s,10))}return r}upVector(e,r,s){return Uu(r,s,e,1)}upVectorScale(e){return{metersToTile:Th(xd(Al(e)))}}}function _g(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new j_(n);case"equirectangular":return new Il(n);case"naturalEarth":return new $_(n);case"equalEarth":return new V_(n);case"winkelTripel":return new G_(n);case"albers":return r?new ef(n):new z_(n);case"lambertConformalConic":return r?new ef(n):new U_(n);case"globe":return new H_(n)}throw new Error(`Invalid projection name: ${n.name}`)}const tf=Ud.types,kp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _u(n,e,r,s,h,p,m,y,b,w,A,k,z){const G=y?Math.min(hc,Math.round(y[0])):0,H=y?Math.min(hc,Math.round(y[1])):0;n.emplaceBack(e,r,Math.round(32*s),Math.round(32*h),p,m,(G<<1)+(b?1:0),H,16*w,16*A,256*k,256*z)}function Op(n,e,r,s,h,p,m){n.emplaceBack(e,r,s,h,p,m)}function sh(n,e,r,s,h){n.emplaceBack(e,r,s,h),n.emplaceBack(e,r,s,h),n.emplaceBack(e,r,s,h),n.emplaceBack(e,r,s,h)}function cv(n){for(const e of n.sections)if(Cf(e.text))return!0;return!1}class nf{constructor(e){this.layoutVertexArray=new Ct,this.indexArray=new yn,this.programConfigurations=e,this.segments=new Oi,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new _n,this.placedSymbolArray=new eo,this.globeExtVertexArray=new Ot}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,r,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,C_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,kp,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ku.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Zt(nf,"SymbolBuffers");class rf{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Oi,this.collisionVertexArray=new Qn,this.collisionVertexArrayExt=new er}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Gd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(rf,"CollisionBuffers");class fc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ol([]),this.placementViewportMatrix=ol([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dp(this.zoom,r["text-size"]),this.iconSizeData=dp(this.zoom,r["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>za[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new nf(new Kc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new nf(new Kc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Zo,this.lineVertexArray=new Pu,this.symbolInstances=new mi}calculateGlyphDependencies(e,r,s,h,p){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,h&&p){const y=Qu[e.charAt(m)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,s,h){const p=this.layers[0],m=p.layout,y="globe"===this.projection.name,b=m.get("text-font"),w=m.get("text-field"),A=m.get("icon-image"),k=("constant"!==w.value.kind||w.value.value instanceof Ki&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),z="constant"!==A.value.kind||!!A.value.value||Object.keys(A.parameters).length>0,G=m.get("symbol-sort-key");if(this.features=[],!k&&!z)return;const H=r.iconDependencies,K=r.glyphDependencies,ie=r.availableImages,ue=new P(this.zoom);for(const{feature:be,id:de,index:xe,sourceLayerIndex:Se}of e){const Me=p._featureFilter.needGeometry,Ke=iu(be,Me);if(!p._featureFilter.filter(ue,Ke,s))continue;if(Me||(Ke.geometry=tc(be,s,h)),y&&1!==be.type&&s.z<=5){const et=Ke.geometry,_t=.98078528056,yt=(Pt,jt)=>ma(Uu(Pt.x,Pt.y,s,1),Uu(jt.x,jt.y,s,1))<_t;for(let Pt=0;Pt<et.length;Pt++)et[Pt]=n_(et[Pt],yt)}let Ze,st;if(k){const et=p.getValueAndResolveTokens("text-field",Ke,s,ie),_t=Ki.factory(et);cv(_t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===v()||this.hasRTLText&&C.isParsed())&&(Ze=D_(_t,p,Ke))}if(z){const et=p.getValueAndResolveTokens("icon-image",Ke,s,ie);st=et instanceof Io?et:Io.fromString(et)}if(!Ze&&!st)continue;const Ft=this.sortFeaturesByKey?G.evaluate(Ke,{},s):void 0;if(this.features.push({id:de,text:Ze,icon:st,index:xe,sourceLayerIndex:Se,geometry:Ke.geometry,properties:be.properties,type:tf[be.type],sortKey:Ft}),st&&(H[st.name]=!0),Ze){const et=b.evaluate(Ke,{},s).join(","),_t="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(za.vertical)>=0;for(const yt of Ze.sections)if(yt.image)H[yt.image.name]=!0;else{const Pt=Ps(Ze.toString()),jt=yt.fontStack||et,ot=K[jt]=K[jt]||{};this.calculateGlyphDependencies(yt.text,ot,_t,this.allowVerticalPlacement,Pt)}}}"line"===m.get("symbol-placement")&&(this.features=function(be){const de={},xe={},Se=[];let Me=0;function Ke(et){Se.push(be[et]),Me++}function Ze(et,_t,yt){const Pt=xe[et];return delete xe[et],xe[_t]=Pt,Se[Pt].geometry[0].pop(),Se[Pt].geometry[0]=Se[Pt].geometry[0].concat(yt[0]),Pt}function st(et,_t,yt){const Pt=de[_t];return delete de[_t],de[et]=Pt,Se[Pt].geometry[0].shift(),Se[Pt].geometry[0]=yt[0].concat(Se[Pt].geometry[0]),Pt}function Ft(et,_t,yt){const Pt=yt?_t[0][_t[0].length-1]:_t[0][0];return`${et}:${Pt.x}:${Pt.y}`}for(let et=0;et<be.length;et++){const _t=be[et],yt=_t.geometry,Pt=_t.text?_t.text.toString():null;if(!Pt){Ke(et);continue}const jt=Ft(Pt,yt),ot=Ft(Pt,yt,!0);if(jt in xe&&ot in de&&xe[jt]!==de[ot]){const Kt=st(jt,ot,yt),dn=Ze(jt,ot,Se[Kt].geometry);delete de[jt],delete xe[ot],xe[Ft(Pt,Se[dn].geometry,!0)]=dn,Se[Kt].geometry=null}else jt in xe?Ze(jt,ot,yt):ot in de?st(jt,ot,yt):(Ke(et),de[jt]=Me-1,xe[ot]=Me-1)}return Se.filter(et=>et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((be,de)=>be.sortKey-de.sortKey)}update(e,r,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=_g(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:h,y:p}of r)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,h,p,m,y,b,w,A,k,z,G,H){const K=e.indexArray,ie=e.layoutVertexArray,ue=e.globeExtVertexArray,be=e.segments.prepareSegment(4*r.length,ie,K,this.canOverlap?m.sortKey:void 0),de=this.glyphOffsetArray.length,xe=be.vertexLength,Se=this.allowVerticalPlacement&&y===za.vertical?Math.PI/2:0,Me=m.text&&m.text.sections;for(let Ze=0;Ze<r.length;Ze++){const{tl:st,tr:Ft,bl:et,br:_t,tex:yt,pixelOffsetTL:Pt,pixelOffsetBR:jt,minFontScaleX:ot,minFontScaleY:Kt,glyphOffset:dn,isSDF:Qt,sectionIndex:Xn}=r[Ze],Dt=be.vertexLength,xn=dn[1];if(_u(ie,w.x,w.y,st.x,xn+st.y,yt.x,yt.y,s,Qt,Pt.x,Pt.y,ot,Kt),_u(ie,w.x,w.y,Ft.x,xn+Ft.y,yt.x+yt.w,yt.y,s,Qt,jt.x,Pt.y,ot,Kt),_u(ie,w.x,w.y,et.x,xn+et.y,yt.x,yt.y+yt.h,s,Qt,Pt.x,jt.y,ot,Kt),_u(ie,w.x,w.y,_t.x,xn+_t.y,yt.x+yt.w,yt.y+yt.h,s,Qt,jt.x,jt.y,ot,Kt),b){const{x:Yn,y:Rr,z:qn}=b.anchor,[An,ri,Kn]=b.up;Op(ue,Yn,Rr,qn,An,ri,Kn),Op(ue,Yn,Rr,qn,An,ri,Kn),Op(ue,Yn,Rr,qn,An,ri,Kn),Op(ue,Yn,Rr,qn,An,ri,Kn),sh(e.dynamicLayoutVertexArray,Yn,Rr,qn,Se)}else sh(e.dynamicLayoutVertexArray,w.x,w.y,w.z,Se);K.emplaceBack(Dt,Dt+1,Dt+2),K.emplaceBack(Dt+1,Dt+2,Dt+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dn[0]),Ze!==r.length-1&&Xn===r[Ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,m,m.index,{},G,H,Me&&Me[Xn])}const Ke=b?b.anchor:w;e.placedSymbolArray.emplaceBack(Ke.x,Ke.y,Ke.z,w.x,w.y,de,this.glyphOffsetArray.length-de,xe,A,k,w.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],y,0,!1,0,z,0)}_commitLayoutVertex(e,r,s,h,p,m,y){e.emplaceBack(r,s,h,p,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,s,h,p,m,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,A=y.tileAnchorX,k=y.tileAnchorY;for(let G=0;G<4;G++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,h,p,m,A,k,new Ge(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,p,m,A,k,new Ge(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,p,m,A,k,new Ge(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,p,m,A,k,new Ge(e.x1,e.y2)),b.vertexLength+=4;const z=s.indexArray;z.emplaceBack(w,w+1),z.emplaceBack(w+1,w+2),z.emplaceBack(w+2,w+3),z.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,h,p,m){for(let y=h;y<p;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,m,r,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,s,h,p,m){for(let y=h;y<p;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rf(hn,Xm.members,Eo),this.iconCollisionBox=new rf(hn,Xm.members,Eo);const s=Ju(this.iconSizeData,e),h=Ju(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,s,h){const p=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:h),m=Hd(this.textSizeData,e,p)/24;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,s){const h=this.icon.placedSymbolArray.get(s),p=Hd(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,h,p,m){for(let y=h;y<p;y++){const b=s.get(y),w=this.getSymbolInstanceTextSize(e,m,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding)}}_updateIconDebugCollisionBoxes(e,r,s,h,p,m){for(let y=h;y<p;y++){const b=s.get(y),w=this.getSymbolInstanceIconSize(e,r,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,b.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Ju(this.iconSizeData,e),h=Ju(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,h,p,m,y,b,w){const A={};if(r<s){const{x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe,featureIndex:Se}=e.get(r);A.textBox={x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe},A.textFeatureIndex=Se}if(h<p){const{x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe,featureIndex:Se}=e.get(h);A.verticalTextBox={x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe},A.verticalTextFeatureIndex=Se}if(m<y){const{x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe,featureIndex:Se}=e.get(m);A.iconBox={x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe},A.iconFeatureIndex=Se}if(b<w){const{x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe,featureIndex:Se}=e.get(b);A.verticalIconBox={x1:k,y1:z,x2:G,y2:H,padding:K,projectedAnchorX:ie,projectedAnchorY:ue,projectedAnchorZ:be,tileAnchorX:de,tileAnchorY:xe},A.verticalIconFeatureIndex=Se}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),h=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),h=[],p=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);h.push(0|Math.round(r*b.tileAnchorX+s*b.tileAnchorY)),p.push(b.featureIndex)}return m.sort((y,b)=>h[y]-h[b]||p[b]-p[y]),m}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zt(fc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),fc.MAX_GLYPHS=65535,fc.addDynamicAttributes=sh;const yg=new me({"symbol-placement":new Y(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new Y(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Y(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new se(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Y(rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Y(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Y(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Y(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Y(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new se(rt.layout_symbol["icon-size"]),"icon-text-fit":new Y(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Y(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new se(rt.layout_symbol["icon-image"]),"icon-rotate":new se(rt.layout_symbol["icon-rotate"]),"icon-padding":new Y(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new Y(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new se(rt.layout_symbol["icon-offset"]),"icon-anchor":new se(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Y(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Y(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Y(rt.layout_symbol["text-rotation-alignment"]),"text-field":new se(rt.layout_symbol["text-field"]),"text-font":new se(rt.layout_symbol["text-font"]),"text-size":new se(rt.layout_symbol["text-size"]),"text-max-width":new se(rt.layout_symbol["text-max-width"]),"text-line-height":new se(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new se(rt.layout_symbol["text-letter-spacing"]),"text-justify":new se(rt.layout_symbol["text-justify"]),"text-radial-offset":new se(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Y(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new se(rt.layout_symbol["text-anchor"]),"text-max-angle":new Y(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new Y(rt.layout_symbol["text-writing-mode"]),"text-rotate":new se(rt.layout_symbol["text-rotate"]),"text-padding":new Y(rt.layout_symbol["text-padding"]),"text-keep-upright":new Y(rt.layout_symbol["text-keep-upright"]),"text-transform":new se(rt.layout_symbol["text-transform"]),"text-offset":new se(rt.layout_symbol["text-offset"]),"text-allow-overlap":new Y(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Y(rt.layout_symbol["text-ignore-placement"]),"text-optional":new Y(rt.layout_symbol["text-optional"])});var Yh={paint:new me({"icon-opacity":new se(rt.paint_symbol["icon-opacity"]),"icon-color":new se(rt.paint_symbol["icon-color"]),"icon-halo-color":new se(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new se(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new se(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new Y(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Y(rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new se(rt.paint_symbol["text-opacity"]),"text-color":new se(rt.paint_symbol["text-color"],{runtimeType:yi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new se(rt.paint_symbol["text-halo-color"]),"text-halo-width":new se(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new se(rt.paint_symbol["text-halo-blur"]),"text-translate":new Y(rt.paint_symbol["text-translate"]),"text-translate-anchor":new Y(rt.paint_symbol["text-translate-anchor"])}),layout:yg};class Pl{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:So,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(Pl,"FormatSectionOverride",{omit:["defaultValue"]});class yu extends Ml{constructor(e){super(e,Yh)}recalculate(e,r){super.recalculate(e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const p of s)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,h){const p=this.layout.get(e).evaluate(r,{},s,h),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Ka(m.value)||!p?p:(y=r.properties,p.replace(/{([^{}]+)}/g,(w,A)=>A in y?String(y[A]):""));var y}createBucket(e){return new fc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Yh.paint.overridableProperties){if(!yu.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Pl(r),h=new $l(s,r.property.specification);let p=null;p="constant"===r.value.kind||"source"===r.value.kind?new qc("source",h):new Ks("composite",h,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new le(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&yu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),h=Yh.paint.properties[r];let p=!1;const m=y=>{for(const b of y)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if("constant"===s.value.kind&&s.value.value instanceof Ki)m(s.value.value.sections);else if("source"===s.value.kind){const y=w=>{p||(w instanceof Pi&&ti(w.value)===mo?m(w.value.sections):w instanceof Zi?m(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return p}getProgramConfiguration(e){return new Sc(this,e)}}var sf={paint:new me({"background-color":new Y(rt.paint_background["background-color"]),"background-pattern":new Y(rt.paint_background["background-pattern"]),"background-opacity":new Y(rt.paint_background["background-opacity"])})},Kh={paint:new me({"raster-opacity":new Y(rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Y(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Y(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Y(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new Y(rt.paint_raster["raster-saturation"]),"raster-contrast":new Y(rt.paint_raster["raster-contrast"]),"raster-resampling":new Y(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new Y(rt.paint_raster["raster-fade-duration"])})};class Z_ extends Ml{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Fp={paint:new me({"sky-type":new Y(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Y(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Y(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Y(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Y(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new fe(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Y(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Y(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Y(rt.paint_sky["sky-opacity"])})};function af(n,e,r){const s=[0,0,1],h=dm([]);return Eh(h,h,r?-tt(n)+Math.PI:tt(n)),vd(h,h,-tt(e)),kf(s,s,h),es(s,s)}const q_={circle:class extends Ml{constructor(n){super(n,o_)}createBucket(n){return new Zf(n)}queryRadius(n){const e=n;return au("circle-radius",this,e)+au("circle-stroke-width",this,e)+Md(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,s,h,p,m,y){const b=xm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return bm(n,s,p,m,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,w)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Sc(this,n)}},heatmap:class extends Ml{createBucket(n){return new wm(n)}constructor(n){super(n,Yf),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=kh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return au("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,s,h,p,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return bm(n,s,p,m,y,!0,!0,new Ge(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Sc(this,n)}},hillshade:class extends Ml{constructor(n){super(n,u_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ml{constructor(n){super(n,Bd)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new Sc(this,n)}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new qu(n)}queryRadius(){return Md(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,s,h,p){return!n.queryGeometry.isAboveHorizon&&Td(Xf(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ml{constructor(n){super(n,v_)}createBucket(n){return new Nh(n)}queryRadius(){return Md(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Sc(this,n)}queryIntersectsFeature(n,e,r,s,h,p,m,y,b){const w=xm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),z=[0,0],G=y&&p.elevation,H=p.elevation?p.elevation.exaggeration():1,K=n.tile.getBucket(this);if(G&&K instanceof Nh){const xe=K.centroidVertexArray,Se=b+1;Se<xe.length&&(z[0]=xe.geta_centroid_pos0(Se),z[1]=xe.geta_centroid_pos1(Se))}if(0===z[0]&&1===z[1])return!1;"globe"===p.projection.name&&(s=op([s],[new Ge(0,0),new Ge(bn,bn)],n.tileID.canonical).map(xe=>xe.polygon).flat());const ie=G?y:null,[ue,be]=(Se=s,Me=k,Ke=A,Ze=w,st=m,Ft=ie,et=z,_t=H,yt=p.center.lat,"globe"===(xe=p).projection.name?function(jt,ot,Kt,dn,Qt,Xn,Dt,xn,Yn,Rr,qn){const An=[],ri=[],Kn=jt.projection.upVectorScale(qn,jt.center.lat,jt.worldSize).metersToTile,jn=[0,0,0,1],Jr=[0,0,0,1],ii=(ei,gi,Vi,Ui)=>{ei[0]=gi,ei[1]=Vi,ei[2]=Ui,ei[3]=1},Qr=ip();Kt>0&&(Kt+=Qr),dn+=Qr;for(const ei of ot){const gi=[],Vi=[];for(const Ui of ei){const Br=Ui.x+Qt.x,oi=Ui.y+Qt.y,Xi=jt.projection.projectTilePoint(Br,oi,qn),Ti=jt.projection.upVector(qn,Ui.x,Ui.y);let ur=Kt,Hr=dn;if(Dt){const Er=ap(Br,oi,Kt,dn,Dt,xn,Yn,Rr);ur+=Er.base,Hr+=Er.top}0!==Kt?ii(jn,Xi.x+Ti[0]*Kn*ur,Xi.y+Ti[1]*Kn*ur,Xi.z+Ti[2]*Kn*ur):ii(jn,Xi.x,Xi.y,Xi.z),ii(Jr,Xi.x+Ti[0]*Kn*Hr,Xi.y+Ti[1]*Kn*Hr,Xi.z+Ti[2]*Kn*Hr),zi(jn,jn,Xn),zi(Jr,Jr,Xn),gi.push(new Yu(jn[0],jn[1],jn[2])),Vi.push(new Yu(Jr[0],Jr[1],Jr[2]))}An.push(gi),ri.push(Vi)}return[An,ri]}(xe,Se,Me,Ke,Ze,st,Ft,et,_t,yt,n.tileID.canonical):Ft?function(jt,ot,Kt,dn,Qt,Xn,Dt,xn,Yn){const Rr=[],qn=[],An=[0,0,0,1];for(const ri of jt){const Kn=[],jn=[];for(const Jr of ri){const ii=Jr.x+dn.x,Qr=Jr.y+dn.y,ei=ap(ii,Qr,ot,Kt,Xn,Dt,xn,Yn);An[0]=ii,An[1]=Qr,An[2]=ei.base,An[3]=1,Pc(An,An,Qt),An[3]=Math.max(An[3],1e-5);const gi=new Yu(An[0]/An[3],An[1]/An[3],An[2]/An[3]);An[0]=ii,An[1]=Qr,An[2]=ei.top,An[3]=1,Pc(An,An,Qt),An[3]=Math.max(An[3],1e-5);const Vi=new Yu(An[0]/An[3],An[1]/An[3],An[2]/An[3]);Kn.push(gi),jn.push(Vi)}Rr.push(Kn),qn.push(jn)}return[Rr,qn]}(Se,Me,Ke,Ze,st,Ft,et,_t,yt):function(jt,ot,Kt,dn,Qt){const Xn=[],Dt=[],xn=Qt[8]*ot,Yn=Qt[9]*ot,Rr=Qt[10]*ot,qn=Qt[11]*ot,An=Qt[8]*Kt,ri=Qt[9]*Kt,Kn=Qt[10]*Kt,jn=Qt[11]*Kt;for(const Jr of jt){const ii=[],Qr=[];for(const ei of Jr){const gi=ei.x+dn.x,Vi=ei.y+dn.y,Ui=Qt[0]*gi+Qt[4]*Vi+Qt[12],Br=Qt[1]*gi+Qt[5]*Vi+Qt[13],oi=Qt[2]*gi+Qt[6]*Vi+Qt[14],Xi=Qt[3]*gi+Qt[7]*Vi+Qt[15],Ti=Ui+xn,ur=Br+Yn,Hr=oi+Rr,Er=Math.max(Xi+qn,1e-5),is=Ui+An,ji=Br+ri,No=oi+Kn,Co=Math.max(Xi+jn,1e-5);ii.push(new Yu(Ti/Er,ur/Er,Hr/Er)),Qr.push(new Yu(is/Co,ji/Co,No/Co))}Xn.push(ii),Dt.push(Qr)}return[Xn,Dt]}(Se,Me,Ke,Ze,st)),de=n.queryGeometry;var xe,Se,Me,Ke,Ze,st,Ft,et,_t,yt;return function(xe,Se,Me){let Ke=1/0;Td(Me,Se)&&(Ke=sp(Me,Se[0]));for(let Ze=0;Ze<Se.length;Ze++){const st=Se[Ze],Ft=xe[Ze];for(let et=0;et<st.length-1;et++){const _t=st[et],yt=[_t,st[et+1],Ft[et+1],Ft[et],_t];_m(Me,yt)&&(Ke=Math.min(Ke,sp(Me,yt)))}}return Ke!==1/0&&Ke}(ue,be,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends Ml{constructor(n){super(n,qm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=hp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new up(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Sc(this,n)}queryRadius(n){const e=n,r=w_(au("line-width",this,e),au("line-gap-width",this,e)),s=au("line-offset",this,e);return r/2+Math.abs(s)+Md(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,s,h,p){if(n.queryGeometry.isAboveHorizon)return!1;const m=Xf(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*w_(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(s=function(w,A){const k=[],z=new Ge(0,0);for(let G=0;G<w.length;G++){const H=w[G],K=[];for(let ie=0;ie<H.length;ie++){const ue=H[ie],be=H[ie+1],de=0===ie?z:ue.sub(H[ie-1])._unit()._perp(),xe=ie===H.length-1?z:be.sub(ue)._unit()._perp(),Se=de._add(xe)._unit();Se._mult(1/(Se.x*xe.x+Se.y*xe.y)),K.push(Se._mult(A)._add(ue))}k.push(K)}return k}(s,b*n.pixelToTileUnitsFactor)),function(w,A,k){for(let z=0;z<A.length;z++){const G=A[z];if(w.length>=3)for(let H=0;H<G.length;H++)if(su(w,G[H]))return!0;if(ym(w,G,k))return!0}return!1}(m,s,y)}isTileClipped(){return!0}},symbol:yu,background:class extends Ml{constructor(n){super(n,sf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ml{constructor(n){super(n,Kh)}getProgramIds(){return["raster"]}},sky:class extends Ml{constructor(n){super(n,Fp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=kh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,p=n.style.light,m=p.properties.get("position");return h&&"viewport"===p.properties.get("anchor")&&Cr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?af(m.azimuthal,90-m.polar,e):af(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return af(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class Jh{constructor(e,r,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,h)}update(e,r,s){const{width:h,height:p}=e,{context:m}=this,{gl:y}=m,{HTMLImageElement:b,HTMLCanvasElement:w,HTMLVideoElement:A,ImageData:k,ImageBitmap:z}=Te;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||!1!==r.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===p){const{x:G,y:H}=s||{x:0,y:0};e instanceof b||e instanceof w||e instanceof A||e instanceof k||z&&e instanceof z?y.texSubImage2D(y.TEXTURE_2D,0,G,H,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,G,H,h,p,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[h,p],e instanceof b||e instanceof w||e instanceof A||e instanceof k||z&&e instanceof z?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,h,p,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qh{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class W_{constructor(){this.tasks={},this.taskQueue=[],Zr(["process"],this),this.invoker=new Qh(this.process),this.nextId=0}add(e,r){const s=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:y}){return y=y||0,"message"===p?0:"maybePrepare"!==p||m?"parseTile"!==p||m?"parseTile"===p&&m?300-y:"maybePrepare"===p&&m?400-y:500:200-y:100-y}(r);if(0===h){fi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){fi();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<r&&(r=p.priority,e=h)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class X_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Y_=["tile","layer","source","sourceLayer","state"];class K_{constructor(e,r,s,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=h,this.properties=e.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const r of Y_)void 0!==this[r]&&(e[r]=this[r]);return e}}const zc=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,r=0,s=0,h=0,p=0,m=0,y=0;for(1&e?h=p=m=32:r=s=y=32;(e>>=1)>1;){const w=r+h>>1,A=s+p>>1;1&e?(h=r,p=s,r=m,s=y):(r=h,s=p,h=m,p=y),m=w,y=A}const b=4*n;zc[b+0]=r,zc[b+1]=s,zc[b+2]=h,zc[b+3]=p}const fl=new Uint16Array(2178),Ll=new Uint8Array(1089),lf=new Uint16Array(1089);function cf(n){return 0===n?-.03125:32===n?.03125:0}var vg=Ne([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const xg={type:2,extent:bn,loadGeometry:()=>[[new Ge(0,0),new Ge(8193,0),new Ge(8193,8193),new Ge(0,8193),new Ge(0,0)]]};class Bp{constructor(e,r,s,h,p){this.tileID=e,this.uid=vr(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<xi.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=gu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const y of h){const b=y.layerIds.map(w=>p.getLayer(w)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(w=>b.filter(A=>A.id===w)[0]));for(const w of b)m[w.id]=y}}return m}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof fc){if(this.hasSymbolBuckets=!0,!s)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof fc&&p.hasRTLText){this.hasRTLText=!0,C.isLoading()||C.isLoaded()||"deferred"!==v()||E();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Kr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Jh(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Jh(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Jh(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,h,p,m,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:y,transform:m,params:p,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),p=r?r.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const y=ha(r&&r.filter),{z:b,x:w,y:A}=this.tileID.canonical,k={z:b,x:w,y:A};for(let z=0;z<m.length;z++){const G=m.feature(z);if(y.needGeometry){const ie=iu(G,!0);if(!y.filter(new P(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!y.filter(new P(this.tileID.overscaledZ),G))continue;const H=s.getId(G,p),K=new K_(G,b,w,A,H);K.tile=k,e.push(K)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=Nr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const p=this.expirationTime-r;p?this.expirationTime=s+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),h=r.style.listImages();for(const p in this.buckets){if(!r.style.hasLayer(p))continue;const m=this.buckets[p],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],w=e[y];if(!b||!w||0===Object.keys(w).length)continue;if(m.update(w,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof up||m instanceof qu){const k=r.style._getSourceCache(m.layers[0].source);r._terrain&&r._terrain.enabled&&k&&m.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}const A=r&&r.style&&r.style.getLayer(p);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=xi.now()+e}setTexture(e,r){const s=r.context,h=s.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Jh(s,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,r){const s={};for(const h of r)s[h]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const h=this.dependencies[s];if(h)for(const p of r)if(h[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const s=tc(xg,this.tileID.canonical,this.tileTransform)[0],h=new Bt,p=new ta;for(let m=0;m<s.length;m++){const{x:y,y:b}=s[m];h.emplaceBack(y,b),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(h,Bu.members),this._tileDebugSegments=Oi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const s=tc(xg,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(y,b){const w=gu(y,b),A=Math.pow(2,y.z);for(let ie=0;ie<33;ie++)for(let ue=0;ue<33;ue++){const be=Os((y.x+(ue+cf(ue))/32)/A),de=qo((y.y+(ie+cf(ie))/32)/A),xe=b.project(be,de),Se=33*ie+ue;fl[2*Se+0]=Math.round((xe.x*w.scale-w.x)*bn),fl[2*Se+1]=Math.round((xe.y*w.scale-w.y)*bn)}Ll.fill(0),lf.fill(0);for(let ie=2045;ie>=0;ie--){const ue=4*ie,be=zc[ue+0],de=zc[ue+1],xe=zc[ue+2],Se=zc[ue+3],Me=be+xe>>1,Ke=de+Se>>1,Ze=Me+Ke-de,st=Ke+be-Me,Ft=33*de+be,et=33*Se+xe,_t=33*Ke+Me,yt=Math.hypot((fl[2*Ft+0]+fl[2*et+0])/2-fl[2*_t+0],(fl[2*Ft+1]+fl[2*et+1])/2-fl[2*_t+1])>=16;Ll[_t]=Ll[_t]||(yt?1:0),ie<1022&&(Ll[_t]=Ll[_t]||Ll[33*(de+st>>1)+(be+Ze>>1)]||Ll[33*(Se+st>>1)+(xe+Ze>>1)])}const k=new mt,z=new yn;let G=0;function H(ie,ue){const be=33*ue+ie;return 0===lf[be]&&(k.emplaceBack(fl[2*be+0],fl[2*be+1],ie*bn/32,ue*bn/32),lf[be]=++G),lf[be]-1}function K(ie,ue,be,de,xe,Se){const Me=ie+be>>1,Ke=ue+de>>1;if(Math.abs(ie-xe)+Math.abs(ue-Se)>1&&Ll[33*Ke+Me])K(xe,Se,ie,ue,Me,Ke),K(be,de,xe,Se,Me,Ke);else{const Ze=H(ie,ue),st=H(be,de),Ft=H(xe,Se);z.emplaceBack(Ze,st,Ft)}}return K(0,0,32,32,32,0),K(32,32,0,0,0,32),{vertices:k,indices:z}}(this.tileID.canonical,r);h=m.vertices,p=m.indices}else{h=new mt,p=new yn;for(const{x:y,y:b}of s)h.emplaceBack(y,b,0,0);const m=Rd(h.int16,void 0,4);for(let y=0;y<m.length;y+=3)p.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,vg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Oi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(e,r){const s=r.projection;if(!s||"globe"!==s.name||r.freezeTileCoverage)return;const h=this.tileID.canonical,p=Sh(Nu(h,r)),m=Ah(r.zoom);let y;m>0&&(y=Pf(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,r,p,y,m),this._makeGlobeTileDebugTextBuffer(e,h,r,p,y,m)}_globePoint(e,r,s,h,p,m,y){let b=Uu(e,r,s);if(m){const w=1<<s.z,A=sl(h.center.lng),k=al(h.center.lat),z=(s.x+.5)/w-A;let G=0;z>.5?G=-1:z<-.5&&(G=1);let H=(e/bn+s.x)/w+G,K=(r/bn+s.y)/w;H=(H-A)*h._pixelsPerMercatorPixel+A,K=(K-k)*h._pixelsPerMercatorPixel+k;const ie=[H*h.worldSize,K*h.worldSize,0];zi(ie,ie,m),b=Fa(b,ie,y)}return zi(b,b,p)}_makeGlobeTileDebugBorderBuffer(e,r,s,h,p,m){const y=new Bt,b=new ta,w=new qe,A=(z,G,H,K,ie)=>{const ue=(H-z)/(ie-1),be=(K-G)/(ie-1),de=y.length;for(let xe=0;xe<ie;xe++){const Se=z+xe*ue,Me=G+xe*be;y.emplaceBack(Se,Me);const Ke=this._globePoint(Se,Me,r,s,h,p,m);w.emplaceBack(Ke[0],Ke[1],Ke[2]),b.emplaceBack(de+xe)}},k=bn;A(0,0,k,0,16),A(k,0,k,k,16),A(k,k,0,k,16),A(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,Bu.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(w,Lc.members),this._tileDebugSegments=Oi.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,r,s,h,p,m){const b=new Bt,w=new yn,A=new qe,k=25;w.reserve(32),b.reserve(k),A.reserve(k);const z=(G,H)=>k*G+H;for(let G=0;G<k;G++){const H=2048*G;for(let K=0;K<k;K++){const ie=2048*K;b.emplaceBack(ie,H);const ue=this._globePoint(ie,H,r,s,h,p,m);A.emplaceBack(ue[0],ue[1],ue[2])}}for(let G=0;G<4;G++)for(let H=0;H<4;H++){const K=z(G,H),ie=z(G,H+1),ue=z(G+1,H),be=z(G+1,H+1);w.emplaceBack(K,ie,ue),w.emplaceBack(ue,ie,be)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(b,Bu.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(A,Lc.members),this._tileDebugTextSegments=Oi.simpleSegment(0,0,k,32)}}class J_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const h=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},gr(this.stateChanges[e][h],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const p in this.state[e])p!==h&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const p in this.state[e][h])s[p]||(this.deletedStates[e][h][p]=null)}else for(const p in s)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][p]&&delete this.deletedStates[e][h][p]}removeFeatureState(e,r,s){if(null===this.deletedStates[e])return;const h=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==r)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(void 0!==r)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),h=gr({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const p=this.deletedStates[e][r];if(null===p)return{};for(const m in p)delete h[m]}return h}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),gr(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];s[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(null===this.deletedStates[h])for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(null===this.deletedStates[h][m])this.state[h][m]={};else if(this.state[h][m])for(const y of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][y];p[m]=this.state[h][m]}s[h]=s[h]||{},gr(s[h],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in e)e[h].setFeatureState(s,r)}}class bg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function wg(n,e,r,s){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(r[m]<n[m]||r[m]>e[m])return null}else{const y=1/s[m];let b=(n[m]-r[m])*y,w=(e[m]-r[m])*y;if(b>w){const A=b;b=w,w=A}if(b>h&&(h=b),w<p&&(p=w),h>p)return null}return h}function ed(n,e,r,s,h,p,m,y,b,w,A){const k=s-n,z=h-e,G=p-r,H=m-n,K=y-e,ie=b-r,ue=A[1]*ie-A[2]*K,be=A[2]*H-A[0]*ie,de=A[0]*K-A[1]*H,xe=k*ue+z*be+G*de;if(Math.abs(xe)<1e-15)return null;const Se=1/xe,Me=w[0]-n,Ke=w[1]-e,Ze=w[2]-r,st=(Me*ue+Ke*be+Ze*de)*Se;if(st<0||st>1)return null;const Ft=Ke*G-Ze*z,et=Ze*k-Me*G,_t=Me*z-Ke*k,yt=(A[0]*Ft+A[1]*et+A[2]*_t)*Se;return yt<0||st+yt>1?null:(H*Ft+K*et+ie*_t)*Se}function Vc(n,e,r){return(n-e)/(r-e)}function Q_(n,e,r,s,h,p,m,y,b){const w=1<<r,A=p-s,k=m-h,z=(n+1)/w*A+s,G=(e+0)/w*k+h,H=(e+1)/w*k+h;y[0]=(n+0)/w*A+s,y[1]=G,b[0]=z,b[1]=H}class ah{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(p){const m=Math.ceil(Math.log2(p.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const w=1/b,A=(G,H,K,ie,ue)=>{const be=ie?1:0,de=(G+1)*K-be,xe=H*K,Se=(H+1)*K-be;ue[0]=G*K,ue[1]=xe,ue[2]=de,ue[3]=Se};let k=new bg(b);const z=[];for(let G=0;G<b*b;G++){A(G%b,Math.floor(G/b),w,!1,z);const H=Uc(z[0],z[1],p),K=Uc(z[2],z[1],p),ie=Uc(z[2],z[3],p),ue=Uc(z[0],z[3],p);k.minimums.push(Math.min(H,K,ie,ue)),k.maximums.push(Math.max(H,K,ie,ue)),k.leaves.push(1)}for(y.push(k),b/=2;b>=1;b/=2){const G=y[y.length-1];k=new bg(b);for(let H=0;H<b*b;H++){A(H%b,Math.floor(H/b),2,!0,z);const K=G.getElevation(z[0],z[1]),ie=G.getElevation(z[2],z[1]),ue=G.getElevation(z[2],z[3]),be=G.getElevation(z[0],z[3]),de=G.isLeaf(z[0],z[1]),xe=G.isLeaf(z[2],z[1]),Se=G.isLeaf(z[2],z[3]),Me=G.isLeaf(z[0],z[3]),Ke=Math.min(K.min,ie.min,ue.min,be.min),Ze=Math.max(K.max,ie.max,ue.max,be.max),st=de&&xe&&Se&&Me;k.maximums.push(Ze),k.minimums.push(Ke),k.leaves.push(Ze-Ke<=5&&st?1:0)}y.push(k)}return y}(this.dem),s=r.length-1,h=r[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,h,p,m,y=1){return wg([e,r,-100],[s,h,this.maximums[0]*y],p,m)}raycast(e,r,s,h,p,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,s,h,p,m,y);if(null==b)return null;const w=[],A=[],k=[],z=[],G=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:H,t:K,nodex:ie,nodey:ue,depth:be}=G.pop();if(this.leaves[H]){Q_(ie,ue,be,e,r,s,h,k,z);const xe=1<<be,Se=(ie+0)/xe,Me=(ie+1)/xe,Ke=(ue+0)/xe,Ze=(ue+1)/xe,st=Uc(Se,Ke,this.dem)*y,Ft=Uc(Me,Ke,this.dem)*y,et=Uc(Me,Ze,this.dem)*y,_t=Uc(Se,Ze,this.dem)*y,yt=ed(k[0],k[1],st,z[0],k[1],Ft,z[0],z[1],et,p,m),Pt=ed(z[0],z[1],et,k[0],z[1],_t,k[0],k[1],st,p,m),jt=Math.min(null!==yt?yt:Number.MAX_VALUE,null!==Pt?Pt:Number.MAX_VALUE);if(jt!==Number.MAX_VALUE)return jt;{const ot=eu([],p,m,K);if(Eg(st,Ft,_t,et,Vc(ot[0],k[0],z[0]),Vc(ot[1],k[1],z[1]))>=ot[2])return K}continue}let de=0;for(let xe=0;xe<this._siblingOffset.length;xe++){Q_((ie<<1)+this._siblingOffset[xe][0],(ue<<1)+this._siblingOffset[xe][1],be+1,e,r,s,h,k,z),k[2]=-100,z[2]=this.maximums[this.childOffsets[H]+xe]*y;const Se=wg(k,z,p,m);if(null!=Se){const Me=Se;w[xe]=Me;let Ke=!1;for(let Ze=0;Ze<de&&!Ke;Ze++)Me>=w[A[Ze]]&&(A.splice(Ze,0,xe),Ke=!0);Ke||(A[de]=xe),de++}}for(let xe=0;xe<de;xe++){const Se=A[xe];G.push({idx:this.childOffsets[H]+Se,t:w[Se],nodex:(ie<<1)+this._siblingOffset[Se][0],nodey:(ue<<1)+this._siblingOffset[Se][1],depth:be+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,h,p){if(1===e[h].isLeaf(r,s))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,y=e[m];let b=0,w=0;for(let A=0;A<this._siblingOffset.length;A++){const k=2*r+this._siblingOffset[A][0],z=2*s+this._siblingOffset[A][1],G=y.getElevation(k,z),H=y.isLeaf(k,z),K=this._addNode(G.min,G.max,H);H&&(b|=1<<A),w||(w=K)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(e,2*r+this._siblingOffset[A][0],2*s+this._siblingOffset[A][1],m,w+A)}}function Eg(n,e,r,s,h,p){return mr(mr(n,r,p),mr(e,s,p),h)}function Uc(n,e,r){const s=r.dim,h=Be(n*s-.5,0,s-1),p=Be(e*s-.5,0,s-1),m=Math.floor(h),y=Math.floor(p),b=Math.min(m+1,s-1),w=Math.min(y+1,s-1);return Eg(r.get(m,y),r.get(b,y),r.get(m,w),r.get(b,w),h-m,p-y)}const uf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function ey(n,e,r){return(256*n*256+256*e+r)/10-1e4}function kl(n,e,r){return 256*n+e+r/256-32768}class jc{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,h=!1,p=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Cr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let b=0;b<m;b++)y[this._idx(-1,b)]=y[this._idx(0,b)],y[this._idx(m,b)]=y[this._idx(m-1,b)],y[this._idx(b,-1)]=y[this._idx(b,0)],y[this._idx(b,m)]=y[this._idx(b,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ah(this)}get(e,r,s=!1){s&&(e=Be(e,-1,this.dim),r=Be(r,-1,this.dim));const h=4*this._idx(e,r);return("terrarium"===this.encoding?kl:ey)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return uf[e]}get unpackVector(){return uf[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const s=[0,0,0,0],h=jc.getUnpackVector(r);let p=Math.floor((e+h[3])/h[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new qi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,p=r*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:h=p-1;break;case 1:p=h+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const b=-r*this.dim,w=-s*this.dim;for(let A=m;A<y;A++)for(let k=h;k<p;k++){const z=4*this._idx(k,A),G=4*this._idx(k+b,A+w);this.pixels[z+0]=e.pixels[G+0],this.pixels[z+1]=e.pixels[G+1],this.pixels[z+2]=e.pixels[G+2],this.pixels[z+3]=e.pixels[G+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Zt(jc,"DEMData"),Zt(ah,"DemMinMaxQuadTree",{omit:["dem"]});class gs{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const p={value:r,timeout:void 0};if(void 0!==s&&(p.timeout=setTimeout(()=>{this.remove(e,p)},s)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,h=void 0===r?0:this.data[s].indexOf(r),p=this.data[s][h];return this.data[s].splice(h,1),p.timeout&&clearTimeout(p.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(p.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const h of this.data[s])e(h.value)||r.push(h);for(const s of r)this.remove(s.value.tileID,s)}}class Ua{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}Ua.ReadOnly=!1,Ua.ReadWrite=!0,Ua.disabled=new Ua(519,Ua.ReadOnly,[0,1]);class na{constructor(e,r,s,h,p,m){this.test=e,this.ref=r,this.mask=s,this.fail=h,this.depthFail=p,this.pass=m}}na.disabled=new na({func:519,mask:0},0,0,7680,7680,7680);class ja{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}ja.Replace=[1,0],ja.disabled=new ja(ja.Replace,pi.transparent,[!1,!1,!1,!1]),ja.unblended=new ja(ja.Replace,pi.transparent,[!0,!0,!0,!0]),ja.alphaBlended=new ja([1,771],pi.transparent,[!0,!0,!0,!0]);class _s{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}_s.disabled=new _s(!1,1029,2305),_s.backCCW=new _s(!0,1029,2305),_s.backCW=new _s(!0,1029,2304),_s.frontCW=new _s(!0,1028,2304),_s.frontCCW=new _s(!0,1028,2305);class $a extends zs{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new gs(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new J_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if("loaded"!==r.state&&"errored"!==r.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return kn(this._tiles).map(e=>e.tileID).sort(vu).map(e=>e.key)}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort((s,h)=>{const p=s.tileID,m=h.tileID,y=new Ge(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new Ge(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-m.overscaledZ||b.y-y.y||b.x-y.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(vu).map(s=>s.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new zn(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=xi.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Gi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const p=r[h];if(e.neighboringTiles&&e.neighboringTiles[p]){const m=this.getTileByID(p);s(e,m),s(m,e)}}function s(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const y=p.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),w=p.tileID.key;0===m&&0===y||Math.abs(y)>1||(Math.abs(m)>1&&(1===Math.abs(m+b)?m+=b:1===Math.abs(m-b)&&(m-=b)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,y),h.neighboringTiles&&h.neighboringTiles[w]&&(h.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>s)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const w=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[w.key],m&&m.hasData()&&(y=w)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){h[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const h=e.scaledTo(s),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,h=Math.ceil(e.height/r)+1,p=Math.floor(s*h*5),m="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+r),s[p.tileID.key]=p}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(e,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new ns(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(h=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(y=>this._source.hasTile(y)))):h=[];const p=this._updateRetainedTiles(h);if(xu(this._source.type)&&0!==h.length){const y={},b={},w=Object.keys(p);for(const k of w){const z=p[k],G=this._tiles[k];if(!G||G.fadeEndTime&&G.fadeEndTime<=xi.now())continue;const H=this.findLoadedParent(z,Math.max(z.overscaledZ-$a.maxOverzooming,this._source.minzoom));H&&(this._addTile(H.tileID),y[H.tileID.key]=H.tileID),b[k]=z}const A=h[h.length-1].overscaledZ;for(const k in this._tiles){const z=this._tiles[k];if(p[k]||!z.hasData())continue;let G=z.tileID;for(;G.overscaledZ>A;){G=G.scaledTo(G.overscaledZ-1);const H=this._tiles[G.key];if(H&&H.hasData()&&b[G.key]){p[k]=z.tileID;break}}}for(const k in y)p[k]||(this._coveredTiles[k]=!0,p[k]=y[k])}for(const y in p)this._tiles[y].clearFadeHold();const m=function(y,b){const w=[];for(const A in y)A in b||w.push(A);return w}(this._tiles,p);for(const y of m){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(0===e.length)return r;const s={},h=e.reduce((w,A)=>Math.min(w,A.overscaledZ),1/0),p=e[0].overscaledZ,m=Math.max(p-$a.maxOverzooming,this._source.minzoom),y=Math.max(p+$a.maxUnderzooming,this._source.minzoom),b={};for(const w of e){const A=this._addTile(w);r[w.key]=w,A.hasData()||h<this._source.maxzoom&&(b[w.key]=w)}this._retainLoadedChildren(b,h,y,r);for(const w of e){let A=this._tiles[w.key];if(A.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const z=w.children(this._source.maxzoom)[0],G=this.getTile(z);if(G&&G.hasData()){r[z.key]=z;continue}}else{const z=w.children(this._source.maxzoom);if(r[z[0].key]&&r[z[1].key]&&r[z[2].key]&&r[z[3].key])continue}let k=A.wasRequested();for(let z=w.overscaledZ-1;z>=m;--z){const G=w.scaledTo(z);if(s[G.key]||(s[G.key]=!0,A=this.getTile(G),!A&&k&&(A=this._addTile(G)),A&&(r[G.key]=G,k=A.wasRequested(),A.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}r.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(p),s)break;h=p}for(const p of r)this._loadedParentTiles[p]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=Boolean(r);if(!s){const h=this.map?this.map.painter:null;r=new Bp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new Gi("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,s){const h=[],p=this.transform;if(!p)return h;const m="globe"===p.projection.name,y=sl(p.center.lng);for(const b in this._tiles){const w=this._tiles[b];if(s&&w.clearQueryDebugViz(),w.holdingForFade())continue;let A;if(m){const k=w.tileID.canonical;if(0===k.z){const z=[Math.abs(Be(y,...Ol(k,-1))-y),Math.abs(Be(y,...Ol(k,1))-y)];A=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(Be(y,...Ol(k,-1))-y),Math.abs(Be(y,...Ol(k,0))-y),Math.abs(Be(y,...Ol(k,1))-y)];A=[z.indexOf(Math.min(...z))-1]}}else A=[0];for(const k of A){const z=e.containsTile(w,p,r,k);z&&h.push(z)}}return h}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(xu(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=xi.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const h=this._tiles[e];h&&h.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const s=new Map,h=Array.isArray(e)?e:[e],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const y of h){const b=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const w of b)s.set(w.key,w);this.usedForTerrain&&y.updateElevation(!1)}fn(Array.from(s.values()),(y,b)=>{const w=new Bp(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(w,A=>{"raster-dem"===this._source.type&&w.dem&&this._backfillDEM(w),b(A,w)})},r)}}function vu(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function xu(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function Ol(n,e){const r=1<<n.z;return[n.x/r+e,(n.x+1)/r+e]}$a.maxOverzooming=10,$a.maxUnderzooming=3;class pc{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const h=s||e.findDEMTileFor(r);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,y=1<<r.canonical.z-m.canonical.z;return new pc(h,h.tileSize/bn/y,[(r.canonical.x/y-m.canonical.x)*p.dim,(r.canonical.y/y-m.canonical.y)*p.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(s);return new Ge(h,p)}getElevationAt(e,r,s,h){const p=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],y=Math.floor(p),b=Math.floor(m),w=this._dem;return h=!!h,s?mr(mr(w.get(y,b,h),w.get(y,b+1,h),m-b),mr(w.get(y+1,b,h),w.get(y+1,b+1,h),m-b),p-y):w.get(y,b,h)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ba(1,e)*this._dem.stride}}class bu{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new El(bn,16,0),this.featureIndexArray=new Dl,this.promoteId=r}insert(e,r,s,h,p,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,p,m);const b=this.grid;for(let w=0;w<r.length;w++){const A=r[w],k=[1/0,1/0,-1/0,-1/0];for(let z=0;z<A.length;z++){const G=A[z];k[0]=Math.min(k[0],G.x),k[1]=Math.min(k[1],G.y),k[2]=Math.max(k[2],G.x),k[3]=Math.max(k[3],G.y)}k[0]<bn&&k[1]<bn&&k[2]>=0&&k[3]>=0&&b.insert(y,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vd(new eh(this.rawTileData)).layers,this.sourceLayerCoder=new X_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,h){this.loadVTLayers();const p=e.params||{},m=ha(p.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,A=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(H,K,ie,ue)=>Wf(y.bufferedTilespaceGeometry,H,K,ie,ue));A.sort(Cg);let k=null;b.elevation&&A.length>0&&(k=pc.create(b.elevation,this.tileID));const z={};let G;for(let H=0;H<A.length;H++){const K=A[H];if(K===G)continue;G=K;const ie=this.featureIndexArray.get(K);let ue=null;this.loadMatchingFeature(z,ie,m,p.layers,p.availableImages,r,s,h,(be,de,xe,Se=0)=>(ue||(ue=tc(be,this.tileID.canonical,e.tileTransform)),de.queryIntersectsFeature(y,be,xe,ue,this.z,e.transform,e.pixelPosMatrix,k,Se)))}return z}loadMatchingFeature(e,r,s,h,p,m,y,b,w){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:z,layoutVertexArrayOffset:G}=r,H=this.bucketLayerIDs[k];if(h&&!function(be,de){for(let xe=0;xe<be.length;xe++)if(de.indexOf(be[xe])>=0)return!0;return!1}(h,H))return;const K=this.sourceLayerCoder.decode(z),ie=this.vtLayers[K].feature(A);if(s.needGeometry){const be=iu(ie,!0);if(!s.filter(new P(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!s.filter(new P(this.tileID.overscaledZ),ie))return;const ue=this.getId(ie,K);for(let be=0;be<H.length;be++){const de=H[be];if(h&&h.indexOf(de)<0)continue;const xe=m[de];if(!xe)continue;let Se={};void 0!==ue&&b&&(Se=b.getState(xe.sourceLayer||"_geojsonTileLayer",ue));const Me=gr({},y[de]);Me.paint=Np(Me.paint,xe.paint,ie,Se,p),Me.layout=Np(Me.layout,xe.layout,ie,Se,p);const Ke=!w||w(ie,xe,Se,G);if(!Ke)continue;const Ze=new K_(ie,this.z,this.x,this.y,ue);Ze.layer=Me;let st=e[de];void 0===st&&(st=e[de]=[]),st.push({featureIndex:A,feature:Ze,intersectionZ:Ke})}}lookupSymbolFeatures(e,r,s,h,p,m,y,b){const w={};this.loadVTLayers();const A=ha(p);for(const k of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:h,featureIndex:k,layoutVertexArrayOffset:0},A,m,y,b,r);return w}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),p=this.vtFeatures[h];if(p[r])return p[r];const m=this.vtLayers[h].feature(r);return p[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[r];null!=h&&(s=e.properties[h]),"boolean"==typeof s&&(s=Number(s))}return s}}function Np(n,e,r,s,h){return ln(n,(p,m)=>{const y=e instanceof ce?e.get(m):null;return y&&y.evaluate?y.evaluate(r,s,h):y})}function Cg(n,e){return e-n}Zt(bu,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class zp{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Fc({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=xr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const h=[];let p=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,y=!0;h.push({left:p,right:m,isDash:y,zeroLength:0===e[0]});let b=e[0];for(let w=1;w<e.length;w++){y=!y;const A=e[w];p=b*s,b+=A,m=b*s,h.push({left:p,right:m,isDash:y,zeroLength:0===A})}return h}addRoundDash(e,r,s){const h=r/2;for(let p=-s;p<=s;p++){const m=this.width*(this.nextRow+s+p);let y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);const A=Math.abs(w-b.left),k=Math.abs(w-b.right),z=Math.min(A,k);let G;const H=p/s*(h+1);if(b.isDash){const K=h-Math.abs(H);G=Math.sqrt(z*z+K*K)}else G=h-Math.sqrt(z*z+H*H);this.image.data[m+w]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const w=e[b],A=e[b+1];w.zeroLength?e.splice(b,1):A&&A.isDash===w.isDash&&(A.left=w.left,e.splice(b,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const p=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const w=Math.abs(b-y.left),A=Math.abs(b-y.right),k=Math.min(w,A);this.image.data[p+b]=Math.max(0,Math.min(255,(y.isDash?k:-k)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const h="round"===r,p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Cr("LineAtlas out of space"),null;0===e.length&&e.push(1);let y=0;for(let A=0;A<e.length;A++)e[A]<0&&(Cr("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),y+=e[A];if(0!==y){const A=this.width/y,k=this.getDashRanges(e,this.width,A);h?this.addRoundDash(k,A,p):this.addRegularDash(k,"square"===r?.5*A:0)}const b=this.nextRow+p;this.nextRow+=m;const w={tl:[b,p],br:[y,0]};return this.positions[s]=w,w}}Zt(zp,"LineAtlas");class Up{constructor(e){const r={},s=[];for(const y in e){const b=e[y],w=r[y]={};for(const A in b.glyphs){const k=b.glyphs[+A];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const z=k.metrics.localGlyph?2:1,G={x:0,y:0,w:k.bitmap.width+2*z,h:k.bitmap.height+2*z};s.push(G),w[A]=G}}const{w:h,h:p}=xp(s),m=new Fc({width:h||1,height:p||1});for(const y in e){const b=e[y];for(const w in b.glyphs){const A=b.glyphs[+w];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const k=r[y][w],z=A.metrics.localGlyph?2:1;Fc.copy(A.bitmap,m,{x:0,y:0},{x:k.x+z,y:k.y+z},A.bitmap)}}this.image=m,this.positions=r}}Zt(Up,"GlyphAtlas");class Dg{constructor(e){this.tileID=new ns(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=gu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,s,h,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Kr;const m=new X_(Object.keys(e.layers).sort()),y=new bu(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},w=new zp(256,256),A={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:s},k=r.familiesBySource[this.source];for(const Se in k){const Me=e.layers[Se];if(!Me)continue;let Ke=!1,Ze=!1;for(const et of k[Se])"symbol"===et[0].type?Ke=!0:Ze=!0;if(!0===this.isSymbolTile&&!Ke||!1===this.isSymbolTile&&!Ze)continue;1===Me.version&&Cr(`Vector tile source "${this.source}" layer "${Se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=m.encode(Se),Ft=[];for(let et=0;et<Me.length;et++){const _t=Me.feature(et),yt=y.getId(_t,Se);Ft.push({feature:_t,id:yt,index:et,sourceLayerIndex:st})}for(const et of k[Se]){const _t=et[0];void 0!==this.isSymbolTile&&"symbol"===_t.type!==this.isSymbolTile||_t.minzoom&&this.zoom<Math.floor(_t.minzoom)||_t.maxzoom&&this.zoom>=_t.maxzoom||"none"!==_t.visibility&&(hf(et,this.zoom,s),(b[_t.id]=_t.createBucket({index:y.bucketLayerIDs.length,layers:et,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Ft,A,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(et.map(yt=>yt.id)))}}let z,G,H,K;w.trim();const ie={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ue=()=>{if(z)return p(z);if(G&&H&&K){const Se=new Up(G),Me=new ig(H,K);for(const Ke in b){const Ze=b[Ke];Ze instanceof fc?(hf(Ze.layers,this.zoom,s),dg(Ze,G,Se.positions,H,Me.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Ze.hasPattern&&(Ze instanceof up||Ze instanceof qu||Ze instanceof Nh)&&(hf(Ze.layers,this.zoom,s),Ze.addFeatures(A,this.tileID.canonical,Me.patternPositions,s,this.tileTransform))}this.status="done",p(null,{buckets:kn(b).filter(Ke=>!Ke.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Se.image,lineAtlas:w,imageAtlas:Me,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?H:null,glyphPositions:this.returnDependencies?Se.positions:null})}},be=ln(A.glyphDependencies,Se=>Object.keys(Se).map(Number));Object.keys(be).length?h.send("getGlyphs",{uid:this.uid,stacks:be},(Se,Me)=>{z||(z=Se,G=Me,ue())},void 0,!1,ie):G={};const de=Object.keys(A.iconDependencies);de.length?h.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"icons"},(Se,Me)=>{z||(z=Se,H=Me,ue())},void 0,!1,ie):H={};const xe=Object.keys(A.patternDependencies);xe.length?h.send("getImages",{icons:xe,source:this.source,tileID:this.tileID,type:"patterns"},(Se,Me)=>{z||(z=Se,K=Me,ue())},void 0,!1,ie):K={},ue()}}function hf(n,e,r){const s=new P(e);for(const h of n)h.recalculate(s,r)}class jp{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,h){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[m,y]=p.result;return this.scheduler?this.scheduler.add(()=>{h(m,y)},r):h(m,y),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=s((m,y)=>{p.result=[m,y];for(const b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,y)},r):b(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(m=>m!==h),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function $p(n,e,r){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const p=Vr(n.request,(m,y,b,w)=>{m?h(m):y&&h(null,{vectorTile:r?void 0:new Vd(new eh(y)),rawData:y,cacheControl:b,expires:w})});return()=>{p.cancel(),h()}},e)}const Tg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(219!==r)throw new Error("Data does not appear to be in a KDBush format.");const h=s>>4;if(1!==h)throw new Error(`Got v${h} data when expected v1.`);const p=Tg[15&s];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Gp(y,m,p,e)}constructor(e,r=64,s=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=Tg.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return df(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:y}=this,b=[0,p.length-1,0],w=[];for(;b.length;){const A=b.pop()||0,k=b.pop()||0,z=b.pop()||0;if(k-z<=y){for(let ie=z;ie<=k;ie++){const ue=m[2*ie],be=m[2*ie+1];ue>=e&&ue<=s&&be>=r&&be<=h&&w.push(p[ie])}continue}const G=z+k>>1,H=m[2*G],K=m[2*G+1];H>=e&&H<=s&&K>=r&&K<=h&&w.push(p[G]),(0===A?e<=H:r<=K)&&(b.push(z),b.push(G-1),b.push(1-A)),(0===A?s>=H:h>=K)&&(b.push(G+1),b.push(k),b.push(1-A))}return w}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,y=[0,h.length-1,0],b=[],w=s*s;for(;y.length;){const A=y.pop()||0,k=y.pop()||0,z=y.pop()||0;if(k-z<=m){for(let ie=z;ie<=k;ie++)ff(p[2*ie],p[2*ie+1],e,r)<=w&&b.push(h[ie]);continue}const G=z+k>>1,H=p[2*G],K=p[2*G+1];ff(H,K,e,r)<=w&&b.push(h[G]),(0===A?e-s<=H:r-s<=K)&&(y.push(z),y.push(G-1),y.push(1-A)),(0===A?e+s>=H:r+s>=K)&&(y.push(G+1),y.push(k),y.push(1-A))}return b}}function df(n,e,r,s,h,p){if(h-s<=r)return;const m=s+h>>1;Mg(n,e,m,s,h,p),df(n,e,r,s,m-1,1-p),df(n,e,r,m+1,h,1-p)}function Mg(n,e,r,s,h,p){for(;h>s;){if(h-s>600){const w=h-s+1,A=r-s+1,k=Math.log(w),z=.5*Math.exp(2*k/3),G=.5*Math.sqrt(k*z*(w-z)/w)*(A-w/2<0?-1:1);Mg(n,e,r,Math.max(s,Math.floor(r-A*z/w+G)),Math.min(h,Math.floor(r+(w-A)*z/w+G)),p)}const m=e[2*r+p];let y=s,b=h;for(ch(n,e,s,r),e[2*h+p]>m&&ch(n,e,s,h);y<b;){for(ch(n,e,y,b),y++,b--;e[2*y+p]<m;)y++;for(;e[2*b+p]>m;)b--}e[2*s+p]===m?ch(n,e,s,b):(b++,ch(n,e,b,h)),b<=r&&(s=b+1),r<=b&&(h=b-1)}}function ch(n,e,r,s){td(n,r,s),td(e,2*r,2*s),td(e,2*r+1,2*s+1)}function td(n,e,r){const s=n[e];n[e]=n[r],n[r]=s}function ff(n,e,r,s){const h=n-r,p=e-s;return h*h+p*p}u.ARRAY_TYPE=ks,u.AUTH_ERR_MSG=Ee,u.Aabb=ts,u.Actor=class{constructor(n,e,r){this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Zr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=fi()?n:Te,this.scheduler=new W_}send(n,e,r,s,h=!1,p){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=p,this.callbacks[m]=r);const y=vn(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:n,hasCallback:!!r,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:Wl(e,y)},y),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||fi()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(n,e){if("<response>"===e.type){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(nl(e.error)):r(null,nl(e.data)))}else{const r=vn(this.globalScope)?void 0:[],s=e.hasCallback?(p,m)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:p?Wl(p):null,data:Wl(m,r)},r)}:p=>{},h=nl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,s);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],h.source)[p[1]](h,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=zh,u.Color=pi,u.ColorMode=ja,u.CullFaceMode=_s,u.DEMData=jc,u.DataConstantProperty=Y,u.DedupedRequest=jp,u.DepthMode=Ua,u.EXTENT=bn,u.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,h=Math.floor(n.x),p=Math.floor((n.x-h)*s),m=Math.floor(n.y*s),y=this.findDEMTileFor(new ns(r,h,r,p,m));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const h=s.getSource().maxzoom,p=1<<h,m=Math.floor(n.x),y=n.x-m,b=new ns(h,m,h,Math.floor(y*p),Math.floor(n.y*p)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;const A=w.dem,k=1<<w.tileID.canonical.z,z=(y*k-w.tileID.canonical.x)*A.dim,G=(n.y*k-w.tileID.canonical.y)*A.dim,H=Math.floor(z),K=Math.floor(G);return(r?this.exaggeration():1)*mr(mr(A.get(H,K),A.get(H,K+1),G-K),mr(A.get(H+1,K),A.get(H+1,K+1),G-K),z-H)}getAtTileOffset(n,e,r){const s=1<<n.canonical.z;return this.getAtPointOrZero(new ju(n.wrap+(n.canonical.x+e/bn)/s,(n.canonical.y+r/bn)/s))}getAtTileOffsetFunc(n,e,r,s){return h=>{const p=this.getAtTileOffset(n,h.x,h.y),m=s.upVector(n.canonical,h.x,h.y);return Qo(m,m,p*s.upVectorScale(n.canonical,e,r).metersToTile),m}}getForTilePoints(n,e,r,s){if(this.isUsingMockSource())return!1;const h=pc.create(this,n,s);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,h=1<<n.canonical.z-s.canonical.z;let p=n.canonical.x/h-s.canonical.x,m=n.canonical.y/h-s.canonical.y,y=0;for(let b=0;b<n.canonical.z-s.canonical.z&&!r.leaves[y];b++){p*=2,m*=2;const w=2*Math.floor(m)+Math.floor(p);y=r.childOffsets[y]+w,p%=1,m%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=zn,u.EvaluationParameters=P,u.Event=Gi,u.Evented=zs,u.FillExtrusionBucket=Nh,u.Frustum=Nf,u.FrustumCorners=Bf,u.GLOBE_RADIUS=Sl,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GLOBE_ZOOM_THRESHOLD_MIN=5,u.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const r=new Bt,s=new yn,h=[],p=n+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),b=(w,A,k)=>{let z=w===p-1?w-2:0===w?w:w-1;return z+=k?24575:0,[z,A]};for(let w=0;w<p;++w)r.emplaceBack(...b(w,0,!0));for(let w=0;w<m;++w)for(let A=0;A<p;++A)r.emplaceBack(...b(A,w,(0===A||A===p-1)&&!0));for(let w=0;w<e.length;++w){const A=e[w];for(let k=0;k<p;++k)r.emplaceBack(...b(k,A,!0))}for(let w=0;w<e.length;++w){const A=s.length,k=e[w]+1+2,z=new yn;for(let K=0;K<k-1;K++){const ie=K===k-2,ue=ie?p*(y-e.length+w-K):p;for(let be=0;be<p-1;be++){const de=K*p+be;0===K||ie||0===be||be===p-2?(z.emplaceBack(de+1,de,de+ue),z.emplaceBack(de+ue,de+ue+1,de+1)):(s.emplaceBack(de+1,de,de+ue),s.emplaceBack(de+ue,de+ue+1,de+1))}}const G=Oi.simpleSegment(0,A,r.length,s.length-A);for(let K=0;K<z.uint16.length;K+=3)s.emplaceBack(z.uint16[K],z.uint16[K+1],z.uint16[K+2]);const H=Oi.simpleSegment(0,A,r.length,s.length-A);h.push({withoutSkirts:G,withSkirts:H})}return{vertices:r,indices:s,segments:h}}_createGrid(n){const e=this._fillGridMeshWithLods(64,nu);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Bu.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new yn;for(let h=0;h<=64;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new ni,s=new ni;this._poleSegments=[];for(let h=0,p=0;h<5;h++){const m=360/(1<<h);r.emplaceBack(0,-Sl,0,.5,0),s.emplaceBack(0,-Sl,0,.5,1);for(let y=0;y<=64;y++){const b=y/64,w=mr(0,m,b),[A,k,z]=zu(Ky,Jy,w,Sl);r.emplaceBack(A,k,z,b,0),s.emplaceBack(A,k,z,b,1)}this._poleSegments.push(Oi.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,Ch,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,Ch,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const r=new Eo,s=64,h=s+1+2,p=1;this._wireframeSegments=[];for(let m=0,y=0;m<nu.length;m++){const b=nu[m];for(let A=p;A<b+p;A++)for(let k=p;k<s+p;k++){const z=A*h+k;r.emplaceBack(z,z+1),r.emplaceBack(z,z+h),r.emplaceBack(z,z+h+1)}const w=b*s*3;this._wireframeSegments.push(Oi.simpleSegment(0,y,(b+1)*h,w)),y+=w}this._wireframeIndexBuffer=n.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},u.GlyphManager=cc,u.ImagePosition=rg,u.KDBush=Gp,u.LivePerformanceUtils=Ln,u.LngLat=Gr,u.LngLatBounds=Jc,u.LocalGlyphMode=Sp,u.MAX_MERCATOR_LATITUDE=to,u.MercatorCoordinate=ju,u.ONE_EM=24,u.OverscaledTileID=ns,u.PerformanceMarkers=En,u.Point=Ge,u.Properties=me,u.RGBAImage=qi,u.Ray=Dh,u.RequestManager=class{constructor(n,e,r){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",nn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!Ce(n))return n;const r=Ut(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!Ce(n))return n;const r=Ut(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(n,e,r,s){if(!Ce(n))return n;const h=Ut(n);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),r&&h.params.push(`language=${r}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(n,e,r,s){const h=Ut(n);return Ce(n)?(h.path=`/styles/v1${h.path}/sprite${e}${r}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${r}`,St(h))}normalizeTileURL(n,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Ce(n))return n;const s=Ut(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&"raster"!==s.authority&&512===r?"@2x":""}${gt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Tt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Tt.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(p){for(const m of p){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||Tt.ACCESS_TOKEN;return Tt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(n,e){const r=Ut(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${Tt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${Tt.TILE_URL_VERSION}/`,"")}`;let h=r.params;return e&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(n,e){const r=!!e&&Ce(e),s=[];for(const h of n.tiles||[])Fe(h)?s.push(this.canonicalizeTileURL(h,r)):s.push(h);return s}_makeAPIURL(n,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Ut(Tt.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,"http"===n.protocol){const h=n.params.indexOf("secure");h>=0&&n.params.splice(h,1)}if("/"!==s.path&&(n.path=`${s.path}${n.path}`),!Tt.REQUIRE_ACCESS_TOKEN)return St(n);if(e=e||Tt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(h=>-1===h.indexOf("access_token")),n.params.push(`access_token=${e||""}`),St(n)}},u.ResourceType=mn,u.SegmentVector=Oi,u.SourceCache=$a,u.StencilMode=na,u.StructArrayLayout1ui2=ta,u.StructArrayLayout2f1f2i16=Sn,u.StructArrayLayout2i4=Bt,u.StructArrayLayout2ui4=Eo,u.StructArrayLayout3f12=er,u.StructArrayLayout3ui6=yn,u.StructArrayLayout4i8=mt,u.StructArrayLayout5f20=ni,u.Texture=Jh,u.Tile=Bp,u.Transitionable=q,u.Uniform1f=dd,u.Uniform1i=class extends Kl{constructor(n){super(n),this.current=0}set(n,e,r){this.fetchUniformLocation(n,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},u.Uniform2f=class extends Kl{constructor(n){super(n),this.current=[0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},u.Uniform3f=class extends Kl{constructor(n){super(n),this.current=[0,0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},u.Uniform4f=Jl,u.UniformColor=ku,u.UniformMatrix2f=class extends Kl{constructor(n){super(n),this.current=Zy}set(n,e,r){if(this.fetchUniformLocation(n,e))for(let s=0;s<4;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}},u.UniformMatrix3f=class extends Kl{constructor(n){super(n),this.current=Hy}set(n,e,r){if(this.fetchUniformLocation(n,e))for(let s=0;s<9;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},u.UniformMatrix4f=class extends Kl{constructor(n){super(n),this.current=Hg}set(n,e,r){if(this.fetchUniformLocation(n,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let s=1;s<16;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},u.UnwrappedTileID=Zm,u.ValidationError=en,u.VectorTileFeature=Ud,u.VectorTileWorkerSource=class extends zs{constructor(n,e,r,s,h){super(),this.actor=n,this.layerIndex=e,this.availableImages=r,this.loadVectorData=h||$p,this.loading={},this.loaded={},this.deduped=new jp(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const r=n.uid,s=n&&n.request,h=s&&s.collectResourceTiming,p=this.loading[r]=new Dg(n);p.abort=this.loadVectorData(n,(m,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||m||!y)return p.status="done",b||(this.loaded[r]=p),e(m);const w=y.rawData,A={};y.expires&&(A.expires=y.expires),y.cacheControl&&(A.cacheControl=y.cacheControl),p.vectorTile=y.vectorTile||new Vd(new eh(w));const k=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,G)=>{if(z||!G)return e(z);const H={};if(h){const K=On(s);K.length>0&&(H.resourceTiming=JSON.parse(JSON.stringify(K)))}e(null,gr({rawTileData:w.slice(0)},G,A,H))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[r]=p})}reloadTile(n,e){const r=this.loaded,s=n.uid,h=this;if(r&&r[s]){const p=r[s];p.showCollisionBoxes=n.showCollisionBoxes,p.enableTerrain=!!n.enableTerrain,p.projection=n.projection,p.tileTransform=gu(n.tileID.canonical,n.projection);const m=(y,b)=>{const w=p.reloadCallback;w&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,w)),e(y,b)};"parsing"===p.status?p.reloadCallback=m:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(n,e){const r=n.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(n,e){const r=this.loaded,s=n.uid;r&&r[s]&&delete r[s],e()}},u.WritingMode=za,u.ZoomDependentExpression=Ks,u.add=ec,u.addDynamicAttributes=sh,u.adjoint=function(n,e){var r=e[0],s=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],w=e[7],A=e[8];return n[0]=m*A-y*w,n[1]=h*w-s*A,n[2]=s*y-h*m,n[3]=y*b-p*A,n[4]=r*A-h*b,n[5]=h*p-r*y,n[6]=p*w-m*b,n[7]=s*b-r*w,n[8]=r*m-s*p,n},u.asyncAll=fn,u.bezier=He,u.bindAll=Zr,u.boundsAttributes=vg,u.bufferConvexPolygon=function(n,e){const r=[];for(let s=0;s<n.length;s++){const h=ht(s-1,-1,n.length-1),p=ht(s+1,-1,n.length-1),m=n[s],y=n[p],b=n[h].sub(m).unit(),w=y.sub(m).unit(),A=w.angleWithSep(b.x,b.y),k=b.add(w).unit().mult(-1*e/Math.sin(A/2));r.push(m.add(k))}return r},u.cacheEntryPossiblyAdded=function(n){pt++,pt>vs&&(n.getActor().send("enforceCacheSizeLimit",fo),pt=0)},u.calculateGlobeLabelMatrix=function(n,e){const{x:r,y:s}=n.point,h=wd(r,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Ac(h,h,Vf(Al(e)))},u.calculateGlobeMatrix=function(n){const{x:e,y:r}=n.point,{lng:s,lat:h}=n._center;return wd(e,r,n.worldSize,s,h)},u.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,r=e/Ba(1,n.center.lat),s=ol(new Float64Array(16));return Ic(s,s,[n.point.x,n.point.y,0]),Qc(s,s,[r,r,e]),Float32Array.from(s)},u.circumferenceAtLatitude=Ph,u.clamp=Be,u.clearTileCache=function(n){if(!ve())return;const e=Te.caches.delete(si);n&&e.catch(n).then(()=>n())},u.clipLine=Tp,u.clone=function(n){var e=new ks(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},u.clone$1=Si,u.collisionCircleLayout=Ym,u.config=Tt,u.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},u.create=function(){var n=new ks(16);return ks!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},u.create$1=lm,u.createExpression=Ss,u.createLayout=Ne,u.createStyleLayer=function(n){return"custom"===n.type?new Z_(n):new q_[n.type](n)},u.cross=_d,u.degToRad=tt,u.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},u.div=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},u.dot=ma,u.earthRadius=Ed,u.ease=lt,u.easeCubicInOut=Xe,u.ecefToLatLng=function([n,e,r]){const s=Math.hypot(n,e,r),h=Math.atan2(n,r),p=.5*Math.PI-Math.acos(-e/s);return new Gr(ft(h),ft(p))},u.emitValidationErrors=mh,u.endsWith=Ar,u.enforceCacheSizeLimit=function(n){we(),kr&&kr.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-n;s++)e.delete(r[s])})})},u.evaluateSizeForFeature=Hd,u.evaluateSizeForZoom=Ju,u.evaluateVariableOffset=hg,u.evented=g,u.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},u.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},u.exported=xi,u.exported$1=gt,u.extend=gr,u.extend$1=io,u.fillExtrusionHeightLift=ip,u.filterObject=Zn,u.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},u.fromQuat=function(n,e){var r=e[0],s=e[1],h=e[2],p=e[3],m=r+r,y=s+s,b=h+h,w=r*m,A=s*m,k=s*y,z=h*m,G=h*y,H=h*b,K=p*m,ie=p*y,ue=p*b;return n[0]=1-k-H,n[1]=A+ue,n[2]=z-ie,n[3]=0,n[4]=A-ue,n[5]=1-w-H,n[6]=G+K,n[7]=0,n[8]=z+ie,n[9]=G-K,n[10]=1-w-k,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},u.fromRotation=function(n,e){var r=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},u.fromScaling=uo,u.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return rn[e]},u.getAABBPointSquareDist=function(n,e,r){let s=0;for(let h=0;h<2;++h){const p=r?r[h]:0;n[h]>p&&(s+=(n[h]-p)*(n[h]-p)),e[h]<p&&(s+=(p-e[h])*(p-e[h]))}return s},u.getAnchorAlignment=og,u.getAnchorJustification=Kd,u.getBounds=function(n){let e=1/0,r=1/0,s=-1/0,h=-1/0;for(const p of n)e=Math.min(e,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),h=Math.max(h,p.y);return{min:new Ge(e,r),max:new Ge(s,h)}},u.getColumn=zr,u.getDefaultExportFromCjs=It,u.getGridMatrix=function(n,e,r,s){const h=e.getNorth(),p=e.getSouth(),m=e.getWest(),y=e.getEast(),b=1<<n.z,w=y-m,A=h-p,k=w/64,z=-A/nu[r],G=[0,k,0,z,0,0,h,m,0];if(n.z>0){const H=180/s;cm(G,G,[H/w+1,0,0,0,H/A+1,0,-.5*H/k,.5*H/z,1])}return G[2]=b,G[5]=n.x,G[8]=n.y,G},u.getImage=he,u.getJSON=function(n,e){return gn(gr(n,{type:"json"}),e)},u.getLatitudinalLod=function(n){const e=to-5;n=Be(n,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(tt(n))),3);return Math.round(r*(nu.length-1))},u.getMapSessionAPI=Ue,u.getPerformanceMeasurement=On,u.getProjection=_g,u.getRTLTextPluginStatus=v,u.getReferrer=cr,u.getTilePoint=function(n,{x:e,y:r},s=0){return new Ge(((e-s)*n.scale-n.x)*bn,(r*n.scale-n.y)*bn)},u.getTileVec3=function(n,e,r=0){return Ou(((e.x-r)*n.scale-n.x)*bn,(e.y*n.scale-n.y)*bn,Cd(e.z,e.y))},u.getVideo=function(n,e){const r=Te.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<n.length;s++){const h=Te.document.createElement("source");Tr(n[s])||(r.crossOrigin="Anonymous"),h.src=n[s],r.appendChild(h)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(n){const e=[0,0,0],r=ol(new Float64Array(16));return Ac(r,n.pixelMatrix,n.globeMatrix),zi(e,e,r),new Ge(e[0],e[1])},u.globeDenormalizeECEF=Vf,u.globeECEFOrigin=function(n,e){const r=[0,0,0];return zi(r,r,Sh(Al(e.canonical))),zi(r,r,n),r},u.globeMetersToEcef=Th,u.globeNormalizeECEF=Sh,u.globePixelsToTileUnits=function(n,e){return bn/(512*Math.pow(2,n))*xd(Al(e))},u.globePoleMatrixForTile=function(n,e,r){const s=ol(new Float64Array(16)),h=(e/(1<<n)-.5)*Math.PI*2;return pd(s,r.globeMatrix,h),Float32Array.from(s)},u.globeTileBounds=Al,u.globeTiltAtLngLat=Qg,u.globeToMercatorTransition=Ah,u.globeUseCustomAntiAliasing=function(n,e,r){const s=Ah(r.zoom),h=n.style.map._antialias,p=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===s&&!h&&!m&&p},u.identity=ol,u.identity$1=dm,u.invert=Pf,u.isFullscreen=function(){return!!Te.document.fullscreenElement||!!Te.document.webkitFullscreenElement},u.isLngLatBehindGlobe=Ih,u.isMapAuthenticated=function(n){return at.has(n)},u.isMapboxURL=Ce,u.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!vn(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=qo,u.latLngToECEF=Vu,u.len=qg,u.length=wh,u.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},u.lngFromMercatorX=Os,u.loadVectorTile=$p,u.makeRequest=gn,u.mapValue=function(n,e,r,s,h){return Be((n-e)/(r-e)*(h-s)+s,s,h)},u.mercatorScale=mm,u.mercatorXfromLng=sl,u.mercatorYfromLat=al,u.mercatorZfromAltitude=Ba,u.mul=Zg,u.mul$1=Xy,u.multiply=Ac,u.multiply$1=cm,u.multiply$2=hm,u.nextPowerOfTwo=xr,u.normalize=es,u.normalize$1=Wg,u.normalize$2=Of,u.number=mr,u.ortho=function(n,e,r,s,h,p,m){var y=1/(e-r),b=1/(s-h),w=1/(p-m);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*w,n[11]=0,n[12]=(e+r)*y,n[13]=(h+s)*b,n[14]=(m+p)*w,n[15]=1,n},u.pbf=T_,u.perspective=function(n,e,r,s,h){var p,m=1/Math.tan(e/2);return n[0]=m/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=h&&h!==1/0?(n[10]=(h+s)*(p=1/(s-h)),n[14]=2*h*s*p):(n[10]=-1,n[14]=-2*s),n},u.pick=function(n,e){const r={};for(let s=0;s<e.length;s++){const h=e[s];h in n&&(r[h]=n[h])}return r},u.plugin=C,u.pointGeometry=sn,u.polesInViewport=function(n){const e=ol(new Float64Array(16));Ac(e,n.pixelMatrix,n.globeMatrix);const r=[0,Oa,0],s=[0,_a,0];return zi(r,r,e),zi(s,s,e),[r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!Ih(n,new Gr(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!Ih(n,new Gr(n.center.lat,-90))]},u.polygonContainsPoint=su,u.polygonIntersectsBox=Wf,u.polygonIntersectsPolygon=_m,u.polygonizeBounds=function(n,e,r=0,s=!0){const h=new Ge(r,r),p=n.sub(h),m=e.add(h),y=[p,new Ge(m.x,p.y),m,new Ge(p.x,m.y)];return s&&y.push(p.clone()),y},u.posAttributes=Bu,u.postMapLoadEvent=Ur,u.postPerformanceEvent=ke,u.postTurnstileEvent=Bn,u.potpack=xp,u.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},u.radToDeg=ft,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(n){return n({pluginStatus:c,pluginURL:t}),g.on("pluginStateChange",n),n},u.removeAuthState=function(n){at.delete(n)},u.renderColorRamp=kh,u.resample=jf,u.rotateX=xh,u.rotateX$1=vd,u.rotateY=pd,u.rotateY$1=Eh,u.rotateZ=function(n,e,r){var s=Math.sin(r),h=Math.cos(r),p=e[0],m=e[1],y=e[2],b=e[3],w=e[4],A=e[5],k=e[6],z=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=p*h+w*s,n[1]=m*h+A*s,n[2]=y*h+k*s,n[3]=b*h+z*s,n[4]=w*h-p*s,n[5]=A*h-m*s,n[6]=k*h-y*s,n[7]=z*h-b*s,n},u.rotateZ$1=function(n,e,r){r*=.5;var s=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return n[0]=s*b+h*y,n[1]=h*b-s*y,n[2]=p*b+m*y,n[3]=m*b-p*y,n},u.scale=Qc,u.scale$1=yd,u.scale$2=Qo,u.scaleAndAdd=eu,u.set=function(n,e,r,s){return n[0]=e,n[1]=r,n[2]=s,n},u.setCacheLimits=function(n,e){fo=n,vs=e},u.setColumn=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},u.setRTLTextPlugin=function(n,e,r=!1){if(c===M||c===S||c===D)throw new Error("setRTLTextPlugin cannot be called multiple times.");t=xi.resolveURL(n),c=M,O=e,d(),r||E()},u.smoothstep=Wt,u.spec=rt,u.squaredLength=function(n){var e=n[0],r=n[1],s=n[2];return e*e+r*r+s*s},u.storeAuthState=function(n,e){e?at.add(n):at.delete(n)},u.sub=ga,u.subtract=Lf,u.symbolSize=Km,u.tileAABB=function(n,e,r,s,h,p,m,y,b){if("globe"===b.name)return function Yy(n,e,r){const s=e/n.worldSize,h=n.globeMatrix;if(r.z<=1){const Ze=Al(r).getCorners();return pm(Ze,h,s),ts.fromPoints(Ze)}const p=Mh(r),m=zf(p);pm(m,h,s);const y=Number.MAX_VALUE,b=[-y,-y,-y],w=[y,y,y];if(p.contains(n.center)){for(const Ft of m)md(w,w,Ft),gd(b,b,Ft);b[2]=0;const Ze=n.point,st=[Ze.x*s,Ze.y*s,0];return md(w,w,st),gd(b,b,st),new ts(w,b)}const A=[h[12]*s,h[13]*s,h[14]*s],k=p.getCenter(),z=Be(n.center.lat,-to,to),G=Be(k.lat,-to,to),H=sl(n.center.lng),K=al(z);let ie=H-sl(k.lng);const ue=K-al(G);ie>.5?ie-=1:ie<-.5&&(ie+=1);let be=0;Math.abs(ie)>Math.abs(ue)?be=ie>=0?1:3:(be=ue>=0?0:2,eu(A,A,[h[4]*s,h[5]*s,h[6]*s],-Math.sin(tt(ue>=0?p.getSouth():p.getNorth()))*Sl));const de=m[be],xe=m[(be+1)%4],Se=new Jg(de,xe,A),Me=[ru(Se,0)||de[0],ru(Se,1)||de[1],ru(Se,2)||de[2]],Ke=Ah(n.zoom);if(Ke>0){const Ze=function({x:Ft,y:et,z:_t},yt,Pt,jt,ot){const Kt=1/(1<<_t);let dn=Ft*Kt,Qt=dn+Kt,Xn=et*Kt,Dt=Xn+Kt,xn=0;const Yn=(dn+Qt)/2-jt;return Yn>.5?xn=-1:Yn<-.5&&(xn=1),dn=((dn+xn)*yt-(jt*=yt))*Pt+jt,Qt=((Qt+xn)*yt-jt)*Pt+jt,Xn=(Xn*yt-(ot*=yt))*Pt+ot,Dt=(Dt*yt-ot)*Pt+ot,[[dn,Dt,0],[Qt,Dt,0],[Qt,Xn,0],[dn,Xn,0]]}(r,e,n._pixelsPerMercatorPixel,H,K);for(let Ft=0;Ft<m.length;Ft++)Fa(m[Ft],Ze[Ft],Ke);const st=ec([],Ze[be],Ze[(be+1)%4]);Qo(st,st,.5),Fa(Me,st,Ke)}for(const Ze of m)md(w,w,Ze),gd(b,b,Ze);return w[2]=Math.min(de[2],xe[2]),md(w,w,Me),gd(b,b,Me),new ts(w,b)}(n,e,new zh(r,s,h));const w=gu({z:r,x:s,y:h},b);return new ts([(p+w.x/w.scale)*e,e*(w.y/w.scale),m],[(p+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},u.tileCornersToBounds=Mh,u.tileTransform=gu,u.transformMat3=function(n,e,r){var s=e[0],h=e[1],p=e[2];return n[0]=s*r[0]+h*r[3]+p*r[6],n[1]=s*r[1]+h*r[4]+p*r[7],n[2]=s*r[2]+h*r[5]+p*r[8],n},u.transformMat4=zi,u.transformMat4$1=Pc,u.transformQuat=kf,u.transitionTileAABBinECEF=Nu,u.translate=Ic,u.transpose=function(n,e){if(n===e){var r=e[1],s=e[2],h=e[5];n[1]=e[3],n[2]=e[6],n[3]=r,n[5]=e[7],n[6]=s,n[7]=h}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},u.triggerPluginCompletionEvent=a,u.uniqueId=vr,u.updateGlobeVertexNormal=function(n,e,r,s,h){const p=5*e+2;n.float32[p+0]=r,n.float32[p+1]=s,n.float32[p+2]=h},u.validateCustomStyleLayer=function(n){const e=[],r=n.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFilter=n=>Jo(Is(n)),u.validateFog=n=>Jo(wl(n)),u.validateLayer=n=>Jo(Ec(n)),u.validateLight=n=>Jo(Cc(n)),u.validateSource=n=>Jo(tl(n)),u.validateStyle=ad,u.validateTerrain=n=>Jo(La(n)),u.values=kn,u.vectorTile=Wu,u.version=Yt,u.warnOnce=Cr,u.window=Te,u.wrap=ht}),I(0,function(u){function Te(_e){if("number"==typeof _e||"boolean"==typeof _e||"string"==typeof _e||null==_e)return JSON.stringify(_e);if(Array.isArray(_e)){let ee="[";for(const he of _e)ee+=`${Te(he)},`;return`${ee}]`}let X="{";for(const ee of Object.keys(_e).sort())X+=`${ee}:${Te(_e[ee])},`;return`${X}}`}function Yt(_e){let X="";for(const ee of u.refProperties)X+=`/${Te(_e[ee])}`;return X}class Vt{constructor(X){this.keyCache={},X&&this.replace(X)}replace(X){this._layerConfigs={},this._layers={},this.update(X,[])}update(X,ee){for(const Ee of X)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=u.createStyleLayer(Ee)).compileFilter(),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of ee)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const he=function(Ee,Ce){const Fe={};for(let Ie=0;Ie<Ee.length;Ie++){const $e=Ce&&Ce[Ee[Ie].id]||Yt(Ee[Ie]);Ce&&(Ce[Ee[Ie].id]=$e);let xt=Fe[$e];xt||(xt=Fe[$e]=[]),xt.push(Ee[Ie])}const Le=[];for(const Ie in Fe)Le.push(Fe[Ie]);return Le}(u.values(this._layerConfigs),this.keyCache);for(const Ee of he){const Ce=Ee.map(Ut=>this._layers[Ut.id]),Fe=Ce[0];if("none"===Fe.visibility)continue;const Le=Fe.source||"";let Ie=this.familiesBySource[Le];Ie||(Ie=this.familiesBySource[Le]={});const $e=Fe.sourceLayer||"_geojsonTileLayer";let xt=Ie[$e];xt||(xt=Ie[$e]=[]),xt.push(Ce)}}}class Tt{loadTile(X,ee){const{uid:he,encoding:Ee,rawImageData:Ce,padding:Fe,buildQuadTree:Le}=X,Ie=u.window.ImageBitmap&&Ce instanceof u.window.ImageBitmap?this.getImageData(Ce,Fe):Ce;ee(null,new u.DEMData(he,Ie,Ee,Fe<1,Le))}getImageData(X,ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);const he=this.offscreenCanvasContext.getImageData(-ee,-ee,X.width+2*ee,X.height+2*ee);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}function gt(_e,X){if(0!==_e.length){vt(_e[0],X);for(var ee=1;ee<_e.length;ee++)vt(_e[ee],!X)}}function vt(_e,X){for(var ee=0,he=0,Ee=0,Ce=_e.length,Fe=Ce-1;Ee<Ce;Fe=Ee++){var Le=(_e[Ee][0]-_e[Fe][0])*(_e[Fe][1]+_e[Ee][1]),Ie=ee+Le;he+=Math.abs(ee)>=Math.abs(Le)?ee-Ie+Le:Le-Ie+ee,ee=Ie}ee+he>=0!=!!X&&_e.reverse()}var dt=u.getDefaultExportFromCjs(function _e(X,ee){var he,Ee=X&&X.type;if("FeatureCollection"===Ee)for(he=0;he<X.features.length;he++)_e(X.features[he],ee);else if("GeometryCollection"===Ee)for(he=0;he<X.geometries.length;he++)_e(X.geometries[he],ee);else if("Feature"===Ee)_e(X.geometry,ee);else if("Polygon"===Ee)gt(X.coordinates,ee);else if("MultiPolygon"===Ee)for(he=0;he<X.coordinates.length;he++)gt(X.coordinates[he],ee);return X});const Ht=u.VectorTileFeature.prototype.toGeoJSON;var Cn={exports:{}},bt=u.pointGeometry,nn=u.vectorTile.VectorTileFeature,It=pn;function pn(_e,X){this.options=X||{},this.features=_e,this.length=_e.length}function on(_e,X){this.id="number"==typeof _e.id?_e.id:void 0,this.type=_e.type,this.rawGeometry=1===_e.type?[_e.geometry]:_e.geometry,this.properties=_e.tags,this.extent=X||4096}pn.prototype.feature=function(_e){return new on(this.features[_e],this.options.extent)},on.prototype.loadGeometry=function(){var _e=this.rawGeometry;this.geometry=[];for(var X=0;X<_e.length;X++){for(var ee=_e[X],he=[],Ee=0;Ee<ee.length;Ee++)he.push(new bt(ee[Ee][0],ee[Ee][1]));this.geometry.push(he)}return this.geometry},on.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _e=this.geometry,X=1/0,ee=-1/0,he=1/0,Ee=-1/0,Ce=0;Ce<_e.length;Ce++)for(var Fe=_e[Ce],Le=0;Le<Fe.length;Le++){var Ie=Fe[Le];X=Math.min(X,Ie.x),ee=Math.max(ee,Ie.x),he=Math.min(he,Ie.y),Ee=Math.max(Ee,Ie.y)}return[X,he,ee,Ee]},on.prototype.toGeoJSON=nn.prototype.toGeoJSON;var or=u.pbf,sn=It;function tn(_e){var X=new or;return function(ee,he){for(var Ee in ee.layers)he.writeMessage(3,Ge,ee.layers[Ee])}(_e,X),X.finish()}function Ge(_e,X){var ee;X.writeVarintField(15,_e.version||1),X.writeStringField(1,_e.name||""),X.writeVarintField(5,_e.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(ee=0;ee<_e.length;ee++)he.feature=_e.feature(ee),X.writeMessage(2,kt,he);var Ee=he.keys;for(ee=0;ee<Ee.length;ee++)X.writeStringField(3,Ee[ee]);var Ce=he.values;for(ee=0;ee<Ce.length;ee++)X.writeMessage(4,Xe,Ce[ee])}function kt(_e,X){var ee=_e.feature;void 0!==ee.id&&X.writeVarintField(1,ee.id),X.writeMessage(2,lr,_e),X.writeVarintField(3,ee.type),X.writeMessage(4,rn,ee)}function lr(_e,X){var ee=_e.feature,he=_e.keys,Ee=_e.values,Ce=_e.keycache,Fe=_e.valuecache;for(var Le in ee.properties){var Ie=ee.properties[Le],$e=Ce[Le];if(null!==Ie){void 0===$e&&(he.push(Le),Ce[Le]=$e=he.length-1),X.writeVarint($e);var xt=typeof Ie;"string"!==xt&&"boolean"!==xt&&"number"!==xt&&(Ie=JSON.stringify(Ie));var Ut=xt+":"+Ie,St=Fe[Ut];void 0===St&&(Ee.push(Ie),Fe[Ut]=St=Ee.length-1),X.writeVarint(St)}}}function tt(_e,X){return(X<<3)+(7&_e)}function ft(_e){return _e<<1^_e>>31}function rn(_e,X){for(var ee=_e.loadGeometry(),he=_e.type,Ee=0,Ce=0,Fe=ee.length,Le=0;Le<Fe;Le++){var Ie=ee[Le],$e=1;1===he&&($e=Ie.length),X.writeVarint(tt(1,$e));for(var xt=3===he?Ie.length-1:Ie.length,Ut=0;Ut<xt;Ut++){1===Ut&&1!==he&&X.writeVarint(tt(2,xt-1));var St=Ie[Ut].x-Ee,Tn=Ie[Ut].y-Ce;X.writeVarint(ft(St)),X.writeVarint(ft(Tn)),Ee+=St,Ce+=Tn}3===he&&X.writeVarint(tt(7,1))}}function Xe(_e,X){var ee=typeof _e;"string"===ee?X.writeStringField(1,_e):"boolean"===ee?X.writeBooleanField(7,_e):"number"===ee&&(_e%1!=0?X.writeDoubleField(3,_e):_e<0?X.writeSVarintField(6,_e):X.writeVarintField(5,_e))}Cn.exports=tn,Cn.exports.fromVectorTileJs=tn,Cn.exports.fromGeojsonVt=function(_e,X){X=X||{};var ee={};for(var he in _e)ee[he]=new sn(_e[he].features,X),ee[he].name=he,ee[he].version=X.version,ee[he].extent=X.extent;return tn({layers:ee})},Cn.exports.GeoJSONWrapper=sn;var He=u.getDefaultExportFromCjs(Cn.exports);const lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:_e=>_e},Be=Math.fround||(Wt=new Float32Array(1),_e=>(Wt[0]=+_e,Wt[0]));var Wt;class gr{constructor(X){this.options=Object.assign(Object.create(lt),X),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(X){const{log:ee,minZoom:he,maxZoom:Ee}=this.options;ee&&console.time("total time");const Ce=`prepare ${X.length} points`;ee&&console.time(Ce),this.points=X;const Fe=[];for(let Ie=0;Ie<X.length;Ie++){const $e=X[Ie];if(!$e.geometry)continue;const[xt,Ut]=$e.geometry.coordinates,St=Be(li(xt)),Tn=Be(xr(Ut));Fe.push(St,Tn,1/0,Ie,-1,1),this.options.reduce&&Fe.push(0)}let Le=this.trees[Ee+1]=this._createTree(Fe);ee&&console.timeEnd(Ce);for(let Ie=Ee;Ie>=he;Ie--){const $e=+Date.now();Le=this.trees[Ie]=this._createTree(this._cluster(Le,Ie)),ee&&console.log("z%d: %d clusters in %dms",Ie,Le.numItems,+Date.now()-$e)}return ee&&console.timeEnd("total time"),this}getClusters(X,ee){let he=((X[0]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,X[1]));let Ce=180===X[2]?180:((X[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)he=-180,Ce=180;else if(he>Ce){const Ut=this.getClusters([he,Ee,180,Fe],ee),St=this.getClusters([-180,Ee,Ce,Fe],ee);return Ut.concat(St)}const Le=this.trees[this._limitZoom(ee)],Ie=Le.range(li(he),xr(Fe),li(Ce),xr(Ee)),$e=Le.data,xt=[];for(const Ut of Ie){const St=this.stride*Ut;xt.push($e[St+5]>1?Dn($e,St,this.clusterProps):this.points[$e[St+3]])}return xt}getChildren(X){const ee=this._getOriginId(X),he=this._getOriginZoom(X),Ee="No cluster with the specified id.",Ce=this.trees[he];if(!Ce)throw new Error(Ee);const Fe=Ce.data;if(ee*this.stride>=Fe.length)throw new Error(Ee);const Le=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Ie=Ce.within(Fe[ee*this.stride],Fe[ee*this.stride+1],Le),$e=[];for(const xt of Ie){const Ut=xt*this.stride;Fe[Ut+4]===X&&$e.push(Fe[Ut+5]>1?Dn(Fe,Ut,this.clusterProps):this.points[Fe[Ut+3]])}if(0===$e.length)throw new Error(Ee);return $e}getLeaves(X,ee,he){const Ee=[];return this._appendLeaves(Ee,X,ee=ee||10,he=he||0,0),Ee}getTile(X,ee,he){const Ee=this.trees[this._limitZoom(X)],Ce=Math.pow(2,X),{extent:Fe,radius:Le}=this.options,Ie=Le/Fe,$e=(he-Ie)/Ce,xt=(he+1+Ie)/Ce,Ut={features:[]};return this._addTileFeatures(Ee.range((ee-Ie)/Ce,$e,(ee+1+Ie)/Ce,xt),Ee.data,ee,he,Ce,Ut),0===ee&&this._addTileFeatures(Ee.range(1-Ie/Ce,$e,1,xt),Ee.data,Ce,he,Ce,Ut),ee===Ce-1&&this._addTileFeatures(Ee.range(0,$e,Ie/Ce,xt),Ee.data,-1,he,Ce,Ut),Ut.features.length?Ut:null}getClusterExpansionZoom(X){let ee=this._getOriginZoom(X)-1;for(;ee<=this.options.maxZoom;){const he=this.getChildren(X);if(ee++,1!==he.length)break;X=he[0].properties.cluster_id}return ee}_appendLeaves(X,ee,he,Ee,Ce){const Fe=this.getChildren(ee);for(const Le of Fe){const Ie=Le.properties;if(Ie&&Ie.cluster?Ce+Ie.point_count<=Ee?Ce+=Ie.point_count:Ce=this._appendLeaves(X,Ie.cluster_id,he,Ee,Ce):Ce<Ee?Ce++:X.push(Le),X.length===he)break}return Ce}_createTree(X){const ee=new u.KDBush(X.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<X.length;he+=this.stride)ee.add(X[he],X[he+1]);return ee.finish(),ee.data=X,ee}_addTileFeatures(X,ee,he,Ee,Ce,Fe){for(const Le of X){const Ie=Le*this.stride,$e=ee[Ie+5]>1;let xt,Ut,St;if($e)xt=vr(ee,Ie,this.clusterProps),Ut=ee[Ie],St=ee[Ie+1];else{const Mn=this.points[ee[Ie+3]];xt=Mn.properties;const[Rn,Bn]=Mn.geometry.coordinates;Ut=li(Rn),St=xr(Bn)}const Tn={type:1,geometry:[[Math.round(this.options.extent*(Ut*Ce-he)),Math.round(this.options.extent*(St*Ce-Ee))]],tags:xt};let $n;$n=$e||this.options.generateId?ee[Ie+3]:this.points[ee[Ie+3]].id,void 0!==$n&&(Tn.id=$n),Fe.features.push(Tn)}}_limitZoom(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))}_cluster(X,ee){const{radius:he,extent:Ee,reduce:Ce,minPoints:Fe}=this.options,Le=he/(Ee*Math.pow(2,ee)),Ie=X.data,$e=[],xt=this.stride;for(let Ut=0;Ut<Ie.length;Ut+=xt){if(Ie[Ut+2]<=ee)continue;Ie[Ut+2]=ee;const St=Ie[Ut],Tn=Ie[Ut+1],$n=X.within(Ie[Ut],Ie[Ut+1],Le),Mn=Ie[Ut+5];let Rn=Mn;for(const Bn of $n){const Mr=Bn*xt;Ie[Mr+2]>ee&&(Rn+=Ie[Mr+5])}if(Rn>Mn&&Rn>=Fe){let Bn,Mr=St*Mn,Ur=Tn*Mn,je=-1;const ke=((Ut/xt|0)<<5)+(ee+1)+this.points.length;for(const ge of $n){const Ue=ge*xt;if(Ie[Ue+2]<=ee)continue;Ie[Ue+2]=ee;const at=Ie[Ue+5];Mr+=Ie[Ue]*at,Ur+=Ie[Ue+1]*at,Ie[Ue+4]=ke,Ce&&(Bn||(Bn=this._map(Ie,Ut,!0),je=this.clusterProps.length,this.clusterProps.push(Bn)),Ce(Bn,this._map(Ie,Ue)))}Ie[Ut+4]=ke,$e.push(Mr/Rn,Ur/Rn,1/0,ke,-1,Rn),Ce&&$e.push(je)}else{for(let Bn=0;Bn<xt;Bn++)$e.push(Ie[Ut+Bn]);if(Rn>1)for(const Bn of $n){const Mr=Bn*xt;if(!(Ie[Mr+2]<=ee)){Ie[Mr+2]=ee;for(let Ur=0;Ur<xt;Ur++)$e.push(Ie[Mr+Ur])}}}}return $e}_getOriginId(X){return X-this.points.length>>5}_getOriginZoom(X){return(X-this.points.length)%32}_map(X,ee,he){if(X[ee+5]>1){const Fe=this.clusterProps[X[ee+6]];return he?Object.assign({},Fe):Fe}const Ee=this.points[X[ee+3]].properties,Ce=this.options.map(Ee);return he&&Ce===Ee?Object.assign({},Ce):Ce}}function Dn(_e,X,ee){return{type:"Feature",id:_e[X+3],properties:vr(_e,X,ee),geometry:{type:"Point",coordinates:[(he=_e[X],360*(he-.5)),Mi(_e[X+1])]}};var he}function vr(_e,X,ee){const he=_e[X+5],Ee=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,Ce=_e[X+6],Fe=-1===Ce?{}:Object.assign({},ee[Ce]);return Object.assign(Fe,{cluster:!0,cluster_id:_e[X+3],point_count:he,point_count_abbreviated:Ee})}function li(_e){return _e/360+.5}function xr(_e){const X=Math.sin(_e*Math.PI/180),ee=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ee<0?0:ee>1?1:ee}function Mi(_e){const X=(180-360*_e)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function Zr(_e,X,ee,he){for(var Ee,Ce=he,Fe=ee-X>>1,Le=ee-X,Ie=_e[X],$e=_e[X+1],xt=_e[ee],Ut=_e[ee+1],St=X+3;St<ee;St+=3){var Tn=Ar(_e[St],_e[St+1],Ie,$e,xt,Ut);if(Tn>Ce)Ee=St,Ce=Tn;else if(Tn===Ce){var $n=Math.abs(St-Fe);$n<Le&&(Ee=St,Le=$n)}}Ce>he&&(Ee-X>3&&Zr(_e,X,Ee,he),_e[Ee+2]=Ce,ee-Ee>3&&Zr(_e,Ee,ee,he))}function Ar(_e,X,ee,he,Ee,Ce){var Fe=Ee-ee,Le=Ce-he;if(0!==Fe||0!==Le){var Ie=((_e-ee)*Fe+(X-he)*Le)/(Fe*Fe+Le*Le);Ie>1?(ee=Ee,he=Ce):Ie>0&&(ee+=Fe*Ie,he+=Le*Ie)}return(Fe=_e-ee)*Fe+(Le=X-he)*Le}function ln(_e,X,ee,he){var Ee={id:void 0===_e?null:_e,type:X,geometry:ee,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var Fe=Ce.geometry,Le=Ce.type;if("Point"===Le||"MultiPoint"===Le||"LineString"===Le)Zn(Ce,Fe);else if("Polygon"===Le||"MultiLineString"===Le)for(var Ie=0;Ie<Fe.length;Ie++)Zn(Ce,Fe[Ie]);else if("MultiPolygon"===Le)for(Ie=0;Ie<Fe.length;Ie++)for(var $e=0;$e<Fe[Ie].length;$e++)Zn(Ce,Fe[Ie][$e])}(Ee),Ee}function Zn(_e,X){for(var ee=0;ee<X.length;ee+=3)_e.minX=Math.min(_e.minX,X[ee]),_e.minY=Math.min(_e.minY,X[ee+1]),_e.maxX=Math.max(_e.maxX,X[ee]),_e.maxY=Math.max(_e.maxY,X[ee+1])}function Si(_e,X,ee,he){if(X.geometry){var Ee=X.geometry.coordinates,Ce=X.geometry.type,Fe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2),Le=[],Ie=X.id;if(ee.promoteId?Ie=X.properties[ee.promoteId]:ee.generateId&&(Ie=he||0),"Point"===Ce)Wo(Ee,Le);else if("MultiPoint"===Ce)for(var $e=0;$e<Ee.length;$e++)Wo(Ee[$e],Le);else if("LineString"===Ce)Cr(Ee,Le,Fe,!1);else if("MultiLineString"===Ce){if(ee.lineMetrics){for($e=0;$e<Ee.length;$e++)Cr(Ee[$e],Le=[],Fe,!1),_e.push(ln(Ie,"LineString",Le,X.properties));return}_r(Ee,Le,Fe,!1)}else if("Polygon"===Ce)_r(Ee,Le,Fe,!0);else{if("MultiPolygon"!==Ce){if("GeometryCollection"===Ce){for($e=0;$e<X.geometry.geometries.length;$e++)Si(_e,{id:Ie,geometry:X.geometry.geometries[$e],properties:X.properties},ee,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for($e=0;$e<Ee.length;$e++){var xt=[];_r(Ee[$e],xt,Fe,!0),Le.push(xt)}}_e.push(ln(Ie,Ce,Le,X.properties))}}function Wo(_e,X){X.push(Mo(_e[0])),X.push(fi(_e[1])),X.push(0)}function Cr(_e,X,ee,he){for(var Ee,Ce,Fe=0,Le=0;Le<_e.length;Le++){var Ie=Mo(_e[Le][0]),$e=fi(_e[Le][1]);X.push(Ie),X.push($e),X.push(0),Le>0&&(Fe+=he?(Ee*$e-Ie*Ce)/2:Math.sqrt(Math.pow(Ie-Ee,2)+Math.pow($e-Ce,2))),Ee=Ie,Ce=$e}var xt=X.length-3;X[2]=1,Zr(X,0,xt,ee),X[xt+2]=1,X.size=Math.abs(Fe),X.start=0,X.end=X.size}function _r(_e,X,ee,he){for(var Ee=0;Ee<_e.length;Ee++){var Ce=[];Cr(_e[Ee],Ce,ee,he),X.push(Ce)}}function Mo(_e){return _e/360+.5}function fi(_e){var X=Math.sin(_e*Math.PI/180),ee=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return ee<0?0:ee>1?1:ee}function Nr(_e,X,ee,he,Ee,Ce,Fe,Le){if(he/=X,Ce>=(ee/=X)&&Fe<he)return _e;if(Fe<ee||Ce>=he)return null;for(var Ie=[],$e=0;$e<_e.length;$e++){var xt=_e[$e],Ut=xt.geometry,St=xt.type,Tn=0===Ee?xt.minX:xt.minY,$n=0===Ee?xt.maxX:xt.maxY;if(Tn>=ee&&$n<he)Ie.push(xt);else if(!($n<ee||Tn>=he)){var Mn=[];if("Point"===St||"MultiPoint"===St)ho(Ut,Mn,ee,he,Ee);else if("LineString"===St)vn(Ut,Mn,ee,he,Ee,!1,Le.lineMetrics);else if("MultiLineString"===St)zr(Ut,Mn,ee,he,Ee,!1);else if("Polygon"===St)zr(Ut,Mn,ee,he,Ee,!0);else if("MultiPolygon"===St)for(var Rn=0;Rn<Ut.length;Rn++){var Bn=[];zr(Ut[Rn],Bn,ee,he,Ee,!0),Bn.length&&Mn.push(Bn)}if(Mn.length){if(Le.lineMetrics&&"LineString"===St){for(Rn=0;Rn<Mn.length;Rn++)Ie.push(ln(xt.id,St,Mn[Rn],xt.tags));continue}"LineString"!==St&&"MultiLineString"!==St||(1===Mn.length?(St="LineString",Mn=Mn[0]):St="MultiLineString"),"Point"!==St&&"MultiPoint"!==St||(St=3===Mn.length?"Point":"MultiPoint"),Ie.push(ln(xt.id,St,Mn,xt.tags))}}}return Ie.length?Ie:null}function ho(_e,X,ee,he,Ee){for(var Ce=0;Ce<_e.length;Ce+=3){var Fe=_e[Ce+Ee];Fe>=ee&&Fe<=he&&(X.push(_e[Ce]),X.push(_e[Ce+1]),X.push(_e[Ce+2]))}}function vn(_e,X,ee,he,Ee,Ce,Fe){for(var Le,Ie,$e=Fi(_e),xt=0===Ee?fo:vs,Ut=_e.start,St=0;St<_e.length-3;St+=3){var Tn=_e[St],$n=_e[St+1],Mn=_e[St+2],Rn=_e[St+3],Bn=_e[St+4],Mr=0===Ee?Tn:$n,Ur=0===Ee?Rn:Bn,je=!1;Fe&&(Le=Math.sqrt(Math.pow(Tn-Rn,2)+Math.pow($n-Bn,2))),Mr<ee?Ur>ee&&(Ie=xt($e,Tn,$n,Rn,Bn,ee),Fe&&($e.start=Ut+Le*Ie)):Mr>he?Ur<he&&(Ie=xt($e,Tn,$n,Rn,Bn,he),Fe&&($e.start=Ut+Le*Ie)):si($e,Tn,$n,Mn),Ur<ee&&Mr>=ee&&(Ie=xt($e,Tn,$n,Rn,Bn,ee),je=!0),Ur>he&&Mr<=he&&(Ie=xt($e,Tn,$n,Rn,Bn,he),je=!0),!Ce&&je&&(Fe&&($e.end=Ut+Le*Ie),X.push($e),$e=Fi(_e)),Fe&&(Ut+=Le)}var ke=_e.length-3;Tn=_e[ke],$n=_e[ke+1],Mn=_e[ke+2],(Mr=0===Ee?Tn:$n)>=ee&&Mr<=he&&si($e,Tn,$n,Mn),ke=$e.length-3,Ce&&ke>=3&&($e[ke]!==$e[0]||$e[ke+1]!==$e[1])&&si($e,$e[0],$e[1],$e[2]),$e.length&&X.push($e)}function Fi(_e){var X=[];return X.size=_e.size,X.start=_e.start,X.end=_e.end,X}function zr(_e,X,ee,he,Ee,Ce){for(var Fe=0;Fe<_e.length;Fe++)vn(_e[Fe],X,ee,he,Ee,Ce,!1)}function si(_e,X,ee,he){_e.push(X),_e.push(ee),_e.push(he)}function fo(_e,X,ee,he,Ee,Ce){var Fe=(Ce-X)/(he-X);return _e.push(Ce),_e.push(ee+(Ee-ee)*Fe),_e.push(1),Fe}function vs(_e,X,ee,he,Ee,Ce){var Fe=(Ce-ee)/(Ee-ee);return _e.push(X+(he-X)*Fe),_e.push(Ce),_e.push(1),Fe}function kr(_e,X){for(var ee=[],he=0;he<_e.length;he++){var Ee,Ce=_e[he],Fe=Ce.type;if("Point"===Fe||"MultiPoint"===Fe||"LineString"===Fe)Ee=Et(Ce.geometry,X);else if("MultiLineString"===Fe||"Polygon"===Fe){Ee=[];for(var Le=0;Le<Ce.geometry.length;Le++)Ee.push(Et(Ce.geometry[Le],X))}else if("MultiPolygon"===Fe)for(Ee=[],Le=0;Le<Ce.geometry.length;Le++){for(var Ie=[],$e=0;$e<Ce.geometry[Le].length;$e++)Ie.push(Et(Ce.geometry[Le][$e],X));Ee.push(Ie)}ee.push(ln(Ce.id,Fe,Ee,Ce.tags))}return ee}function Et(_e,X){var ee=[];ee.size=_e.size,void 0!==_e.start&&(ee.start=_e.start,ee.end=_e.end);for(var he=0;he<_e.length;he+=3)ee.push(_e[he]+X,_e[he+1],_e[he+2]);return ee}function ve(_e,X){if(_e.transformed)return _e;var ee,he,Ee,Ce=1<<_e.z,Fe=_e.x,Le=_e.y;for(ee=0;ee<_e.features.length;ee++){var Ie=_e.features[ee],$e=Ie.geometry,xt=Ie.type;if(Ie.geometry=[],1===xt)for(he=0;he<$e.length;he+=2)Ie.geometry.push(we($e[he],$e[he+1],X,Ce,Fe,Le));else for(he=0;he<$e.length;he++){var Ut=[];for(Ee=0;Ee<$e[he].length;Ee+=2)Ut.push(we($e[he][Ee],$e[he][Ee+1],X,Ce,Fe,Le));Ie.geometry.push(Ut)}}return _e.transformed=!0,_e}function we(_e,X,ee,he,Ee,Ce){return[Math.round(ee*(_e*he-Ee)),Math.round(ee*(X*he-Ce))]}function ct(_e,X,ee,he,Ee){for(var Ce=X===Ee.maxZoom?0:Ee.tolerance/((1<<X)*Ee.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ee,y:he,z:X,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Le=0;Le<_e.length;Le++){Fe.numFeatures++,pt(Fe,_e[Le],Ce,Ee);var Ie=_e[Le].minX,$e=_e[Le].minY,xt=_e[Le].maxX,Ut=_e[Le].maxY;Ie<Fe.minX&&(Fe.minX=Ie),$e<Fe.minY&&(Fe.minY=$e),xt>Fe.maxX&&(Fe.maxX=xt),Ut>Fe.maxY&&(Fe.maxY=Ut)}return Fe}function pt(_e,X,ee,he){var Ee=X.geometry,Ce=X.type,Fe=[];if("Point"===Ce||"MultiPoint"===Ce)for(var Le=0;Le<Ee.length;Le+=3)Fe.push(Ee[Le]),Fe.push(Ee[Le+1]),_e.numPoints++,_e.numSimplified++;else if("LineString"===Ce)mn(Fe,Ee,_e,ee,!1,!1);else if("MultiLineString"===Ce||"Polygon"===Ce)for(Le=0;Le<Ee.length;Le++)mn(Fe,Ee[Le],_e,ee,"Polygon"===Ce,0===Le);else if("MultiPolygon"===Ce)for(var Ie=0;Ie<Ee.length;Ie++){var $e=Ee[Ie];for(Le=0;Le<$e.length;Le++)mn(Fe,$e[Le],_e,ee,!0,0===Le)}if(Fe.length){var xt=X.tags||null;if("LineString"===Ce&&he.lineMetrics){for(var Ut in xt={},X.tags)xt[Ut]=X.tags[Ut];xt.mapbox_clip_start=Ee.start/Ee.size,xt.mapbox_clip_end=Ee.end/Ee.size}var St={geometry:Fe,type:"Polygon"===Ce||"MultiPolygon"===Ce?3:"LineString"===Ce||"MultiLineString"===Ce?2:1,tags:xt};null!==X.id&&(St.id=X.id),_e.features.push(St)}}function mn(_e,X,ee,he,Ee,Ce){var Fe=he*he;if(he>0&&X.size<(Ee?Fe:he))ee.numPoints+=X.length/3;else{for(var Le=[],Ie=0;Ie<X.length;Ie+=3)(0===he||X[Ie+2]>Fe)&&(ee.numSimplified++,Le.push(X[Ie]),Le.push(X[Ie+1])),ee.numPoints++;Ee&&function($e,xt){for(var Ut=0,St=0,Tn=$e.length,$n=Tn-2;St<Tn;$n=St,St+=2)Ut+=($e[St]-$e[$n])*($e[St+1]+$e[$n+1]);if(Ut>0===xt)for(St=0,Tn=$e.length;St<Tn/2;St+=2){var Mn=$e[St],Rn=$e[St+1];$e[St]=$e[Tn-2-St],$e[St+1]=$e[Tn-1-St],$e[Tn-2-St]=Mn,$e[Tn-1-St]=Rn}}(Le,Ce),_e.push(Le)}}function In(_e,X){var ee=(X=this.options=function(Ee,Ce){for(var Fe in Ce)Ee[Fe]=Ce[Fe];return Ee}(Object.create(this.options),X)).debug;if(ee&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ee,Ce,Fe,Le,Ie,$e,he=function(Ee,Ce){var Fe=[];if("FeatureCollection"===Ee.type)for(var Le=0;Le<Ee.features.length;Le++)Si(Fe,Ee.features[Le],Ce,Le);else Si(Fe,"Feature"===Ee.type?Ee:{geometry:Ee},Ce);return Fe}(_e,X);this.tiles={},this.tileCoords=[],ee&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=Ee=he,Ie=Nr(Ee,1,-1-(Fe=(Ce=X).buffer/Ce.extent),Fe,0,-1,2,Ce),$e=Nr(Ee,1,1-Fe,2+Fe,0,-1,2,Ce),(Ie||$e)&&(Le=Nr(Ee,1,-Fe,1+Fe,0,-1,2,Ce)||[],Ie&&(Le=kr(Ie,1).concat(Le)),$e&&(Le=Le.concat(kr($e,-1)))),(he=Le).length&&this.splitTile(he,0,0,0),ee&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cr(_e,X,ee){return 32*((1<<_e)*ee+X)+_e}function gn(_e,X){const ee=_e.tileID.canonical;if(!this._geoJSONIndex)return X(null,null);const he=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!he)return X(null,null);const Ee=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(Le){this._feature=Le,this.extent=u.EXTENT,this.type=Le.type,this.properties=Le.tags,"id"in Le&&!isNaN(Le.id)&&(this.id=parseInt(Le.id,10))}loadGeometry(){if(1===this._feature.type){const Le=[];for(const Ie of this._feature.geometry)Le.push([new u.Point(Ie[0],Ie[1])]);return Le}{const Le=[];for(const Ie of this._feature.geometry){const $e=[];for(const xt of Ie)$e.push(new u.Point(xt[0],xt[1]));Le.push($e)}return Le}}toGeoJSON(Le,Ie,$e){return Ht.call(this,Le,Ie,$e)}}(this._features[Fe])}}(he.features);let Ce=He(Ee);0===Ce.byteOffset&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),X(null,{vectorTile:Ee,rawData:Ce.buffer})}In.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},In.prototype.splitTile=function(_e,X,ee,he,Ee,Ce,Fe){for(var Le=[_e,X,ee,he],Ie=this.options,$e=Ie.debug;Le.length;){he=Le.pop(),ee=Le.pop(),X=Le.pop(),_e=Le.pop();var xt=1<<X,Ut=cr(X,ee,he),St=this.tiles[Ut];if(!St&&($e>1&&console.time("creation"),St=this.tiles[Ut]=ct(_e,X,ee,he,Ie),this.tileCoords.push({z:X,x:ee,y:he}),$e)){$e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,ee,he,St.numFeatures,St.numPoints,St.numSimplified),console.timeEnd("creation"));var Tn="z"+X;this.stats[Tn]=(this.stats[Tn]||0)+1,this.total++}if(St.source=_e,Ee){if(X===Ie.maxZoom||X===Ee)continue;var $n=1<<Ee-X;if(ee!==Math.floor(Ce/$n)||he!==Math.floor(Fe/$n))continue}else if(X===Ie.indexMaxZoom||St.numPoints<=Ie.indexMaxPoints)continue;if(St.source=null,0!==_e.length){$e>1&&console.time("clipping");var Mn,Rn,Bn,Mr,Ur,je,ke=.5*Ie.buffer/Ie.extent,ge=.5-ke,Ue=.5+ke,at=1+ke;Mn=Rn=Bn=Mr=null,Ur=Nr(_e,xt,ee-ke,ee+Ue,0,St.minX,St.maxX,Ie),je=Nr(_e,xt,ee+ge,ee+at,0,St.minX,St.maxX,Ie),_e=null,Ur&&(Mn=Nr(Ur,xt,he-ke,he+Ue,1,St.minY,St.maxY,Ie),Rn=Nr(Ur,xt,he+ge,he+at,1,St.minY,St.maxY,Ie),Ur=null),je&&(Bn=Nr(je,xt,he-ke,he+Ue,1,St.minY,St.maxY,Ie),Mr=Nr(je,xt,he+ge,he+at,1,St.minY,St.maxY,Ie),je=null),$e>1&&console.timeEnd("clipping"),Le.push(Mn||[],X+1,2*ee,2*he),Le.push(Rn||[],X+1,2*ee,2*he+1),Le.push(Bn||[],X+1,2*ee+1,2*he),Le.push(Mr||[],X+1,2*ee+1,2*he+1)}}},In.prototype.getTile=function(_e,X,ee){var he=this.options,Ee=he.extent,Ce=he.debug;if(_e<0||_e>24)return null;var Fe=1<<_e,Le=cr(_e,X=(X%Fe+Fe)%Fe,ee);if(this.tiles[Le])return ve(this.tiles[Le],Ee);Ce>1&&console.log("drilling down to z%d-%d-%d",_e,X,ee);for(var Ie,$e=_e,xt=X,Ut=ee;!Ie&&$e>0;)$e--,xt=Math.floor(xt/2),Ut=Math.floor(Ut/2),Ie=this.tiles[cr($e,xt,Ut)];return Ie&&Ie.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",$e,xt,Ut),Ce>1&&console.time("drilling down"),this.splitTile(Ie.source,$e,xt,Ut,_e,X,ee),Ce>1&&console.timeEnd("drilling down"),this.tiles[Le]?ve(this.tiles[Le],Ee):null):null};class Vr extends u.VectorTileWorkerSource{constructor(X,ee,he,Ee,Ce){super(X,ee,he,Ee,gn),Ce&&(this.loadGeoJSON=Ce)}loadData(X,ee){const he=X&&X.request,Ee=he&&he.collectResourceTiming;this.loadGeoJSON(X,(Ce,Fe)=>{if(Ce||!Fe)return ee(Ce);if("object"!=typeof Fe)return ee(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));{dt(Fe,!0);try{if(X.filter){const Ie=u.createExpression(X.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ie.result)throw new Error(Ie.value.map(xt=>`${xt.key}: ${xt.message}`).join(", "));const $e=Fe.features.filter(xt=>Ie.value.evaluate({zoom:0},xt));Fe={type:"FeatureCollection",features:$e}}this._geoJSONIndex=X.cluster?new gr(function({superclusterOptions:Ie,clusterProperties:$e}){if(!$e||!Ie)return Ie;const xt={},Ut={},St={accumulated:null,zoom:0},Tn={properties:null},$n=Object.keys($e);for(const Mn of $n){const[Rn,Bn]=$e[Mn],Mr=u.createExpression(Bn),Ur=u.createExpression("string"==typeof Rn?[Rn,["accumulated"],["get",Mn]]:Rn);xt[Mn]=Mr.value,Ut[Mn]=Ur.value}return Ie.map=Mn=>{Tn.properties=Mn;const Rn={};for(const Bn of $n)Rn[Bn]=xt[Bn].evaluate(St,Tn);return Rn},Ie.reduce=(Mn,Rn)=>{Tn.properties=Rn;for(const Bn of $n)St.accumulated=Mn[Bn],Mn[Bn]=Ut[Bn].evaluate(St,Tn)},Ie}(X)).load(Fe.features):new In(Ie=Fe,X.geojsonVtOptions)}catch(Ie){return ee(Ie)}this.loaded={};const Le={};if(Ee){const Ie=u.getPerformanceMeasurement(he);Ie&&(Le.resourceTiming={},Le.resourceTiming[X.source]=JSON.parse(JSON.stringify(Ie)))}ee(null,Le)}var Ie})}reloadTile(X,ee){const he=this.loaded;return he&&he[X.uid]?super.reloadTile(X,ee):this.loadTile(X,ee)}loadGeoJSON(X,ee){if(X.request)u.getJSON(X.request,ee);else{if("string"!=typeof X.data)return ee(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`));try{return ee(null,JSON.parse(X.data))}catch{return ee(new Error(`Input data given to '${X.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(X,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(X.clusterId))}catch(he){ee(he)}}getClusterChildren(X,ee){try{ee(null,this._geoJSONIndex.getChildren(X.clusterId))}catch(he){ee(he)}}getClusterLeaves(X,ee){try{ee(null,this._geoJSONIndex.getLeaves(X.clusterId,X.limit,X.offset))}catch(he){ee(he)}}}class Tr{constructor(X){this.self=X,this.actor=new u.Actor(X,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Vr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ee,he)=>{if(this.workerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.workerSourceTypes[ee]=he},this.self.registerRTLTextPlugin=ee=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=ee.applyArabicShaping,u.plugin.processBidirectionalText=ee.processBidirectionalText,u.plugin.processStyledBidirectionalText=ee.processStyledBidirectionalText}}clearCaches(X,ee,he){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X],he()}checkIfReady(X,ee,he){he()}setReferrer(X,ee){this.referrer=ee}spriteLoaded(X,ee){this.isSpriteLoaded[X]=ee;for(const he in this.workerSources[X]){const Ee=this.workerSources[X][he];for(const Ce in Ee)Ee[Ce]instanceof u.VectorTileWorkerSource&&(Ee[Ce].isSpriteLoaded=ee,Ee[Ce].fire(new u.Event("isSpriteLoaded")))}}setImages(X,ee,he){this.availableImages[X]=ee;for(const Ee in this.workerSources[X]){const Ce=this.workerSources[X][Ee];for(const Fe in Ce)Ce[Fe].availableImages=ee}he()}enableTerrain(X,ee,he){this.terrain=ee,he()}setProjection(X,ee){this.projections[X]=u.getProjection(ee)}setLayers(X,ee,he){this.getLayerIndex(X).replace(ee),he()}updateLayers(X,ee,he){this.getLayerIndex(X).update(ee.layers,ee.removedIds),he()}loadTile(X,ee,he){const Ee=this.enableTerrain?u.extend({enableTerrain:this.terrain},ee):ee;Ee.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,ee.type,ee.source).loadTile(Ee,he)}loadDEMTile(X,ee,he){const Ee=this.enableTerrain?u.extend({buildQuadTree:this.terrain},ee):ee;this.getDEMWorkerSource(X,ee.source).loadTile(Ee,he)}reloadTile(X,ee,he){const Ee=this.enableTerrain?u.extend({enableTerrain:this.terrain},ee):ee;Ee.projection=this.projections[X]||this.defaultProjection,this.getWorkerSource(X,ee.type,ee.source).reloadTile(Ee,he)}abortTile(X,ee,he){this.getWorkerSource(X,ee.type,ee.source).abortTile(ee,he)}removeTile(X,ee,he){this.getWorkerSource(X,ee.type,ee.source).removeTile(ee,he)}removeSource(X,ee,he){if(!this.workerSources[X]||!this.workerSources[X][ee.type]||!this.workerSources[X][ee.type][ee.source])return;const Ee=this.workerSources[X][ee.type][ee.source];delete this.workerSources[X][ee.type][ee.source],void 0!==Ee.removeSource?Ee.removeSource(ee,he):he()}loadWorkerSource(X,ee,he){try{this.self.importScripts(ee.url),he()}catch(Ee){he(Ee.toString())}}syncRTLPluginState(X,ee,he){try{u.plugin.setState(ee);const Ee=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=Ee){this.self.importScripts(Ee);const Ce=u.plugin.isParsed();he(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ee}`),Ce)}}catch(Ee){he(Ee.toString())}}getAvailableImages(X){let ee=this.availableImages[X];return ee||(ee=[]),ee}getLayerIndex(X){let ee=this.layerIndexes[X];return ee||(ee=this.layerIndexes[X]=new Vt),ee}getWorkerSource(X,ee,he){return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][ee]||(this.workerSources[X][ee]={}),this.workerSources[X][ee][he]||(this.workerSources[X][ee][he]=new this.workerSourceTypes[ee]({send:(Ce,Fe,Le,Ie,$e,xt)=>{this.actor.send(Ce,Fe,Le,X,$e,xt)},scheduler:this.actor.scheduler},this.getLayerIndex(X),this.getAvailableImages(X),this.isSpriteLoaded[X])),this.workerSources[X][ee][he]}getDEMWorkerSource(X,ee){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][ee]||(this.demWorkerSources[X][ee]=new Tt),this.demWorkerSources[X][ee]}enforceCacheSizeLimit(X,ee){u.enforceCacheSizeLimit(ee)}getWorkerPerformanceMetrics(X,ee,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Tr(self)),Tr}),I(0,function(u){function Te(c,t){if(Array.isArray(c)){if(!Array.isArray(t)||c.length!==t.length)return!1;for(let a=0;a<c.length;a++)if(!Te(c[a],t[a]))return!1;return!0}if("object"==typeof c&&null!==c&&null!==t){if("object"!=typeof t||Object.keys(c).length!==Object.keys(t).length)return!1;for(const a in c)if(!Te(c[a],t[a]))return!1;return!0}return c===t}var Yt=Vt;function Vt(c){return t=c,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,g,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{g=new Worker(E),d=!0}catch{d=!1}return g&&g.terminate(),URL.revokeObjectURL(E),d}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var d=document.createElement("canvas");d.width=d.height=1;var g=d.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===d.width}()||(void 0===Tt[a=t&&t.failIfMajorPerformanceCaveat]&&(Tt[a]=function(d){var g,E,C,P,v=(E=d,C=document.createElement("canvas"),(P=Object.create(Vt.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,C.getContext("webgl",P)||C.getContext("experimental-webgl",P));if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),!0===v.getShaderParameter(g,v.COMPILE_STATUS))}(a)),!Tt[a]||document.documentMode));var t,a}var Tt={};function gt(c,t,a){const d=u.window.document.createElement(c);return void 0!==t&&(d.className=t),a&&a.appendChild(d),d}function vt(c,t,a){const d=u.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const g of Object.keys(t))d.setAttributeNS(null,g,t[g]);return a&&a.appendChild(d),d}Vt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const dt=u.window.document&&u.window.document.documentElement.style,Ht=dt&&void 0!==dt.userSelect?"userSelect":"WebkitUserSelect";let Cn;function bt(){dt&&Ht&&(Cn=dt[Ht],dt[Ht]="none")}function nn(){dt&&Ht&&(dt[Ht]=Cn)}function It(c){c.preventDefault(),c.stopPropagation(),u.window.removeEventListener("click",It,!0)}function pn(){u.window.addEventListener("click",It,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",It,!0)},0)}function on(c,t){const a=c.getBoundingClientRect();return tn(c,a,t)}function or(c,t){const a=c.getBoundingClientRect(),d=[];for(let g=0;g<t.length;g++)d.push(tn(c,a,t[g]));return d}function sn(c){return void 0!==u.window.InstallTrigger&&2===c.button&&c.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function tn(c,t,a){const d=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new u.Point((a.clientX-t.left)*d,(a.clientY-t.top)*d)}function Ge(c,t){var a=t[0],d=t[1],g=t[2],v=t[3],E=a*v-g*d;return E?(c[0]=v*(E=1/E),c[1]=-d*E,c[2]=-g*E,c[3]=a*E,c):null}function kt(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class lr extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,callback:d}of this.requestors)this._notify(a,d);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,a){this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const g of t){if(g[0]<d||g[1]<g[0]||a<g[1])return!1;d=g[1]}return!0}_validateContent(t,a){return!(t&&(4!==t.length||t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,a){a.version=this.images[t].version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,a){let d=!0;if(!this.isLoaded())for(const g of t)this.images[g]||(d=!1);this.isLoaded()||d?this._notify(t,a):this.requestors.push({ids:t,callback:a})}_notify(t,a){const d={};for(const g of t){this.images[g]||this.fire(new u.Event("styleimagemissing",{id:g}));const v=this.images[g];v?d[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:u.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,d)}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],d=this.getImage(t);if(!d)return null;if(a&&a.position.version===d.version)return a.position;if(a)a.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},v=new u.ImagePosition(g,d);this.patterns[t]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(t,this.atlasImage,a.RGBA),this.atlasTexture&&this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const v in this.patterns)t.push(this.patterns[v].bin);const{w:a,h:d}=u.potpack(t),g=this.atlasImage;g.resize({width:a||1,height:d||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],C=E.x+1,P=E.y+1,U=this.images[v].data,V=U.width,q=U.height;u.RGBAImage.copy(U,g,{x:0,y:0},{x:C,y:P},{width:V,height:q}),u.RGBAImage.copy(U,g,{x:0,y:q-1},{x:C,y:P-1},{width:V,height:1}),u.RGBAImage.copy(U,g,{x:0,y:0},{x:C,y:P+q},{width:V,height:1}),u.RGBAImage.copy(U,g,{x:V-1,y:0},{x:C-1,y:P},{width:1,height:q}),u.RGBAImage.copy(U,g,{x:0,y:0},{x:C+V,y:P},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const d=this.images[a];kt(d)&&this.updateImage(a,d)}}}const tt=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(c,t){return function([a,d,g]){const v=u.degToRad(d+90),E=u.degToRad(g);return{x:a*Math.cos(v)*Math.sin(E),y:a*Math.sin(v)*Math.sin(E),z:a*Math.cos(E),azimuthal:d,polar:g}}(c.expression.evaluate(t))}interpolate(c,t,a){return{x:u.number(c.x,t.x,a),y:u.number(c.y,t.y,a),z:u.number(c.z,t.z,a),azimuthal:u.number(c.azimuthal,t.azimuthal,a),polar:u.number(c.polar,t.polar,a)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)});class ft extends u.Evented{constructor(t){super(),this._transitionable=new u.Transitionable(tt),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(u.validateLight,t,a))for(const d in t){const g=t[d];u.endsWith(d,"-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||!1!==d.validate)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const rn=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)});let Xe=class extends u.Evented{constructor(c,t){super(),this._transitionable=new u.Transitionable(rn),this.set(c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(c){for(const t in c){const a=c[t];u.endsWith(t,"-transition")?this._transitionable.setTransition(t.slice(0,-11),a):this._transitionable.setValue(t,a)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}};function He(c,t,a,d){const g=u.smoothstep(45,65,a),[v,E]=lt(c,d),C=u.length(t);let P=1-Math.min(1,Math.exp((C-v)/(E-v)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*g*c.alpha}function lt(c,t){const a=.5/Math.tan(.5*t);return[c.range[0]+a,c.range[1]+a]}const Be=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])});class Wt extends u.Evented{constructor(t,a){super(),this._transitionable=new u.Transitionable(Be),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const t=this._transform,a="globe"===t.projection.name,d=u.globeToMercatorTransition(t.zoom),g=this.properties.get("range"),v=[.5,3];return{range:a?[u.number(v[0],g[0],d),u.number(v[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a={}){if(!this._validate(u.validateFog,t,a)){for(const d of Object.keys(u.spec.fog))t&&void 0===t[d]&&(t[d]=u.spec.fog[d].default);for(const d in t){const g=t[d];u.endsWith(d,"-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(d,g,v){const E=u.MercatorCoordinate.fromLngLat(g),C=v.elevation?v.elevation.getAtPointOrZero(E):0,P=[E.x,E.y,C];return u.transformMat4(P,P,v.mercatorFogMatrix),He(d,P,v.pitch,v._fov)}(this.state,t,a):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?lt(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||!1!==d.validate)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class ht{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const d=this.workerPool.acquire(this.id);for(let g=0;g<d.length;g++){const v=new ht.Actor(d[g],a,this.id);v.name=`Worker ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,a,d){u.asyncAll(this.actors,(g,v)=>{g.send(t,a,v)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function fn(c,t,a){return t*(u.EXTENT/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}ht.Actor=u.Actor;class kn{constructor(t,a,d,g){this.screenBounds=t,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(t,a){let d,g;if(t instanceof u.Point||"number"==typeof t[0]){const v=u.Point.convert(t);d=[v],g=a.isPointAboveHorizon(v)}else{const v=u.Point.convert(t[0]),E=u.Point.convert(t[1]);d=[v,E],g=u.polygonizeBounds(v,E).every(C=>a.isPointAboveHorizon(C))}return new kn(d,a.getCameraPoint(),g,a)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],d=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],g=u.polygonizeBounds(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(g[3]=this.cameraPoint)),u.bufferConvexPolygon(g,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],d=1===this.screenBounds.length?this.screenBounds[0].add(new u.Point(1,1)):this.screenBounds[1],g=u.polygonizeBounds(a,d,t),v=this.cameraPoint.clone();switch(3*((v.y>a.y)+(v.y>d.y))+((v.x>a.x)+(v.x>d.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(t,a,d,g=0){const v=t.queryPadding/a._pixelsPerMercatorPixel+1,E=d?this._bufferedCameraMercator(v,a):this._bufferedScreenMercator(v,a);let C=t.tileID.wrap+(E.unwrapped?g:0);const P=E.polygon.map(ce=>u.getTilePoint(t.tileTransform,ce,C));if(!u.polygonIntersectsBox(P,0,0,u.EXTENT,u.EXTENT))return;C=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const U=this.screenGeometryMercator.polygon.map(ce=>u.getTileVec3(t.tileTransform,ce,C)),V=U.map(ce=>new u.Point(ce[0],ce[1])),q=a.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),te=u.getTileVec3(t.tileTransform,q,C),oe=U.map(ce=>{const Y=u.sub(ce,ce,te);return u.normalize(Y,Y),new u.Ray(te,Y)}),ae=fn(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:V,tilespaceRays:oe,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(le=u.getBounds(P),le.min.x=u.clamp(le.min.x,0,u.EXTENT),le.min.y=u.clamp(le.min.y,0,u.EXTENT),le.max.x=u.clamp(le.max.x,0,u.EXTENT),le.max.y=u.clamp(le.max.y,0,u.EXTENT),le),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ae};var le}_bufferedScreenMercator(t,a){const d=vr(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g="globe"===a.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(t,a){const d=vr(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g="globe"===a.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(v=>a.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(t,a){const d=function(v,E){const C=u.multiply([],E.pixelMatrix,E.globeMatrix),P=[0,-u.GLOBE_RADIUS,0,1],U=[0,u.GLOBE_RADIUS,0,1],V=[0,0,0,1];u.transformMat4$1(P,P,C),u.transformMat4$1(U,U,C),u.transformMat4$1(V,V,C);const q=new u.Point(P[0]/P[3],P[1]/P[3]),te=new u.Point(U[0]/U[3],U[1]/U[3]),oe=u.polygonContainsPoint(v,q)&&P[3]<V[3],ae=u.polygonContainsPoint(v,te)&&U[3]<V[3];if(!oe&&!ae)return null;const le=function(Re,ze,Ne){for(let We=1;We<Re.length;We++){const Bt=Dn(ze.pointCoordinate3D(Re[We-1]).x),qe=Dn(ze.pointCoordinate3D(Re[We]).x);if(Ne<0){if(Bt<qe)return{idx:We,t:-Bt/(qe-1-Bt)}}else if(qe<Bt)return{idx:We,t:(1-Bt)/(qe+1-Bt)}}return null}(v,E,oe?-1:1);if(!le)return null;const{idx:ce,t:Y}=le;let se=ce>1?gr(v.slice(0,ce),E):[],fe=ce<v.length?gr(v.slice(ce),E):[];se=se.map(Re=>new u.Point(Dn(Re.x),Re.y)),fe=fe.map(Re=>new u.Point(Dn(Re.x),Re.y));const me=[...se];0===me.length&&me.push(fe[fe.length-1]);const Pe=u.number(me[me.length-1].y,(0===fe.length?se[0]:fe[0]).y,Y);let De;return De=oe?[new u.Point(0,Pe),new u.Point(0,0),new u.Point(1,0),new u.Point(1,Pe)]:[new u.Point(1,Pe),new u.Point(1,1),new u.Point(0,1),new u.Point(0,Pe)],me.push(...De),0===fe.length?me.push(se[0]):me.push(...fe),{polygon:me.map(Re=>new u.MercatorCoordinate(Re.x,Re.y)),unwrapped:!1}}(t,a);if(d)return d;const g=function(v,E){let C=!1,P=-1/0,U=0;for(let q=0;q<v.length-1;q++)v[q].x>P&&(P=v[q].x,U=q);for(let q=0;q<v.length-1;q++){const te=(U+q)%(v.length-1),oe=v[te],ae=v[te+1];Math.abs(oe.x-ae.x)>.5&&(oe.x<ae.x?(oe.x+=1,0===te&&(v[v.length-1].x+=1)):(ae.x+=1,te+1===v.length-1&&(v[0].x+=1)),C=!0)}const V=u.mercatorXfromLng(E.center.lng);return C&&V<Math.abs(V-1)&&v.forEach(q=>{q.x-=1}),{polygon:v,unwrapped:C}}(gr(t,a).map(v=>new u.Point(Dn(v.x),v.y)),a);return{polygon:g.polygon.map(v=>new u.MercatorCoordinate(v.x,v.y)),unwrapped:g.unwrapped}}}function gr(c,t){return u.resample(c,a=>{const d=t.pointCoordinate3D(a);a.x=d.x,a.y=d.y},1/256)}function Dn(c){return c<0?1+c%1:c%1}function vr(c){return 100*c|0}function li(c,t,a,d,g){const v=function(E,C){if(E)return g(E);if(C){c.url&&C.tiles&&c.tiles&&delete c.tiles;const P=u.pick(u.extend(C,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(P.vectorLayers=C.vector_layers,P.vectorLayerIds=P.vectorLayers.map(U=>U.id)),P.tiles=t.canonicalizeTileset(P,c.url),g(null,P)}};return c.url?u.getJSON(t.transformRequest(t.normalizeSourceURL(c.url,null,a,d),u.ResourceType.Source),v):u.exported.frame(()=>v(null,c))}class xr{constructor(t,a,d){this.bounds=u.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),d=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*a),g=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*a),v=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*a),E=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*a);return t.x>=d&&t.x<v&&t.y>=g&&t.y<E}}class Mi{constructor(t,a,d){this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Zr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ar{constructor(t,a,d,g){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=g,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const g=a.attributes[this.attributes[d].name];void 0!==g&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,a,d){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],E=a.attributes[v.name];void 0!==E&&t.vertexAttribPointer(E,v.components,t[Zr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ln{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zn extends ln{getDefault(){return u.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Si extends ln{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Wo extends ln{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Cr extends ln{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _r extends ln{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Mo extends ln{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class fi extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Nr extends ln{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ho extends ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class vn extends ln{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Fi extends ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class zr extends ln{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class si extends ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class fo extends ln{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class vs extends ln{getDefault(){return u.Color.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class kr extends ln{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Et extends ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class ve extends ln{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class we extends ln{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let ct,pt=class extends ln{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class mn extends ln{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class In extends ln{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class cr extends ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class gn extends ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Vr extends ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Tr extends ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class _e extends ln{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class X extends ln{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class ee extends ln{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class he extends ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ee extends ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ce extends ln{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Fe extends Ce{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Le extends Ce{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ie extends Le{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class $e{constructor(t,a,d,g){this.context=t,this.width=a,this.height=d;const v=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Fe(t,v),g&&(this.depthAttachment=new Le(t,v))}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const d=this.depthAttachment.get();d&&t.deleteRenderbuffer(d)}t.deleteFramebuffer(this.framebuffer)}}class xt{constructor(t,a=!1){if(this.gl=t,this.isWebGL2=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),a){const d=t;this.extVertexArrayObject={createVertexArrayOES:d.createVertexArray.bind(t),deleteVertexArrayOES:d.deleteVertexArray.bind(t),bindVertexArrayOES:d.bindVertexArray.bind(t)}}this.clearColor=new Zn(this),this.clearDepth=new Si(this),this.clearStencil=new Wo(this),this.colorMask=new Cr(this),this.depthMask=new _r(this),this.stencilMask=new Mo(this),this.stencilFunc=new fi(this),this.stencilOp=new Nr(this),this.stencilTest=new ho(this),this.depthRange=new vn(this),this.depthTest=new Fi(this),this.depthFunc=new zr(this),this.blend=new si(this),this.blendFunc=new fo(this),this.blendColor=new vs(this),this.blendEquation=new kr(this),this.cullFace=new Et(this),this.cullFaceSide=new ve(this),this.frontFace=new we(this),this.program=new pt(this),this.activeTexture=new mn(this),this.viewport=new In(this),this.bindFramebuffer=new cr(this),this.bindRenderbuffer=new gn(this),this.bindTexture=new Vr(this),this.bindVertexBuffer=new Tr(this),this.bindElementBuffer=new _e(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new X(this),this.pixelStoreUnpack=new ee(this),this.pixelStoreUnpackPremultiplyAlpha=new he(this),this.pixelStoreUnpackFlipY=new Ee(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),a||(this.extTextureHalfFloat=t.getExtension("OES_texture_half_float")),(a||this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a||t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Mi(this,t,a)}createVertexBuffer(t,a,d){return new Ar(this,t,a,d)}createRenderbuffer(t,a,d){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),v}createFramebuffer(t,a,d){return new $e(this,t,a,d)}clear({color:t,depth:a,stencil:d}){const g=this.gl;let v=0;t&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==a&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),void 0!==d&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(v)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Te(t.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ut extends u.Evented{constructor(t,a,d,g){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(a,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(t){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=li(this._options,this.map._requestManager,a,d,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&2!==d.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new u.ErrorEvent(g))):v&&(u.extend(this,v),v.bounds&&(this.tileBounds=new xr(v.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(t,a){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(d,u.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=a:t.request=t.actor.send("reloadTile",g,v.bind(this));else if(t.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const E=u.loadVectorTile.call({deduped:this._deduped},g,(C,P)=>{C||!P?v.call(this,C):(g.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},t.actor&&t.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);t.request={cancel:E}}function v(E,C){return delete t.request,t.aborted?a(null):E&&404!==E.status?a(E):(C&&C.resourceTiming&&(t.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&t.setExpiryData(C),t.loadVectorData(C,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class St extends u.Evented{constructor(t,a,d,g){super(),this.id=t,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},a),u.extend(this,u.pick(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=li(this._options,this.map._requestManager,null,null,(a,d)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new u.ErrorEvent(a)):d&&(u.extend(this,d),d.bounds&&(this.tileBounds=new xr(d.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(d.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),t&&t(a)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const d=u.exported.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=u.getImage(this.map._requestManager.transformRequest(g,u.ResourceType.Tile),(v,E,C,P)=>(delete t.request,t.aborted?(t.state="unloaded",a(null)):v?(t.state="errored",a(v)):E?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:C,expires:P}),t.setTexture(E,this.map.painter),t.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(t,a,d){t.setTexture(a,d)}static unloadTileData(t,a){t.texture&&a.saveTileTexture(t.texture)}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a()}unloadTile(t,a){t.texture&&this.map.painter.saveTileTexture(t.texture),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Tn(c,t,a,d,g,v,E,C){const P=[c,a,g,t,d,v,1,1,1],U=[E,C,1],V=u.adjoint([],P),[q,te,oe]=u.transformMat3(U,U,u.transpose(V,V));return u.multiply$1(P,[q,0,0,0,te,0,0,0,oe],P)}class $n extends u.Evented{constructor(t,a,d,g){super(),this.id=t,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=a,this._dirty=!1}load(t,a){this._loaded=a||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(d,g)=>{if(this._imageRequest=null,this._loaded=!0,d)this.fire(new u.ErrorEvent(d));else if(g){const{HTMLImageElement:v}=u.window;this.image=g instanceof v?u.exported.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const a=t.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(d){let g=1/0,v=1/0,E=-1/0,C=-1/0;for(const q of d)g=Math.min(g,q.x),v=Math.min(v,q.y),E=Math.max(E,q.x),C=Math.max(C,q.y);const P=Math.max(E-g,C-v),U=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),V=Math.pow(2,U);return new u.CanonicalTileID(U,Math.floor((g+E)/2*V),Math.floor((v+C)/2*V))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const P in this.tiles){const U=this.tiles[P];"loaded"!==U.state&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray)return;const a=u.tileTransform(this.tileID,this.map.transform.projection),[d,g,v,E]=this.coordinates.map(P=>{const U=a.projection.project(P[0],P[1]);return u.getTilePoint(a,U)._round()});this.perspectiveTransform=function(P,U,V,q,te,oe,ae,le,ce,Y){const se=Tn(0,0,P,0,0,U,P,U),fe=Tn(V,q,te,oe,ae,le,ce,Y);return u.multiply$1(fe,u.adjoint(se,se),fe),[fe[6]/fe[8]*P/u.EXTENT,fe[7]/fe[8]*U/u.EXTENT]}(this.width,this.height,d.x,d.y,g.x,g.y,E.x,E.y,v.x,v.y);const C=this._boundsArray=new u.StructArrayLayout4i8;C.emplaceBack(d.x,d.y,0,0),C.emplaceBack(g.x,g.y,u.EXTENT,0),C.emplaceBack(E.x,E.y,0,u.EXTENT),C.emplaceBack(v.x,v.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(C,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,a=t.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(t)}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Mn={vector:Ut,raster:St,"raster-dem":class extends St{constructor(c,t,a,d){super(c,t,a,d),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const a=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,v){g&&(c.state="errored",t(g)),v&&(c.dem=v,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=u.getImage(this.map._requestManager.transformRequest(a,u.ResourceType.Tile),function(g,v,E,C){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(g)c.state="errored",t(g);else if(v){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:E,expires:C});const P=u.window.ImageBitmap&&v instanceof u.window.ImageBitmap&&(null==ct&&(ct=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),ct),U=1-(v.width-u.prevPowerOfTwo(v.width))/2;U<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const V=P?v:u.exported.getImageData(v,U),q={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:V,encoding:this.encoding,padding:U};c.actor&&"expired"!==c.state||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",q,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const t=c.canonical,a=Math.pow(2,t.z),d=(t.x-1+a)%a,g=0===t.x?c.wrap-1:c.wrap,v=(t.x+1+a)%a,E=t.x+1===a?c.wrap+1:c.wrap,C={};return C[new u.OverscaledTileID(c.overscaledZ,g,t.z,d,t.y).key]={backfilled:!1},C[new u.OverscaledTileID(c.overscaledZ,E,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(C[new u.OverscaledTileID(c.overscaledZ,g,t.z,d,t.y-1).key]={backfilled:!1},C[new u.OverscaledTileID(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},C[new u.OverscaledTileID(c.overscaledZ,E,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<a&&(C[new u.OverscaledTileID(c.overscaledZ,g,t.z,d,t.y+1).key]={backfilled:!1},C[new u.OverscaledTileID(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},C[new u.OverscaledTileID(c.overscaledZ,E,t.z,v,t.y+1).key]={backfilled:!1}),C}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends u.Evented{constructor(c,t,a,d){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=t.data,this._options=u.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*g,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*g,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},t),this}getClusterLeaves(c,t,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:t,offset:a},d),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=u.extend({},this.workerOptions),t=this._data;"string"==typeof t?(c.request=this.map._requestManager.transformRequest(u.exported.resolveURL(t),u.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(a,d)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new u.ErrorEvent(a));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(g.resourceTiming=d.resourceTiming[this.id]),this.fire(new u.Event("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,t){const a=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(a,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(d,g)=>(delete c.request,c.unloadVectorData(),c.aborted?t(null):d?t(d):(c.loadVectorData(g,this.map.painter,"reloadTile"===a),t(null))),void 0,"loadTile"===a)}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends $n{constructor(c,t,a,d){super(c,t,a,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,u.ResourceType.Source).url);u.getVideo(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(c,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:$n,canvas:class extends $n{constructor(c,t,a,d){super(c,t,a,d),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(g=>!Array.isArray(g)||2!==g.length||g.some(v=>"number"!=typeof v))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends u.Evented{constructor(c,t,a,d){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new xr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:a,z:d}=c.canonical;return this._implementation.hasTile({x:t,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:a,y:d,z:g}=c.tileID.canonical,v=new u.window.AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:g},{signal:v.signal})).then(function(E){return delete c.request,c.aborted?(c.state="unloaded",t(null)):void 0===E?(c.state="errored",t(null)):null===E?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):(C=E)instanceof u.window.ImageData||C instanceof u.window.HTMLCanvasElement||C instanceof u.window.ImageBitmap||C instanceof u.window.HTMLImageElement?(this.loadTileData(c,E),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var C}.bind(this)).catch(E=>{20!==E.code&&(c.state="errored",t(E))}),c.request.cancel=()=>v.abort()}loadTileData(c,t){St.loadTileData(c,t,this._map.painter)}unloadTileData(c){St.unloadTileData(c,this._map.painter)}unloadTile(c,t){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:a,y:d,z:g}=c.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:g})}t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Rn=function(c,t,a,d){const g=new Mn[t.type](c,t,a,d);if(g.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${g.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],g),g};function Bn(c,t){const a=u.identity([]);return u.scale(a,a,[.5*c.width,.5*-c.height,1]),u.translate(a,a,[1,-1,0]),u.multiply(a,a,c.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(a)}function Mr(c,t,a,d,g,v,E,C=!1){const P=c.tilesIn(d,E,C);P.sort(je);const U=[];for(const q of P)U.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(t,a,c._state,q,g,v,Bn(c.transform,q.tile.tileID),C)});const V=function(q){const te={},oe={};for(const ae of q){const le=ae.queryResults,ce=ae.wrappedTileID,Y=oe[ce]=oe[ce]||{};for(const se in le){const fe=le[se],me=Y[se]=Y[se]||{},Pe=te[se]=te[se]||[];for(const De of fe)me[De.featureIndex]||(me[De.featureIndex]=!0,Pe.push(De))}}return te}(U);for(const q in V)V[q].forEach(te=>{const oe=te.feature,ae=oe.layer;ae&&"background"!==ae.type&&"sky"!==ae.type&&(oe.source=ae.source,ae["source-layer"]&&(oe.sourceLayer=ae["source-layer"]),oe.state=void 0!==oe.id?c.getFeatureState(ae["source-layer"],oe.id):{})});return V}function Ur(c,t){const a=c.getRenderableIds().map(v=>c.getTileByID(v)),d=[],g={};for(let v=0;v<a.length;v++){const E=a[v],C=E.tileID.canonical.key;g[C]||(g[C]=!0,E.querySourceFeatures(d,t))}return d}function je(c,t){const a=c.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function ke(){return null!=O.workerClass?new O.workerClass:new u.window.Worker(O.workerUrl)}const ge="mapboxgl_preloaded_worker_pool";class Ue{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Ue.workerCount;)this.workers.push(new ke);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ge]}numActive(){return Object.keys(this.active).length}}let at;function En(){return at||(at=new Ue),at}function Ln(c,t){const a={};for(const d in c)"ref"!==d&&(a[d]=c[d]);return u.refProperties.forEach(d=>{d in t&&(a[d]=t[d])}),a}function hr(c){c=c.slice();const t=Object.create(null);for(let a=0;a<c.length;a++)t[c[a].id]=c[a];for(let a=0;a<c.length;a++)"ref"in c[a]&&(c[a]=Ln(c[a],t[c[a].ref]));return c}Ue.workerCount=2;const wt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function On(c,t,a){a.push({command:wt.addSource,args:[c,t[c]]})}function Sr(c,t,a){t.push({command:wt.removeSource,args:[c]}),a[c]=!0}function _i(c,t,a,d){Sr(c,a,d),On(c,t,a)}function ro(c,t,a){let d;for(d in c[a])if(c[a].hasOwnProperty(d)&&"data"!==d&&!Te(c[a][d],t[a][d]))return!1;for(d in t[a])if(t[a].hasOwnProperty(d)&&"data"!==d&&!Te(c[a][d],t[a][d]))return!1;return!0}function Lr(c,t,a,d,g,v){let E;for(E in t=t||{},c=c||{})c.hasOwnProperty(E)&&(Te(c[E],t[E])||a.push({command:v,args:[d,E,t[E],g]}));for(E in t)t.hasOwnProperty(E)&&!c.hasOwnProperty(E)&&(Te(c[E],t[E])||a.push({command:v,args:[d,E,t[E],g]}))}function xi(c){return c.id}function Or(c,t){return c[t.id]=t,c}class $i{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=u.clamp(t,0,1);let a=1,d=this._distances[a];const g=t*this.paddedLength+this.padding;for(;d<g&&a<this._distances.length;)d=this._distances[++a];const v=a-1,E=this._distances[v],C=d-E,P=C>0?(g-E)/C:0;return this.points[v].mult(1-P).add(this.points[a].mult(P))}}class Gi{constructor(t,a,d){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,g,v){this._forEachCell(a,d,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(t,a,d,g){this._forEachCell(a-g,d-g,a+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(g)}_insertBoxCell(t,a,d,g,v,E){this.boxCells[v].push(E)}_insertCircleCell(t,a,d,g,v,E){this.circleCells[v].push(E)}_query(t,a,d,g,v,E){if(d<0||t>this.width||g<0||a>this.height)return!v&&[];const C=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=g){if(v)return!0;for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const U=this.circles[3*P],V=this.circles[3*P+1],q=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:U-q,y1:V-q,x2:U+q,y2:V+q})}return E?C.filter(E):C}return this._forEachCell(t,a,d,g,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?C.length>0:C}_queryCircle(t,a,d,g,v){const E=t-d,C=t+d,P=a-d,U=a+d;if(C<0||E>this.width||U<0||P>this.height)return!g&&[];const V=[];return this._forEachCell(E,P,C,U,this._queryCellCircle,V,{hitTest:g,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},v),g?V.length>0:V}query(t,a,d,g,v){return this._query(t,a,d,g,!1,v)}hitTest(t,a,d,g,v){return this._query(t,a,d,g,!0,v)}hitTestCircle(t,a,d,g){return this._queryCircle(t,a,d,!0,g)}_queryCell(t,a,d,g,v,E,C,P){const U=C.seenUids,V=this.boxCells[v];if(null!==V){const te=this.bboxes;for(const oe of V)if(!U.box[oe]){U.box[oe]=!0;const ae=4*oe;if(t<=te[ae+2]&&a<=te[ae+3]&&d>=te[ae+0]&&g>=te[ae+1]&&(!P||P(this.boxKeys[oe]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[oe],x1:te[ae],y1:te[ae+1],x2:te[ae+2],y2:te[ae+3]})}}}const q=this.circleCells[v];if(null!==q){const te=this.circles;for(const oe of q)if(!U.circle[oe]){U.circle[oe]=!0;const ae=3*oe;if(this._circleAndRectCollide(te[ae],te[ae+1],te[ae+2],t,a,d,g)&&(!P||P(this.circleKeys[oe]))){if(C.hitTest)return E.push(!0),!0;{const le=te[ae],ce=te[ae+1],Y=te[ae+2];E.push({key:this.circleKeys[oe],x1:le-Y,y1:ce-Y,x2:le+Y,y2:ce+Y})}}}}}_queryCellCircle(t,a,d,g,v,E,C,P){const U=C.circle,V=C.seenUids,q=this.boxCells[v];if(null!==q){const oe=this.bboxes;for(const ae of q)if(!V.box[ae]){V.box[ae]=!0;const le=4*ae;if(this._circleAndRectCollide(U.x,U.y,U.radius,oe[le+0],oe[le+1],oe[le+2],oe[le+3])&&(!P||P(this.boxKeys[ae])))return E.push(!0),!0}}const te=this.circleCells[v];if(null!==te){const oe=this.circles;for(const ae of te)if(!V.circle[ae]){V.circle[ae]=!0;const le=3*ae;if(this._circlesCollide(oe[le],oe[le+1],oe[le+2],U.x,U.y,U.radius)&&(!P||P(this.circleKeys[ae])))return E.push(!0),!0}}}_forEachCell(t,a,d,g,v,E,C,P){const U=this._convertToXCellCoord(t),V=this._convertToYCellCoord(a),q=this._convertToXCellCoord(d),te=this._convertToYCellCoord(g);for(let oe=U;oe<=q;oe++)for(let ae=V;ae<=te;ae++)if(v.call(this,t,a,d,g,this.xCellCount*ae+oe,E,C,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,g,v,E){const C=g-t,P=v-a,U=d+E;return U*U>C*C+P*P}_circleAndRectCollide(t,a,d,g,v,E,C){const P=(E-g)/2,U=Math.abs(t-(g+P));if(U>P+d)return!1;const V=(C-v)/2,q=Math.abs(a-(v+V));if(q>V+d)return!1;if(U<=P||q<=V)return!0;const te=U-P,oe=q-V;return te*te+oe*oe<=d*d}}const zn_unknown=0,zn_flipRequired=1,zn_flipNotRequired=2,zs=Math.tan(85*Math.PI/180);function rt(c,t,a,d,g,v,E){const C=u.create();if(a)if("globe"===v.name){const P=u.calculateGlobeLabelMatrix(g,t);u.multiply(C,C,P)}else{const P=Ge([],E);C[0]=P[0],C[1]=P[1],C[4]=P[2],C[5]=P[3],d||u.rotateZ(C,C,g.angle)}else u.multiply(C,g.labelPlaneMatrix,c);return C}function io(c,t,a,d,g,v,E){const C=rt(c,t,a,d,g,v,E);return"globe"===v.name&&a||(C[2]=C[6]=C[10]=C[14]=0),C}function Ir(c,t,a,d,g,v,E){if(a){if("globe"===v.name){const C=rt(c,t,a,d,g,v,E);return u.invert(C,C),u.multiply(C,c,C),C}{const C=u.clone(c),P=u.identity([]);return P[0]=E[0],P[1]=E[1],P[4]=E[2],P[5]=E[3],u.multiply(C,C,P),d||u.rotateZ(C,C,-g.angle),C}}return g.glCoordMatrix}function rr(c,t,a,d){const g=[c,t,a,1];a?u.transformMat4$1(g,g,d):Pn(g,g,d);const v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function po(c,t){return Math.min(.5+c/t*.5,1.5)}function Ai(c,t){const a=c[0]/c[3],d=c[1]/c[3];return a>=-t[0]&&a<=t[0]&&d>=-t[1]&&d<=t[1]}function Ii(c,t,a,d,g,v,E,C,P,U){const V=a.transform,q=d?c.textSizeData:c.iconSizeData,te=u.evaluateSizeForZoom(q,a.transform.zoom),oe="globe"===V.projection.name,ae=[256/a.width*2+1,256/a.height*2+1],le=d?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;le.clear();let ce=null;oe&&(ce=d?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const Y=c.lineVertexArray,se=d?c.text.placedSymbolArray:c.icon.placedSymbolArray,fe=a.transform.width/a.transform.height;let me,Pe=!1;for(let De=0;De<se.length;De++){const Re=se.get(De),{numGlyphs:ze,writingMode:Ne}=Re;if(Ne!==u.WritingMode.vertical||Pe||me===u.WritingMode.horizontal||(Pe=!0),me=Ne,(Re.hidden||Ne===u.WritingMode.vertical)&&!Pe){bi(ze,le);continue}Pe=!1;const We=new u.Point(Re.tileAnchorX,Re.tileAnchorY);let{x:Bt,y:qe,z:mt}=V.projection.projectTilePoint(We.x,We.y,U.canonical);if(P){const[Un,hn,Sn]=P(We);Bt+=Un,qe+=hn,mt+=Sn}const Qe=[Bt,qe,mt,1];if(u.transformMat4$1(Qe,Qe,t),!Ai(Qe,ae)){bi(ze,le);continue}const Lt=po(a.transform.cameraToCenterDistance,Qe[3]),Ye=u.evaluateSizeForFeature(q,te,Re),ut=E?Ye/Lt:Ye*Lt,zt=rr(Bt,qe,mt,g);if(zt[3]<=0){bi(ze,le);continue}let Ct={};const Ot=E?null:P,_n=Rt(Re,ut,!1,C,t,g,v,c.glyphOffsetArray,Y,le,ce,zt,We,Ct,fe,Ot,V.projection,U,E);Pe=_n.useVertical,Ot&&_n.needsFlipping&&(Ct={}),(_n.notEnoughRoom||Pe||_n.needsFlipping&&Rt(Re,ut,!0,C,t,g,v,c.glyphOffsetArray,Y,le,ce,zt,We,Ct,fe,Ot,V.projection,U,E).notEnoughRoom)&&bi(ze,le)}d?(c.text.dynamicLayoutVertexBuffer.updateData(le),ce&&c.text.globeExtVertexBuffer.updateData(ce)):(c.icon.dynamicLayoutVertexBuffer.updateData(le),ce&&c.icon.globeExtVertexBuffer.updateData(ce))}function Xo(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le){const{lineStartIndex:ce,glyphStartIndex:Y,segment:se}=C,fe=Y+C.numGlyphs,me=ce+C.lineLength,Pe=t.getoffsetX(Y),De=t.getoffsetX(fe-1),Re=yi(c*Pe,a,d,g,v,E,se,ce,me,P,U,V,q,te,!0,oe,ae,le);if(!Re)return null;const ze=yi(c*De,a,d,g,v,E,se,ce,me,P,U,V,q,te,!0,oe,ae,le);return ze?{first:Re,last:ze}:null}function So(c,t,a,d){return c===u.WritingMode.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:c===u.WritingMode.vertical?d>0?{needsFlipping:!0}:null:t!==zn_unknown&&(0===(g=a)||Math.abs(d/g)>zs)?t===zn_flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null;var g}function Rt(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le,ce,Y,se){const fe=t/24,me=c.lineOffsetX*fe,Pe=c.lineOffsetY*fe,{lineStartIndex:De,glyphStartIndex:Re,numGlyphs:ze,segment:Ne,writingMode:We,flipState:Bt}=c,qe=De+c.lineLength,mt=Qe=>{if(V){const[zt,Ct,Ot]=Qe.up,_n=U.length;u.updateGlobeVertexNormal(V,_n+0,zt,Ct,Ot),u.updateGlobeVertexNormal(V,_n+1,zt,Ct,Ot),u.updateGlobeVertexNormal(V,_n+2,zt,Ct,Ot),u.updateGlobeVertexNormal(V,_n+3,zt,Ct,Ot)}const[Lt,Ye,ut]=Qe.point;u.addDynamicAttributes(U,Lt,Ye,ut,Qe.angle)};if(ze>1){const Qe=Xo(fe,C,me,Pe,a,q,te,c,P,v,oe,le,!1,ce,Y,se);if(!Qe)return{notEnoughRoom:!0};if(d&&!a){let[Lt,Ye,ut]=Qe.first.point,[zt,Ct,Ot]=Qe.last.point;[Lt,Ye]=rr(Lt,Ye,ut,E),[zt,Ct]=rr(zt,Ct,Ot,E);const _n=So(We,Bt,(zt-Lt)*ae,Ct-Ye);if(c.flipState=_n&&_n.needsFlipping?zn_flipRequired:zn_flipNotRequired,_n)return _n}mt(Qe.first);for(let Lt=Re+1;Lt<Re+ze-1;Lt++){const Ye=yi(fe*C.getoffsetX(Lt),me,Pe,a,q,te,Ne,De,qe,P,v,oe,le,!1,!1,ce,Y,se);if(!Ye)return U.length-=4*(Lt-Re),{notEnoughRoom:!0};mt(Ye)}mt(Qe.last)}else{if(d&&!a){const Lt=rr(te.x,te.y,0,g),Ye=De+Ne+1,ut=new u.Point(P.getx(Ye),P.gety(Ye)),zt=rr(ut.x,ut.y,0,g),Ct=zt[3]>0?zt:Vn(te,ut,Lt,1,g,void 0,ce,Y.canonical),Ot=So(We,Bt,(Ct[0]-Lt[0])*ae,Ct[1]-Lt[1]);if(c.flipState=Ot&&Ot.needsFlipping?zn_flipRequired:zn_flipNotRequired,Ot)return Ot}const Qe=yi(fe*C.getoffsetX(Re),me,Pe,a,q,te,Ne,De,qe,P,v,oe,le,!1,!1,ce,Y,se);if(!Qe)return{notEnoughRoom:!0};mt(Qe)}return{}}function Gn(c,t,a,d,g){const{x:v,y:E,z:C}=d.projectTilePoint(c.x,c.y,t);if(!g)return rr(v,E,C,a);const[P,U,V]=g(c);return rr(v+P,E+U,C+V,a)}function Vn(c,t,a,d,g,v,E,C){const P=Gn(c.sub(t)._unit()._add(c),C,g,E,v);return u.sub(P,a,P),u.normalize(P,P),u.scaleAndAdd(P,a,P,d)}function yi(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le,ce,Y){const se=d?c-t:c+t;let fe=se>0?1:-1,me=0;d&&(fe*=-1,me=Math.PI),fe<0&&(me+=Math.PI);let Pe=C+E+(fe>0?0:1)|0,De=g,Re=g,ze=0,Ne=0;const We=Math.abs(se),Bt=[],qe=[];let mt=v,Qe=mt;const Lt=()=>Vn(Qe,mt,Re,We-ze+1,V,te,le,ce.canonical);for(;ze+Ne<=We;){if(Pe+=fe,Pe<C||Pe>=P)return null;if(Re=De,Qe=mt,Bt.push(Re),oe&&qe.push(Qe),mt=new u.Point(U.getx(Pe),U.gety(Pe)),De=q[Pe],!De){const Sn=Gn(mt,ce.canonical,V,le,te);De=Sn[3]>0?q[Pe]=Sn:Lt()}ze+=Ne,Ne=u.distance(Re,De)}ae&&te&&(q[Pe]&&(De=Lt(),Ne=u.distance(Re,De)),q[Pe]=De);const Ye=(We-ze)/Ne,ut=mt.sub(Qe)._mult(Ye)._add(Qe),zt=u.sub([],De,Re),Ct=u.scaleAndAdd([],Re,zt,Ye);let Ot=[0,0,1],_n=zt[0],Un=zt[1];if(Y&&(Ot=le.upVector(ce.canonical,ut.x,ut.y),0!==Ot[0]||0!==Ot[1]||1!==Ot[2])){const Sn=[Ot[2],0,-Ot[0]],Qn=u.cross([],Ot,Sn);u.normalize(Sn,Sn),u.normalize(Qn,Qn),_n=u.dot(zt,Sn),Un=u.dot(zt,Qn)}if(a){const Sn=u.cross([],Ot,zt);u.normalize(Sn,Sn),u.scaleAndAdd(Ct,Ct,Sn,a*fe)}const hn=me+Math.atan2(Un,_n);return Bt.push(Ct),oe&&qe.push(ut),{point:Ct,angle:hn,path:Bt,tilePath:qe,up:Ot}}function bi(c,t){const a=t.length,d=a+4*c;t.resize(d),t.float32.fill(-1/0,4*a,4*d)}function Pn(c,t,a){const d=t[0],g=t[1];return c[0]=a[0]*d+a[4]*g+a[12],c[1]=a[1]*d+a[5]*g+a[13],c[3]=a[3]*d+a[7]*g+a[15],c}const Hi=100;class mo{constructor(t,a,d=new Gi(t.width+200,t.height+200,25),g=new Gi(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Hi,this.screenBottomBoundary=t.height+Hi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,d,g,v,E,C,P){let U=d.projectedAnchorX,V=d.projectedAnchorY,q=d.projectedAnchorZ;const te=d.elevation,oe=d.tileID,ae=t.getProjection();if(te&&oe){const[De,Re,ze]=ae.upVector(oe.canonical,d.tileAnchorX,d.tileAnchorY),Ne=ae.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=De*te*Ne,V+=Re*te*Ne,q+=ze*te*Ne}const le=this.projectAndGetPerspectiveRatio(C,U,V,q,d.tileID,"globe"===ae.name||!!te||this.transform.pitch>0,ae),ce=E*le.perspectiveRatio,Y=(d.x1*a+g.x-d.padding)*ce+le.point.x,se=(d.y1*a+g.y-d.padding)*ce+le.point.y,fe=(d.x2*a+g.x+d.padding)*ce+le.point.x,me=(d.y2*a+g.y+d.padding)*ce+le.point.y,Pe=le.perspectiveRatio<=.55||le.occluded;return!this.isInsideGrid(Y,se,fe,me)||!v&&this.grid.hitTest(Y,se,fe,me,P)||Pe?{box:[],offscreen:!1,occluded:le.occluded}:{box:[Y,se,fe,me],offscreen:this.isOffscreen(Y,se,fe,me),occluded:!1}}placeCollisionCircles(t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le){const ce=[],Y=this.transform.elevation,se=t.getProjection(),fe=Y?Y.getAtTileOffsetFunc(le,this.transform.center.lat,this.transform.worldSize,se):null,me=new u.Point(d.tileAnchorX,d.tileAnchorY);let{x:Pe,y:De,z:Re}=se.projectTilePoint(me.x,me.y,le.canonical);if(fe){const[ut,zt,Ct]=fe(me);Pe+=ut,De+=zt,Re+=Ct}const ze="globe"===se.name,Ne=this.projectAndGetPerspectiveRatio(C,Pe,De,Re,le,ze||!!Y||this.transform.pitch>0,se),{perspectiveRatio:We}=Ne,Bt=(q?E/We:E*We)/u.ONE_EM,qe=rr(Pe,De,Re,P),mt=Ne.signedDistanceFromCamera>0?Xo(Bt,v,d.lineOffsetX*Bt,d.lineOffsetY*Bt,!1,qe,me,d,g,P,{},Y&&!q?fe:null,q&&!!Y,se,le,q):null;let Qe=!1,Lt=!1,Ye=!0;if(mt&&!Ne.occluded){const ut=.5*oe*We+ae,zt=new u.Point(-100,-100),Ct=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),Ot=new $i,{first:_n,last:Un}=mt,hn=_n.path.length;let Sn=[];for(let yn=hn-1;yn>=1;yn--)Sn.push(_n.path[yn]);for(let yn=1;yn<Un.path.length;yn++)Sn.push(Un.path[yn]);const Qn=2.5*ut;U&&(Sn=Sn.map(([yn,Fr,$r],Yr)=>(fe&&!ze&&($r=fe(Yr<hn-1?_n.tilePath[hn-1-Yr]:Un.tilePath[Yr-hn+2])[2]),rr(yn,Fr,$r,U))),Sn.some(yn=>yn[3]<=0)&&(Sn=[]));let er=[];if(Sn.length>0){let yn=1/0,Fr=-1/0,$r=1/0,Yr=-1/0;for(const ni of Sn)yn=Math.min(yn,ni[0]),$r=Math.min($r,ni[1]),Fr=Math.max(Fr,ni[0]),Yr=Math.max(Yr,ni[1]);Fr>=zt.x&&yn<=Ct.x&&Yr>=zt.y&&$r<=Ct.y&&(er=[Sn.map(ni=>new u.Point(ni[0],ni[1]))],(yn<zt.x||Fr>Ct.x||$r<zt.y||Yr>Ct.y)&&(er=u.clipLine(er,zt.x,zt.y,Ct.x,Ct.y)))}for(const yn of er){Ot.reset(yn,.25*ut);let Fr=0;Fr=Ot.length<=.5*ut?1:Math.ceil(Ot.paddedLength/Qn)+1;for(let $r=0;$r<Fr;$r++){const Yr=$r/Math.max(Fr-1,1),ni=Ot.lerp(Yr),Go=ni.x+Hi,Eo=ni.y+Hi;ce.push(Go,Eo,ut,0);const ta=Go-ut,Rs=Eo-ut,hi=Go+ut,Kr=Eo+ut;if(Ye=Ye&&this.isOffscreen(ta,Rs,hi,Kr),Lt=Lt||this.isInsideGrid(ta,Rs,hi,Kr),!a&&this.grid.hitTestCircle(Go,Eo,ut,te)&&(Qe=!0,!V))return{circles:[],offscreen:!1,collisionDetected:Qe,occluded:!1}}}}return{circles:!V&&Qe||!Lt?[]:ce,offscreen:Ye,collisionDetected:Qe,occluded:Ne.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const a=[];let d=1/0,g=1/0,v=-1/0,E=-1/0;for(const V of t){const q=new u.Point(V.x+Hi,V.y+Hi);d=Math.min(d,q.x),g=Math.min(g,q.y),v=Math.max(v,q.x),E=Math.max(E,q.y),a.push(q)}const C=this.grid.query(d,g,v,E).concat(this.ignoredGrid.query(d,g,v,E)),P={},U={};for(const V of C){const q=V.key;if(void 0===P[q.bucketInstanceId]&&(P[q.bucketInstanceId]={}),P[q.bucketInstanceId][q.featureIndex])continue;const te=[new u.Point(V.x1,V.y1),new u.Point(V.x2,V.y1),new u.Point(V.x2,V.y2),new u.Point(V.x1,V.y2)];u.polygonIntersectsPolygon(a,te)&&(P[q.bucketInstanceId][q.featureIndex]=!0,void 0===U[q.bucketInstanceId]&&(U[q.bucketInstanceId]=[]),U[q.bucketInstanceId].push(q.featureIndex))}return U}insertCollisionBox(t,a,d,g,v){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,g,v){const E=a?this.ignoredGrid:this.grid,C={bucketInstanceId:d,featureIndex:g,collisionGroupID:v};for(let P=0;P<t.length;P+=4)E.insertCircle(C,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,a,d,g,v,E,C){const P=[a,d,g,1];let U=!1;g||this.transform.pitch>0?(u.transformMat4$1(P,P,t),this.fogState&&v&&"globe"!==C.name&&(U=function(te,oe,ae,le,ce,Y){const se=Y.calculateFogTileMatrix(ce),fe=[oe,ae,le];return u.transformMat4(fe,fe,se),He(te,fe,Y.pitch,Y._fov)}(this.fogState,a,d,g,v.toUnwrapped(),this.transform)>.9)):Pn(P,P,t);const V=P[3];return{point:new u.Point((P[0]/V+1)/2*this.transform.width+Hi,(-P[1]/V+1)/2*this.transform.height+Hi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/V*.5,1.5),signedDistanceFromCamera:V,occluded:E&&P[2]>V||U}}isOffscreen(t,a,d,g){return d<Hi||t>=this.screenRightBoundary||g<Hi||a>this.screenBottomBoundary}isInsideGrid(t,a,d,g){return d>=0&&t<this.gridRightBoundary&&g>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=u.identity([]);return u.translate(t,t,[-100,-100,0]),t}}function qr(c,t,a){const d=t.createTileMatrix(c,c.worldSize,a.toUnwrapped());return u.multiply(new Float32Array(16),c.projMatrix,d)}function go(c,t,a){if(t.projection.name===a.projection.name)return c.projMatrix;const d=a.clone();return d.setProjection(t.projection),qr(d,t.getProjection(),c)}function sr(c,t,a){return t.name===a.projection.name?c.projMatrix:qr(a,t,c)}class vi{constructor(t,a,d,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):g&&d?1:0,this.placed=d}isHidden(){return 0===this.opacity&&!this.placed}}class Ao{constructor(t,a,d,g,v,E=!1){this.text=new vi(t?t.text:null,a,d,v),this.icon=new vi(t?t.icon:null,a,g,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wr{constructor(t,a,d,g=!1){this.text=t,this.icon=a,this.skipFade=d,this.clipped=g}}class _o{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Yi{constructor(t,a,d,g,v){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=v}}class Ga{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function ra(c,t,a,d,g){const{horizontalAlign:v,verticalAlign:E}=u.getAnchorAlignment(c),C=-(v-.5)*t,P=-(E-.5)*a,U=u.evaluateVariableOffset(c,d);return new u.Point(C+U[0]*g,P+U[1]*g)}function ia(c,t,a,d,g){const v=new u.Point(c,t);return a&&v._rotate(d?g:-g),v}class xa{constructor(t,a,d,g,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new mo(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Ga(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,d,g){const v=d.getBucket(a),E=d.latestFeatureIndex;if(!v||!E||a.id!==v.layerIds[0])return;const C=v.layers[0].layout,P=d.collisionBoxArray,U=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),V=d.tileSize/u.EXTENT,q=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);const te=(oe=d.tileID,ae=v.getProjection(),le=this.transform,ae.name===this.projection?le.calculateProjMatrix(oe.toUnwrapped()):qr(le,ae,oe));var oe,ae,le;const ce="map"===C.get("text-pitch-alignment"),Y="map"===C.get("text-rotation-alignment");a.compileFilter();const se=a.dynamicFilter(),fe=a.dynamicFilterNeedsFeature(),me=this.transform.calculatePixelsToTileUnitsMatrix(d),Pe=io(te,d.tileID.canonical,ce,Y,this.transform,v.getProjection(),me);let De=null;if(ce){const Ne=Ir(te,d.tileID.canonical,ce,Y,this.transform,v.getProjection(),me);De=u.multiply([],this.transform.labelPlaneMatrix,Ne)}let Re=null;se&&d.latestFeatureIndex&&(Re={unwrappedTileID:q,dynamicFilter:se,dynamicFilterNeedsFeature:fe,featureIndex:d.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Yi(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,d.tileID);const ze={bucket:v,layout:C,posMatrix:te,textLabelPlaneMatrix:Pe,labelToScreenMatrix:De,clippingData:Re,scale:U,textPixelRatio:V,holdingForFade:d.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Ne of v.sortKeyRanges){const{sortKey:We,symbolInstanceStart:Bt,symbolInstanceEnd:qe}=Ne;t.push({sortKey:We,symbolInstanceStart:Bt,symbolInstanceEnd:qe,parameters:ze})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le,ce,Y,se){const{textOffset0:fe,textOffset1:me,crossTileID:Pe}=te,De=[fe,me],Re=ra(t,d,g,De,v),ze=this.collisionIndex.placeCollisionBox(ae,v,a,ia(Re.x,Re.y,E,C,this.transform.angle),q,P,U,V.predicate);if(ce){const Ne=ae.getSymbolInstanceIconSize(se,this.transform.zoom,te.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ae,Ne,ce,ia(Re.x,Re.y,E,C,this.transform.angle),q,P,U,V.predicate).box.length)return}if(ze.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[Pe]&&this.prevPlacement.placements[Pe]&&this.prevPlacement.placements[Pe].text&&(Ne=this.prevPlacement.variableOffsets[Pe].anchor),this.variableOffsets[Pe]={textOffset:De,width:d,height:g,anchor:t,textScale:v,prevAnchor:Ne},this.markUsedJustification(ae,t,te,le),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,le,te),this.placedOrientations[Pe]=le),{shift:Re,placedGlyphBoxes:ze}}}placeLayerBucketPart(t,a,d,g){const{bucket:v,layout:E,posMatrix:C,textLabelPlaneMatrix:P,labelToScreenMatrix:U,clippingData:V,textPixelRatio:q,holdingForFade:te,collisionBoxArray:oe,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:le,collisionGroup:ce}=t.parameters,Y=E.get("text-optional"),se=E.get("icon-optional"),fe=E.get("text-allow-overlap"),me=E.get("icon-allow-overlap"),Pe="map"===E.get("text-rotation-alignment"),De="map"===E.get("text-pitch-alignment"),Re="none"!==E.get("icon-text-fit"),ze="viewport-y"===E.get("symbol-z-order");this.transform.setProjection(v.projection);let Ne=fe&&(me||!v.hasIconData()||se),We=me&&(fe||!v.hasTextData()||Y);!v.collisionArrays&&oe&&v.deserializeCollisionBoxes(oe),d&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,oe);const Bt=(qe,mt,Qe)=>{const{crossTileID:Lt,numVerticalGlyphVertices:Ye}=qe;if(V){const hi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Kr=null;if(V.dynamicFilterNeedsFeature){const Pr=this.retainedQueryData[v.bucketInstanceId];Kr=V.featureIndex.loadFeature({featureIndex:qe.featureIndex,bucketIndex:Pr.bucketIndex,sourceLayerIndex:Pr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,V.dynamicFilter)(hi,Kr,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new u.Point(qe.tileAnchorX,qe.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[Lt]=new Wr(!1,!1,!1,!0),void a.add(Lt)}if(a.has(Lt))return;if(te)return void(this.placements[Lt]=new Wr(!1,!1,!1));let ut=!1,zt=!1,Ct=!0,Ot=!1,_n=!1,Un=null,hn={box:null,offscreen:null,occluded:null},Sn={box:null,offscreen:null,occluded:null},Qn=null,er=null,yn=null,Fr=0,$r=0,Yr=0;Qe.textFeatureIndex?Fr=Qe.textFeatureIndex:qe.useRuntimeCollisionCircles&&(Fr=qe.featureIndex),Qe.verticalTextFeatureIndex&&($r=Qe.verticalTextFeatureIndex);const ni=hi=>{hi.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Kr=this.transform.elevation;(Kr||hi.elevation)&&(hi.elevation=Kr?Kr.getAtTileOffset(hi.tileID,hi.tileAnchorX,hi.tileAnchorY):0)},Go=Qe.textBox;if(Go){ni(Go);const hi=Pr=>{let eo=u.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Pr&&this.prevPlacement){const Ho=this.prevPlacement.placedOrientations[Lt];Ho&&(this.placedOrientations[Lt]=Ho,eo=Ho,this.markUsedOrientation(v,eo,qe))}return eo},Kr=(Pr,eo)=>{if(v.allowVerticalPlacement&&Ye>0&&Qe.verticalTextBox){for(const Ho of v.writingModes)if(Ho===u.WritingMode.vertical?(hn=eo(),Sn=hn):hn=Pr(),hn&&hn.box&&hn.box.length)break}else hn=Pr()};if(E.get("text-variable-anchor")){let Pr=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt]){const mi=this.prevPlacement.variableOffsets[Lt];Pr.indexOf(mi.anchor)>0&&(Pr=Pr.filter(Zo=>Zo!==mi.anchor),Pr.unshift(mi.anchor))}const eo=(mi,Zo,Pu)=>{const Cl=v.getSymbolInstanceTextSize(ae,qe,this.transform.zoom,mt),Dl=(mi.x2-mi.x1)*Cl+2*mi.padding,pa=(mi.y2-mi.y1)*Cl+2*mi.padding,Ls=Re&&!me?Zo:null;Ls&&ni(Ls);let Yl={box:[],offscreen:!1,occluded:!1};const Ru=fe?2*Pr.length:Pr.length;for(let Lu=0;Lu<Ru;++Lu){const Tc=this.attemptAnchorPlacement(Pr[Lu%Pr.length],mi,Dl,pa,Cl,Pe,De,q,C,ce,Lu>=Pr.length,qe,mt,v,Pu,Ls,ae,le);if(Tc&&(Yl=Tc.placedGlyphBoxes,Yl&&Yl.box&&Yl.box.length)){ut=!0,Un=Tc.shift;break}}return Yl};Kr(()=>eo(Go,Qe.iconBox,u.WritingMode.horizontal),()=>{const mi=Qe.verticalTextBox;return mi&&ni(mi),v.allowVerticalPlacement&&!(hn&&hn.box&&hn.box.length)&&Ye>0&&mi?eo(mi,Qe.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),hn&&(ut=hn.box,Ct=hn.offscreen,Ot=hn.occluded);const Ho=hi(!(!hn||!hn.box));if(!ut&&this.prevPlacement){const mi=this.prevPlacement.variableOffsets[Lt];mi&&(this.variableOffsets[Lt]=mi,this.markUsedJustification(v,mi.anchor,qe,Ho))}}else{const Pr=(eo,Ho)=>{const mi=v.getSymbolInstanceTextSize(ae,qe,this.transform.zoom,mt),Zo=this.collisionIndex.placeCollisionBox(v,mi,eo,new u.Point(0,0),fe,q,C,ce.predicate);return Zo&&Zo.box&&Zo.box.length&&(this.markUsedOrientation(v,Ho,qe),this.placedOrientations[Lt]=Ho),Zo};Kr(()=>Pr(Go,u.WritingMode.horizontal),()=>{const eo=Qe.verticalTextBox;return v.allowVerticalPlacement&&Ye>0&&eo?(ni(eo),Pr(eo,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),hi(!!(hn&&hn.box&&hn.box.length))}}if(Qn=hn,ut=Qn&&Qn.box&&Qn.box.length>0,Ct=Qn&&Qn.offscreen,Ot=Qn&&Qn.occluded,qe.useRuntimeCollisionCircles){const hi=v.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex>=0?qe.centerJustifiedTextSymbolIndex:qe.verticalPlacedTextSymbolIndex),Kr=u.evaluateSizeForFeature(v.textSizeData,ae,hi),Pr=E.get("text-padding");er=this.collisionIndex.placeCollisionCircles(v,fe,hi,v.lineVertexArray,v.glyphOffsetArray,Kr,C,P,U,d,De,ce.predicate,qe.collisionCircleDiameter*Kr/u.ONE_EM,Pr,this.retainedQueryData[v.bucketInstanceId].tileID),ut=fe||er.circles.length>0&&!er.collisionDetected,Ct=Ct&&er.offscreen,Ot=er.occluded}if(Qe.iconFeatureIndex&&(Yr=Qe.iconFeatureIndex),Qe.iconBox){const hi=Kr=>{ni(Kr);const Pr=Re&&Un?ia(Un.x,Un.y,Pe,De,this.transform.angle):new u.Point(0,0),eo=v.getSymbolInstanceIconSize(le,this.transform.zoom,qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,eo,Kr,Pr,me,q,C,ce.predicate)};Sn&&Sn.box&&Sn.box.length&&Qe.verticalIconBox?(yn=hi(Qe.verticalIconBox),zt=yn.box.length>0):(yn=hi(Qe.iconBox),zt=yn.box.length>0),Ct=Ct&&yn.offscreen,_n=yn.occluded}const Eo=Y||0===qe.numHorizontalGlyphVertices&&0===Ye,ta=se||0===qe.numIconVertices;if(Eo||ta?ta?Eo||(zt=zt&&ut):ut=zt&&ut:zt=ut=zt&&ut,ut&&Qn&&Qn.box&&this.collisionIndex.insertCollisionBox(Qn.box,E.get("text-ignore-placement"),v.bucketInstanceId,Sn&&Sn.box&&$r?$r:Fr,ce.ID),zt&&yn&&this.collisionIndex.insertCollisionBox(yn.box,E.get("icon-ignore-placement"),v.bucketInstanceId,Yr,ce.ID),er&&(ut&&this.collisionIndex.insertCollisionCircles(er.circles,E.get("text-ignore-placement"),v.bucketInstanceId,Fr,ce.ID),d)){const hi=v.bucketInstanceId;let Kr=this.collisionCircleArrays[hi];void 0===Kr&&(Kr=this.collisionCircleArrays[hi]=new _o);for(let Pr=0;Pr<er.circles.length;Pr+=4)Kr.circles.push(er.circles[Pr+0]),Kr.circles.push(er.circles[Pr+1]),Kr.circles.push(er.circles[Pr+2]),Kr.circles.push(er.collisionDetected?1:0)}const Rs="globe"!==v.projection.name;Ne=Ne&&(Rs||!Ot),We=We&&(Rs||!_n),this.placements[Lt]=new Wr(ut||Ne,zt||We,Ct||v.justReloaded),a.add(Lt)};if(ze){const qe=v.getSortedSymbolIndexes(this.transform.angle);for(let mt=qe.length-1;mt>=0;--mt){const Qe=qe[mt];Bt(v.symbolInstances.get(Qe),Qe,v.collisionArrays[Qe])}}else for(let qe=t.symbolInstanceStart;qe<t.symbolInstanceEnd;qe++)Bt(v.symbolInstances.get(qe),qe,v.collisionArrays[qe]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[v.bucketInstanceId];u.invert(qe.invProjMatrix,C),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,a,d,g){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:P,crossTileID:U}=d,V=u.getAnchorJustification(a),q=g===u.WritingMode.vertical?P:"left"===V?v:"center"===V?E:"right"===V?C:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=q>=0&&v!==q?0:U),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=q>=0&&E!==q?0:U),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=q>=0&&C!==q?0:U),P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=q>=0&&P!==q?0:U)}markUsedOrientation(t,a,d){const g=a===u.WritingMode.horizontal||a===u.WritingMode.horizontalOnly?a:0,v=a===u.WritingMode.vertical?a:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:U}=d,V=t.text.placedSymbolArray;E>=0&&(V.get(E).placedOrientation=g),C>=0&&(V.get(C).placedOrientation=g),P>=0&&(V.get(P).placedOrientation=g),U>=0&&(V.get(U).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const g=a?a.symbolFadeChange(t):1,v=a?a.opacities:{},E=a?a.variableOffsets:{},C=a?a.placedOrientations:{};for(const P in this.placements){const U=this.placements[P],V=v[P];V?(this.opacities[P]=new Ao(V,g,U.text,U.icon,null,U.clipped),d=d||U.text!==V.text.placed||U.icon!==V.icon.placed):(this.opacities[P]=new Ao(null,g,U.text,U.icon,U.skipFade,U.clipped),d=d||U.text||U.icon)}for(const P in v){const U=v[P];if(!this.opacities[P]){const V=new Ao(U,g,!1,!1);V.isHidden()||(this.opacities[P]=V,d=d||U.text.placed||U.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);d?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const d=new Set;for(const g of a){const v=g.getBucket(t);v&&g.latestFeatureIndex&&t.id===v.layerIds[0]&&this.updateBucketOpacities(v,d,g.collisionBoxArray)}}updateBucketOpacities(t,a,d){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const g=t.layers[0].layout,v=!!t.layers[0].dynamicFilter(),E=new Ao(null,0,!1,!1,!0),C=g.get("text-allow-overlap"),P=g.get("icon-allow-overlap"),U=g.get("text-variable-anchor"),V="map"===g.get("text-rotation-alignment"),q="map"===g.get("text-pitch-alignment"),te="none"!==g.get("icon-text-fit"),oe=new Ao(null,0,C&&(P||!t.hasIconData()||g.get("icon-optional")),P&&(C||!t.hasTextData()||g.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const ae=(ce,Y,se)=>{for(let fe=0;fe<Y/4;fe++)ce.opacityVertexArray.emplaceBack(se)};let le=0;for(let ce=0;ce<t.symbolInstances.length;ce++){const Y=t.symbolInstances.get(ce),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:fe,crossTileID:me,numIconVertices:Pe}=Y,De=a.has(me);let Re=this.opacities[me];De?Re=E:Re||(Re=oe,this.opacities[me]=Re),a.add(me);const ze=se>0||fe>0,Ne=Pe>0,We=this.placedOrientations[me],Bt=We===u.WritingMode.vertical,qe=We===u.WritingMode.horizontal||We===u.WritingMode.horizontalOnly;if(!ze&&!Ne||Re.isHidden()||le++,ze){const mt=oa(Re.text);ae(t.text,se,Bt?ti:mt),ae(t.text,fe,qe?ti:mt);const Qe=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:Lt,centerJustifiedTextSymbolIndex:Ye,rightJustifiedTextSymbolIndex:ut,verticalPlacedTextSymbolIndex:zt}=Y,Ct=t.text.placedSymbolArray,Ot=Qe||Bt?1:0;Lt>=0&&(Ct.get(Lt).hidden=Ot),Ye>=0&&(Ct.get(Ye).hidden=Ot),ut>=0&&(Ct.get(ut).hidden=Ot),zt>=0&&(Ct.get(zt).hidden=Qe||qe?1:0);const _n=this.variableOffsets[me];_n&&this.markUsedJustification(t,_n.anchor,Y,We);const Un=this.placedOrientations[me];Un&&(this.markUsedJustification(t,"left",Y,Un),this.markUsedOrientation(t,Un,Y))}if(Ne){const mt=oa(Re.icon),{placedIconSymbolIndex:Qe,verticalPlacedIconSymbolIndex:Lt}=Y,Ye=t.icon.placedSymbolArray,ut=Re.icon.isHidden()?1:0;Qe>=0&&(ae(t.icon,Pe,Bt?ti:mt),Ye.get(Qe).hidden=ut),Lt>=0&&(ae(t.icon,Y.numVerticalIconVertices,qe?ti:mt),Ye.get(Lt).hidden=ut)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const mt=t.collisionArrays[ce];if(mt){let Qe=new u.Point(0,0),Lt=!0;if(mt.textBox||mt.verticalTextBox){if(U){const ut=this.variableOffsets[me];ut?(Qe=ra(ut.anchor,ut.width,ut.height,ut.textOffset,ut.textScale),V&&Qe._rotate(q?this.transform.angle:-this.transform.angle)):Lt=!1}v&&(Lt=!Re.clipped),mt.textBox&&Vs(t.textCollisionBox.collisionVertexArray,Re.text.placed,!Lt||Bt,Qe.x,Qe.y),mt.verticalTextBox&&Vs(t.textCollisionBox.collisionVertexArray,Re.text.placed,!Lt||qe,Qe.x,Qe.y)}const Ye=Lt&&Boolean(!qe&&mt.verticalIconBox);mt.iconBox&&Vs(t.iconCollisionBox.collisionVertexArray,Re.icon.placed,Ye,te?Qe.x:0,te?Qe.y:0),mt.verticalIconBox&&Vs(t.iconCollisionBox.collisionVertexArray,Re.icon.placed,!Ye,te?Qe.x:0,te?Qe.y:0)}}}if(t.fullyClipped=0===le,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ce=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ce.invProjMatrix,t.placementViewportMatrix=ce.viewportMatrix,t.collisionCircleArray=ce.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Vs(c,t,a,d,g){c.emplaceBack(t?1:0,a?1:0,d||0,g||0),c.emplaceBack(t?1:0,a?1:0,d||0,g||0),c.emplaceBack(t?1:0,a?1:0,d||0,g||0),c.emplaceBack(t?1:0,a?1:0,d||0,g||0)}const oo=Math.pow(2,25),pi=Math.pow(2,24),Ha=Math.pow(2,17),ml=Math.pow(2,16),Ki=Math.pow(2,9),Io=Math.pow(2,8),Za=Math.pow(2,1);function oa(c){if(0===c.opacity&&!c.placed)return 0;if(1===c.opacity&&c.placed)return 4294967295;const t=c.placed?1:0,a=Math.floor(127*c.opacity);return a*oo+t*pi+a*Ha+t*ml+a*Ki+t*Io+a*Za+t}const ti=0;class xs{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,d,g,v){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(E,g,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(a.placeLayerBucketPart(C,this._seenCrossTileIDs,d,0===C.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class sa{constructor(t,a,d,g,v,E,C,P){this.placement=new xa(t,v,E,C,P),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d){const g=u.exported.now(),v=()=>{const E=u.exported.now()-g;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=a[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new xs(E)),this._inProgressLayer.continuePlacement(d[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Pi=512/u.EXTENT/2;class ci{constructor(t,a,d){this.tileID=t,this.bucketInstanceId=d,this.index=new u.KDBush(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*u.EXTENT,v=t.canonical.y*u.EXTENT;for(let E=0;E<a.length;E++){const{key:C,crossTileID:P,tileAnchorX:U,tileAnchorY:V}=a.get(E),q=Math.floor((g+U)*Pi),te=Math.floor((v+V)*Pi);this.index.add(q,te),this.keys.push(C),this.crossTileIDs.push(P)}this.index.finish()}findMatches(t,a,d){const g=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),v=Pi/Math.pow(2,a.canonical.z-this.tileID.canonical.z),E=a.canonical.x*u.EXTENT,C=a.canonical.y*u.EXTENT;for(let P=0;P<t.length;P++){const U=t.get(P);if(U.crossTileID)continue;const{key:V,tileAnchorX:q,tileAnchorY:te}=U,oe=Math.floor((E+q)*v),ae=Math.floor((C+te)*v),le=this.index.range(oe-g,ae-g,oe+g,ae+g);for(const ce of le){const Y=this.crossTileIDs[ce];if(this.keys[ce]===V&&!d.has(Y)){d.add(Y),U.crossTileID=Y;break}}}}}class bs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class os{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(0!==a)for(const d in this.indexes){const g=this.indexes[d],v={};for(const E in g){const C=g[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+a),v[C.tileID.key]=C}this.indexes[d]=v}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<a.symbolInstances.length;v++)a.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>t.overscaledZ)for(const C in E){const P=E[C];P.tileID.isChildOf(t)&&P.findMatches(a.symbolInstances,t,g)}else{const C=E[t.scaledTo(Number(v)).key];C&&C.findMatches(a.symbolInstances,t,g)}}for(let v=0;v<a.symbolInstances.length;v++){const E=a.symbolInstances.get(v);E.crossTileID||(E.crossTileID=d.generate(),g.add(E.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ci(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d of a.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const g=this.indexes[d];for(const v in g)t[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[v]),delete g[v],a=!0)}return a}}class yo{constructor(){this.layerIndexes={},this.crossTileIDs=new bs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d,g){let v=this.layerIndexes[t.id];void 0===v&&(v=this.layerIndexes[t.id]=new os);let E=!1;const C={};"globe"!==g.name&&v.handleWrapJump(d);for(const P of a){const U=P.getBucket(t);U&&t.id===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(P.tileID,U,this.crossTileIDs)&&(E=!0),C[U.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(t){const a={};t.forEach(d=>{a[d]=!0});for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const Zi=(c,t)=>u.emitValidationErrors(c,t&&t.filter(a=>"source.canvas"!==a.identifier)),qa=u.pick(wt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),ss=u.pick(wt,["setCenter","setZoom","setBearing","setPitch"]),ws={version:8,layers:[],sources:{}},zo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class so extends u.Evented{constructor(t,a={}){super(),this.map=t,this.dispatcher=new ht(En(),this),this.imageManager=new lr,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(t._requestManager,a.localFontFamily?u.LocalGlyphMode.all:a.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.crossTileSymbolIndex=new yo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const d=this;this._rtlTextPluginCallback=so.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,E)=>{if(u.triggerPluginCompletionEvent(v),E&&E.every(C=>C))for(const C in d._sourceCaches){const P=d._sourceCaches[C],U=P.getSource().type;"vector"!==U&&"geojson"!==U||P.reload()}})}),this.on("data",g=>{if("source"!==g.dataType||"metadata"!==g.sourceDataType)return;const v=this.getSource(g.sourceId);if(v&&v.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===v.id&&this._validateLayer(C)}})}loadURL(t,a={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const d="boolean"==typeof a.validate?a.validate:!u.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,a.accessToken);const g=this.map._requestManager.transformRequest(t,u.ResourceType.Style);this._request=u.getJSON(g,(v,E)=>{this._request=null,v?this.fire(new u.ErrorEvent(v)):E&&this._load(E,d)})}loadJSON(t,a={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(t,!1!==a.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(ws,!1)}_updateLayerCount(t,a){const d=a?1:-1;t.is3D()&&(this._num3DLayers+=d),"circle"===t.type&&(this._numCircleLayers+=d),"symbol"===t.type&&(this._numSymbolLayers+=d)}_load(t,a){if(a&&Zi(this,u.validateStyle(t)))return;this._loaded=!0,this.stylesheet=u.clone$1(t),this._updateMapProjection();for(const g in t.sources)this.addSource(g,t.sources[g],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const d=hr(this.stylesheet.layers);this._order=d.map(g=>g.id),this._layers={},this._serializedLayers={};for(const g of d){const v=u.createStyleLayer(g);v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ft(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(t){this._spriteRequest=function(a,d,g){let v,E,C;const P=u.exported.devicePixelRatio>1?"@2x":"";let U=u.getJSON(d.transformRequest(d.normalizeSpriteURL(a,P,".json"),u.ResourceType.SpriteJSON),(te,oe)=>{U=null,C||(C=te,v=oe,q())}),V=u.getImage(d.transformRequest(d.normalizeSpriteURL(a,P,".png"),u.ResourceType.SpriteImage),(te,oe)=>{V=null,C||(C=te,E=oe,q())});function q(){if(C)g(C);else if(v&&E){const te=u.exported.getImageData(E),oe={};for(const ae in v){const{width:le,height:ce,x:Y,y:se,sdf:fe,pixelRatio:me,stretchX:Pe,stretchY:De,content:Re}=v[ae],ze=new u.RGBAImage({width:le,height:ce});u.RGBAImage.copy(te,ze,{x:Y,y:se},{x:0,y:0},{width:le,height:ce}),oe[ae]={data:ze,pixelRatio:me,sdf:fe,stretchX:Pe,stretchY:De,content:Re}}g(null,oe)}}return{cancel(){U&&(U.cancel(),U=null),V&&(V.cancel(),V=null)}}}(t,this.map._requestManager,(a,d)=>{if(this._spriteRequest=null,a)this.fire(new u.ErrorEvent(a));else if(d)for(const g in d)this.imageManager.addImage(g,d[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(t){const a=this.getSource(t.source);if(!a)return;const d=t.sourceLayer;d&&("geojson"===a.type||a.vectorLayerIds&&-1===a.vectorLayerIds.indexOf(d))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const a=[];for(const d of t){const g=this._layers[d];"custom"!==g.type&&a.push(g.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&("function"==typeof t.isLayerDraped?t.isLayerDraped():zo[t.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const a=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const E in this._updatedSources){const C=this._updatedSources[E];"reload"===C?this._reloadSource(E):"clear"===C&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const d={};for(const g in this._sourceCaches){const v=this._sourceCaches[g];d[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];if(v.recalculate(t,this._availableImages),!v.isHidden(t.zoom)){const C=this._getLayerSourceCache(v);C&&(C.used=!0)}const E=this.map.painter;if(E){const C=v.getProgramIds();if(!C)continue;const P=v.getProgramConfiguration(t.zoom);for(const U of C)E.useProgram(U,P)}}for(const g in d){const v=this._sourceCaches[g];d[g]!==v.used&&v.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),Zi(this,u.validateStyle(t)))return!1;(t=u.clone$1(t)).layers=hr(t.layers);const a=function(g,v){if(!g)return[{command:wt.setStyle,args:[v]}];let E=[];try{if(!Te(g.version,v.version))return[{command:wt.setStyle,args:[v]}];Te(g.center,v.center)||E.push({command:wt.setCenter,args:[v.center]}),Te(g.zoom,v.zoom)||E.push({command:wt.setZoom,args:[v.zoom]}),Te(g.bearing,v.bearing)||E.push({command:wt.setBearing,args:[v.bearing]}),Te(g.pitch,v.pitch)||E.push({command:wt.setPitch,args:[v.pitch]}),Te(g.sprite,v.sprite)||E.push({command:wt.setSprite,args:[v.sprite]}),Te(g.glyphs,v.glyphs)||E.push({command:wt.setGlyphs,args:[v.glyphs]}),Te(g.transition,v.transition)||E.push({command:wt.setTransition,args:[v.transition]}),Te(g.light,v.light)||E.push({command:wt.setLight,args:[v.light]}),Te(g.fog,v.fog)||E.push({command:wt.setFog,args:[v.fog]}),Te(g.projection,v.projection)||E.push({command:wt.setProjection,args:[v.projection]});const C={},P=[];!function(q,te,oe,ae){let le;for(le in te=te||{},q=q||{})q.hasOwnProperty(le)&&(te.hasOwnProperty(le)||Sr(le,oe,ae));for(le in te){if(!te.hasOwnProperty(le))continue;const ce=te[le];q.hasOwnProperty(le)?Te(q[le],ce)||("geojson"===q[le].type&&"geojson"===ce.type&&ro(q,te,le)?oe.push({command:wt.setGeoJSONSourceData,args:[le,ce.data]}):_i(le,te,oe,ae)):On(le,te,oe)}}(g.sources,v.sources,P,C);const U=[];g.layers&&g.layers.forEach(q=>{q.source&&C[q.source]?E.push({command:wt.removeLayer,args:[q.id]}):U.push(q)});let V=g.terrain;V&&C[V.source]&&(E.push({command:wt.setTerrain,args:[void 0]}),V=void 0),E=E.concat(P),Te(V,v.terrain)||E.push({command:wt.setTerrain,args:[v.terrain]}),function(q,te,oe){te=te||[];const ae=(q=q||[]).map(xi),le=te.map(xi),ce=q.reduce(Or,{}),Y=te.reduce(Or,{}),se=ae.slice(),fe=Object.create(null);let me,Pe,De,Re,ze,Ne,We;for(me=0,Pe=0;me<ae.length;me++)De=ae[me],Y.hasOwnProperty(De)?Pe++:(oe.push({command:wt.removeLayer,args:[De]}),se.splice(se.indexOf(De,Pe),1));for(me=0,Pe=0;me<le.length;me++)De=le[le.length-1-me],se[se.length-1-me]!==De&&(ce.hasOwnProperty(De)?(oe.push({command:wt.removeLayer,args:[De]}),se.splice(se.lastIndexOf(De,se.length-Pe),1)):Pe++,Ne=se[se.length-me],oe.push({command:wt.addLayer,args:[Y[De],Ne]}),se.splice(se.length-me,0,De),fe[De]=!0);for(me=0;me<le.length;me++)if(De=le[me],Re=ce[De],ze=Y[De],!fe[De]&&!Te(Re,ze))if(Te(Re.source,ze.source)&&Te(Re["source-layer"],ze["source-layer"])&&Te(Re.type,ze.type)){for(We in Lr(Re.layout,ze.layout,oe,De,null,wt.setLayoutProperty),Lr(Re.paint,ze.paint,oe,De,null,wt.setPaintProperty),Te(Re.filter,ze.filter)||oe.push({command:wt.setFilter,args:[De,ze.filter]}),Te(Re.minzoom,ze.minzoom)&&Te(Re.maxzoom,ze.maxzoom)||oe.push({command:wt.setLayerZoomRange,args:[De,ze.minzoom,ze.maxzoom]}),Re)Re.hasOwnProperty(We)&&"layout"!==We&&"paint"!==We&&"filter"!==We&&"metadata"!==We&&"minzoom"!==We&&"maxzoom"!==We&&(0===We.indexOf("paint.")?Lr(Re[We],ze[We],oe,De,We.slice(6),wt.setPaintProperty):Te(Re[We],ze[We])||oe.push({command:wt.setLayerProperty,args:[De,We,ze[We]]}));for(We in ze)ze.hasOwnProperty(We)&&!Re.hasOwnProperty(We)&&"layout"!==We&&"paint"!==We&&"filter"!==We&&"metadata"!==We&&"minzoom"!==We&&"maxzoom"!==We&&(0===We.indexOf("paint.")?Lr(Re[We],ze[We],oe,De,We.slice(6),wt.setPaintProperty):Te(Re[We],ze[We])||oe.push({command:wt.setLayerProperty,args:[De,We,ze[We]]}))}else oe.push({command:wt.removeLayer,args:[De]}),Ne=se[se.lastIndexOf(De)+1],oe.push({command:wt.addLayer,args:[ze,Ne]})}(U,v.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:wt.setStyle,args:[v]}]}return E}(this.serialize(),t).filter(g=>!(g.command in ss));if(0===a.length)return!1;const d=a.filter(g=>!(g.command in qa));if(d.length>0)throw new Error(`Unimplemented: ${d.map(g=>g.command).join(", ")}.`);return a.forEach(g=>{"setTransition"!==g.command&&"setProjection"!==g.command&&this[g.command].apply(this,g.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,a){return this.getImage(t)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,a),this._afterImageUpdated(t),this)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,a,d={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.validateSource,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const g=Rn(t,a,this.dispatcher,this);g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:g.serialize(),sourceId:t}));const v=E=>{const C=(E?"symbol:":"other:")+t,P=this._sourceCaches[C]=new u.SourceCache(C,g,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[t]=P,P.style=this,P.onAdd(this.map)};v(!1),"vector"!==a.type&&"geojson"!==a.type||v(!0),g.onAdd&&g.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const a=this.getSource(t);if(!a)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const d=this._getSourceCaches(t);for(const g of d)delete this._sourceCaches[g.id],delete this._updatedSources[g.id],g.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getSource(t).setData(a),this._changed=!0}getSource(t){const a=this._getSourceCache(t);return a&&a.getSource()}_getSources(){const t=[];for(const a in this._otherSourceCaches){const d=this._getSourceCache(a);d&&t.push(d.getSource())}return t}addLayer(t,a,d={}){this._checkLoaded();const g=t.id;if(this.getLayer(g))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${g}" already exists on this map`)));let v;if("custom"===t.type){if(Zi(this,u.validateCustomStyleLayer(t)))return;v=u.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(g,t.source),t=u.clone$1(t),t=u.extend(t,{source:g})),this._validate(u.validateLayer,`layers.${g}`,t,{arrayIndex:-1},d))return;v=u.createStyleLayer(t),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const E=a?this._order.indexOf(a):this._order.length;if(a&&-1===E)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=v;const C=this._getLayerSourceCache(v);if(this._removedLayers[g]&&v.source&&C&&"custom"!==v.type){const P=this._removedLayers[g];delete this._removedLayers[g],P.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const d=this._order.indexOf(t);this._order.splice(d,1);const g=a?this._order.indexOf(a):this._order.length;a&&-1===g?this.fire(new u.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(g,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const d=this._order.indexOf(t);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,d){this._checkLoaded();const g=this.getLayer(t);g?g.minzoom===a&&g.maxzoom===d||(null!=a&&(g.minzoom=a),null!=d&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,a,d={}){this._checkLoaded();const g=this.getLayer(t);if(g){if(!Te(g.filter,a))return null==a?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(u.validateFilter,`layers.${g.id}.filter`,a,{layerType:g.type},d)||(g.filter=u.clone$1(a),this._updateLayer(g)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const a=this.getLayer(t);return a&&u.clone$1(a.filter)}setLayoutProperty(t,a,d,g={}){this._checkLoaded();const v=this.getLayer(t);v?Te(v.getLayoutProperty(a),d)||(v.setLayoutProperty(a,d,g),this._updateLayer(v)):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,a){const d=this.getLayer(t);if(d)return d.getLayoutProperty(a);this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,a,d,g={}){this._checkLoaded();const v=this.getLayer(t);v?Te(v.getPaintProperty(a),d)||(v.setPaintProperty(a,d,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,a){const d=this.getLayer(t);return d&&d.getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const d=t.source,g=t.sourceLayer,v=this.getSource(d);if(!v)return void this.fire(new u.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const E=v.type;if("geojson"===E&&g)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!g)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(d);for(const P of C)P.setFeatureState(g,t.id,a)}removeFeatureState(t,a){this._checkLoaded();const d=t.source,g=this.getSource(d);if(!g)return void this.fire(new u.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const v=g.type,E="vector"===v?t.sourceLayer:void 0;if("vector"===v&&!E)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(d);for(const P of C)P.removeFeatureState(E,t.id,a)}getFeatureState(t){this._checkLoaded();const a=t.source,d=t.sourceLayer,g=this.getSource(a);if(g){if("vector"!==g.type||d)return void 0===t.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(d,t.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();t[d.id]||(t[d.id]=d.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},a=>void 0!==a)}_updateLayer(t){this._updatedLayers[t.id]=!0;const a=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&a&&"raster"!==a.getSource().type&&(this._updatedSources[t.source]="reload",a.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=E=>"fill-extrusion"===this._layers[E].type,d={},g=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(a(C)){d[C]=E;for(const P of t){const U=P[C];if(U)for(const V of U)g.push(V)}}}g.sort((E,C)=>C.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(a(C))for(let P=g.length-1;P>=0;P--){const U=g[P].feature;if(d[U.layer.id]<E)break;v.push(U),g.pop()}else for(const P of t){const U=P[C];if(U)for(const V of U)v.push(V.feature)}}return v}queryRenderedFeatures(t,a,d){a&&a.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const g={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of a.layers){const U=this._layers[P];if(!U)return this.fire(new u.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];g[U.source]=!0}}const v=[];a.availableImages=this._availableImages;const E=a&&a.layers?a.layers.some(P=>{const U=this.getLayer(P);return U&&U.is3D()}):this.has3DLayers(),C=kn.createFromScreenPoints(t,d);for(const P in this._sourceCaches){const U=this._sourceCaches[P].getSource().id;a.layers&&!g[U]||v.push(Mr(this._sourceCaches[P],this._layers,this._serializedLayers,C,a,d,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(P,U,V,q,te,oe,ae){const le={},ce=oe.queryRenderedSymbols(q),Y=[];for(const se of Object.keys(ce).map(Number))Y.push(ae[se]);Y.sort(je);for(const se of Y){const fe=se.featureIndex.lookupSymbolFeatures(ce[se.bucketInstanceId],U,se.bucketIndex,se.sourceLayerIndex,te.filter,te.layers,te.availableImages,P);for(const me in fe){const Pe=le[me]=le[me]||[],De=fe[me];De.sort((Re,ze)=>{const Ne=se.featureSortOrder;if(Ne){const We=Ne.indexOf(Re.featureIndex);return Ne.indexOf(ze.featureIndex)-We}return ze.featureIndex-Re.featureIndex});for(const Re of De)Pe.push(Re)}}for(const se in le)le[se].forEach(fe=>{const me=fe.feature,Pe=V(P[se]);if(!Pe)return;const De=Pe.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=De});return le}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(t,a){a&&a.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const d=this._getSourceCaches(t);let g=[];for(const v of d)g=g.concat(Ur(v,a));return g}addSourceType(t,a,d){return so.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(so.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const E in t)if(!Te(t[E],d[E])){g=!0;break}if(!g)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,a),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,a=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let d=t;if(1===a){if("object"==typeof d.source){const g="terrain-dem-src";this.addSource(g,d.source),d=u.clone$1(d),d=u.extend(d,{source:g})}if(this._validate(u.validateTerrain,"terrain",d))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a)}else{const g=this.terrain,v=g.get();for(const E of Object.keys(u.spec.terrain))!d.hasOwnProperty(E)&&u.spec.terrain[E].default&&(d[E]=u.spec.terrain[E].default);for(const E in d)if(!Te(d[E],v[E])){g.set(d),this.stylesheet.terrain=d;const C=this._setTransitionParameters({duration:0});g.updateTransitions(C);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Wt(t,this.map.transform);this.stylesheet.fog=t;const d=this._setTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,d=a.get();0===Object.keys(t).length&&a.set(t);for(const g in t)if(!Te(t[g],d[g])){a.set(t),this.stylesheet.fog=t;const v=this._setTransitionParameters({duration:0});a.updateTransitions(v);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:u.exported.now(),transition:u.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(d=>this.isLayerDraped(this._layers[d])),a=this._order.filter(d=>!this.isLayerDraped(this._layers[d]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const d=this.terrain=new Xe(t,a);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const g=this._setTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];"fill-extrusion"===a.type&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];"symbol"===a.type&&this._updateLayer(a)}}_validate(t,a,d,g,v={}){return(!v||!1!==v.validate)&&Zi(this,t.call(u.validateStyle,u.extend({key:a,style:this.serialize(),value:d,styleSpec:u.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const a=this._getSourceCaches(t);for(const d of a)d.clearTiles()}_reloadSource(t){const a=this._getSourceCaches(t);for(const d of a)d.resume(),d.reload()}_reloadSources(){for(const t of this._getSources())t.reload&&t.reload()}_updateSources(t){for(const a in this._sourceCaches)this._sourceCaches[a].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,d,g,v=!1){let E=!1,C=!1;const P={};for(const U of this._order){const V=this._layers[U];if("symbol"!==V.type)continue;if(!P[V.source]){const te=this._getLayerSourceCache(V);if(!te)continue;P[V.source]=te.getRenderableIds(!0).map(oe=>te.getTileByID(oe)).sort((oe,ae)=>ae.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ae.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,P[V.source],t.center.lng,t.projection);E=E||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===d,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),t.zoom))&&(this.pauseablePlacement=new sa(t,this._order,v,a,d,g,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const U of this._order){const V=this._layers[U];"symbol"===V.type&&this.placement.updateLayerOpacities(V,P[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a,d){this.imageManager.getImages(a.icons,d),this._updateTilesForChangedImages();const g=v=>{v&&v.setDependencies(a.tileID.key,a.type,a.icons)};g(this._otherSourceCaches[a.source]),g(this._symbolSourceCaches[a.source])}getGlyphs(t,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(t,a,d){return u.makeRequest(a,d)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this._getSourceCaches(t);return 0===a.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):a.every(d=>d.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}so.getSourceType=function(c){return Mn[c]},so.setSourceType=function(c,t){Mn[c]=t},so.registerForPluginStateChange=u.registerForPluginStateChange;var Us="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",as="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Po="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",js="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",vo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ba={},ls={};const wi=[];aa(Us,wi),aa(Po,wi),aa(js,wi),aa(vo,wi),ba=cn("",Po),ls=cn(vo,js);const Es=cn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),$s=Us,Ro="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var wa={background:cn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:cn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:cn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:cn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:cn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:cn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:cn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:cn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:cn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:cn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:cn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:cn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:cn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:cn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:cn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:cn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:cn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:cn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:cn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:cn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:cn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:cn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:cn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",as),skyboxGradient:cn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",as),skyboxCapture:cn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:cn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function aa(c,t){const a=c.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let d of a)if(d=d.trim(),"#"===d[0]&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=d.split(" ");for(const v of g)t.includes(v)||t.push(v)}}function cn(c,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g={},v=[...wi];return aa(c,v),aa(t,v),{fragmentSource:c=c.replace(a,(E,C,P,U,V)=>(g[V]=!0,"define"===C?`\n#ifndef HAS_UNIFORM_u_${V}\nvarying ${P} ${U} ${V};\n#else\nuniform ${P} ${U} u_${V};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${V}\n    ${P} ${U} ${V} = u_${V};\n#endif\n`)),vertexSource:t=t.replace(a,(E,C,P,U,V)=>{const q="float"===U?"vec2":"vec4",te=V.match(/color/)?"color":q;return g[V]?"define"===C?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${P} ${q} a_${V};\nvarying ${P} ${U} ${V};\n#else\nuniform ${P} ${U} u_${V};\n#endif\n`:"vec4"===te?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = a_${V};\n#else\n    ${P} ${U} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = unpack_mix_${te}(a_${V}, u_${V}_t);\n#else\n    ${P} ${U} ${V} = u_${V};\n#endif\n`:"define"===C?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${P} ${q} a_${V};\n#else\nuniform ${P} ${U} u_${V};\n#endif\n`:"vec4"===te?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${P} ${U} ${V} = a_${V};\n#else\n    ${P} ${U} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${P} ${U} ${V} = unpack_mix_${te}(a_${V}, u_${V}_t);\n#else\n    ${P} ${U} ${V} = u_${V};\n#endif\n`}),staticAttributes:d,usedDefines:v}}class Ea{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,d,g,v,E,C){this.context=t;let P=this.boundPaintVertexBuffers.length!==g.length;for(let V=0;!P&&V<g.length;V++)this.boundPaintVertexBuffers[V]!==g[V]&&(P=!0);let U=this.boundDynamicVertexBuffers.length!==C.length;for(let V=0;!U&&V<C.length;V++)this.boundDynamicVertexBuffers[V]!==C[V]&&(U=!0);if(!t.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||P||U||this.boundIndexBuffer!==v||this.boundVertexOffset!==E)this.freshBind(a,d,g,v,E,C);else{t.bindVertexArrayOES.set(this.vao);for(const V of C)V&&V.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(t,a,d,g,v,E){let C;const P=t.numAttributes,U=this.context,V=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=E;else{C=U.currentNumAttributes||0;for(let q=P;q<C;q++)V.disableVertexAttribArray(q)}a.enableAttributes(V,t),a.bind(),a.setVertexAttribPointers(V,t,v);for(const q of d)q.enableAttributes(V,t),q.bind(),q.setVertexAttribPointers(V,t,v);for(const q of E)q&&(q.enableAttributes(V,t),q.bind(),q.setVertexAttribPointers(V,t,v));g&&g.bind(),U.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Gs(c,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new u.MercatorCoordinate(0,d/a).toLngLat().lat,new u.MercatorCoordinate(0,(d+1)/a).toLngLat().lat]}function Ca(c,t,a,d,g,v,E){const C=c.context,P=C.gl,U=a.fbo;if(!U)return;c.prepareDrawTile();const V=c.useProgram("hillshade");C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,U.colorAttachment.get());const q=((le,ce,Y,se)=>{const fe=Y.paint.get("hillshade-shadow-color"),me=Y.paint.get("hillshade-highlight-color"),Pe=Y.paint.get("hillshade-accent-color");let De=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Y.paint.get("hillshade-illumination-anchor")&&(De-=le.transform.angle);const Re=!le.options.moving;return{u_matrix:se||le.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Re),u_image:0,u_latrange:Gs(0,ce.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),De],u_shadow:fe,u_highlight:me,u_accent:Pe}})(c,a,d,c.terrain?t.projMatrix:null);c.prepareDrawProgram(C,V,t.toUnwrapped());const{tileBoundsBuffer:te,tileBoundsIndexBuffer:oe,tileBoundsSegments:ae}=c.getTileBoundsBuffers(a);V.draw(C,P.TRIANGLES,g,v,E,u.CullFaceMode.disabled,q,d.id,te,oe,ae)}function Bi(c,t,a){if(!t.needsDEMTextureUpload)return;const d=c.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(a.stride);const v=a.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new u.Texture(d,v,g.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function la(c,t,a,d,g,v){const E=c.context,C=E.gl;if(!t.dem)return;const P=t.dem;if(E.activeTexture.set(C.TEXTURE1),Bi(c,t,P),!t.demTexture)return;t.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const U=P.dim;E.activeTexture.set(C.TEXTURE0);let V=t.fbo;if(!V){const ae=new u.Texture(E,{width:U,height:U,data:null},C.RGBA);ae.bind(C.LINEAR,C.CLAMP_TO_EDGE),V=t.fbo=E.createFramebuffer(U,U,!0),V.colorAttachment.set(ae.texture)}E.bindFramebuffer.set(V.framebuffer),E.viewport.set([0,0,U,U]);const{tileBoundsBuffer:q,tileBoundsIndexBuffer:te,tileBoundsSegments:oe}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,d,g,v,u.CullFaceMode.disabled,((ae,le)=>{const ce=le.stride,Y=u.create();return u.ortho(Y,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(Y,Y,[0,-u.EXTENT,0]),{u_matrix:Y,u_image:1,u_dimension:[ce,ce],u_zoom:ae.overscaledZ,u_unpack:le.unpackVector}})(t.tileID,P),a.id,q,te,oe),t.needsHillshadePrepare=!1}const Hs=c=>({u_matrix:new u.UniformMatrix4f(c),u_image0:new u.Uniform1i(c),u_skirt_height:new u.Uniform1f(c)}),Vo=(c,t)=>({u_matrix:c,u_image0:0,u_skirt_height:t}),Ji=(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:E,u_frustum_tr:C,u_frustum_br:P,u_frustum_bl:U,u_globe_pos:V,u_globe_radius:q,u_viewport:te,u_grid_matrix:ae?Float32Array.from(ae):new Float32Array(9),u_skirt_height:oe});function ca(c,t){return null!=c&&null!=t&&!(!c.hasData()||!t.hasData())&&null!=c.demTexture&&null!=t.demTexture&&c.tileID.key!==t.tileID.key}const Lo=new class{constructor(){this.operations={}}newMorphing(c,t,a,d,g){if(c in this.operations){const v=this.operations[c];v.to.tileID.key!==a.tileID.key&&(v.queued=a)}else this.operations[c]={startTime:d,phase:0,duration:g,from:t,to:a,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const a=this.operations[t];for(a.phase=(c-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Uo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ko(c){return 6*Math.pow(1.5,22-c)}function Cs(c,t){const a=1<<c.z;return!t&&(0===c.x||c.x===a-1)||0===c.y||c.y===a-1}const Zs=c=>({u_matrix:c});function Nn(c,t,a,d,g){if(g>0){const v=u.exported.now(),E=(v-c.timeAdded)/g,C=t?(v-t.timeAdded)/g:-1,P=a.getSource(),U=d.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-U)>Math.abs(c.tileID.overscaledZ-U),q=V&&c.refreshedUponExpiration?1:u.clamp(V?E:1-C,0,1);return c.refreshedUponExpiration&&E>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class ao extends u.SourceCache{constructor(t){const a={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new ht(En(),null),g=Rn("mock-dem",a,d,t.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class Da extends u.SourceCache{constructor(t){const a=Rn("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new ht(En(),null),t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,d){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){const C=new u.Tile(E,this._source.tileSize*E.overscaleFactor(),t.tileZoom);C.state="loaded",this._tiles[E.key]=C}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const a=this.proxyCachedFBO[t];if(void 0!==a){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ds extends u.OverscaledTileID{constructor(t,a,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class gl extends u.Elevation{constructor(t,a){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,g,v]=function(P){const U=new u.StructArrayLayout2i4,V=new u.StructArrayLayout3ui6,q=131;U.reserve(17161),V.reserve(33800);const te=u.EXTENT/128,oe=u.EXTENT+te/2,ae=oe+te;for(let ce=-te;ce<ae;ce+=te)for(let Y=-te;Y<ae;Y+=te){const se=Y<0||Y>oe||ce<0||ce>oe?24575:0,fe=u.clamp(Math.round(Y),0,u.EXTENT),me=u.clamp(Math.round(ce),0,u.EXTENT);U.emplaceBack(fe+se,me)}const le=(ce,Y)=>{const se=Y*q+ce;V.emplaceBack(se+1,se,se+q),V.emplaceBack(se+q,se+q+1,se+1)};for(let ce=1;ce<129;ce++)for(let Y=1;Y<129;Y++)le(Y,ce);return[0,129].forEach(ce=>{for(let Y=0;Y<130;Y++)le(Y,ce),le(ce,Y)}),[U,V,32768]}(),E=t.context;this.gridBuffer=E.createVertexBuffer(d,u.posAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(g),this.gridSegments=u.SegmentVector.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Da(a.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const C=E.gl;this._overlapStencilMode=new u.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ao(a.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,d){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const g=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(g.get("source")),this._exaggeration=g.get("exaggeration");const v=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(a,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=0===d._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(d.center),-1),this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=a.getIds().map(P=>{const U=a.getTileByID(P).tileID;return U.projMatrix=d.calculateProjMatrix(U.toUnwrapped()),U});(function(P,U){const V=U.transform.pointCoordinate(U.transform.getCameraPoint()),q=new u.Point(V.x,V.y);P.sort((te,oe)=>{if(oe.overscaledZ-te.overscaledZ)return oe.overscaledZ-te.overscaledZ;const ae=new u.Point(te.canonical.x+(1<<te.canonical.z)*te.wrap,te.canonical.y),le=new u.Point(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),ce=q.mult(1<<te.canonical.z);return ce.x-=.5,ce.y-=.5,ce.distSqr(ae)-ce.distSqr(le)})})(g,this.painter),this._previousZoom=d.zoom;const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const P in E){const U=E[P];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,t[P],v),U.usedForTerrain))continue;const V=t[P];U.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[a.id]=g.map(P=>new Ds(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const C={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const U=this.terrainTileForTile[P.key];if(!U)continue;const V=U.tileID.key;V in C||(this._visibleDemTiles.push(U),C[V]=V)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const d in this.terrainTileForTile){const g=this.terrainTileForTile[d],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Bi(this.painter,g,v))}}_prepareDemTileUniforms(t,a,d,g){if(!a||null==a.demTexture)return!1;const v=t.tileID.canonical,E=Math.pow(2,a.tileID.canonical.z-v.z),C=g||"";return d[`u_dem_tl${C}`]=[v.x*E%1,v.y*E%1],d[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,a=t.gl;if(!this._emptyDepthBufferTexture){const d=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(t,d,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const a=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;const v=g.dem.tree.minimums[0];return v>0&&t++,d+v},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),g=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(d,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new u.Texture(t,g,a.RGBA,{premultiply:!1}),v}setupElevationDraw(t,a,d){const g=this.painter.context,v=g.gl,E=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var C;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let P=null,U=null,V=1;if(d&&d.morphing&&this._useVertexMorphing){const q=d.morphing.srcDemTile,te=d.morphing.dstDemTile;V=d.morphing.phase,q&&te&&(this._prepareDemTileUniforms(t,q,E,"_prev")&&(U=q),this._prepareDemTileUniforms(t,te,E)&&(P=te))}if(U&&P?(g.activeTexture.set(v.TEXTURE2),P.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),g.activeTexture.set(v.TEXTURE4),U.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=V):(P=this.terrainTileForTile[t.tileID.key],g.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(t,P,E)?P.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),g.activeTexture.set(v.TEXTURE3),d&&d.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),d&&d.useMeterToDem&&P){const q=(1<<P.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=q}if(d&&d.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(g,E),"globe"===this.painter.transform.projection.name){const q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(g,q)}}globeUniformValues(t,a,d){const g=t.projection;return{u_tile_tl_up:g.upVector(a,0,0),u_tile_tr_up:g.upVector(a,u.EXTENT,0),u_tile_br_up:g.upVector(a,u.EXTENT,u.EXTENT),u_tile_bl_up:g.upVector(a,0,u.EXTENT),u_tile_up_scale:d?u.globeMetersToEcef(1):g.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,d=this.painter.context;0!==t.length&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,E,C,P){if("globe"===g.transform.projection.name)!function(U,V,q,te,oe){const ae=U.context,le=ae.gl;let ce,Y;const se=U.options.showTerrainWireframe?2:0,fe=U.transform,me=u.globeUseCustomAntiAliasing(U,ae,fe),Pe=(Lt,Ye)=>{if(Y===Lt)return;const ut=[Uo[Lt],"PROJECTION_GLOBE_VIEW"];me&&ut.push("CUSTOM_ANTIALIASING"),Ye&&ut.push(Uo[se]),ce=U.useProgram("globeRaster",null,ut),Y=Lt},De=U.colorModeForRenderPass(),Re=new u.DepthMode(le.LEQUAL,u.DepthMode.ReadWrite,U.depthRangeFor3D);Lo.update(oe);const ze=u.calculateGlobeMercatorMatrix(fe),Ne=[u.mercatorXfromLng(fe.center.lng),u.mercatorYfromLat(fe.center.lat)],We=se?[!1,!0]:[!1],Bt=U.globeSharedBuffers,qe=[fe.width*u.exported.devicePixelRatio,fe.height*u.exported.devicePixelRatio],mt=Float32Array.from(fe.globeMatrix),Qe={useDenormalizedUpVectorScale:!0};if(We.forEach(Lt=>{const Ye=U.transform,ut=ko(Ye.zoom)*V.exaggeration();Y=-1;const zt=Lt?le.LINES:le.TRIANGLES;for(const Ct of te){const Ot=q.getTile(Ct),_n=u.StencilMode.disabled,Un=V.prevTerrainTileForTile[Ct.key],hn=V.terrainTileForTile[Ct.key];ca(Un,hn)&&Lo.newMorphing(Ct.key,Un,hn,oe,250),ae.activeTexture.set(le.TEXTURE0),Ot.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const Sn=Lo.getMorphValuesForProxy(Ct.key),Qn=Sn?1:0;Sn&&u.extend$1(Qe,{morphing:{srcDemTile:Sn.from,dstDemTile:Sn.to,phase:u.easeCubicInOut(Sn.phase)}});const er=u.tileCornersToBounds(Ct.canonical),yn=u.getLatitudinalLod(er.getCenter().lat),Fr=u.getGridMatrix(Ct.canonical,er,yn,Ye.worldSize/Ye._pixelsPerMercatorPixel),$r=u.globeNormalizeECEF(u.globeTileBounds(Ct.canonical)),Yr=Ji(Ye.projMatrix,mt,ze,$r,u.globeToMercatorTransition(Ye.zoom),Ne,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,qe,ut,Fr);if(Pe(Qn,Lt),V.setupElevationDraw(Ot,ce,Qe),U.prepareDrawProgram(ae,ce,Ct.toUnwrapped()),Bt){const[ni,Go,Eo]=Lt?Bt.getWirefameBuffers(U.context,yn):Bt.getGridBuffers(yn,0!==ut);ce.draw(ae,zt,Re,_n,De,u.CullFaceMode.backCCW,Yr,"globe_raster",ni,Go,Eo)}}}),Bt){const Lt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&Lt.push("CUSTOM_ANTIALIASING"),ce=U.useProgram("globeRaster",null,Lt);for(const Ye of te){const{x:ut,y:zt,z:Ct}=Ye.canonical,Ot=0===zt,_n=zt===(1<<Ct)-1,[Un,hn,Sn,Qn]=Bt.getPoleBuffers(Ct);if(Qn&&(Ot||_n)){const er=q.getTile(Ye);ae.activeTexture.set(le.TEXTURE0),er.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);let yn=u.globePoleMatrixForTile(Ct,ut,fe);const Fr=u.globeNormalizeECEF(u.globeTileBounds(Ye.canonical)),$r=(Yr,ni)=>Yr.draw(ae,le.TRIANGLES,Re,u.StencilMode.disabled,De,u.CullFaceMode.disabled,Ji(fe.projMatrix,yn,yn,Fr,0,Ne,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,qe,0),"globe_pole_raster",ni,Sn,Qn);V.setupElevationDraw(er,ce,Qe),U.prepareDrawProgram(ae,ce,Ye.toUnwrapped()),Ot&&$r(ce,Un),_n&&(yn=u.scale(u.create(),yn,[1,-1,1]),$r(ce,hn))}}}}(g,v,E,C,P);else{const U=g.context,V=U.gl;let q,te;const oe=g.options.showTerrainWireframe?2:0,ae=(fe,me)=>{if(te===fe)return;const Pe=[Uo[fe]];me&&Pe.push(Uo[oe]),q=g.useProgram("terrainRaster",null,Pe),te=fe},le=g.colorModeForRenderPass(),ce=new u.DepthMode(V.LEQUAL,u.DepthMode.ReadWrite,g.depthRangeFor3D);Lo.update(P);const Y=g.transform,se=ko(Y.zoom)*v.exaggeration();(oe?[!1,!0]:[!1]).forEach(fe=>{te=-1;const me=fe?V.LINES:V.TRIANGLES,[Pe,De]=fe?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const Re of C){const ze=E.getTile(Re),Ne=u.StencilMode.disabled,We=v.prevTerrainTileForTile[Re.key],Bt=v.terrainTileForTile[Re.key];ca(We,Bt)&&Lo.newMorphing(Re.key,We,Bt,P,250),U.activeTexture.set(V.TEXTURE0),ze.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const qe=Lo.getMorphValuesForProxy(Re.key),mt=qe?1:0;let Qe;qe&&(Qe={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:u.easeCubicInOut(qe.phase)}});const Lt=Vo(Re.projMatrix,Cs(Re.canonical,Y.renderWorldCopies)?se/10:se);ae(mt,fe),v.setupElevationDraw(ze,q,Qe),g.prepareDrawProgram(U,q,Re.toUnwrapped()),q.draw(U,me,ce,Ne,le,u.CullFaceMode.backCCW,Lt,"terrain_raster",v.gridBuffer,Pe,De)}})}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],E=this._drapedRenderBatches.shift(),C=[],P=a.style.order;let U=0;for(const V of v){const q=g.getTileByID(V.proxyTileKey),te=g.proxyCachedFBO[V.key]?g.proxyCachedFBO[V.key][t]:void 0,oe=void 0!==te?g.renderCache[te]:this.pool[U++],ae=void 0!==te;if(q.texture=oe.tex,ae&&!oe.dirty){C.push(q.tileID);continue}let le;d.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(d.clear({color:u.Color.transparent,stencil:0}),oe.dirty=!1);for(let ce=E.start;ce<=E.end;++ce){const Y=a.style._layers[P[ce]];if(Y.isHidden(a.transform.zoom))continue;const se=a.style._getLayerSourceCache(Y),fe=se?this.proxyToSource[V.key][se.id]:[V];if(!fe)continue;const me=fe;d.viewport.set([0,0,oe.fb.width,oe.fb.height]),le!==(se?se.id:null)&&(this._setupStencil(oe,fe,Y,se),le=se?se.id:null),a.renderLayer(a,se,Y,me)}this.renderedToTile?(oe.dirty=!0,C.push(q.tileID)):ae||--U,5===U&&(U=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),E.end+1}postRender(){}renderCacheEfficiency(t){const a=t.order.length;if(0===a)return{efficiency:100};let d,g=0,v=0,E=!1;for(let C=0;C<a;++C){const P=t._layers[t.order[C]];this._style.isLayerDraped(P)?(E&&++g,++v):E||(E=!0,d=P.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-g/v),firstUndrapedLayer:d}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,a,d){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const E=v.tileID,C=1<<E.overscaledZ,{x:P,y:U}=E.canonical,V=P/C,q=(P+1)/C,te=U/C,oe=(U+1)/C;return{minx:V,miny:te,maxx:q,maxy:oe,t:v.dem.tree.raycastRoot(V,te,q,oe,t,a,d),tile:v}});g.sort((v,E)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const v of g){if(null==v.t)return null;const E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,a,d);if(null!=E)return E}return null}_createFBO(){const t=this.painter.context,a=t.gl,d=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const g=new u.Texture(t,{width:d[0],height:d[1],data:null},a.RGBA);g.bind(a.LINEAR,a.CLAMP_TO_EDGE);const v=t.createFramebuffer(d[0],d[1],!1);return v.colorAttachment.set(g.texture),v.depthAttachment=new Ie(t,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._layers[t],d=a.isHidden(this.painter.transform.zoom);return"custom"===a.type?!d&&a.shouldRedrape():!d&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style._getSources())if(d instanceof Ut){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const g=this._style._layers[this._style.order[d]],v=this._style._getLayerSourceCache(g);if(v&&!a[v.id]&&!g.isHidden(this.painter.transform.zoom)&&"line"===g.type&&g.widthExpression()instanceof u.ZoomDependentExpression){a[v.id]=!0;for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][v.id];if(C)for(const P of C)this._clearRenderCacheForTile(v.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof St){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const g=this._style._layers[this._style.order[d]],v=this._style._getLayerSourceCache(g);if(!v||a[v.id]||g.isHidden(this.painter.transform.zoom)||"raster"!==g.type)continue;const E=g.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][v.id];if(P)for(const U of P){const V=Nn(v.getTile(U),v.findLoadedParent(U,0),v,this.painter.transform,E);(1!==V.opacity||0!==V.mix)&&this._clearRenderCacheForTile(v.id,U)}}}}_setupDrapedRenderBatches(){const t=this._style.order,a=t.length;if(0===a)return;const d=[];let g,v=0,E=this._style._layers[t[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<a;)E=this._style._layers[t[v]];for(;v<a;++v){const C=this._style._layers[t[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===g&&(g=v):void 0!==g&&(d.push({start:g,end:v-1}),g=void 0))}void 0!==g&&d.push({start:g,end:v-1}),this._drapedRenderBatches=d}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const E=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let C=0;C<E.length;++C){const P=Object.values(E[C]);a.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,g=this._tilesDirty;for(let E=d.length-1;E>=0;E--){const C=d[E];if(a.getTileByID(C.key),void 0!==a.proxyCachedFBO[C.key]){const P=t[C.key],U=this.proxyToSource[C.key];let V=0;for(const q in U){const te=U[q],oe=P[q];if(!oe||oe.length!==te.length||te.some((ae,le)=>ae!==oe[le]||g[q]&&g[q].hasOwnProperty(ae.key))){V=-1;break}++V}for(const q in a.proxyCachedFBO[C.key])a.renderCache[a.proxyCachedFBO[C.key][q]].dirty=V<0||V!==Object.values(P).length}}const v=[...this._drapedRenderBatches];v.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of v)for(const C of d){if(a.proxyCachedFBO[C.key])continue;let P=a.renderCachePool.pop();void 0===P&&a.renderCache.length<50&&(P=a.renderCache.length,a.renderCache.push(this._createFBO())),void 0!==P&&(a.proxyCachedFBO[C.key]={},a.proxyCachedFBO[C.key][E.start]=P,a.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,E=v.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let C;if(d.isTileClipped())C=a.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(t,a){const d=this.painter,g=this.painter.context,v=g.gl;d._tileClippingMaskIDs={},g.setColorMode(u.ColorMode.disabled),g.setDepthMode(u.DepthMode.disabled);const E=d.useProgram("clippingMask");for(const C of t){const P=d._tileClippingMaskIDs[C.key]=--a;E.draw(g,v.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Zs(C.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const d=[t.x,t.y,1,1];u.transformMat4$1(d,d,a.pixelMatrixInverse),u.scale$1(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const g=a._camera.position,v=u.mercatorZfromAltitude(1,a.center.lat),E=[g[0],g[1],g[2]/v,0],C=u.subtract([],d.slice(0,3),E);u.normalize(C,C);const P=this.raycast(E,C,this._exaggeration);return null!==P&&P?(u.scaleAndAdd(E,E,C,P),E[3]=E[2],E[2]*=v,E):null}drawDepth(){const t=this.painter,a=t.context,d=this.proxySourceCache,g=Math.ceil(t.width),v=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=a.gl,C=a.createFramebuffer(g,v,!0);a.activeTexture.set(E.TEXTURE0);const P=new u.Texture(a,{width:g,height:v,data:null},E.RGBA);P.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(P.texture);const U=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,g,v);C.depthAttachment.set(U),this._depthFBO=C,this._depthTexture=P}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,g,v]),function(E,C,P,U){if("globe"===E.transform.projection.name)return;const V=E.context,q=V.gl;V.clear({depth:1});const te=E.useProgram("terrainDepth"),oe=new u.DepthMode(q.LESS,u.DepthMode.ReadWrite,E.depthRangeFor3D);for(const ae of U){const le=P.getTile(ae),ce=Vo(ae.projMatrix,0);C.setupElevationDraw(le,te),te.draw(V,q.TRIANGLES,oe,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,ce,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(t,this,d,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,a,d){if(t.getSource()instanceof $n)return this._setupProxiedCoordsForImageSource(t,a,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const P=v[C],U=this._findTileCoveringTileID(P,t);if(U){const V=this._createProxiedId(P,U,d[P.key]&&d[P.key][t.id]);g.push(V),this.proxyToSource[P.key][t.id]=[V]}}let E=!1;for(let C=0;C<a.length;C++){const P=t.getTile(a[C]);if(!P||!P.hasData())continue;const U=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==P.tileID.canonical.z){const V=this.proxyToSource[U.tileID.key][t.id],q=this._createProxiedId(U.tileID,P,d[U.tileID.key]&&d[U.tileID.key][t.id]);V?V.splice(V.length-1,0,q):this.proxyToSource[U.tileID.key][t.id]=[q],g.push(q),E=!0}}this._sourceTilesOverlap[t.id]=E}_setupProxiedCoordsForImageSource(t,a,d){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],v=this.proxyCoords,E=t.getSource(),C=new u.Point(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),P=E.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((V,q)=>(V.min.x=Math.min(V.min.x,q.x-C.x),V.min.y=Math.min(V.min.y,q.y-C.y),V.max.x=Math.max(V.max.x,q.x-C.x),V.max.y=Math.max(V.max.y,q.y-C.y),V),{min:new u.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(V,q)=>{const te=V.wrap+V.canonical.x/(1<<V.canonical.z),oe=V.canonical.y/(1<<V.canonical.z),ae=u.EXTENT/(1<<V.canonical.z),le=q.wrap+q.canonical.x/(1<<q.canonical.z),ce=q.canonical.y/(1<<q.canonical.z);return te+ae<le+P.min.x||te>le+P.max.x||oe+ae<ce+P.min.y||oe>ce+P.max.y};for(let V=0;V<v.length;V++){const q=v[V];for(let te=0;te<a.length;te++){const oe=t.getTile(a[te]);if(!oe||!oe.hasData()||U(q,oe.tileID))continue;const ae=this._createProxiedId(q,oe,d[q.key]&&d[q.key][t.id]),le=this.proxyToSource[q.key][t.id];le?le.push(ae):this.proxyToSource[q.key][t.id]=[ae],g.push(ae)}}}_createProxiedId(t,a,d){let g=this.orthoMatrix;if(d){const v=d.find(E=>E.key===a.tileID.key);if(v)return v}if(a.tileID.key!==t.key){const v=t.canonical.z-a.tileID.canonical.z;let E,C,P;g=u.create();const U=a.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(E=u.EXTENT>>v,C=E*((a.tileID.canonical.x<<v)-t.canonical.x+U),P=E*((a.tileID.canonical.y<<v)-t.canonical.y)):(E=u.EXTENT<<-v,C=u.EXTENT*(a.tileID.canonical.x-(t.canonical.x+U<<-v)),P=u.EXTENT*(a.tileID.canonical.y-(t.canonical.y<<-v))),u.ortho(g,0,E,0,E,0,1),u.translate(g,g,[C,P,0])}return new Ds(a.tileID,t.key,g)}_findTileCoveringTileID(t,a){let d=a.getTile(t);if(d&&d.hasData())return d;const g=this._findCoveringTileCache[a.id],v=g[t.key];if(d=v?a.getTileByID(v):null,d&&d.hasData()||null===v)return d;let E=d?d.tileID:t,C=E.overscaledZ;const P=a.getSource().minzoom,U=[];if(!v){const q=a.getSource().maxzoom;if(t.canonical.z>=q){const te=t.canonical.z-q;a.getSource().reparseOverscaled?(C=Math.max(t.canonical.z+2,a.transform.tileZoom),E=new u.OverscaledTileID(C,t.wrap,q,t.canonical.x>>te,t.canonical.y>>te)):0!==te&&(C=q,E=new u.OverscaledTileID(C,t.wrap,q,t.canonical.x>>te,t.canonical.y>>te))}E.key!==t.key&&(U.push(E.key),d=a.getTile(E))}const V=q=>{U.forEach(te=>{g[te]=q}),U.length=0};for(C-=1;C>=P&&(!d||!d.hasData());C--){d&&V(d.tileID.key);const q=E.calculateScaledKey(C);if(d=a.getTileByID(q),d&&d.hasData())break;const te=g[q];if(null===te)break;void 0===te?U.push(q):d=a.getTileByID(te)}return V(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(a){let d=0;const g=new u.StructArrayLayout2ui4,v=131;for(let E=1;E<129;E++){for(let C=1;C<129;C++)d=E*v+C,g.emplaceBack(d,d+1),g.emplaceBack(d,d+v),g.emplaceBack(d+1,d+v),128===E&&g.emplaceBack(d+v,d+v+1);g.emplaceBack(d+1,d+1+v)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mr{static cacheKey(t,a,d,g){let v=`${a}${g?g.cacheKey:""}`;for(const E of d)t.usedDefines.includes(E)&&(v+=`/${E}`);return v}constructor(t,a,d,g,v,E){const C=t.gl;this.program=C.createProgram();const P=function(Y){const se=[];for(let fe=0;fe<Y.length;fe++){if(null===Y[fe])continue;const me=Y[fe].split(" ");se.push(me.pop())}return se}(d.staticAttributes),U=g?g.getBinderAttributes():[],V=P.concat(U);let q=g?g.defines():[];q=q.concat(E.map(Y=>`#define ${Y}`));const te=t.isWebGL2?"#version 300 es\n":"",oe=te+q.concat(t.extStandardDerivatives&&0===te.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Ro):Ro,Ro,$s,Es.fragmentSource,ls.fragmentSource,d.fragmentSource).join("\n"),ae=te+q.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",$s,Es.vertexSource,ls.vertexSource,ba.vertexSource,d.vertexSource).join("\n"),le=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(le,oe),C.compileShader(le),C.attachShader(this.program,le);const ce=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ce,ae),C.compileShader(ce),C.attachShader(this.program,ce),this.attributes={},this.numAttributes=V.length;for(let Y=0;Y<this.numAttributes;Y++)V[Y]&&(C.bindAttribLocation(this.program,Y,V[Y]),this.attributes[V[Y]]=Y);C.linkProgram(this.program),C.deleteShader(ce),C.deleteShader(le),this.fixedUniforms=v(t),this.binderUniforms=g?g.getUniforms(t):[],E.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(Y=t),u_dem_prev:new u.Uniform1i(Y),u_dem_unpack:new u.Uniform4f(Y),u_dem_tl:new u.Uniform2f(Y),u_dem_scale:new u.Uniform1f(Y),u_dem_tl_prev:new u.Uniform2f(Y),u_dem_scale_prev:new u.Uniform1f(Y),u_dem_size:new u.Uniform1f(Y),u_dem_lerp:new u.Uniform1f(Y),u_exaggeration:new u.Uniform1f(Y),u_depth:new u.Uniform1i(Y),u_depth_size_inv:new u.Uniform2f(Y),u_meter_to_dem:new u.Uniform1f(Y),u_label_plane_matrix_inv:new u.UniformMatrix4f(Y)}),E.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new u.Uniform3f(Y),u_tile_tr_up:new u.Uniform3f(Y),u_tile_br_up:new u.Uniform3f(Y),u_tile_bl_up:new u.Uniform3f(Y),u_tile_up_scale:new u.Uniform1f(Y)}))(t)),E.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new u.UniformMatrix4f(Y),u_fog_range:new u.Uniform2f(Y),u_fog_color:new u.Uniform4f(Y),u_fog_horizon_blend:new u.Uniform1f(Y),u_fog_temporal_offset:new u.Uniform1f(Y),u_frustum_tl:new u.Uniform3f(Y),u_frustum_tr:new u.Uniform3f(Y),u_frustum_br:new u.Uniform3f(Y),u_frustum_bl:new u.Uniform3f(Y),u_globe_pos:new u.Uniform3f(Y),u_globe_radius:new u.Uniform1f(Y),u_globe_transition:new u.Uniform1f(Y),u_is_globe:new u.Uniform1i(Y),u_viewport:new u.Uniform2f(Y)}))(t))}var Y}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g]&&d[g].set(this.program,g,a[g])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g]&&d[g].set(this.program,g,a[g])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in a)d[g].set(this.program,g,a[g])}}draw(t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le){const ce=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(d),t.setStencilMode(g),t.setColorMode(v),t.setCullFace(E);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,C[se]);ae&&ae.setUniforms(this.program,t,this.binderUniforms,te,{zoom:oe});const Y={[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[a];for(const se of q.get()){const fe=se.vaos||(se.vaos={});(fe[P]||(fe[P]=new Ea)).bind(t,this,U,ae?ae.getPaintVertexBuffers():[],V,se.vertexOffset,le||[]),ce.drawElements(a,se.primitiveLength*Y,ce.UNSIGNED_SHORT,se.primitiveOffset*Y*2)}}}function qs(c,t){const a=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,c.transform.tileZoom)/a,g=d*(t.tileID.canonical.x+t.tileID.wrap*a),v=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture.size,u_tile_units_to_pixels:1/fn(t,1,c.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}const Wa=u.create(),_l=(c,t,a,d,g,v,E,C,P,U,V)=>{const q=t.style.light,te=q.properties.get("position"),oe=[te.x,te.y,te.z],ae=u.create$1();"viewport"===q.properties.get("anchor")&&(u.fromRotation(ae,-t.transform.angle),u.transformMat3(oe,oe,ae));const le=q.properties.get("color"),ce=t.transform,Y={u_matrix:c,u_lightpos:oe,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wa,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v};return"globe"===ce.projection.name&&(Y.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],Y.u_zoom_transition=P,Y.u_inv_rot_matrix=V,Y.u_merc_center=U,Y.u_up_dir=ce.projection.upVector(new u.CanonicalTileID(0,0,0),U[0]*u.EXTENT,U[1]*u.EXTENT),Y.u_height_lift=C),Y},Nt=(c,t,a,d,g,v,E,C,P,U,V,q)=>{const te=_l(c,t,a,d,g,v,E,P,U,V,q),oe={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return u.extend(te,qs(t,C),oe)},Wn=c=>({u_matrix:c}),cs=(c,t,a)=>u.extend(Wn(c),qs(t,a)),zl=(c,t)=>({u_matrix:c,u_world:t}),Xr=(c,t,a,d)=>u.extend(cs(c,t,a),{u_world:d}),Yo=u.create(),Ni=(c,t,a,d,g,v)=>{const E=c.transform,C="globe"===E.projection.name;let P;if("map"===v.paint.get("circle-pitch-alignment"))if(C){const V=u.globePixelsToTileUnits(E.zoom,t.canonical)*E._pixelsPerMercatorPixel;P=Float32Array.from([V,0,0,V])}else P=E.calculatePixelsToTileUnitsMatrix(a);else P=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const U={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:c.translatePosMatrix(t.projMatrix,a,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Yo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){U.u_inv_rot_matrix=d,U.u_merc_center=g,U.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],U.u_zoom_transition=u.globeToMercatorTransition(E.zoom);const V=g[0]*u.EXTENT,q=g[1]*u.EXTENT;U.u_up_dir=E.projection.upVector(new u.CanonicalTileID(0,0,0),V,q)}return U},Qi=c=>{const t=[];return"map"===c.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===c.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},xo=(c,t,a,d)=>{const g=u.EXTENT/a.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/g,t.pixelsToGLUnits[1]/g]}},us=(c,t,a=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:a}),_c=u.create(),Vl=(c,t,a,d,g,v,E)=>{const C=c.transform,P="globe"===C.projection.name,U=P?u.globePixelsToTileUnits(C.zoom,t.canonical)*C._pixelsPerMercatorPixel:fn(a,1,v),V={u_matrix:t.projMatrix,u_extrude_scale:U,u_intensity:E,u_inv_rot_matrix:_c,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){V.u_inv_rot_matrix=d,V.u_merc_center=g,V.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],V.u_zoom_transition=u.globeToMercatorTransition(C.zoom);const q=g[0]*u.EXTENT,te=g[1]*u.EXTENT;V.u_up_dir=C.projection.upVector(new u.CanonicalTileID(0,0,0),q,te)}return V},Zc=(c,t,a,d,g,v,E)=>{const C=c.transform,P=C.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:bo(c,t,a,d),u_pixels_to_tile_units:P,u_device_pixel_ratio:v,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:Ko(a)?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ui(t,c.transform),u_alpha_discard_threshold:0,u_trim_offset:E}},Ta=(c,t,a,d,g)=>{const v=c.transform;return{u_matrix:bo(c,t,a,d),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:ui(t,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ui(c,t){return 1/fn(c,1,t.tileZoom)}function bo(c,t,a,d){return c.translatePosMatrix(d||t.tileID.projMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function Ko(c){const t=c.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const wo=(c,t,a,d,g,v)=>{return{u_matrix:c,u_tl_parent:t,u_scale_parent:a,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(E=g.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ei(g.paint.get("raster-hue-rotate")),u_perspective_transform:v};var E,C};function Ei(c){c*=Math.PI/180;const t=Math.sin(c),a=Math.cos(c);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Ma=u.create(),Xa=(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le)=>{const ce=g.transform,Y={u_is_size_zoom_constant:+("constant"===c||"source"===c),u_is_size_feature_constant:+("constant"===c||"camera"===c),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ce.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:ce.width/ce.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+P,u_pitch_with_map:+d,u_texsize:U,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ma,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ma,u_up_vector:[0,-1,0]};return"globe"===le.name&&(Y.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],Y.u_zoom_transition=q,Y.u_inv_rot_matrix=oe,Y.u_merc_center=te,Y.u_camera_forward=ce._camera.forward(),Y.u_ecef_origin=u.globeECEFOrigin(ce.globeMatrix,V.toUnwrapped()),Y.u_tile_matrix=Float32Array.from(ce.globeMatrix),Y.u_up_vector=ae),Y},Ws=(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le,ce)=>u.extend(Xa(c,t,a,d,g,v,E,C,P,U,q,te,oe,ae,le,ce),{u_gamma_scale:d?g.transform.cameraToCenterDistance*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+V}),Ul=(c,t,a,d,g,v,E,C,P,U,V,q,te,oe,ae,le)=>u.extend(Ws(c,t,a,d,g,v,E,C,!0,P,!0,V,q,te,oe,ae,le),{u_texsize_icon:U,u_texture_icon:1}),Sa=(c,t,a)=>({u_matrix:c,u_opacity:t,u_color:a}),Ya=(c,t,a,d,g)=>u.extend(function(v,E,C){const P=E.imageManager.getPattern(v.toString()),{width:U,height:V}=E.imageManager.getPixelSize(),q=Math.pow(2,C.tileID.overscaledZ),te=C.tileSize*Math.pow(2,E.transform.tileZoom)/q,oe=te*(C.tileID.canonical.x+C.tileID.wrap*q),ae=te*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[U,V],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/fn(C,1,E.transform.tileZoom),u_pixel_coord_upper:[oe>>16,ae>>16],u_pixel_coord_lower:[65535&oe,65535&ae]}}(d,a,g),{u_matrix:c,u_opacity:t}),B={fillExtrusion:c=>({u_matrix:new u.UniformMatrix4f(c),u_lightpos:new u.Uniform3f(c),u_lightintensity:new u.Uniform1f(c),u_lightcolor:new u.Uniform3f(c),u_vertical_gradient:new u.Uniform1f(c),u_opacity:new u.Uniform1f(c),u_edge_radius:new u.Uniform1f(c),u_ao:new u.Uniform2f(c),u_tile_id:new u.Uniform3f(c),u_zoom_transition:new u.Uniform1f(c),u_inv_rot_matrix:new u.UniformMatrix4f(c),u_merc_center:new u.Uniform2f(c),u_up_dir:new u.Uniform3f(c),u_height_lift:new u.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new u.UniformMatrix4f(c),u_lightpos:new u.Uniform3f(c),u_lightintensity:new u.Uniform1f(c),u_lightcolor:new u.Uniform3f(c),u_vertical_gradient:new u.Uniform1f(c),u_height_factor:new u.Uniform1f(c),u_edge_radius:new u.Uniform1f(c),u_ao:new u.Uniform2f(c),u_tile_id:new u.Uniform3f(c),u_zoom_transition:new u.Uniform1f(c),u_inv_rot_matrix:new u.UniformMatrix4f(c),u_merc_center:new u.Uniform2f(c),u_up_dir:new u.Uniform3f(c),u_height_lift:new u.Uniform1f(c),u_image:new u.Uniform1i(c),u_texsize:new u.Uniform2f(c),u_pixel_coord_upper:new u.Uniform2f(c),u_pixel_coord_lower:new u.Uniform2f(c),u_tile_units_to_pixels:new u.Uniform1f(c),u_opacity:new u.Uniform1f(c)}),fill:c=>({u_matrix:new u.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new u.UniformMatrix4f(c),u_image:new u.Uniform1i(c),u_texsize:new u.Uniform2f(c),u_pixel_coord_upper:new u.Uniform2f(c),u_pixel_coord_lower:new u.Uniform2f(c),u_tile_units_to_pixels:new u.Uniform1f(c)}),fillOutline:c=>({u_matrix:new u.UniformMatrix4f(c),u_world:new u.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new u.UniformMatrix4f(c),u_world:new u.Uniform2f(c),u_image:new u.Uniform1i(c),u_texsize:new u.Uniform2f(c),u_pixel_coord_upper:new u.Uniform2f(c),u_pixel_coord_lower:new u.Uniform2f(c),u_tile_units_to_pixels:new u.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new u.Uniform1f(c),u_extrude_scale:new u.UniformMatrix2f(c),u_device_pixel_ratio:new u.Uniform1f(c),u_matrix:new u.UniformMatrix4f(c),u_inv_rot_matrix:new u.UniformMatrix4f(c),u_merc_center:new u.Uniform2f(c),u_tile_id:new u.Uniform3f(c),u_zoom_transition:new u.Uniform1f(c),u_up_dir:new u.Uniform3f(c)}),collisionBox:c=>({u_matrix:new u.UniformMatrix4f(c),u_camera_to_center_distance:new u.Uniform1f(c),u_extrude_scale:new u.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new u.UniformMatrix4f(c),u_inv_matrix:new u.UniformMatrix4f(c),u_camera_to_center_distance:new u.Uniform1f(c),u_viewport_size:new u.Uniform2f(c)}),debug:c=>({u_color:new u.UniformColor(c),u_matrix:new u.UniformMatrix4f(c),u_overlay:new u.Uniform1i(c),u_overlay_scale:new u.Uniform1f(c)}),clippingMask:c=>({u_matrix:new u.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new u.Uniform1f(c),u_intensity:new u.Uniform1f(c),u_matrix:new u.UniformMatrix4f(c),u_inv_rot_matrix:new u.UniformMatrix4f(c),u_merc_center:new u.Uniform2f(c),u_tile_id:new u.Uniform3f(c),u_zoom_transition:new u.Uniform1f(c),u_up_dir:new u.Uniform3f(c)}),heatmapTexture:c=>({u_image:new u.Uniform1i(c),u_color_ramp:new u.Uniform1i(c),u_opacity:new u.Uniform1f(c)}),hillshade:c=>({u_matrix:new u.UniformMatrix4f(c),u_image:new u.Uniform1i(c),u_latrange:new u.Uniform2f(c),u_light:new u.Uniform2f(c),u_shadow:new u.UniformColor(c),u_highlight:new u.UniformColor(c),u_accent:new u.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new u.UniformMatrix4f(c),u_image:new u.Uniform1i(c),u_dimension:new u.Uniform2f(c),u_zoom:new u.Uniform1f(c),u_unpack:new u.Uniform4f(c)}),line:c=>({u_matrix:new u.UniformMatrix4f(c),u_pixels_to_tile_units:new u.UniformMatrix2f(c),u_device_pixel_ratio:new u.Uniform1f(c),u_units_to_pixels:new u.Uniform2f(c),u_dash_image:new u.Uniform1i(c),u_gradient_image:new u.Uniform1i(c),u_image_height:new u.Uniform1f(c),u_texsize:new u.Uniform2f(c),u_tile_units_to_pixels:new u.Uniform1f(c),u_alpha_discard_threshold:new u.Uniform1f(c),u_trim_offset:new u.Uniform2f(c)}),linePattern:c=>({u_matrix:new u.UniformMatrix4f(c),u_texsize:new u.Uniform2f(c),u_pixels_to_tile_units:new u.UniformMatrix2f(c),u_device_pixel_ratio:new u.Uniform1f(c),u_image:new u.Uniform1i(c),u_units_to_pixels:new u.Uniform2f(c),u_tile_units_to_pixels:new u.Uniform1f(c),u_alpha_discard_threshold:new u.Uniform1f(c)}),raster:c=>({u_matrix:new u.UniformMatrix4f(c),u_tl_parent:new u.Uniform2f(c),u_scale_parent:new u.Uniform1f(c),u_fade_t:new u.Uniform1f(c),u_opacity:new u.Uniform1f(c),u_image0:new u.Uniform1i(c),u_image1:new u.Uniform1i(c),u_brightness_low:new u.Uniform1f(c),u_brightness_high:new u.Uniform1f(c),u_saturation_factor:new u.Uniform1f(c),u_contrast_factor:new u.Uniform1f(c),u_spin_weights:new u.Uniform3f(c),u_perspective_transform:new u.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new u.Uniform1i(c),u_is_size_feature_constant:new u.Uniform1i(c),u_size_t:new u.Uniform1f(c),u_size:new u.Uniform1f(c),u_camera_to_center_distance:new u.Uniform1f(c),u_rotate_symbol:new u.Uniform1i(c),u_aspect_ratio:new u.Uniform1f(c),u_fade_change:new u.Uniform1f(c),u_matrix:new u.UniformMatrix4f(c),u_label_plane_matrix:new u.UniformMatrix4f(c),u_coord_matrix:new u.UniformMatrix4f(c),u_is_text:new u.Uniform1i(c),u_pitch_with_map:new u.Uniform1i(c),u_texsize:new u.Uniform2f(c),u_tile_id:new u.Uniform3f(c),u_zoom_transition:new u.Uniform1f(c),u_inv_rot_matrix:new u.UniformMatrix4f(c),u_merc_center:new u.Uniform2f(c),u_camera_forward:new u.Uniform3f(c),u_tile_matrix:new u.UniformMatrix4f(c),u_up_vector:new u.Uniform3f(c),u_ecef_origin:new u.Uniform3f(c),u_texture:new u.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new u.Uniform1i(c),u_is_size_feature_constant:new u.Uniform1i(c),u_size_t:new u.Uniform1f(c),u_size:new u.Uniform1f(c),u_camera_to_center_distance:new u.Uniform1f(c),u_rotate_symbol:new u.Uniform1i(c),u_aspect_ratio:new u.Uniform1f(c),u_fade_change:new u.Uniform1f(c),u_matrix:new u.UniformMatrix4f(c),u_label_plane_matrix:new u.UniformMatrix4f(c),u_coord_matrix:new u.UniformMatrix4f(c),u_is_text:new u.Uniform1i(c),u_pitch_with_map:new u.Uniform1i(c),u_texsize:new u.Uniform2f(c),u_texture:new u.Uniform1i(c),u_gamma_scale:new u.Uniform1f(c),u_device_pixel_ratio:new u.Uniform1f(c),u_tile_id:new u.Uniform3f(c),u_zoom_transition:new u.Uniform1f(c),u_inv_rot_matrix:new u.UniformMatrix4f(c),u_merc_center:new u.Uniform2f(c),u_camera_forward:new u.Uniform3f(c),u_tile_matrix:new u.UniformMatrix4f(c),u_up_vector:new u.Uniform3f(c),u_ecef_origin:new u.Uniform3f(c),u_is_halo:new u.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new u.Uniform1i(c),u_is_size_feature_constant:new u.Uniform1i(c),u_size_t:new u.Uniform1f(c),u_size:new u.Uniform1f(c),u_camera_to_center_distance:new u.Uniform1f(c),u_rotate_symbol:new u.Uniform1i(c),u_aspect_ratio:new u.Uniform1f(c),u_fade_change:new u.Uniform1f(c),u_matrix:new u.UniformMatrix4f(c),u_label_plane_matrix:new u.UniformMatrix4f(c),u_coord_matrix:new u.UniformMatrix4f(c),u_is_text:new u.Uniform1i(c),u_pitch_with_map:new u.Uniform1i(c),u_texsize:new u.Uniform2f(c),u_texsize_icon:new u.Uniform2f(c),u_texture:new u.Uniform1i(c),u_texture_icon:new u.Uniform1i(c),u_gamma_scale:new u.Uniform1f(c),u_device_pixel_ratio:new u.Uniform1f(c),u_is_halo:new u.Uniform1i(c)}),background:c=>({u_matrix:new u.UniformMatrix4f(c),u_opacity:new u.Uniform1f(c),u_color:new u.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new u.UniformMatrix4f(c),u_opacity:new u.Uniform1f(c),u_image:new u.Uniform1i(c),u_pattern_tl:new u.Uniform2f(c),u_pattern_br:new u.Uniform2f(c),u_texsize:new u.Uniform2f(c),u_pattern_size:new u.Uniform2f(c),u_pixel_coord_upper:new u.Uniform2f(c),u_pixel_coord_lower:new u.Uniform2f(c),u_tile_units_to_pixels:new u.Uniform1f(c)}),terrainRaster:Hs,terrainDepth:Hs,skybox:c=>({u_matrix:new u.UniformMatrix4f(c),u_sun_direction:new u.Uniform3f(c),u_cubemap:new u.Uniform1i(c),u_opacity:new u.Uniform1f(c),u_temporal_offset:new u.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new u.UniformMatrix4f(c),u_color_ramp:new u.Uniform1i(c),u_center_direction:new u.Uniform3f(c),u_radius:new u.Uniform1f(c),u_opacity:new u.Uniform1f(c),u_temporal_offset:new u.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new u.UniformMatrix3f(c),u_sun_direction:new u.Uniform3f(c),u_sun_intensity:new u.Uniform1f(c),u_color_tint_r:new u.Uniform4f(c),u_color_tint_m:new u.Uniform4f(c),u_luminance:new u.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new u.UniformMatrix4f(c),u_globe_matrix:new u.UniformMatrix4f(c),u_normalize_matrix:new u.UniformMatrix4f(c),u_merc_matrix:new u.UniformMatrix4f(c),u_zoom_transition:new u.Uniform1f(c),u_merc_center:new u.Uniform2f(c),u_image0:new u.Uniform1i(c),u_grid_matrix:new u.UniformMatrix3f(c),u_skirt_height:new u.Uniform1f(c),u_frustum_tl:new u.Uniform3f(c),u_frustum_tr:new u.Uniform3f(c),u_frustum_br:new u.Uniform3f(c),u_frustum_bl:new u.Uniform3f(c),u_globe_pos:new u.Uniform3f(c),u_globe_radius:new u.Uniform1f(c),u_viewport:new u.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new u.Uniform3f(c),u_frustum_tr:new u.Uniform3f(c),u_frustum_br:new u.Uniform3f(c),u_frustum_bl:new u.Uniform3f(c),u_horizon:new u.Uniform1f(c),u_transition:new u.Uniform1f(c),u_fadeout_range:new u.Uniform1f(c),u_color:new u.Uniform4f(c),u_high_color:new u.Uniform4f(c),u_space_color:new u.Uniform4f(c),u_star_intensity:new u.Uniform1f(c),u_star_density:new u.Uniform1f(c),u_star_size:new u.Uniform1f(c),u_temporal_offset:new u.Uniform1f(c),u_horizon_angle:new u.Uniform1f(c),u_rotation_matrix:new u.UniformMatrix4f(c)})};let J;function $(c,t,a,d,g,v,E){const C=c.context,P=C.gl,U=c.transform,V=c.useProgram("collisionBox"),q=[];let te=0,oe=0;for(let me=0;me<d.length;me++){const Pe=d[me],De=t.getTile(Pe),Re=De.getBucket(a);if(!Re)continue;const ze=go(Pe,Re,U);let Ne=ze;0===g[0]&&0===g[1]||(Ne=c.translatePosMatrix(ze,De,g,v));const We=E?Re.textCollisionBox:Re.iconCollisionBox,Bt=Re.collisionCircleArray;if(Bt.length>0){const qe=u.create(),mt=Ne;u.mul(qe,Re.placementInvProjMatrix,U.glCoordMatrix),u.mul(qe,qe,Re.placementViewportMatrix),q.push({circleArray:Bt,circleOffset:oe,transform:mt,invTransform:qe,projection:Re.getProjection()}),te+=Bt.length/4,oe=te}We&&(c.terrain&&c.terrain.setupElevationDraw(De,V),V.draw(C,P.LINES,u.DepthMode.disabled,u.StencilMode.disabled,c.colorModeForRenderPass(),u.CullFaceMode.disabled,xo(Ne,U,De,Re.getProjection()),a.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,U.zoom,null,[We.collisionVertexBuffer,We.collisionVertexBufferExt]))}if(!E||!q.length)return;const ae=c.useProgram("collisionCircle"),le=new u.StructArrayLayout2f1f2i16;le.resize(4*te),le._trim();let ce=0;for(const me of q)for(let Pe=0;Pe<me.circleArray.length/4;Pe++){const De=4*Pe,Re=me.circleArray[De+0],ze=me.circleArray[De+1],Ne=me.circleArray[De+2],We=me.circleArray[De+3];le.emplace(ce++,Re,ze,Ne,We,0),le.emplace(ce++,Re,ze,Ne,We,1),le.emplace(ce++,Re,ze,Ne,We,2),le.emplace(ce++,Re,ze,Ne,We,3)}(!J||J.length<2*te)&&(J=function(me){const Pe=2*me,De=new u.StructArrayLayout3ui6;De.resize(Pe),De._trim();for(let Re=0;Re<Pe;Re++){const ze=6*Re;De.uint16[ze+0]=4*Re+0,De.uint16[ze+1]=4*Re+1,De.uint16[ze+2]=4*Re+2,De.uint16[ze+3]=4*Re+2,De.uint16[ze+4]=4*Re+3,De.uint16[ze+5]=4*Re+0}return De}(te));const Y=C.createIndexBuffer(J,!0),se=C.createVertexBuffer(le,u.collisionCircleLayout.members,!0);for(const me of q){const Pe={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(fe=U).getCameraToCenterDistance(me.projection),u_viewport_size:[fe.width,fe.height]};ae.draw(C,P.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,c.colorModeForRenderPass(),u.CullFaceMode.disabled,Pe,a.id,se,Y,u.SegmentVector.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,U.zoom)}var fe;se.destroy(),Y.destroy()}const re=u.create();function Ae({width:c,height:t,anchor:a,textOffset:d,textScale:g},v){const{horizontalAlign:E,verticalAlign:C}=u.getAnchorAlignment(a),P=-(E-.5)*c,U=-(C-.5)*t,V=u.evaluateVariableOffset(a,d);return new u.Point((P/g+V[0])*v,(U/g+V[1])*v)}function it(c,t,a,d,g,v,E,C,P,U,V){const q=c.text.placedSymbolArray,te=c.text.dynamicLayoutVertexArray,oe=c.icon.dynamicLayoutVertexArray,ae={},le=c.getProjection(),ce=sr(C,le,v),Y=v.elevation,se=le.upVectorScale(C.canonical,v.center.lat,v.worldSize).metersToTile;te.clear();for(let fe=0;fe<q.length;fe++){const me=q.get(fe),{tileAnchorX:Pe,tileAnchorY:De,numGlyphs:Re}=me,ze=me.hidden||!me.crossTileID||c.allowVerticalPlacement&&!me.placedOrientation?null:d[me.crossTileID];if(ze){let Ne=0,We=0,Bt=0;if(Y){const Ot=Y?Y.getAtTileOffset(C,Pe,De):0,[_n,Un,hn]=le.upVector(C.canonical,Pe,De);Ne=Ot*_n*se,We=Ot*Un*se,Bt=Ot*hn*se}let[qe,mt,Qe,Lt]=rr(me.projectedAnchorX+Ne,me.projectedAnchorY+We,me.projectedAnchorZ+Bt,a?ce:E);const Ye=po(v.getCameraToCenterDistance(le),Lt);let ut=g.evaluateSizeForFeature(c.textSizeData,U,me)*Ye/u.ONE_EM;a&&(ut*=c.tilePixelRatio/P);const zt=Ae(ze,ut);a?(({x:qe,y:mt,z:Qe}=le.projectTilePoint(Pe+zt.x,De+zt.y,C.canonical)),[qe,mt,Qe]=rr(qe+Ne,mt+We,Qe+Bt,E)):(t&&zt._rotate(-v.angle),qe+=zt.x,mt+=zt.y,Qe=0);const Ct=c.allowVerticalPlacement&&me.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let Ot=0;Ot<Re;Ot++)u.addDynamicAttributes(te,qe,mt,Qe,Ct);V&&me.associatedIconIndex>=0&&(ae[me.associatedIconIndex]={x:qe,y:mt,z:Qe,angle:Ct})}else bi(Re,te)}if(V){oe.clear();const fe=c.icon.placedSymbolArray;for(let me=0;me<fe.length;me++){const Pe=fe.get(me),{numGlyphs:De}=Pe,Re=ae[me];if(Pe.hidden||!Re)bi(De,oe);else{const{x:ze,y:Ne,z:We,angle:Bt}=Re;for(let qe=0;qe<De;qe++)u.addDynamicAttributes(oe,ze,Ne,We,Bt)}}c.icon.dynamicLayoutVertexBuffer.updateData(oe)}c.text.dynamicLayoutVertexBuffer.updateData(te)}function At(c,t,a){return a.iconsInText&&t?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function un(c,t,a,d,g,v,E,C,P,U,V,q){const te=c.context,oe=te.gl,ae=c.transform,le="map"===C,ce="map"===P,Y=le&&"point"!==a.layout.get("symbol-placement"),se=le&&!ce&&!Y,fe=void 0!==a.layout.get("symbol-sort-key").constantOr(1);let me=!1;const Pe=c.depthModeForSublayer(0,u.DepthMode.ReadOnly),De=[u.mercatorXfromLng(ae.center.lng),u.mercatorYfromLat(ae.center.lat)],Re=a.layout.get("text-variable-anchor"),ze="globe"===ae.projection.name,Ne=[],We=[0,-1,0];let Bt=We;!ze&&!ae.mercatorFromTransition||le||(Bt=function(qe){const mt=qe._camera.getWorldToCamera(qe.worldSize,1),Qe=u.multiply([],mt,qe.globeMatrix);u.invert(Qe,Qe);const Lt=[0,0,0],Ye=[0,1,0,0];return u.transformMat4$1(Ye,Ye,Qe),Lt[0]=Ye[0],Lt[1]=Ye[1],Lt[2]=Ye[2],u.normalize(Lt,Lt),Lt}(ae));for(const qe of d){const mt=t.getTile(qe),Qe=mt.getBucket(a);if(!Qe||"mercator"===Qe.projection.name&&ze)continue;const Lt=g?Qe.text:Qe.icon;if(!Lt||Qe.fullyClipped||!Lt.segments.get().length)continue;const Ye=Lt.programConfigurations.get(a.id),ut=g||Qe.sdfIcons,zt=g?Qe.textSizeData:Qe.iconSizeData,Ct=ce||0!==ae.pitch,Ot=u.evaluateSizeForZoom(zt,ae.zoom);let _n,Un,hn,Sn,Qn=[0,0],er=null;if(g)Un=mt.glyphAtlasTexture,hn=oe.LINEAR,_n=mt.glyphAtlasTexture.size,Qe.iconsInText&&(Qn=mt.imageAtlasTexture.size,er=mt.imageAtlasTexture,Sn=Ct||c.options.rotating||c.options.zooming||"composite"===zt.kind||"camera"===zt.kind?oe.LINEAR:oe.NEAREST);else{const pa=1!==a.layout.get("icon-size").constantOr(0)||Qe.iconsNeedLinear;Un=mt.imageAtlasTexture,hn=ut||c.options.rotating||c.options.zooming||pa||Ct?oe.LINEAR:oe.NEAREST,_n=mt.imageAtlasTexture.size}const yn="globe"===Qe.projection.name,Fr=yn?Bt:We,$r=yn?u.globeToMercatorTransition(ae.zoom):0,Yr=sr(qe,Qe.getProjection(),ae),ni=ae.calculatePixelsToTileUnitsMatrix(mt),Go=rt(Yr,mt.tileID.canonical,ce,le,ae,Qe.getProjection(),ni),Eo=c.terrain&&ce&&Y?u.invert(u.create(),Go):re,ta=Ir(Yr,mt.tileID.canonical,ce,le,ae,Qe.getProjection(),ni),Rs=Re&&Qe.hasTextData(),hi="none"!==a.layout.get("icon-text-fit")&&Rs&&Qe.hasIconData();if(Y){const pa=ae.elevation,Ls=pa?pa.getAtTileOffsetFunc(qe,ae.center.lat,ae.worldSize,Qe.getProjection()):null,Yl=io(Yr,mt.tileID.canonical,ce,le,ae,Qe.getProjection(),ni);Ii(Qe,Yr,c,g,Yl,ta,ce,U,Ls,qe)}const Kr=Y||g&&Re||hi,Pr=c.translatePosMatrix(Yr,mt,v,E),eo=Kr?re:Go,Ho=c.translatePosMatrix(ta,mt,v,E,!0),mi=Qe.getProjection().createInversionMatrix(ae,qe.canonical),Zo=[];c.terrainRenderModeElevated()&&ce&&Zo.push("PITCH_WITH_MAP_TERRAIN"),yn&&Zo.push("PROJECTION_GLOBE_VIEW"),Kr&&Zo.push("PROJECTED_POS_ON_VIEWPORT");const Pu=ut&&0!==a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1);let Cl;Cl=ut?Qe.iconsInText?Ul(zt.kind,Ot,se,ce,c,Pr,eo,Ho,_n,Qn,qe,$r,De,mi,Fr,Qe.getProjection()):Ws(zt.kind,Ot,se,ce,c,Pr,eo,Ho,g,_n,!0,qe,$r,De,mi,Fr,Qe.getProjection()):Xa(zt.kind,Ot,se,ce,c,Pr,eo,Ho,g,_n,qe,$r,De,mi,Fr,Qe.getProjection());const Dl={program:c.useProgram(At(ut,g,Qe),Ye,Zo),buffers:Lt,uniformValues:Cl,atlasTexture:Un,atlasTextureIcon:er,atlasInterpolation:hn,atlasInterpolationIcon:Sn,isSDF:ut,hasHalo:Pu,tile:mt,labelPlaneMatrixInv:Eo};if(fe&&Qe.canOverlap){me=!0;const pa=Lt.segments.get();for(const Ls of pa)Ne.push({segments:new u.SegmentVector([Ls]),sortKey:Ls.sortKey,state:Dl})}else Ne.push({segments:Lt.segments,sortKey:0,state:Dl})}me&&Ne.sort((qe,mt)=>qe.sortKey-mt.sortKey);for(const qe of Ne){const mt=qe.state;if(c.terrain&&c.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:!ze,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}),te.activeTexture.set(oe.TEXTURE0),mt.atlasTexture.bind(mt.atlasInterpolation,oe.CLAMP_TO_EDGE),mt.atlasTextureIcon&&(te.activeTexture.set(oe.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),mt.isSDF){const Qe=mt.uniformValues;mt.hasHalo&&(Qe.u_is_halo=1,yr(mt.buffers,qe.segments,a,c,mt.program,Pe,V,q,Qe)),Qe.u_is_halo=0}yr(mt.buffers,qe.segments,a,c,mt.program,Pe,V,q,mt.uniformValues)}}function yr(c,t,a,d,g,v,E,C,P){const U=d.context,V=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];g.draw(U,U.gl.TRIANGLES,v,E,C,u.CullFaceMode.disabled,P,a.id,c.layoutVertexBuffer,c.indexBuffer,t,a.paint,d.transform.zoom,c.programConfigurations.get(a.id),V)}function wr(c,t,a,d,g,v,E){const C=c.context.gl,P=a.paint.get("fill-pattern"),U=P&&P.constantOr(1);let V,q,te,oe,ae;E?(q=U&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=C.LINES):(q=U?"fillPattern":"fill",V=C.TRIANGLES);for(const le of d){const ce=t.getTile(le);if(U&&!ce.patternsLoaded())continue;const Y=ce.getBucket(a);if(!Y)continue;c.prepareDrawTile();const se=Y.programConfigurations.get(a.id),fe=c.useProgram(q,se);U&&(c.context.activeTexture.set(C.TEXTURE0),ce.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),se.updatePaintBuffers());const me=P.constantOr(null);if(me&&ce.imageAtlas){const De=ce.imageAtlas.patternPositions[me.toString()];De&&se.setConstantPatternPositions(De)}const Pe=c.translatePosMatrix(le.projMatrix,ce,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(E){oe=Y.indexBuffer2,ae=Y.segments2;const De=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];te="fillOutlinePattern"===q&&U?Xr(Pe,c,ce,De):zl(Pe,De)}else oe=Y.indexBuffer,ae=Y.segments,te=U?cs(Pe,c,ce):Wn(Pe);c.prepareDrawProgram(c.context,fe,le.toUnwrapped()),fe.draw(c.context,V,g,c.stencilModeForClipping(le),v,u.CullFaceMode.disabled,te,a.id,Y.layoutVertexBuffer,oe,ae,a.paint,c.transform.zoom,se)}}function Dr(c,t,a,d,g,v,E){const C=c.context,P=C.gl,U=c.transform,V=a.paint.get("fill-extrusion-pattern"),q=V.constantOr(1),te=a.paint.get("fill-extrusion-opacity"),oe=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],ae=a.layout.get("fill-extrusion-edge-radius"),le=ae>0&&!a.paint.get("fill-extrusion-rounded-roof"),ce=le?0:ae,Y="globe"===U.projection.name?u.fillExtrusionHeightLift():0,se="globe"===U.projection.name,fe=se?u.globeToMercatorTransition(U.zoom):0,me=[u.mercatorXfromLng(U.center.lng),u.mercatorYfromLat(U.center.lat)],Pe=[];se&&Pe.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&Pe.push("FAUX_AO"),le&&Pe.push("ZERO_ROOF_RADIUS");for(const De of d){const Re=t.getTile(De),ze=Re.getBucket(a);if(!ze||ze.projection.name!==U.projection.name)continue;const Ne=ze.programConfigurations.get(a.id),We=c.useProgram(q?"fillExtrusionPattern":"fillExtrusion",Ne,Pe);if(c.terrain){const ut=c.terrain;if(c.style.terrainSetForDrapingOnly())ut.setupElevationDraw(Re,We,{useMeterToDem:!0});else{if(!ze.enableTerrain)continue;if(ut.setupElevationDraw(Re,We,{useMeterToDem:!0}),dr(C,t,De,ze,a,ut),!ze.centroidVertexBuffer){const zt=We.attributes.a_centroid_pos;void 0!==zt&&P.vertexAttrib2f(zt,0,0)}}}q&&(c.context.activeTexture.set(P.TEXTURE0),Re.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ne.updatePaintBuffers());const Bt=V.constantOr(null);if(Bt&&Re.imageAtlas){const ut=Re.imageAtlas.patternPositions[Bt.toString()];ut&&Ne.setConstantPatternPositions(ut)}const qe=c.translatePosMatrix(De.projMatrix,Re,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),mt=U.projection.createInversionMatrix(U,De.canonical),Qe=a.paint.get("fill-extrusion-vertical-gradient"),Lt=q?Nt(qe,c,Qe,te,oe,ce,De,Re,Y,fe,me,mt):_l(qe,c,Qe,te,oe,ce,De,Y,fe,me,mt);c.prepareDrawProgram(C,We,De.toUnwrapped());const Ye=[];c.terrain&&Ye.push(ze.centroidVertexBuffer),se&&Ye.push(ze.layoutVertexExtBuffer),We.draw(C,C.gl.TRIANGLES,g,v,E,u.CullFaceMode.backCCW,Lt,a.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,a.paint,c.transform.zoom,Ne,Ye)}}function dr(c,t,a,d,g,v){const E=[Y=>{let se=Y.canonical.x-1,fe=Y.wrap;return se<0&&(se=(1<<Y.canonical.z)-1,fe--),new u.OverscaledTileID(Y.overscaledZ,fe,Y.canonical.z,se,Y.canonical.y)},Y=>{let se=Y.canonical.x+1,fe=Y.wrap;return se===1<<Y.canonical.z&&(se=0,fe++),new u.OverscaledTileID(Y.overscaledZ,fe,Y.canonical.z,se,Y.canonical.y)},Y=>new u.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,(0===Y.canonical.y?1<<Y.canonical.z:Y.canonical.y)-1),Y=>new u.OverscaledTileID(Y.overscaledZ,Y.wrap,Y.canonical.z,Y.canonical.x,Y.canonical.y===(1<<Y.canonical.z)-1?0:Y.canonical.y+1)],C=Y=>{const se=t.getSource().minzoom,fe=Pe=>{const De=t.getTileByID(Pe);if(De&&De.hasData())return De.getBucket(g)},me=[0,-1,1];for(const Pe of me){if(Y.overscaledZ+Pe<se)continue;const De=fe(Y.calculateScaledKey(Y.overscaledZ+Pe));if(De)return De}},P=[0,0,0],U=(Y,se)=>(P[0]=Math.min(Y.min.y,se.min.y),P[1]=Math.max(Y.max.y,se.max.y),P[2]=u.EXTENT-se.min.x>Y.max.x?se.min.x-u.EXTENT:Y.max.x,P),V=(Y,se)=>(P[0]=Math.min(Y.min.x,se.min.x),P[1]=Math.max(Y.max.x,se.max.x),P[2]=u.EXTENT-se.min.y>Y.max.y?se.min.y-u.EXTENT:Y.max.y,P),q=[(Y,se)=>U(Y,se),(Y,se)=>U(se,Y),(Y,se)=>V(Y,se),(Y,se)=>V(se,Y)],te=new u.Point(0,0);let oe,ae,le;const ce=(Y,se,fe,me,Pe)=>{const De=[[me?fe:Y,me?Y:fe,0],[me?fe:se,me?se:fe,0]],Re=Pe<0?u.EXTENT+Pe:Pe,ze=[me?Re:(Y+se)/2,me?(Y+se)/2:Re,0];return 0===fe&&Pe<0||0!==fe&&Pe>0?v.getForTilePoints(le,[ze],!0,ae):De.push(ze),v.getForTilePoints(a,De,!0,oe),Math.max(De[0][2],De[1][2],ze[2])/v.exaggeration()};for(let Y=0;Y<4;Y++){const se=(Y<2?1:5)-Y,fe=d.borders[Y];if(0===fe.length)continue;const me=le=E[Y](a),Pe=C(me);if(!(Pe&&Pe instanceof u.FillExtrusionBucket&&Pe.enableTerrain)||d.borderDoneWithNeighborZ[Y]===Pe.canonical.z&&Pe.borderDoneWithNeighborZ[se]===d.canonical.z||(ae=v.findDEMTileFor(me),!ae||!ae.dem))continue;if(!oe){const Ne=v.findDEMTileFor(a);if(!Ne||!Ne.dem)return;oe=Ne}const De=Pe.borders[se];let Re=0;const ze=Pe.borderDoneWithNeighborZ[se]!==d.canonical.z;if(d.canonical.z===Pe.canonical.z){for(let Ne=0;Ne<fe.length;Ne++){const We=d.featuresOnBorder[fe[Ne]],Bt=We.borders[Y];let qe;for(;Re<De.length&&(qe=Pe.featuresOnBorder[De[Re]],!(qe.borders[se][1]>Bt[0]+3));)ze&&Pe.encodeCentroid(void 0,qe,!1),Re++;if(qe&&Re<De.length){const mt=Re;let Qe=0;for(;!(qe.borders[se][0]>Bt[1]-3)&&(Qe++,++Re!==De.length);)qe=Pe.featuresOnBorder[De[Re]];if(qe=Pe.featuresOnBorder[De[mt]],We.intersectsCount()>1||qe.intersectsCount()>1||1!==Qe){1!==Qe&&(Re=mt),d.encodeCentroid(void 0,We,!1),ze&&Pe.encodeCentroid(void 0,qe,!1);continue}const Lt=q[Y](We,qe),Ye=Y%2?u.EXTENT-1:0;te.x=ce(Lt[0],Math.min(u.EXTENT-1,Lt[1]),Ye,Y<2,Lt[2]),te.y=0,d.encodeCentroid(te,We,!1),ze&&Pe.encodeCentroid(te,qe,!1)}else d.encodeCentroid(void 0,We,!1)}d.borderDoneWithNeighborZ[Y]=Pe.canonical.z,d.needsCentroidUpdate=!0,ze&&(Pe.borderDoneWithNeighborZ[se]=d.canonical.z,Pe.needsCentroidUpdate=!0)}else{for(const Ne of fe)d.encodeCentroid(void 0,d.featuresOnBorder[Ne],!1);if(ze){for(const Ne of De)Pe.encodeCentroid(void 0,Pe.featuresOnBorder[Ne],!1);Pe.borderDoneWithNeighborZ[se]=d.canonical.z,Pe.needsCentroidUpdate=!0}d.borderDoneWithNeighborZ[Y]=Pe.canonical.z,d.needsCentroidUpdate=!0}}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&0!==d.centroidVertexArray.length)&&d.uploadCentroid(c)}const nr=new u.Color(1,0,0,1),br=new u.Color(0,1,0,1),ar=new u.Color(0,0,1,1),Oo=new u.Color(1,0,1,1),lo=new u.Color(0,1,1,1);function Ts(c,t,a){const d=c.context,g=c.transform,v=d.gl,E="globe"===g.projection.name,C=E?["PROJECTION_GLOBE_VIEW"]:null;let P=a.projMatrix;if(E&&u.globeToMercatorTransition(g.zoom)>0){const We=u.transitionTileAABBinECEF(a.canonical,g),Bt=u.globeDenormalizeECEF(We);P=u.multiply(new Float32Array(16),g.globeMatrix,Bt),u.multiply(P,g.projMatrix,P)}const U=c.useProgram("debug",null,C),V=t.getTileByID(a.key);c.terrain&&c.terrain.setupElevationDraw(V,U);const q=u.DepthMode.disabled,te=u.StencilMode.disabled,oe=c.colorModeForRenderPass();d.activeTexture.set(v.TEXTURE0),c.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),E?V._makeGlobeTileDebugBuffers(c.context,g):V._makeDebugTileBoundsBuffers(c.context,g.projection);const le=V._tileDebugBuffer||c.debugBuffer,ce=V._tileDebugIndexBuffer||c.debugIndexBuffer,Y=V._tileDebugSegments||c.debugSegments;U.draw(d,v.LINE_STRIP,q,te,oe,u.CullFaceMode.disabled,us(P,u.Color.red),"$debug",le,ce,Y,null,null,null,[V._globeTileDebugBorderBuffer]);const se=V.latestRawTileData,fe=Math.floor((se&&se.byteLength||0)/1024),me=t.getTile(a).tileSize,Pe=512/Math.min(me,512)*(a.overscaledZ/g.zoom)*.5;let De=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(De+=` => ${a.overscaledZ}`),De+=` ${fe}kb`,function(We,Bt){We.initDebugOverlayCanvas();const qe=We.debugOverlayCanvas,mt=We.context.gl,Qe=We.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,qe.width,qe.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(Bt,5,5),Qe.strokeText(Bt,5,5),We.debugOverlayTexture.update(qe),We.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(c,De);const Re=V._tileDebugTextBuffer||c.debugBuffer,ze=V._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Ne=V._tileDebugTextSegments||c.debugSegments;U.draw(d,v.TRIANGLES,q,te,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,us(P,u.Color.transparent,Pe),"$debug",Re,ze,Ne,null,null,null,[V._globeTileDebugTextBuffer])}function co(c,t,a,d){ds(c,0,t+a/2,c.transform.width,a,d)}function hs(c,t,a,d){ds(c,t-a/2,0,a,c.transform.height,d)}function ds(c,t,a,d,g,v){const E=c.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*u.exported.devicePixelRatio,a*u.exported.devicePixelRatio,d*u.exported.devicePixelRatio,g*u.exported.devicePixelRatio),E.clear({color:v}),C.disable(C.SCISSOR_TEST)}const Xs=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:j}=Xs;function F(c,t,a,d){c.emplaceBack(t,a,d)}class R{constructor(t){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,F(this.vertexArray,-1,-1,1),F(this.vertexArray,1,-1,1),F(this.vertexArray,-1,1,1),F(this.vertexArray,1,1,1),F(this.vertexArray,-1,-1,-1),F(this.vertexArray,1,-1,-1),F(this.vertexArray,-1,1,-1),F(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,j),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function Q(c,t,a,d,g,v){const E=c.gl,C=t.paint.get("sky-atmosphere-color"),P=t.paint.get("sky-atmosphere-halo-color"),U=t.paint.get("sky-atmosphere-sun-intensity"),V={u_matrix_3f:u.fromMat4(u.create$1(),d),u_sun_direction:g,u_sun_intensity:U,u_color_tint_r:[(ae=C).r,ae.g,ae.b,ae.a],u_color_tint_m:[(le=P).r,le.g,le.b,le.a],u_luminance:5e-5};var ae,le;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),a.draw(c,E.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,V,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Ve=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Jt{constructor(t){const a=new u.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new u.StructArrayLayout3ui6;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,Ve.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fr={symbol:function(c,t,a,d,g){if("translucent"!==c.renderPass)return;const v=u.StencilMode.disabled,E=c.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(C,P,U,V,q,te,oe){const ae=P.transform,le="map"===q,ce="map"===te;for(const Y of C){const se=V.getTile(Y),fe=se.getBucket(U);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const me=u.evaluateSizeForZoom(fe.textSizeData,ae.zoom),Pe=sr(Y,fe.getProjection(),ae),De=ae.calculatePixelsToTileUnitsMatrix(se),Re=rt(Pe,se.tileID.canonical,ce,le,ae,fe.getProjection(),De),ze="none"!==U.layout.get("icon-text-fit")&&fe.hasIconData();if(me){const Ne=Math.pow(2,ae.zoom-se.tileID.overscaledZ);it(fe,le,ce,oe,u.symbolSize,ae,Re,Y,Ne,me,ze)}}}(d,c,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),0!==a.paint.get("icon-opacity").constantOr(1)&&un(c,t,a,d,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),v,E),0!==a.paint.get("text-opacity").constantOr(1)&&un(c,t,a,d,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),v,E),t.map.showCollisionBoxes&&($(c,t,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),$(c,t,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,a,d){if("translucent"!==c.renderPass)return;const g=a.paint.get("circle-opacity"),v=a.paint.get("circle-stroke-width"),E=a.paint.get("circle-stroke-opacity"),C=void 0!==a.layout.get("circle-sort-key").constantOr(1);if(0===g.constantOr(1)&&(0===v.constantOr(1)||0===E.constantOr(1)))return;const P=c.context,U=P.gl,V=c.transform,q=c.depthModeForSublayer(0,u.DepthMode.ReadOnly),te=u.StencilMode.disabled,oe=c.colorModeForRenderPass(),ae="globe"===V.projection.name,le=[u.mercatorXfromLng(V.center.lng),u.mercatorYfromLat(V.center.lat)],ce=[];for(let se=0;se<d.length;se++){const fe=d[se],me=t.getTile(fe),Pe=me.getBucket(a);if(!Pe||Pe.projection.name!==V.projection.name)continue;const De=Pe.programConfigurations.get(a.id),Re=Qi(a);ae&&Re.push("PROJECTION_GLOBE_VIEW");const ze=c.useProgram("circle",De,Re),Ne=Pe.layoutVertexBuffer,We=Pe.globeExtVertexBuffer,Bt=Pe.indexBuffer,qe=V.projection.createInversionMatrix(V,fe.canonical),mt={programConfiguration:De,program:ze,layoutVertexBuffer:Ne,globeExtVertexBuffer:We,indexBuffer:Bt,uniformValues:Ni(c,fe,me,qe,le,a),tile:me};if(C){const Qe=Pe.segments.get();for(const Lt of Qe)ce.push({segments:new u.SegmentVector([Lt]),sortKey:Lt.sortKey,state:mt})}else ce.push({segments:Pe.segments,sortKey:0,state:mt})}C&&ce.sort((se,fe)=>se.sortKey-fe.sortKey);const Y={useDepthForOcclusion:!ae};for(const se of ce){const{programConfiguration:fe,program:me,layoutVertexBuffer:Pe,globeExtVertexBuffer:De,indexBuffer:Re,uniformValues:ze,tile:Ne}=se.state,We=se.segments;c.terrain&&c.terrain.setupElevationDraw(Ne,me,Y),c.prepareDrawProgram(P,me,Ne.tileID.toUnwrapped()),me.draw(P,U.TRIANGLES,q,te,oe,u.CullFaceMode.disabled,ze,a.id,Pe,Re,We,a.paint,V.zoom,fe,[De])}},heatmap:function(c,t,a,d){if(0!==a.paint.get("heatmap-opacity"))if("offscreen"===c.renderPass){const g=c.context,v=g.gl,E=u.StencilMode.disabled,C=new u.ColorMode([v.ONE,v.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(oe,ae,le,ce){const Y=oe.gl,se=ae.width*ce,fe=ae.height*ce;oe.activeTexture.set(Y.TEXTURE1),oe.viewport.set([0,0,se,fe]);let me=le.heatmapFbo;if(!me||me&&(me.width!==se||me.height!==fe)){me&&me.destroy();const Pe=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,Pe),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),me=le.heatmapFbo=oe.createFramebuffer(se,fe,!1),function(De,Re,ze,Ne,We,Bt){const qe=De.gl;qe.texImage2D(qe.TEXTURE_2D,0,De.isWebGL2&&De.extRenderToTextureHalfFloat?qe.RGBA16F:qe.RGBA,We,Bt,0,qe.RGBA,De.extRenderToTextureHalfFloat?De.isWebGL2?qe.HALF_FLOAT:De.extTextureHalfFloat.HALF_FLOAT_OES:qe.UNSIGNED_BYTE,null),Ne.colorAttachment.set(ze)}(oe,0,Pe,me,se,fe)}else Y.bindTexture(Y.TEXTURE_2D,me.colorAttachment.get()),oe.bindFramebuffer.set(me.framebuffer)})(g,c,a,"globe"===c.transform.projection.name?.5:.25),g.clear({color:u.Color.transparent});const P=c.transform,U="globe"===P.projection.name,V=U?["PROJECTION_GLOBE_VIEW"]:null,q=U?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,te=[u.mercatorXfromLng(P.center.lng),u.mercatorYfromLat(P.center.lat)];for(let oe=0;oe<d.length;oe++){const ae=d[oe];if(t.hasRenderableParent(ae))continue;const le=t.getTile(ae),ce=le.getBucket(a);if(!ce||ce.projection.name!==P.projection.name)continue;const Y=ce.programConfigurations.get(a.id),se=c.useProgram("heatmap",Y,V),{zoom:fe}=c.transform;c.terrain&&c.terrain.setupElevationDraw(le,se),c.prepareDrawProgram(g,se,ae.toUnwrapped());const me=P.projection.createInversionMatrix(P,ae.canonical);se.draw(g,v.TRIANGLES,u.DepthMode.disabled,E,C,q,Vl(c,ae,le,me,te,fe,a.paint.get("heatmap-intensity")),a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,a.paint,c.transform.zoom,Y,U?[ce.globeExtVertexBuffer]:null)}g.viewport.set([0,0,c.width,c.height])}else"translucent"===c.renderPass&&(c.context.setColorMode(c.colorModeForRenderPass()),function(g,v){const E=g.context,C=E.gl,P=v.heatmapFbo;if(!P)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let U=v.colorRampTexture;U||(U=v.colorRampTexture=new u.Texture(E,v.colorRamp,C.RGBA)),U.bind(C.LINEAR,C.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(E,C.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,g.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(c,a))},line:function(c,t,a,d){if("translucent"!==c.renderPass)return;const g=a.paint.get("line-opacity"),v=a.paint.get("line-width");if(0===g.constantOr(1)||0===v.constantOr(1))return;const E=c.depthModeForSublayer(0,u.DepthMode.ReadOnly),C=c.colorModeForRenderPass(),P=c.terrain&&c.terrain.renderingToTexture?1:u.exported.devicePixelRatio,U=a.paint.get("line-dasharray"),V=U.constantOr(1),q=a.layout.get("line-cap"),te=a.paint.get("line-pattern"),oe=te.constantOr(1),ae=a.paint.get("line-gradient"),le=oe?"linePattern":"line",ce=c.context,Y=ce.gl,se=(me=>{const Pe=[];Ko(me)&&Pe.push("RENDER_LINE_DASH"),me.paint.get("line-gradient")&&Pe.push("RENDER_LINE_GRADIENT");const De=me.paint.get("line-trim-offset");0===De[0]&&0===De[1]||Pe.push("RENDER_LINE_TRIM_OFFSET");const Re=me.paint.get("line-pattern").constantOr(1),ze=1!==me.paint.get("line-opacity").constantOr(1);return!Re&&ze&&Pe.push("RENDER_LINE_ALPHA_DISCARD"),Pe})(a);let fe=se.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const me of d){const Pe=t.getTile(me);if(oe&&!Pe.patternsLoaded())continue;const De=Pe.getBucket(a);if(!De)continue;c.prepareDrawTile();const Re=De.programConfigurations.get(a.id),ze=c.useProgram(le,Re,se),Ne=te.constantOr(null);if(Ne&&Pe.imageAtlas){const ut=Pe.imageAtlas.patternPositions[Ne.toString()];ut&&Re.setConstantPatternPositions(ut)}const We=U.constantOr(null),Bt=q.constantOr(null);if(!oe&&We&&Bt&&Pe.lineAtlas){const ut=Pe.lineAtlas.getDash(We,Bt);ut&&Re.setConstantPatternPositions(ut)}let[qe,mt]=a.paint.get("line-trim-offset");("round"===Bt||"square"===Bt)&&qe!==mt&&(0===qe&&(qe-=1),1===mt&&(mt+=1));const Qe=c.terrain?me.projMatrix:null,Lt=oe?Ta(c,Pe,a,Qe,P):Zc(c,Pe,a,Qe,De.lineClipsArray.length,P,[qe,mt]);if(ae){const ut=De.gradients[a.id];let zt=ut.texture;if(a.gradientVersion!==ut.version){let Ct=256;if(a.stepInterpolant){const Ot=t.getSource().maxzoom,_n=me.canonical.z===Ot?Math.ceil(1<<c.transform.maxZoom-me.canonical.z):1;Ct=u.clamp(u.nextPowerOfTwo(De.maxLineLength/u.EXTENT*1024*_n),256,ce.maxTextureSize)}ut.gradient=u.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ct,image:ut.gradient||void 0,clips:De.lineClipsArray}),ut.texture?ut.texture.update(ut.gradient):ut.texture=new u.Texture(ce,ut.gradient,Y.RGBA),ut.version=a.gradientVersion,zt=ut.texture}ce.activeTexture.set(Y.TEXTURE1),zt.bind(a.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}V&&(ce.activeTexture.set(Y.TEXTURE0),Pe.lineAtlasTexture.bind(Y.LINEAR,Y.REPEAT),Re.updatePaintBuffers()),oe&&(ce.activeTexture.set(Y.TEXTURE0),Pe.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Re.updatePaintBuffers()),c.prepareDrawProgram(ce,ze,me.toUnwrapped());const Ye=ut=>{ze.draw(ce,Y.TRIANGLES,E,ut,C,u.CullFaceMode.disabled,Lt,a.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,a.paint,c.transform.zoom,Re,[De.layoutVertexBuffer2])};if(fe){const ut=c.stencilModeForClipping(me).ref;0===ut&&c.terrain&&ce.clear({stencil:0});const zt={func:Y.EQUAL,mask:255};Lt.u_alpha_discard_threshold=.8,Ye(new u.StencilMode(zt,ut,255,Y.KEEP,Y.KEEP,Y.INVERT)),Lt.u_alpha_discard_threshold=0,Ye(new u.StencilMode(zt,ut,255,Y.KEEP,Y.KEEP,Y.KEEP))}else Ye(c.stencilModeForClipping(me))}fe&&(c.resetStencilClippingMasks(),c.terrain&&ce.clear({stencil:0}))},fill:function(c,t,a,d){const g=a.paint.get("fill-color"),v=a.paint.get("fill-opacity");if(0===v.constantOr(1))return;const E=c.colorModeForRenderPass(),C=a.paint.get("fill-pattern"),P=c.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===g.constantOr(u.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(c.renderPass===P){const U=c.depthModeForSublayer(1,"opaque"===c.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);wr(c,t,a,d,U,E,!1)}if("translucent"===c.renderPass&&a.paint.get("fill-antialias")){const U=c.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);wr(c,t,a,d,U,E,!0)}},"fill-extrusion":function(c,t,a,d){const g=a.paint.get("fill-extrusion-opacity");if(0!==g&&"translucent"===c.renderPass){const v=new u.DepthMode(c.context.gl.LEQUAL,u.DepthMode.ReadWrite,c.depthRangeFor3D);if(1!==g||a.paint.get("fill-extrusion-pattern").constantOr(1))Dr(c,t,a,d,v,u.StencilMode.disabled,u.ColorMode.disabled),Dr(c,t,a,d,v,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const E=c.colorModeForRenderPass();Dr(c,t,a,d,v,u.StencilMode.disabled,E)}}},hillshade:function(c,t,a,d){if("offscreen"!==c.renderPass&&"translucent"!==c.renderPass)return;const g=c.context,v=c.depthModeForSublayer(0,u.DepthMode.ReadOnly),E=c.colorModeForRenderPass(),C=c.terrain&&c.terrain.renderingToTexture,[P,U]="translucent"!==c.renderPass||C?[{},d]:c.stencilConfigForOverlap(d);for(const V of U){const q=t.getTile(V);if(q.needsHillshadePrepare&&"offscreen"===c.renderPass)la(c,q,a,v,u.StencilMode.disabled,E);else if("translucent"===c.renderPass){const te=C&&c.terrain?c.terrain.stencilModeForRTTOverlap(V):P[V.overscaledZ];Ca(c,V,q,a,v,te,E)}}g.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,a,d,g,v){if("translucent"!==c.renderPass||0===a.paint.get("raster-opacity")||!d.length)return;const E=c.context,C=E.gl,P=t.getSource(),U=c.useProgram("raster"),V=c.colorModeForRenderPass(),q=c.terrain&&c.terrain.renderingToTexture,[te,oe]=P instanceof $n||q?[{},d]:c.stencilConfigForOverlap(d),ae=oe[oe.length-1].overscaledZ,le=!c.options.moving;for(const ce of oe){const Y=q?u.DepthMode.disabled:c.depthModeForSublayer(ce.overscaledZ-ae,1===a.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,C.LESS),se=ce.toUnwrapped(),fe=t.getTile(ce);if(q&&(!fe||!fe.hasData()))continue;const me=q?ce.projMatrix:c.transform.calculateProjMatrix(se,le),Pe=c.terrain&&q?c.terrain.stencilModeForRTTOverlap(ce):te[ce.overscaledZ],De=v?0:a.paint.get("raster-fade-duration");fe.registerFadeDuration(De);const Re=t.findLoadedParent(ce,0),ze=Nn(fe,Re,t,c.transform,De);let Ne,We;c.terrain&&c.terrain.prepareDrawTile();const Bt="nearest"===a.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),fe.texture.bind(Bt,C.CLAMP_TO_EDGE),E.activeTexture.set(C.TEXTURE1),Re?(Re.texture.bind(Bt,C.CLAMP_TO_EDGE),Ne=Math.pow(2,Re.tileID.overscaledZ-fe.tileID.overscaledZ),We=[fe.tileID.canonical.x*Ne%1,fe.tileID.canonical.y*Ne%1]):fe.texture.bind(Bt,C.CLAMP_TO_EDGE),fe.texture.useMipmap&&E.extTextureFilterAnisotropic&&c.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const qe=wo(me,We||[0,0],Ne||1,ze,a,P instanceof $n?P.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(E,U,se),P instanceof $n)P.boundsBuffer&&P.boundsSegments&&U.draw(E,C.TRIANGLES,Y,u.StencilMode.disabled,V,u.CullFaceMode.disabled,qe,a.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:Qe,tileBoundsSegments:Lt}=c.getTileBoundsBuffers(fe);U.draw(E,C.TRIANGLES,Y,Pe,V,u.CullFaceMode.disabled,qe,a.id,mt,Qe,Lt)}}c.resetStencilClippingMasks()},background:function(c,t,a,d){const g=a.paint.get("background-color"),v=a.paint.get("background-opacity");if(0===v)return;const E=c.context,C=E.gl,P=c.transform,U=P.tileSize,V=a.paint.get("background-pattern");if(c.isPatternMissing(V))return;const q=!V&&1===g.a&&1===v&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==q)return;const te=u.StencilMode.disabled,oe=c.depthModeForSublayer(0,"opaque"===q?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),ae=c.colorModeForRenderPass(),le=c.useProgram(V?"backgroundPattern":"background");let ce,Y=d;Y||(ce=c.getBackgroundTiles(),Y=Object.values(ce).map(se=>se.tileID)),V&&(E.activeTexture.set(C.TEXTURE0),c.imageManager.bind(c.context));for(const se of Y){const fe=se.toUnwrapped(),me=d?se.projMatrix:c.transform.calculateProjMatrix(fe);c.prepareDrawTile();const Pe=t?t.getTile(se):ce?ce[se.key]:new u.Tile(se,U,P.zoom,c),De=V?Ya(me,v,c,V,{tileID:se,tileSize:U}):Sa(me,v,g);c.prepareDrawProgram(E,le,fe);const{tileBoundsBuffer:Re,tileBoundsIndexBuffer:ze,tileBoundsSegments:Ne}=c.getTileBoundsBuffers(Pe);le.draw(E,C.TRIANGLES,oe,te,ae,u.CullFaceMode.disabled,De,a.id,Re,ze,Ne)}},sky:function(c,t,a){const d=c.transform,g="mercator"===d.projection.name||"globe"===d.projection.name?1:u.smoothstep(7,8,d.zoom),v=a.paint.get("sky-opacity")*g;if(0===v)return;const E=c.context,C=a.paint.get("sky-type"),P=new u.DepthMode(E.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),U=c.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===c.renderPass?a.needsSkyboxCapture(c)&&(function(V,q,te,oe){const ae=V.context,le=ae.gl;let ce=q.skyboxFbo;if(!ce){ce=q.skyboxFbo=ae.createFramebuffer(32,32,!1),q.skyboxGeometry=new R(ae),q.skyboxTexture=ae.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,q.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let me=0;me<6;++me)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}ae.bindFramebuffer.set(ce.framebuffer),ae.viewport.set([0,0,32,32]);const Y=q.getCenter(V,!0),se=V.useProgram("skyboxCapture"),fe=new Float64Array(16);u.identity(fe),u.rotateY(fe,fe,.5*-Math.PI),Q(ae,q,se,fe,Y,0),u.identity(fe),u.rotateY(fe,fe,.5*Math.PI),Q(ae,q,se,fe,Y,1),u.identity(fe),u.rotateX(fe,fe,.5*-Math.PI),Q(ae,q,se,fe,Y,2),u.identity(fe),u.rotateX(fe,fe,.5*Math.PI),Q(ae,q,se,fe,Y,3),u.identity(fe),Q(ae,q,se,fe,Y,4),u.identity(fe),u.rotateY(fe,fe,Math.PI),Q(ae,q,se,fe,Y,5),ae.viewport.set([0,0,V.width,V.height])}(c,a),a.markSkyboxValid(c)):"sky"===c.renderPass&&function(V,q,te,oe,ae){const le=V.context,ce=le.gl,Y=V.transform,se=V.useProgram("skybox");le.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_CUBE_MAP,q.skyboxTexture);const fe={u_matrix:Y.skyboxMatrix,u_sun_direction:q.getCenter(V,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:ae};V.prepareDrawProgram(le,se),se.draw(le,ce.TRIANGLES,te,u.StencilMode.disabled,V.colorModeForRenderPass(),u.CullFaceMode.backCW,fe,"skybox",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(c,a,P,v,U):"gradient"===C&&"sky"===c.renderPass&&function(V,q,te,oe,ae){const le=V.context,ce=le.gl,Y=V.transform,se=V.useProgram("skyboxGradient");q.skyboxGeometry||(q.skyboxGeometry=new R(le)),le.activeTexture.set(ce.TEXTURE0);let fe=q.colorRampTexture;fe||(fe=q.colorRampTexture=new u.Texture(le,q.colorRamp,ce.RGBA)),fe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE);const me=(Pe=Y.skyboxMatrix,De=q.getCenter(V,!1),Re=q.paint.get("sky-gradient-radius"),ze=oe,Ne=ae,{u_matrix:Pe,u_color_ramp:0,u_center_direction:De,u_radius:u.degToRad(Re),u_opacity:ze,u_temporal_offset:Ne});var Pe,De,Re,ze,Ne;V.prepareDrawProgram(le,se),se.draw(le,ce.TRIANGLES,te,u.StencilMode.disabled,V.colorModeForRenderPass(),u.CullFaceMode.backCW,me,"skyboxGradient",q.skyboxGeometry.vertexBuffer,q.skyboxGeometry.indexBuffer,q.skyboxGeometry.segment)}(c,a,P,v,U)},debug:function(c,t,a){for(let d=0;d<a.length;d++)Ts(c,t,a[d])},custom:function(c,t,a,d){const g=c.context,v=a.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||"offscreen"===c.renderPass)&&a.isLayerDraped()){if("offscreen"===c.renderPass){const E=v.prerender;if(E){if(c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),"globe"===c.transform.projection.name){const C=c.transform.pointMerc;E.call(v,g.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(c.transform.zoom),[C.x,C.y],c.transform.pixelsPerMeterRatio)}else E.call(v,g.gl,c.transform.customLayerMatrix());g.setDirty(),c.setBaseState()}}else if("translucent"===c.renderPass){if(c.terrain&&c.terrain.renderingToTexture){const C=v.renderToTile;if(C){const P=d[0].canonical,U=new u.MercatorCoordinate(P.x+d[0].wrap*(1<<P.z),P.y,P.z);g.setDepthMode(u.DepthMode.disabled),g.setStencilMode(u.StencilMode.disabled),g.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),C.call(v,g.gl,U),g.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),g.setStencilMode(u.StencilMode.disabled);const E="3d"===v.renderingMode?new u.DepthMode(c.context.gl.LEQUAL,u.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,u.DepthMode.ReadOnly);if(g.setDepthMode(E),"globe"===c.transform.projection.name){const C=c.transform.pointMerc;v.render(g.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(c.transform.zoom),[C.x,C.y],c.transform.pixelsPerMeterRatio)}else v.render(g.gl,c.transform.customLayerMatrix());g.setDirty(),c.setBaseState(),g.bindFramebuffer.set(null)}}else u.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ri{constructor(t,a,d=!1){this.context=new xt(t,d),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,a){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new gl(this,t));const g=this._terrain;this.transform.elevation=d?g:null,g.update(t,this.transform,a)}_updateFog(t){const a=t.fog;if(!a||"globe"===this.transform.projection.name||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,g]=a.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);const v=d+.78*(g-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,a){if(this.width=t*u.exported.devicePixelRatio,this.height=a*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._layers[d].resize()}setup(){const t=this.context,a=new u.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(u.EXTENT,0),a.emplaceBack(0,u.EXTENT),a.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(a,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const d=new u.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(u.EXTENT,0),d.emplaceBack(0,u.EXTENT),d.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=t.createVertexBuffer(d,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const g=new u.StructArrayLayout2i4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const v=new u.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(u.EXTENT,0,u.EXTENT,0),v.emplaceBack(0,u.EXTENT,0,u.EXTENT),v.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(v,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const E=new u.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(E);const C=new u.StructArrayLayout1ui2;for(const U of[0,1,3,2,0])C.emplaceBack(U);this.debugIndexBuffer=t.createIndexBuffer(C),this.emptyTexture=new u.Texture(t,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=u.create();const P=this.context.gl;this.stencilClearMode=new u.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new Jt(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,a.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,Zs(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,d){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!d||0===d.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const P of d)if(void 0===this._tileClippingMaskIDs[P.key]){C=!0;break}if(!C)return}this.currentStencilSource=a.id;const g=this.context,v=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(u.ColorMode.disabled),g.setDepthMode(u.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of d){const P=a.getTile(C),U=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:q,tileBoundsSegments:te}=this.getTileBoundsBuffers(P);E.draw(g,v.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:v.ALWAYS,mask:0},U,255,v.KEEP,v.KEEP,v.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Zs(C.projMatrix),"$clipping",V,q,te)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new u.StencilMode({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new u.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,d=t.sort((E,C)=>C.overscaledZ-E.overscaledZ),g=d[d.length-1].overscaledZ,v=d[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let C=0;C<v;C++)E[C+g]=new u.StencilMode({func:a.GEQUAL,mask:255},C+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=v,[E,d]}return[{[g]:u.StencilMode.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([t.CONSTANT_COLOR,t.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(t,a,d){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new u.DepthMode(d||this.context.gl.LEQUAL,a,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const d=this.style.order,g=this.style._sourceCaches;for(const U in g){const V=g[U];V.used&&V.prepare(this.context)}const v={},E={},C={};for(const U in g){const V=g[U];v[U]=V.getVisibleCoordinates(),E[U]=v[U].slice().reverse(),C[U]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<d.length;U++)if(this.style._layers[d[U]].is3D()){this.opaquePassCutoff=U;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const U of d){const V=this.style._layers[U],q=t._getLayerSourceCache(V);if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const te=q?E[q.id]:void 0;("custom"===V.type||V.isSky()||te&&te.length)&&this.renderLayer(this,q,V,te)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const U=this.style._layers[d[this.currentLayer]],V=t._getLayerSourceCache(U);if(U.isSky())continue;const q=V?E[V.id]:void 0;this._renderTileClippingMasks(U,V,q),this.renderLayer(this,V,U,q)}if(this.style.fog&&this.transform.projection.supportsFog&&function(U,V){const q=U.context,te=q.gl,oe=U.transform,ae=new u.DepthMode(te.LEQUAL,u.DepthMode.ReadOnly,[0,1]),le=U.useProgram("globeAtmosphere",null,"globe"===oe.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ce=u.globeToMercatorTransition(oe.zoom),Y=V.properties.get("color").toArray01(),se=V.properties.get("high-color").toArray01(),fe=V.properties.get("space-color").toArray01PremultipliedAlpha(),me=u.identity$1([]);u.rotateY$1(me,me,-u.degToRad(oe._center.lng)),u.rotateX$1(me,me,u.degToRad(oe._center.lat)),u.rotateZ$1(me,me,oe.angle),u.rotateX$1(me,me,-oe._pitch);const Pe=u.fromQuat(new Float32Array(16),me),De=u.mapValue(V.properties.get("star-intensity"),0,1,0,.25),ze=u.mapValue(V.properties.get("horizon-blend"),0,1,5e-4,.25),Ne=u.globeUseCustomAntiAliasing(U,q,oe)&&5e-4===ze?oe.worldSize/(2*Math.PI*1.025)-1:oe.globeRadius,We=U.frameCounter/1e3%1,Bt=u.length(oe.globeCenterInViewSpace),qe=Math.sqrt(Math.pow(Bt,2)-Math.pow(Ne,2)),mt=Math.acos(qe/Bt),Qe={u_frustum_tl:oe.frustumCorners.TL,u_frustum_tr:oe.frustumCorners.TR,u_frustum_br:oe.frustumCorners.BR,u_frustum_bl:oe.frustumCorners.BL,u_horizon:oe.frustumCorners.horizon,u_transition:ce,u_fadeout_range:ze,u_color:Y,u_high_color:se,u_space_color:fe,u_star_intensity:De,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:We,u_horizon_angle:mt,u_rotation_matrix:Pe};U.prepareDrawProgram(q,le);const Lt=U.atmosphereBuffer;Lt&&le.draw(q,te.TRIANGLES,ae,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,Qe,"skybox",Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const U=this.style._layers[d[this.currentLayer]],V=t._getLayerSourceCache(U);U.isSky()&&this.renderLayer(this,V,U,V?E[V.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;){const U=this.style._layers[d[this.currentLayer]],V=t._getLayerSourceCache(U);if(U.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(U)){if(U.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=V?("symbol"===U.type?C:E)[V.id]:void 0;this._renderTileClippingMasks(U,V,V?v[V.id]:void 0),this.renderLayer(this,V,U,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let U=null;u.values(this.style._layers).forEach(V=>{const q=t._getLayerSourceCache(V);q&&!V.isHidden(this.transform.zoom)&&(!U||U.getSource().maxzoom<q.getSource().maxzoom)&&(U=q)}),U&&this.options.showTileBoundaries&&fr.debug(this,U,U.getVisibleCoordinates())}this.options.showPadding&&function(U){const V=U.transform.padding;co(U,U.transform.height-(V.top||0),3,nr),co(U,V.bottom||0,3,br),hs(U,V.left||0,3,ar),hs(U,U.transform.width-(V.right||0),3,Oo);const q=U.transform.centerPoint;var te,oe,ae,le;ds(te=U,(oe=q.x)-1,(ae=U.transform.height-q.y)-10,2,20,le=lo),ds(te,oe-10,ae-1,20,2,le)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,a,d,g){d.isHidden(this.transform.zoom)||("background"===d.type||"sky"===d.type||"custom"===d.type||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes(d.type)||t.terrain&&"custom"===d.type)&&fr[d.type](t,a,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let d=this.gpuTimers[t.id];d||(d=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),d.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),t.beginQueryEXT(t.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const d in t){const g=t[d],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(g.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(g.query),a[d]=E}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let d=0;for(const g of t)d+=a.getQueryObjectEXT(g,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(g);return d}translatePosMatrix(t,a,d,g,v){if(!d[0]&&!d[1])return t;const E=v?"map"===g?this.transform.angle:0:"viewport"===g?-this.transform.angle:0;if(E){const U=Math.sin(E),V=Math.cos(E);d=[d[0]*V-d[1]*U,d[0]*U+d[1]*V]}const C=[v?d[0]:fn(a,d[0],this.transform.zoom),v?d[1]:fn(a,d[1],this.transform.zoom),0],P=new Float32Array(16);return u.translate(P,t,C),P}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){return null===t||void 0!==t&&!this.imageManager.getPattern(t.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,a=this.terrain&&0===this.terrain.exaggeration(),d=this.style&&this.style.fog,g=[];return this.terrainRenderModeElevated()&&g.push("TERRAIN"),"globe"===this.transform.projection.name&&g.push("GLOBE"),a&&g.push("ZERO_EXAGGERATION"),d&&!t&&0!==d.getOpacity(this.transform.pitch)&&g.push("FOG"),t&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(t,a,d){this.cache=this.cache||{};const g=d||[],v=this.currentGlobalDefines().concat(g),E=mr.cacheKey(wa[t],t,v,a);return this.cache[E]||(this.cache[E]=new mr(this.context,t,wa[t],a,B[t],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,a,d){if(this.terrain&&this.terrain.renderingToTexture)return;const g=this.style.fog;if(g){const v=g.getOpacity(this.transform.pitch),E=((C,P,U,V,q,te,oe,ae,le,ce,Y)=>{const se=C.transform,fe=P.properties.get("color").toArray01();fe[3]=V;const me=C.frameCounter/1e3%1;return{u_fog_matrix:U?se.calculateFogTileMatrix(U):C.identityMat,u_fog_range:P.getFovAdjustedRange(se._fov),u_fog_color:fe,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:me,u_frustum_tl:q,u_frustum_tr:te,u_frustum_br:oe,u_frustum_bl:ae,u_globe_pos:le,u_globe_radius:ce,u_viewport:Y,u_globe_transition:u.globeToMercatorTransition(se.zoom),u_is_globe:+("globe"===se.projection.name)}})(this,g,d,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);a.setFogUniformValues(t,E)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const g of d)a[g.key]=t[g.key]||new u.Tile(g,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class jo{constructor(t=0,a=0,d=0,g=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=g}interpolate(t,a,d){return null!=a.top&&null!=t.top&&(this.top=u.number(t.top,a.top,d)),null!=a.bottom&&null!=t.bottom&&(this.bottom=u.number(t.bottom,a.bottom,d)),null!=a.left&&null!=t.left&&(this.left=u.number(t.left,a.left,d)),null!=a.right&&null!=t.right&&(this.right=u.number(t.right,a.right,d)),this}getCenter(t,a){const d=u.clamp((this.left+t-this.right)/2,0,t),g=u.clamp((this.top+a-this.bottom)/2,0,a);return new u.Point(d,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new jo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ci(c,t){const a=u.getColumn(c,3);u.fromQuat(c,t),u.setColumn(c,3,a)}function Jn(c,t){const a=u.identity$1([]);return u.rotateZ$1(a,a,-t),u.rotateX$1(a,a,-c),a}function Ys(c,t){const a=[c[0],c[1],0],d=[t[0],t[1],0];if(u.length(a)>=1e-15){const E=u.normalize([],a);u.scale$2(d,E,u.dot(d,E)),t[0]=d[0],t[1]=d[1]}const g=u.cross([],t,c);if(u.len(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return Jn(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),v)}class yc{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof u.MercatorCoordinate?t:new u.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=u.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a){if(this.orientation=null,!this.position)return;const d=this.position,g=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(t)):0,v=u.MercatorCoordinate.fromLngLat(t,g),E=[v.x-d.x,v.y-d.y,v.z-d.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Ys(E,a)}setPitchBearing(t,a){this.orientation=Jn(u.degToRad(t),u.degToRad(-a))}}class vc{constructor(t,a){this._transform=u.identity([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new u.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=u.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&u.setColumn(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||u.identity$1([]),t&&Ci(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=Jn(t,a),Ci(this._transform,this._orientation)}forward(){const t=u.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=u.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=u.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const d=new Float64Array(16);return u.invert(d,this.getWorldToCamera(t,a)),d}getWorldToCameraPosition(t,a,d){const g=this.position;u.scale$2(g,g,-t);const v=new Float64Array(16);return u.fromScaling(v,[d,d,d]),u.translate(v,v,g),v[10]*=a,v}getWorldToCamera(t,a){const d=new Float64Array(16),g=new Float64Array(4),v=this.position;return u.conjugate(g,this._orientation),u.scale$2(v,v,-t),u.fromQuat(d,g),u.translate(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(t,a,d,g){const v=new Float64Array(16);return u.perspective(v,t,a,d,g),v}getDistanceToElevation(t,a=!1){const d=0===t?0:u.mercatorZfromAltitude(t,a?u.latFromMercatorY(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new vc([...this.position],[...this.orientation])}}function yl(c,t){const a=xl(c.projection,c.zoom,c.width,c.height),d=function(v,E,C,P,U){const V=new u.LngLat(C.lng-180*Ms,C.lat),q=new u.LngLat(C.lng+180*Ms,C.lat),te=v.project(V.lng,V.lat),oe=v.project(q.lng,q.lat),ae=-Math.atan2(oe.y-te.y,oe.x-te.x),le=u.MercatorCoordinate.fromLngLat(C);le.y=u.clamp(le.y,-1+Ms,1-Ms);const ce=le.toLngLat(),Y=v.project(ce.lng,ce.lat),se=u.MercatorCoordinate.fromLngLat(ce);se.x+=Ms;const fe=se.toLngLat(),me=v.project(fe.lng,fe.lat),Pe=$l(me.x-Y.x,me.y-Y.y,ae),De=u.MercatorCoordinate.fromLngLat(ce);De.y+=Ms;const Re=De.toLngLat(),ze=v.project(Re.lng,Re.lat),Ne=$l(ze.x-Y.x,ze.y-Y.y,ae),We=Math.abs(Pe.x)/Math.abs(Ne.y),Bt=u.identity([]);u.rotateZ(Bt,Bt,-ae*(1-(U?0:P)));const qe=u.identity([]);return u.scale(qe,qe,[1,1-(1-We)*P,1]),qe[4]=-Ne.x/Ne.y*P,u.rotateZ(qe,qe,ae),u.multiply(qe,Bt,qe),qe}(c.projection,0,c.center,a,t),g=vl(c);return u.scale(d,d,[g,g,1]),d}function vl(c){const t=c.projection,a=xl(c.projection,c.zoom,c.width,c.height),d=jl(t,c.center),g=jl(t,u.LngLat.convert(t.center));return Math.pow(2,d*a+(1-a)*g)}function xl(c,t,a,d,g=1/0){const v=c.range;if(!v)return 0;const E=Math.min(g,Math.max(a,d)),C=Math.log(E/1024)/Math.LN2;return u.smoothstep(v[0]+C,v[1]+C,t)}const Ms=1/4e4;function jl(c,t){const a=u.clamp(t.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),d=new u.LngLat(t.lng-180*Ms,a),g=new u.LngLat(t.lng+180*Ms,a),v=c.project(d.lng,a),E=c.project(g.lng,a),C=u.MercatorCoordinate.fromLngLat(d),P=u.MercatorCoordinate.fromLngLat(g),U=E.x-v.x,V=E.y-v.y,q=P.x-C.x,te=P.y-C.y,oe=Math.sqrt((q*q+te*te)/(U*U+V*V));return Math.log(oe)/Math.LN2}function $l(c,t,a){const d=Math.cos(a),g=Math.sin(a);return{x:c*d-t*g,y:c*g+t*d}}class Ka{constructor(t,a,d,g,v,E,C){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(E),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new jo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new Ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t,a=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const d=!Te(a,this.getProjection());return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.Point(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;var d,g,v,E,C,P,U,V,q,te;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(d=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),g=this.rotationMatrix,E=this.angle,C=(v=this.rotationMatrix)[0],P=v[1],U=v[2],V=v[3],q=Math.sin(E),te=Math.cos(E),g[0]=C*te+U*q,g[1]=P*te+V*q,g[2]=C*-q+U*te,g[3]=P*-q+V*te)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=u.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=u.degToRad(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let g=0,v=0;for(let E=0;E<a.length;E++){const C=new u.Point(a[E][0]*this.width,d+a[E][1]*(this.height-d)),P=t.pointCoordinate(C);if(!P)continue;const U=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);g+=P[3]*U,v+=U}return 0===v?NaN:g/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,g=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(g-d,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const g=u.length(u.sub([],this._camera.position,d));return u.clamp(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!u.exactEquals(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];u.exactEquals$1(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new yc;return a.position=new u.MercatorCoordinate(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!u.length$1(t))return!1;u.normalize$1(t,t);const a=u.transformQuat([],[0,0,-1],t),d=u.transformQuat([],[0,-1,0],t);if(d[2]<0)return!1;const g=Ys(a,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=u.clamp(t[2],g/d,g/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new u.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new u.Point(0,0)),g=this.pointCoordinate(new u.Point(this.width,0)),v=this.pointCoordinate(new u.Point(this.width,this.height)),E=this.pointCoordinate(new u.Point(0,this.height)),C=Math.floor(Math.min(d.x,g.x,v.x,E.x)),P=Math.floor(Math.max(d.x,g.x,v.x,E.x)),U=1;for(let V=C-U;V<=P+U;V++)0!==V&&a.push(new u.UnwrappedTileID(V,t))}return a}coveringTiles(t){let a=this.coveringZoomLevel(t);const d=a,g=this.elevation&&!t.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==t.minzoom&&a<t.minzoom)return[];void 0!==t.maxzoom&&a>t.maxzoom&&(a=t.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,P=1<<a,U=[P*E.x,P*E.y,0],V="globe"===this.projection.name,q=!V,te=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,q),oe=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=P*u.mercatorZfromAltitude(1,this.center.lat),le=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),ce=[P*oe.x,P*oe.y,le*(q?1:ae)],Y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,fe=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,me=t.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pe=this.projection.isReprojectedInTileSpace?vl(this):1,De=Ye=>{const zt=new u.MercatorCoordinate(Ye.x+25e-6,Ye.y,Ye.z),Ct=new u.MercatorCoordinate(Ye.x,Ye.y+25e-6,Ye.z),Ot=Ye.toLngLat(),_n=zt.toLngLat(),Un=Ct.toLngLat(),hn=this.locationCoordinate(Ot),Sn=this.locationCoordinate(_n),Qn=this.locationCoordinate(Un),er=Math.hypot(Sn.x-hn.x,Sn.y-hn.y),yn=Math.hypot(Qn.x-hn.x,Qn.y-hn.y);return Math.sqrt(er*yn)*Pe/25e-6},Re=Ye=>{const ut=fe,zt=me;return{aabb:u.tileAABB(this,P,0,0,0,Ye,zt,ut,this.projection),zoom:0,x:0,y:0,minZ:zt,maxZ:ut,wrap:Ye,fullyVisible:!1}},ze=[];let Ne=[];const We=a,Bt=t.reparseOverscaled?d:a,qe=Ye=>Ye*Ye,mt=qe((le-this._centerAltitude)*ae),Qe=Ye=>{if(!this._elevation||!Ye.tileID||!v)return;const ut=this._elevation.getMinMaxForTile(Ye.tileID),zt=Ye.aabb;ut?(zt.min[2]=ut.min,zt.max[2]=ut.max,zt.center[2]=(zt.min[2]+zt.max[2])/2):(Ye.shouldSplit=Lt(Ye),Ye.shouldSplit||(zt.min[2]=zt.max[2]=zt.center[2]=this._centerAltitude))},Lt=Ye=>{if(Ye.zoom<se)return!0;if(Ye.zoom===We)return!1;if(null!=Ye.shouldSplit)return Ye.shouldSplit;const ut=Ye.aabb.distanceX(ce),zt=Ye.aabb.distanceY(ce);let Ct=mt,Ot=1;if(V){Ct=qe(Ye.aabb.distanceZ(ce));const hn=Math.pow(2,Ye.zoom),Sn=u.latFromMercatorY((Ye.y+1)/hn),Qn=u.latFromMercatorY(Ye.y/hn),er=Math.min(Math.max(C,Sn),Qn),yn=u.circumferenceAtLatitude(er)/u.circumferenceAtLatitude(C);if(Ot=er===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,yn/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&Ye.zoom===We-1&&yn>=.9)return!0}else if(g&&(Ct=qe(Ye.aabb.distanceZ(ce)*ae)),this.projection.isReprojectedInTileSpace&&d<=5){const hn=Math.pow(2,Ye.zoom),Sn=De(new u.MercatorCoordinate((Ye.x+.5)/hn,(Ye.y+.5)/hn));Ot=Sn>.85?1:Sn}const _n=ut*ut+zt*zt+Ct;return _n<qe((1<<We-Ye.zoom)*Y*Ot*((hn,Sn)=>{if(Sn*qe(.707)<hn)return 1;const Qn=Math.sqrt(Sn/hn);return Qn/(1.4144271570014144+(Math.pow(1.1,Qn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ct,mt),_n))};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)ze.push(Re(-Ye)),ze.push(Re(Ye));for(ze.push(Re(0));ze.length>0;){const Ye=ze.pop(),ut=Ye.x,zt=Ye.y;let Ct=Ye.fullyVisible;if(!Ct){const Ot=Ye.aabb.intersects(te);if(0===Ot)continue;Ct=2===Ot}if(Ye.zoom!==We&&Lt(Ye))for(let Ot=0;Ot<4;Ot++){const _n=(ut<<1)+Ot%2,Un=(zt<<1)+(Ot>>1),hn={aabb:v?Ye.aabb.quadrant(Ot):u.tileAABB(this,P,Ye.zoom+1,_n,Un,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:_n,y:Un,wrap:Ye.wrap,fullyVisible:Ct,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};g&&!V&&(hn.tileID=new u.OverscaledTileID(Ye.zoom+1===We?Bt:Ye.zoom+1,Ye.wrap,Ye.zoom+1,_n,Un),Qe(hn)),ze.push(hn)}else{const Ot=Ye.zoom===We?Bt:Ye.zoom;if(t.minzoom&&t.minzoom>Ot)continue;const _n=U[0]-(.5+ut+(Ye.wrap<<Ye.zoom))*(1<<a-Ye.zoom),Un=U[1]-.5-zt,hn=Ye.tileID?Ye.tileID:new u.OverscaledTileID(Ot,Ye.wrap,Ye.zoom,ut,zt);Ne.push({tileID:hn,distanceSq:_n*_n+Un*Un})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,ut=this.horizonLineFromTop();Ne=Ne.filter(zt=>{const Ct=[0,0,0,1],Ot=[u.EXTENT,u.EXTENT,0,1],_n=this.calculateFogTileMatrix(zt.tileID.toUnwrapped());u.transformMat4$1(Ct,Ct,_n),u.transformMat4$1(Ot,Ot,_n);const Un=u.getAABBPointSquareDist(Ct,Ot);if(0===Un)return!0;let hn=!1;const Sn=this._elevation;if(Sn&&Un>Ye&&0!==ut){const Qn=this.calculateProjMatrix(zt.tileID.toUnwrapped());let er;t.isTerrainDEM||(er=Sn.getMinMaxForTile(zt.tileID)),er||(er={min:me,max:fe});const yn=u.furthestTileCorner(this.rotation),Fr=[yn[0]*u.EXTENT,yn[1]*u.EXTENT,er.max];u.transformMat4(Fr,Fr,Qn),hn=(1-Fr[1])*this.height*.5<ut}return Un<Ye||hn})}return Ne.sort((Ye,ut)=>Ye.distanceSq-ut.distanceSq).map(Ye=>Ye.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=u.clamp(t.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),d=this.projection.project(t.lng,a);return new u.Point(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/u.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let d,g;const v=this.centerPoint;if("globe"===this.projection.name){const C=this.worldSize;d=(a.x-v.x)/C,g=(a.y-v.y)/C}else{const C=this.pointCoordinate(a),P=this.pointCoordinate(v);d=C.x-P.x,g=C.y-P.y}const E=this.locationCoordinate(t);this.setLocation(new u.MercatorCoordinate(E.x-d,E.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,a){const d=a?u.mercatorZfromAltitude(a,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new u.MercatorCoordinate(g.x,g.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const d=a??this._centerAltitude,g=[t.x,t.y,0,1],v=[t.x,t.y,1,1];u.transformMat4$1(g,g,this.pixelMatrixInverse),u.transformMat4$1(v,v,this.pixelMatrixInverse);const E=v[3];u.scale$1(g,g,1/g[3]),u.scale$1(v,v,1/E);const C=g[2],P=v[2];return{p0:g,p1:v,t:C===P?0:(d-C)/(P-C)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return u.transformMat4$1(a,a,this.pixelMatrixInverse),u.transformMat4$1(d,d,this.pixelMatrixInverse),u.scale$1(a,a,1/a[3]),u.scale$1(d,d,1/d[3]),a[2]=u.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,d[2]=u.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,u.scale$1(a,a,1/this.worldSize),u.scale$1(d,d,1/this.worldSize),new u.Ray([a[0],a[1],a[2]],u.normalize([],u.sub([],d,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:d,t:g}=t,v=u.mercatorZfromAltitude(a[2],this._center.lat),E=u.mercatorZfromAltitude(d[2],this._center.lat);return new u.MercatorCoordinate(u.number(a[0],d[0],g)/this.worldSize,u.number(a[1],d[1],g)/this.worldSize,u.number(v,E,g))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let a=this.projection.pointCoordinate3D(this,t.x,t.y);if(a)return new u.MercatorCoordinate(a[0],a[1],a[2]);let d=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t);const v=.02*g,E=t.clone();for(let C=0;C<10&&g-d>v;C++){E.y=u.number(d,g,.66);const P=this.projection.pointCoordinate3D(this,E.x,E.y);P?(g=E.y,a=P):d=E.y}return a?new u.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return u.transformMat4$1(g,g,this.pixelMatrix),g[3]>0?new u.Point(g[0]/g[3],g[1]/g[3]):new u.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new u.Point(a,t)),E=this.pointLocation3D(new u.Point(g,t)),C=this.pointLocation3D(new u.Point(g,d)),P=this.pointLocation3D(new u.Point(a,d));let U=Math.min(v.lng,E.lng,C.lng,P.lng),V=Math.max(v.lng,E.lng,C.lng,P.lng),q=Math.min(v.lat,E.lat,C.lat,P.lat),te=Math.max(v.lat,E.lat,C.lat,P.lat);const oe=Math.pow(2,-this.zoom)/16*270,ae="globe"===this.projection.name?1:4,le=(ce,Y,se,fe,me)=>{const Pe=(ce+se)/2,De=(Y+fe)/2,Re=new u.Point(Pe,De),{lng:ze,lat:Ne}=this.pointLocation3D(Re),We=Math.max(0,U-ze,q-Ne,ze-V,Ne-te);U=Math.min(U,ze),V=Math.max(V,ze),q=Math.min(q,Ne),te=Math.max(te,Ne),(me<ae||We>oe)&&(le(ce,Y,Pe,De,me+1),le(Pe,De,se,fe,me+1))};if(le(a,t,g,t,1),le(g,t,g,d,1),le(g,d,a,d,1),le(a,d,a,t,1),"globe"===this.projection.name){const[ce,Y]=u.polesInViewport(this);ce?(te=90,V=180,U=-180):Y&&(q=-90,V=180,U=-180)}return new u.LngLatBounds(new u.LngLat(U,q),new u.LngLat(V,te))}_getBoundsRectangular(t,a){const{top:d,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,C=new u.Point(g,d),P=new u.Point(E,d),U=new u.Point(E,v),V=new u.Point(g,v);let q=this.pointCoordinate(C,t),te=this.pointCoordinate(P,t);const oe=this.pointCoordinate(U,a),ae=this.pointCoordinate(V,a),le=(ce,Y)=>(Y.y-ce.y)/(Y.x-ce.x);return q.y>1&&te.y>=0?q=new u.MercatorCoordinate((1-ae.y)/le(ae,q)+ae.x,1):q.y<0&&te.y<=1&&(q=new u.MercatorCoordinate(-ae.y/le(ae,q)+ae.x,0)),te.y>1&&q.y>=0?te=new u.MercatorCoordinate((1-oe.y)/le(oe,te)+oe.x,1):te.y<0&&q.y<=1&&(te=new u.MercatorCoordinate(-oe.y/le(oe,te)+oe.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(oe))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce((d,g)=>{if(g.dem){const v=g.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,d=this._distanceTileDataCache;if(d[a])return d[a];const g=t.canonical,v=1/this.height,E=this.cameraWorldSize,C=E/this.zoomScale(g.z),P=(g.x+Math.pow(2,g.z)*t.wrap)*C,U=g.y*C,V=this.point;V.x*=E/this.worldSize,V.y*=E/this.worldSize;const q=this.angle,te=Math.sin(-q),oe=-Math.cos(-q);return d[a]={bearing:[te,oe],center:[(V.x-P)*v,(V.y-U)*v],scale:C/u.EXTENT*v},d[a]}calculateFogTileMatrix(t){const a=t.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return u.multiply(g,this.worldToFogMatrix,g),d[a]=new Float32Array(g),d[a]}calculateProjMatrix(t,a=!1){const d=t.key,g=a?this._alignedProjMatrixCache:this._projMatrixCache;if(g[d])return g[d];const v=this.calculatePosMatrix(t,this.worldSize);return u.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,v),g[d]=new Float32Array(v),g[d]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const g=function(v,E){const{scale:C}=v.tileTransform,P=C*u.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return U=new Float32Array(4),te=(V=E.inverseAdjustmentMatrix)[1],oe=V[2],ae=V[3],ce=(q=[P,P])[1],U[0]=V[0]*(le=q[0]),U[1]=te*le,U[2]=oe*ce,U[3]=ae*ce,U;var U,V,q,te,oe,ae,le,ce}(t,this);return d[a]=g,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,a=u.fromScaling([],[t,t,t]);return u.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const a=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),g=this._camera.forward(),v=u.mercatorZfromAltitude(1,this._center.lat);d[2]/=v,g[2]/=v,u.normalize(g,g);const E=t.raycast(d,g,t.exaggeration());if(E){const C=u.scaleAndAdd([],d,g,E),P=new u.MercatorCoordinate(C[0],C[1],u.mercatorZfromAltitude(C[2],u.latFromMercatorY(C[1]))),U=(P.z+u.length([P.x-d[0],P.y-d[1],P.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,d=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),v=a.getAtPointOrZero(new u.MercatorCoordinate(...g)),E=this.pixelsPerMeter/this.worldSize*v,C=this._minimumHeightOverTerrain(),P=g[2]-E;if(P<=C)if(P<0||t){const U=this.locationCoordinate(this._center,this._centerAltitude),V=[g[0],g[1],U.z-g[2]],q=u.length(V);V[2]-=(C-P)/this._pixelsPerMercatorPixel;const te=u.length(V);if(0===te)return;u.scale$2(V,V,q/te*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],U.z*this._pixelsPerMercatorPixel-V[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const te=this.center;return te.lat=u.clamp(te.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(te.lng=u.clamp(te.lng,this.minLng,this.maxLng)),this.center=te,void(this._constraining=!1)}const a=this._unmodified,{x:d,y:g}=this.point;let v=0,E=d,C=g;const P=this.width/2,U=this.height/2,V=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(g-U<V&&(C=V+U),g+U>q&&(C=q-U),q-V<this.height&&(v=Math.max(v,this.height/(q-V)),C=(q+V)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const te=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,ae=this.worldSize/2-(te+oe)/2;E=(d+ae+this.worldSize)%this.worldSize-ae,E-P<te&&(E=te+P),E+P>oe&&(E=oe-P),oe-te<this.width&&(v=Math.max(v,this.width/(oe-te)),E=(oe+te)/2)}E===d&&C===g||(this.center=this.unproject(new u.Point(E,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const d=xl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g="meters"===this.projection.zAxisUnit?a:1,v=this._camera.getWorldToCamera(this.worldSize,g),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-t.x/this.width,E[9]=2*t.y/this.height;let C=u.mul([],E,v);if(this.projection.isReprojectedInTileSpace){const De=this.locationCoordinate(this.center),Re=u.identity([]);u.translate(Re,Re,[De.x*this.worldSize,De.y*this.worldSize,0]),u.multiply(Re,Re,yl(this)),u.translate(Re,Re,[-De.x*this.worldSize,-De.y*this.worldSize,0]),u.multiply(C,C,Re),this.inverseAdjustmentMatrix=function(ze){const Ne=yl(ze,!0);return Ge([],[Ne[0],Ne[1],Ne[4],Ne[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],C,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=C,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const P=u.invert([],E);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const U=new Float32Array(16);u.identity(U),u.scale(U,U,[1,-1,1]),u.rotateX(U,U,this._pitch),u.rotateZ(U,U,this.angle);const V=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-t.x/this.width,V[9]=2*(t.y+q)/this.height,this.skyboxMatrix=u.multiply(U,V,U);const te=this.point,oe=te.x,ae=te.y,le=this.width%2/2,ce=this.height%2/2,Y=Math.cos(this.angle),se=Math.sin(this.angle),fe=oe-Math.round(oe)+Y*le+se*ce,me=ae-Math.round(ae)+Y*ce+se*le,Pe=new Float64Array(C);if(u.translate(Pe,Pe,[fe>.5?fe-1:fe,me>.5?me-1:me,0]),this.alignedProjMatrix=Pe,C=u.create(),u.scale(C,C,[this.width/2,-this.height/2,1]),u.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=u.create(),u.scale(C,C,[1,-1,1]),u.translate(C,C,[-1,-1,0]),u.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},C=u.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const De=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(De,De,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,a];u.scale$2(v,v,g),u.scale$2(d,d,-1),u.multiply$2(d,d,v);const E=u.create();u.translate(E,E,d),u.scale(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,g)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*v,g.y/this.worldSize-d[1]*v,t/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=t[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((a-d)/g,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),v=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),C=Math.max((t[2]-v)/Math.cos(d),E),P=this._zoomFromMercatorZ(C);u.scaleAndAdd(t,t,a,C),this._pitch=u.clamp(d,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(g,-Math.PI,Math.PI),this._setZoom(u.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,d=u.GLOBE_ZOOM_THRESHOLD_MAX,g=0,v=1/0;for(;d-a>1e-6&&d>a;){const E=a+.5*(d-a),C=this.tileSize*Math.pow(2,E),P=this.getCameraToCenterDistance(this.projection,E,C),U=this.scaleZoom(P/(t*this.tileSize)),V=Math.abs(E-U);V<v&&(v=V,g=E),E<U?a=E:d=E}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const d=Math.min(t.x,a.x),g=Math.max(t.x,a.x),v=Math.min(t.y,a.y),E=Math.max(t.y,a.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new u.Point(d,v),new u.Point(g,E),new u.Point(d,E),new u.Point(g,v)],P=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const V of C){const q=this.pointRayIntersection(V);if(q.t<0)return!0;const te=this.rayIntersectionCoordinate(q);if(te.x<P||te.y<0||te.x>U||te.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.Point(0,0),new u.Point(this.width,this.height))}zoomDeltaToMovement(t,a){const d=u.length(u.sub([],this._camera.position,t)),g=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if("globe"===this.projection.name){const t=function([a,d,g],v){const E=[a,d,g,1];u.transformMat4$1(E,E,v);const C=E[3]=Math.max(E[3],1e-6);return E[0]/=C,E[1]/=C,E[2]/=C,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.Point(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,t))}}getCameraToCenterDistance(t,a=this.zoom,d=this.worldSize){const g=xl(t,a,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,d,g);return.5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(t,t,this.globeMatrix),t}}function Ss(c,t){let a=!1,d=null;const g=()=>{d=null,a&&(c(),d=setTimeout(g,t),a=!1)};return()=>(a=!0,d||g(),d)}class qc{constructor(t){this._hashName=t&&encodeURIComponent(t),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ss(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,u.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=Ks(t);if(this._hashName){const d=this._hashName;let g=!1;const v=u.window.location.hash.slice(1).split("&").map(E=>{const C=E.split("=")[0];return C===d?(g=!0,`${C}=${a}`):E}).filter(E=>E);return g||v.push(`${d}=${a}`),`#${v.join("&")}`}return`#${a}`}_getCurrentHash(){const t=u.window.location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(a=d)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(d=>isNaN(d))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,t)}}function Ks(c,t){const a=c.getCenter(),d=Math.round(100*c.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),E=Math.round(a.lng*v)/v,C=Math.round(a.lat*v)/v,P=c.getBearing(),U=c.getPitch();let V=t?`/${E}/${C}/${d}`:`${d}/${C}/${E}`;return(P||U)&&(V+="/"+Math.round(10*P)/10),U&&(V+=`/${Math.round(U)}`),V}const Aa={linearity:.3,easing:u.bezier(0,0,.3,1)},ua=u.extend({deceleration:2500,maxSpeed:1400},Aa),xc=u.extend({deceleration:20,maxSpeed:1400},Aa),en=u.extend({deceleration:1e3,maxSpeed:360},Aa),As=u.extend({deceleration:1e3,maxSpeed:90},Aa);class Cu{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=u.exported.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)a.zoom+=v.zoomDelta||0,a.bearing+=v.bearingDelta||0,a.pitch+=v.pitchDelta||0,v.panDelta&&a.pan._add(v.panDelta),v.around&&(a.around=v.around),v.pinchAround&&(a.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(a.pan.mag()){const v=Gl(a.pan.mag(),d,u.extend({},ua,t||{}));g.offset=a.pan.mult(v.amount/a.pan.mag()),g.center=this._map.transform.center,$o(g,v)}if(a.zoom){const v=Gl(a.zoom,d,xc);g.zoom=this._map.transform.zoom+v.amount,$o(g,v)}if(a.bearing){const v=Gl(a.bearing,d,en);g.bearing=this._map.transform.bearing+u.clamp(v.amount,-179,179),$o(g,v)}if(a.pitch){const v=Gl(a.pitch,d,As);g.pitch=this._map.transform.pitch+v.amount,$o(g,v)}if(g.zoom||g.bearing){const v=void 0===a.pinchAround?a.around:a.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function $o(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Gl(c,t,a){const{maxSpeed:d,linearity:g,deceleration:v}=a,E=u.clamp(c*g/(t/1e3),-d,d),C=Math.abs(E)/(v*g);return{easing:a.easing,duration:1e3*C,amount:E*(C/2)}}class Di extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,g={}){const v=on(a.getCanvasContainer(),d),E=a.unproject(v);super(t,u.extend({point:v,lngLat:E,originalEvent:d},g)),this._defaultPrevented=!1,this.target=a}}class Js extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const g="touchend"===t?d.changedTouches:d.touches,v=or(a.getCanvasContainer(),g),E=v.map(P=>a.unproject(P)),C=v.reduce((P,U,V,q)=>P.add(U.div(q.length)),new u.Point(0,0));super(t,{points:v,point:C,lngLats:E,lngLat:a.unproject(C),originalEvent:d}),this._defaultPrevented=!1}}class Ja extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){super(t,{originalEvent:d}),this._defaultPrevented=!1}}class Ia{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Ja(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Di(t.type,this._map,t))}mouseup(t){this._map.fire(new Di(t.type,this._map,t))}preclick(t){const a=u.extend({},t);a.type="preclick",this._map.fire(new Di(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Di(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Di(t.type,this._map,t))}mouseover(t){this._map.fire(new Di(t.type,this._map,t))}mouseout(t){this._map.fire(new Di(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Js(t.type,this._map,t))}touchmove(t){this._map.fire(new Js(t.type,this._map,t))}touchend(t){this._map.fire(new Js(t.type,this._map,t))}touchcancel(t){this._map.fire(new Js(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ha{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Di(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Di(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Du{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&0===t.button&&(bt(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=gt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const E=Math.min(g.x,d.x),C=Math.max(g.x,d.x),P=Math.min(g.y,d.y),U=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${P}px)`,this._box.style.width=C-E+"px",this._box.style.height=U-P+"px")})}mouseupWindow(t,a){if(!this._active)return;const d=this._startPos,g=a;if(d&&0===t.button){if(this.reset(),pn(),d.x!==g.x||d.y!==g.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),nn(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new u.Event(t,{originalEvent:a}))}}function Hl(c,t){const a={};for(let d=0;d<c.length;d++)a[c[d].identifier]=t[d];return a}class Qs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const v=new u.Point(0,0);for(const E of g)v._add(E);return v.div(g.length)}(a),this.touches=Hl(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const g=Hl(d,a);for(const v in this.touches){const E=g[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===d.length){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class bc{constructor(t){this.singleTap=new Qs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const g=this.singleTap.touchend(t,a,d);if(g){const v=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(v&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Tu{constructor(){this._zoomIn=new bc({numTouches:1,numTaps:2}),this._zoomOut=new bc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const g=this._zoomIn.touchend(t,a,d),v=this._zoomOut.touchend(t,a,d);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(g)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mu={0:1,2:2};class da{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const d=sn(t);this._correctButton(t,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(t,a){const d=this._lastPoint;if(d)if(t.preventDefault(),null!=this._eventButton&&function(g,v){const E=Mu[v];return void 0===g.buttons||(g.buttons&E)!==E}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}mouseupWindow(t){this._lastPoint&&sn(t)===this._eventButton&&(this._moved&&pn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qa extends da{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return 0===a&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class wc extends da{_correctButton(t,a){return 0===a&&t.ctrlKey||2===a}_move(t,a){const d=.8*(a.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){t.preventDefault()}}class Li extends da{_correctButton(t,a){return 0===a&&t.ctrlKey||2===a}_move(t,a){const d=-.5*(a.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){t.preventDefault()}}class Zl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.Point(0,0)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===d.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,d)}}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const g=Hl(d,a),v=new u.Point(0,0),E=new u.Point(0,0);let C=0;for(const U in g){const V=g[U],q=this._touches[U];q&&(v._add(V),E._add(V.sub(q)),C++,g[U]=V)}if(this._touches=g,C<this._minTouches||!E.mag())return;const P=E.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Is{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,d){return{}}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[v,E]=g,C=Pa(d,a,v),P=Pa(d,a,E);if(!C||!P)return;const U=this._aroundCenter?null:C.add(P).div(2);return this._move([C,P],U,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,E=Pa(d,a,g),C=Pa(d,a,v);E&&C||(this._active&&pn(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pa(c,t,a){for(let d=0;d<c.length;d++)if(c[d].identifier===a)return t[d]}function el(c,t){return Math.log(c/t)/Math.LN2}class ql extends Is{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(el(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:el(this._distance,d),pinchAround:a}}}function Wc(c,t){return 180*c.angleWith(t)/Math.PI}class Ec extends Is{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Wc(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const g=Wc(t,d);return Math.abs(g)<a}}function fa(c){return Math.abs(c.y)>Math.abs(c.x)}class bl extends Is{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,fa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){const g=this._lastPoints;if(!g)return;const v=t[0].sub(g[0]),E=t[1].sub(g[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,E,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5})}gestureBeginsVertically(t,a,d){if(void 0!==this._valid)return this._valid;const g=t.mag()>=2,v=a.mag()>=2;if(!g&&!v)return;if(!g||!v)return null==this._firstMove&&(this._firstMove=d),d-this._firstMove<100&&void 0;const E=t.y>0==a.y>0;return fa(t)&&fa(a)&&E}}const tl={panStep:100,bearingStep:15,pitchStep:10};class Ra{constructor(){const t=tl;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,g=0,v=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:C=>{const P=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Cc,zoom:a?Math.round(P)+a*(t.shiftKey?2:1):P,bearing:C.getBearing()+d*this._bearingStep,pitch:C.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cc(c){return c*(2-c)}const La=4.000244140625;class wl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=u.exported.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,0!==a&&a%La==0?this._type="wheel":0!==a&&Math.abs(a)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=on(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>La?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==U&&(U=1/U);const V=a(),q=Math.pow(2,V),te="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(te*U))),"wheel"===this._type&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._delta=0}const d="number"==typeof this._targetZoom?this._targetZoom:a(),g=this._startZoom,v=this._easing;let E,C=!1;if("wheel"===this._type&&g&&v){const P=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),U=v(P);E=u.number(g,d,U),P<1?this._frameId||(this._frameId=!0):C=!0}else E=d,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:E-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=u.ease;if(this._prevEase){const d=this._prevEase,g=(u.exported.now()-d.start)/d.duration,v=d.easing(g+.01)-d.easing(g),E=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-E*E);a=u.bezier(E,C,.25,1)}return this._prevEase={start:u.exported.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Su{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ki{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jr{constructor(){this._tap=new bc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,a,d))}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=a[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){this._tapTime?this._swipePoint&&0===d.length&&this.reset():this._tap.touchend(t,a,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fh{constructor(t,a,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ph{constructor(t,a,d,g){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Jo=c=>c.zoom||c.drag||c.pitch||c.rotate;class mh extends u.Event{}class ld{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const d=u.sub([],a,t);this.radius=u.length(d[2]<0?u.div([],d,this.constants):[d[0],d[1],0])}projectRay(t){u.div(t,t,this.constants),u.normalize(t,t),u.mul$1(t,t,this.constants);const a=u.scale$2([],t,this.radius);if(a[2]>0){const d=u.scale$2([],[0,0,1],u.dot(a,[0,0,1])),g=u.scale$2([],u.normalize([],[a[0],a[1],0]),this.radius),v=u.add([],a,u.scale$2([],u.sub([],u.add([],g,d),a),2));a[0]=v[0],a[1]=v[1]}return a}}function ea(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class Fo{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cu(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ld,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),u.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[g,v,E]of this._listeners)g.addEventListener(v,g===u.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,a,d]of this._listeners)t.removeEventListener(a,t===u.window.document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new Ia(a,t));const g=a.boxZoom=new Du(a,t);this._add("boxZoom",g);const v=new Tu,E=new ki;a.doubleClickZoom=new Su(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const C=new jr;this._add("tapDragZoom",C);const P=a.touchPitch=new bl(a);this._add("touchPitch",P);const U=new wc(t),V=new Li(t);a.dragRotate=new fh(t,U,V),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const q=new Qa(t),te=new Zl(a,t);a.dragPan=new ad(d,q,te),this._add("mousePan",q),this._add("touchPan",te,["touchZoom","touchRotate"]);const oe=new Ec,ae=new ql;a.touchZoomRotate=new ph(d,ae,oe,C),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ha(a));const le=a.scrollZoom=new wl(a,this);this._add("scrollZoom",le,["mousePan"]);const ce=a.keyboard=new Ra;this._add("keyboard",ce);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Y]&&a[Y].enable(t[Y])}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,d){for(const g in t)if(g!==d&&(!a||a.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}handleEvent(t,a){this._updatingCamera=!0;const d="renderFrame"===t.type,g=d?void 0:t,v={needsRenderFrame:!1},E={},C={},P=t.touches?this._getMapTouches(t.touches):void 0,U=P?or(this._el,P):d?void 0:on(this._el,t);for(const{handlerName:te,handler:oe,allowed:ae}of this._handlers){if(!oe.isEnabled())continue;let le;this._blockedByActive(C,ae,te)?oe.reset():oe[a||t.type]&&(le=oe[a||t.type](t,U,P),this.mergeHandlerResult(v,E,le,te,g),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||oe.isActive())&&(C[te]=oe)}const V={};for(const te in this._previousActiveHandlers)C[te]||(V[te]=g);this._previousActiveHandlers=C,(Object.keys(V).length||ea(v))&&(this._changes.push([v,E,V]),this._triggerRenderFrame()),(Object.keys(C).length||ea(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=v;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(t,a,d,g,v){if(!d)return;u.extend(t,d);const E={handlerName:g,originalEvent:d.originalEvent||v};void 0!==d.zoomDelta&&(a.zoom=E),void 0!==d.panDelta&&(a.drag=E),void 0!==d.pitchDelta&&(a.pitch=E),void 0!==d.bearingDelta&&(a.rotate=E)}_applyChanges(){const t={},a={},d={};for(const[g,v,E]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new u.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),void 0!==g.around&&(t.around=g.around),void 0!==g.aroundCoord&&(t.aroundCoord=g.aroundCoord),void 0!==g.pinchAround&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),u.extend(a,v),u.extend(d,E);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const g=this._map,v=g.transform,E=se=>[se.x,se.y,se.z];if((se=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!ea(t)){const se=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",se!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!ea(t))return void this._fireEvents(a,d,!0);let{panDelta:C,zoomDelta:P,bearingDelta:U,pitchDelta:V,around:q,aroundCoord:te,pinchAround:oe}=t;v._isCameraConstrained&&(P>0&&(P=0),v._isCameraConstrained=!1),void 0!==oe&&(q=oe),(P||(se=>a.drag&&!this._eventsInProgress.drag)())&&q&&(this._dragOrigin=E(v.pointCoordinate3D(q)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),q=q||g.transform.centerPoint,U&&(v.bearing+=U),V&&(v.pitch+=V),v._updateCameraState();const ae=[0,0,0];if(C)if("mercator"===v.projection.name){const se=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(q).dir),fe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(q.sub(C)).dir);ae[0]=fe[0]-se[0],ae[1]=fe[1]-se[1]}else{const se=v.pointCoordinate(q);if("globe"===v.projection.name){C=C.rotate(-v.angle);const fe=v._pixelsPerMercatorPixel/v.worldSize;ae[0]=-C.x*u.mercatorScale(u.latFromMercatorY(se.y))*fe,ae[1]=-C.y*u.mercatorScale(v.center.lat)*fe}else{const fe=v.pointCoordinate(q.sub(C));se&&fe&&(ae[0]=fe.x-se.x,ae[1]=fe.y-se.y)}}const le=v.zoom,ce=[0,0,0];if(P){const se=E(te||v.pointCoordinate3D(q)),fe={dir:u.normalize([],u.sub([],se,v._camera.position))};if(fe.dir[2]<0){const me=v.zoomDeltaToMovement(se,P);u.scale$2(ce,fe.dir,me)}}const Y=u.add(ae,ae,ce);v._translateCameraConstrained(Y),P&&Math.abs(v.zoom-le)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const g=Jo(this._eventsInProgress),v=Jo(t),E={};for(const V in t){const{originalEvent:q}=t[V];this._eventsInProgress[V]||(E[`${V}start`]=q),this._eventsInProgress[V]=t[V]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in E)this._fireEvent(V,E[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in t){const{originalEvent:q}=t[V];this._fireEvent(V,q)}const C={};let P;for(const V in this._eventsInProgress){const{handlerName:q,originalEvent:te}=this._eventsInProgress[V];this._handlersById[q].isActive()||(delete this._eventsInProgress[V],P=a[q]||te,C[`${V}end`]=P)}for(const V in C)this._fireEvent(V,C[V]);const U=Jo(this._eventsInProgress);if(d&&(g||v)&&!U){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=te=>0!==te&&-this._bearingSnap<te&&te<this._bearingSnap;V?(q(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:P})):(this._map.fire(new u.Event("moveend",{originalEvent:P})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new u.Event(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new mh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const El="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Au extends u.Evented{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=!1!==a.respectPrefersReducedMotion,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,d){return t=u.Point.convert(t).mult(-1),this.panTo(this.transform.center,u.extend({offset:t},a),d)}panTo(t,a,d){return this.easeTo(u.extend({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(u.extend({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(u.extend({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,u.extend({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=u.LngLatBounds.convert(t);const d=a&&a.bearing||0,g=a&&a.pitch||0,v=t.getNorthWest(),E=t.getSouthEast();return this._cameraForBounds(this.transform,v,E,d,g,a)}_extendCameraOptions(t){const a={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=u.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const d=t.padding;t.padding={top:d,bottom:d,right:d,left:d}}return t.padding=u.extend(a,t.padding),t}_minimumAABBFrustumDistance(t,a){const d=a.max[0]-a.min[0],g=a.max[1]-a.min[1];return d/g>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,d,g,v,E){const C=t.clone(),P=this._extendCameraOptions(E);C.bearing=g,C.pitch=v;const U=u.LngLat.convert(a),V=u.LngLat.convert(d),q=.5*(U.lat+V.lat),te=.5*(U.lng+V.lng),oe=u.latLngToECEF(q,te),ae=u.normalize([],oe),le=u.normalize([],u.cross([],ae,[0,1,0])),ce=u.cross([],le,ae),Y=[le[0],le[1],le[2],0,ce[0],ce[1],ce[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],se=[oe,u.latLngToECEF(U.lat,U.lng),u.latLngToECEF(V.lat,U.lng),u.latLngToECEF(V.lat,V.lng),u.latLngToECEF(U.lat,V.lng),u.latLngToECEF(q,U.lng),u.latLngToECEF(q,V.lng),u.latLngToECEF(U.lat,te),u.latLngToECEF(V.lat,te)];let fe=u.Aabb.fromPoints(se.map(Ct=>[u.dot(le,Ct),u.dot(ce,Ct),u.dot(ae,Ct)]));const me=u.transformMat4([],fe.center,Y);0===u.squaredLength(me)&&u.set(me,0,0,1),u.normalize(me,me),u.scale$2(me,me,u.GLOBE_RADIUS),C.center=u.ecefToLatLng(me);const Pe=C.getWorldToCameraMatrix(),De=u.invert(new Float64Array(16),Pe);fe=u.Aabb.applyTransform(fe,u.multiply([],Pe,Y)),u.transformMat4(me,me,Pe);const Re=.5*(fe.max[2]-fe.min[2]),ze=this._minimumAABBFrustumDistance(C,fe),Ne=u.scale$2([],[0,0,1],Re),We=u.add(Ne,me,Ne),Bt=ze+(0===C.pitch?0:u.distance(me,We)),qe=C.globeCenterInViewSpace,mt=u.sub([],me,[qe[0],qe[1],qe[2]]);u.normalize(mt,mt),u.scale$2(mt,mt,Bt);const Qe=u.add([],me,mt);u.transformMat4(Qe,Qe,De);const Lt=u.earthRadius/u.GLOBE_RADIUS,Ye=u.length(Qe),ut=u.mercatorZfromAltitude(Math.max(Ye*Lt-u.earthRadius,Number.EPSILON),0),zt=Math.min(C.zoomFromMercatorZAdjusted(ut),P.maxZoom);return zt>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"mercator"}),C.zoom=zt,this._cameraForBounds(C,a,d,g,v,E)):{center:C.center,zoom:zt,bearing:g,pitch:v}}queryTerrainElevation(t,a){const d=this.transform.elevation;return d?(a=u.extend({},{exaggerated:!0},a),d.getAtPoint(u.MercatorCoordinate.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,d,g,v,E){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,a,d,g,v,E);const C=t.clone(),P=this._extendCameraOptions(E),U=C.padding;C.bearing=g,C.pitch=v;const V=u.LngLat.convert(a),q=u.LngLat.convert(d),te=new u.LngLat(V.lng,q.lat),oe=new u.LngLat(q.lng,V.lat),ae=C.project(V),le=C.project(q),ce=this.queryTerrainElevation(V),Y=this.queryTerrainElevation(q),se=this.queryTerrainElevation(te),fe=this.queryTerrainElevation(oe),me=[[ae.x,ae.y,Math.min(ce||0,Y||0,se||0,fe||0)],[le.x,le.y,Math.max(ce||0,Y||0,se||0,fe||0)]];let Pe=u.Aabb.fromPoints(me);const De=C.getWorldToCameraMatrix(),Re=u.invert(new Float64Array(16),De);Pe=u.Aabb.applyTransform(Pe,De);const ze=u.sub([],Pe.max,Pe.min),Ne=U.left||0,We=U.right||0,Bt=U.bottom||0,qe=U.top||0,{left:mt,right:Qe,top:Lt,bottom:Ye}=P.padding,ut=.5*(Ne+We),zt=.5*(qe+Bt),Ct=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(Ne+We+mt+Qe))/ze[0],(C.height-(Bt+qe+Ye+Lt))/ze[1])),P.maxZoom),Ot=C.scale/C.zoomScale(Ct);Pe=new u.Aabb([Pe.min[0]-(mt+ut)*Ot,Pe.min[1]-(Ye+zt)*Ot,Pe.min[2]],[Pe.max[0]+(Qe+ut)*Ot,Pe.max[1]+(Lt+zt)*Ot,Pe.max[2]]);const _n=.5*ze[2],Un=this._minimumAABBFrustumDistance(C,Pe),hn=[0,0,1,0];u.transformMat4$1(hn,hn,De),u.normalize$2(hn,hn);const Sn=u.scale$2([],hn,Un+_n),Qn=u.add([],Pe.center,Sn),er=("number"==typeof P.offset.x&&"number"==typeof P.offset.y?new u.Point(P.offset.x,P.offset.y):u.Point.convert(P.offset)).rotate(-u.degToRad(g));Pe.center[0]-=er.x*Ot,Pe.center[1]+=er.y*Ot,u.transformMat4(Pe.center,Pe.center,Re),u.transformMat4(Qn,Qn,Re);const yn=[Pe.center[0],Pe.center[1],Qn[2]*C.pixelsPerMeter];u.scale$2(yn,yn,1/C.worldSize);const Fr=u.lngFromMercatorX(yn[0]),$r=u.latFromMercatorY(yn[1]),Yr=Math.min(C._zoomFromMercatorZ(yn[2]),P.maxZoom),ni=new u.LngLat(Fr,$r);return C.mercatorFromTransition&&Yr<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(C.setProjection({name:"globe"}),C.zoom=Yr,this._cameraForBounds(C,a,d,g,v,E)):{center:ni,zoom:Yr,bearing:g,pitch:v}}fitBounds(t,a,d){const g=this.cameraForBounds(t,a);return this._fitInternal(g,a,d)}fitScreenCoordinates(t,a,d,g,v){const E=u.Point.convert(t),C=u.Point.convert(a),P=new u.Point(Math.min(E.x,C.x),Math.min(E.y,C.y)),U=new u.Point(Math.max(E.x,C.x),Math.max(E.y,C.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(E,C))return this;const V=this.transform.pointLocation3D(P),q=this.transform.pointLocation3D(U),te=this.transform.pointLocation3D(new u.Point(P.x,U.y)),oe=this.transform.pointLocation3D(new u.Point(U.x,P.y)),ae=[Math.min(V.lng,q.lng,te.lng,oe.lng),Math.min(V.lat,q.lat,te.lat,oe.lat)],le=[Math.max(V.lng,q.lng,te.lng,oe.lng),Math.max(V.lat,q.lat,te.lat,oe.lat)],ce=g&&g.pitch?g.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,ae,le,d,ce,g);return this._fitInternal(Y,g,v)}_fitInternal(t,a,d){return t?(delete(a=u.extend(t,a)).padding,a.linear?this.easeTo(a,d):this.flyTo(a,d)):this}jumpTo(t,a){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,E=!1;return"zoom"in t&&d.zoom!==+t.zoom&&(g=!0,d.zoom=+t.zoom),void 0!==t.center&&(d.center=u.LngLat.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(v=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(E=!0,d.pitch=+t.pitch),null==t.padding||d.isPaddingEqual(t.padding)||(d.padding=t.padding),t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new u.Event("movestart",a)).fire(new u.Event("move",a)),g&&this.fire(new u.Event("zoomstart",a)).fire(new u.Event("zoom",a)).fire(new u.Event("zoomend",a)),v&&this.fire(new u.Event("rotatestart",a)).fire(new u.Event("rotate",a)).fire(new u.Event("rotateend",a)),E&&this.fire(new u.Event("pitchstart",a)).fire(new u.Event("pitch",a)).fire(new u.Event("pitchend",a)),this.fire(new u.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(El),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return u.warnOnce(El),this;this.stop();const g=d.zoom,v=d.pitch,E=d.bearing;d.setFreeCameraOptions(t);const C=g!==d.zoom,P=v!==d.pitch,U=E!==d.bearing;return this.fire(new u.Event("movestart",a)).fire(new u.Event("move",a)),C&&this.fire(new u.Event("zoomstart",a)).fire(new u.Event("zoom",a)).fire(new u.Event("zoomend",a)),U&&this.fire(new u.Event("rotatestart",a)).fire(new u.Event("rotate",a)).fire(new u.Event("rotateend",a)),P&&this.fire(new u.Event("pitchstart",a)).fire(new u.Event("pitch",a)).fire(new u.Event("pitchend",a)),this.fire(new u.Event("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),(!1===(t=u.extend({offset:[0,0],duration:500,easing:u.ease},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,g=this.getZoom(),v=this.getBearing(),E=this.getPitch(),C=this.getPadding(),P="zoom"in t?+t.zoom:g,U="bearing"in t?this._normalizeBearing(t.bearing,v):v,V="pitch"in t?+t.pitch:E,q="padding"in t?t.padding:d.padding,te=u.Point.convert(t.offset);let oe,ae,le;if("globe"===d.projection.name){const Ne=u.MercatorCoordinate.fromLngLat(d.center),We=te.rotate(-d.angle);Ne.x+=We.x/d.worldSize,Ne.y+=We.y/d.worldSize;const Bt=Ne.toLngLat(),qe=u.LngLat.convert(t.center||Bt);this._normalizeCenter(qe),oe=d.centerPoint.add(We),ae=new u.Point(Ne.x,Ne.y).mult(d.worldSize),le=new u.Point(u.mercatorXfromLng(qe.lng),u.mercatorYfromLat(qe.lat)).mult(d.worldSize).sub(ae)}else{oe=d.centerPoint.add(te);const Ne=d.pointLocation(oe),We=u.LngLat.convert(t.center||Ne);this._normalizeCenter(We),ae=d.project(Ne),le=d.project(We).sub(ae)}const ce=d.zoomScale(P-g);let Y,se;t.around&&(Y=u.LngLat.convert(t.around),se=d.locationPoint(Y));const fe=this._zooming||P!==g,me=this._rotating||v!==U,Pe=this._pitching||V!==E,De=!d.isPaddingEqual(q),Re=Ne=>We=>{if(fe&&(Ne.zoom=u.number(g,P,We)),me&&(Ne.bearing=u.number(v,U,We)),Pe&&(Ne.pitch=u.number(E,V,We)),De&&(Ne.interpolatePadding(C,q,We),oe=Ne.centerPoint.add(te)),Y)Ne.setLocationAtPoint(Y,se);else{const Bt=Ne.zoomScale(Ne.zoom-g),qe=P>g?Math.min(2,ce):Math.max(.5,ce),mt=Math.pow(qe,1-We),Qe=Ne.unproject(ae.add(le.mult(We*mt)).mult(Bt));Ne.setLocationAtPoint(Ne.renderWorldCopies?Qe.wrap():Qe,oe)}return t.preloadOnly||this._fireMoveEvents(a),Ne};if(t.preloadOnly){const Ne=this._emulate(Re,t.duration,d);return this._preloadTiles(Ne),this}const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=me,this._pitching=Pe,this._padding=De,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ze),this._ease(Re(d),Ne=>{d.recenterOnTerrain(),this._afterEase(a,Ne)},t),this}_prepareEase(t,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||d.moving||this.fire(new u.Event("movestart",t)),this._zooming&&!d.zooming&&this.fire(new u.Event("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new u.Event("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new u.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new u.Event("move",t)),this._zooming&&this.fire(new u.Event("zoom",t)),this._rotating&&this.fire(new u.Event("rotate",t)),this._pitching&&this.fire(new u.Event("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new u.Event("zoomend",t)),g&&this.fire(new u.Event("rotateend",t)),v&&this.fire(new u.Event("pitchend",t)),this.fire(new u.Event("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const Ct=u.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ct,a)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},t);const d=this.transform,g=this.getZoom(),v=this.getBearing(),E=this.getPitch(),C=this.getPadding(),P="zoom"in t?u.clamp(+t.zoom,d.minZoom,d.maxZoom):g,U="bearing"in t?this._normalizeBearing(t.bearing,v):v,V="pitch"in t?+t.pitch:E,q="padding"in t?t.padding:d.padding,te=d.zoomScale(P-g),oe=u.Point.convert(t.offset);let ae=d.centerPoint.add(oe);const le=d.pointLocation(ae),ce=u.LngLat.convert(t.center||le);this._normalizeCenter(ce);const Y=d.project(le),se=d.project(ce).sub(Y);let fe=t.curve;const me=Math.max(d.width,d.height),Pe=me/te,De=se.mag();if("minZoom"in t){const Ct=u.clamp(Math.min(t.minZoom,g,P),d.minZoom,d.maxZoom),Ot=me/d.zoomScale(Ct-g);fe=Math.sqrt(Ot/De*2)}const Re=fe*fe;function ze(Ct){const Ot=(Pe*Pe-me*me+(Ct?-1:1)*Re*Re*De*De)/(2*(Ct?Pe:me)*Re*De);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function Ne(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function We(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const Bt=ze(0);let qe=function(Ct){return We(Bt)/We(Bt+fe*Ct)},mt=function(Ct){return me*((We(Bt)*(Ne(Ot=Bt+fe*Ct)/We(Ot))-Ne(Bt))/Re)/De;var Ot},Qe=(ze(1)-Bt)/fe;if(Math.abs(De)<1e-6||!isFinite(Qe)){if(Math.abs(me-Pe)<1e-6)return this.easeTo(t,a);const Ct=Pe<me?-1:1;Qe=Math.abs(Math.log(Pe/me))/fe,mt=function(){return 0},qe=function(Ot){return Math.exp(Ct*fe*Ot)}}t.duration="duration"in t?+t.duration:1e3*Qe/("screenSpeed"in t?+t.screenSpeed/fe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Lt=v!==U,Ye=V!==E,ut=!d.isPaddingEqual(q),zt=Ct=>Ot=>{const _n=Ot*Qe,Un=1/qe(_n);Ct.zoom=1===Ot?P:g+Ct.scaleZoom(Un),Lt&&(Ct.bearing=u.number(v,U,Ot)),Ye&&(Ct.pitch=u.number(E,V,Ot)),ut&&(Ct.interpolatePadding(C,q,Ot),ae=Ct.centerPoint.add(oe));const hn=1===Ot?ce:Ct.unproject(Y.add(se.mult(mt(_n))).mult(Un));return Ct.setLocationAtPoint(Ct.renderWorldCopies?hn.wrap():hn,ae),Ct._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Ct};if(t.preloadOnly){const Ct=this._emulate(zt,t.duration,d);return this._preloadTiles(Ct),this}return this._zooming=!0,this._rotating=Lt,this._pitching=Ye,this._padding=ut,this._prepareEase(a,!1),this._ease(zt(d),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,a,d){!1===d.animate||0===d.duration?(t(1),a()):(this._easeStart=u.exported.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=u.wrap(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const d=t.lng-a.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&u.exported.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,d){const g=Math.ceil(15*a/1e3),v=[],E=t(d.clone());for(let C=0;C<=g;C++){const P=E(C/g);v.push(P.clone())}return v}}class Zt{constructor(t={}){this.options=t,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact;return this._map=t,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=gt("button","mapboxgl-ctrl-attrib-button",this._container),gt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===a&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const d=this._map._getUIString(`AttributionControl.${a}`);t.setAttribute("aria-label",d),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",d)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(t){const d=a.reduce((g,v,E)=>(v.value&&(g+=`${v.key}=${v.value}${E<a.length-1?"&":""}`),g),"?");t.href=`${u.config.FEEDBACK_URL}/${d}#${Ks(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const a=this._map.style._sourceCaches;for(const g in a){const v=a[g];if(v.used){const E=v.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t.sort((g,v)=>g.length-v.length),t=t.filter((g,v)=>{for(let E=v+1;E<t.length;E++)if(t[E].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Dc{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=gt("div","mapboxgl-ctrl");const a=gt("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const a in t){const d=t[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class ka{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const g of d)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Wl(c,t,a){if(c=new u.LngLat(c.lng,c.lat),t){const d=new u.LngLat(c.lng-360,c.lat),g=new u.LngLat(c.lng+360,c.lat),v=360*Math.ceil(Math.abs(c.lng-a.center.lng)/360),E=a.locationPoint(c).distSqr(t),C=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint(d).distSqr(t)<E&&(C||Math.abs(d.lng-a.center.lng)<v)?c=d:a.locationPoint(g).distSqr(t)<E&&(C||Math.abs(g.lng-a.center.lng)<v)&&(c=g)}for(;Math.abs(c.lng-a.center.lng)>180;){const d=a.locationPoint(c);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;c.lng>a.center.lng?c.lng-=360:c.lng+=360}return c}const nl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class qt extends u.Evented{constructor(t,a){if(super(),(t instanceof u.window.HTMLElement||a)&&(t=u.extend({element:t},a)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=u.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt("div");const g=41,v=27,E=vt("svg",{display:"block",height:g*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${g}`},this._element),C=vt("radialGradient",{id:"shadowGradient"},vt("defs",{},E));vt("stop",{offset:"10%","stop-opacity":.4},C),vt("stop",{offset:"100%","stop-opacity":.05},C),vt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),vt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),vt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),vt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=u.Point.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const d=this._element.classList;for(const g in nl)d.remove(`mapboxgl-marker-anchor-${g}`);d.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,d=t.charCode||t.keyCode;"Space"!==a&&"Enter"!==a&&32!==d&&13!==d||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const d=t.unproject(a),g=t.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(a);let g;t._showingGlobe()&&u.isLngLatBehindGlobe(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${nl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${a.x}px,${a.y}px)\n        `}_calculateXYTransform(){const t=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!t||"map"!==d)return"";if(!a._showingGlobe()){const P=a.getPitch();return P?`rotateX(${P}deg)`:""}const g=u.radToDeg(u.globeTiltAtLngLat(a.transform,this._lngLat)),v=t.sub(u.globeCenterToScreenPoint(a.transform)),E=Math.abs(v.x)+Math.abs(v.y);if(0===E)return"";const C=g/E;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let d=0;const g=this.getRotationAlignment();if("map"===g)if(a._showingGlobe()){const v=a.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=a.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);d=u.radToDeg(Math.atan2(E.y,E.x))-90}else d=-a.getBearing();else if("horizon"===g){const v=u.smoothstep(4,6,a.getZoom()),E=u.globeCenterToScreenPoint(a.transform);E.y+=v*a.transform.height;const C=t.sub(E),P=u.radToDeg(Math.atan2(C.y,C.x));d=(P>90?P-270:P+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){u.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Wl(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),!0===t?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=u.Point.convert(t),this._update(),this}_onMove(t){const a=this._map;if(!a)return;const d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){const v=this._clickTolerance||a._clickTolerance;if(t.point.dist(d)<v)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,d=this._pos;a&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ps={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Iu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xl(c=new u.Point(0,0),t="bottom"){if("number"==typeof c){const a=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new u.Point(0,c);case"top-left":return new u.Point(a,a);case"top-right":return new u.Point(-a,a);case"bottom":return new u.Point(0,-c);case"bottom-left":return new u.Point(a,-a);case"bottom-right":return new u.Point(-a,-a);case"left":return new u.Point(c,0);case"right":return new u.Point(-c,0)}return new u.Point(0,0)}return c instanceof u.Point||Array.isArray(c)?u.Point.convert(c):u.Point.convert(c[t]||[0,0])}class rl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=u.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,d){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+d}}const Xc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Yc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},gh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cf{constructor(t,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new wc({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new Li({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),bt()}move(t,a){const d=this.map,g=this.mouseRotate.mousemoveWindow(t,a),v=g&&g.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const E=this.mousePitch.mousemoveWindow(t,a),C=E&&E.pitchDelta;C&&d.setPitch(d.getPitch()+C)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){nn(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(u.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),on(this.element,t)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,on(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=or(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=or(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const M={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},S={maxWidth:100,unit:"metric"},D={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},O={version:u.version,supported:Yt,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends Au{constructor(c){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(c=u.extend({},Yc,c)).minZoom&&null!=c.maxZoom&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=c.minPitch&&null!=c.maxPitch&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=c.minPitch&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=c.maxPitch&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(c.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ka(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._useWebGL2=c.useWebGL2,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new ka,this._domRenderTaskQueue=new ka,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},Xc,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new rl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,"string"==typeof c.container){if(this._container=u.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Fo(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new qc("string"==typeof c.hash&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,u.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new Zt({customAttribution:c.customAttribution})),this._logoControl=new Dc,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new u.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new u.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(c,t){if(void 0===t&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=c.onAdd(this);this._controls.push(c);const d=this._controlPositions[t];return-1!==t.indexOf("bottom")?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),this.fire(new u.Event("resize",c)),t&&this.fire(new u.Event("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(u.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return"auto"===c?u.window.navigator.language:Array.isArray(c)?0===c.length?void 0:c.map(t=>"auto"===t?u.window.navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style._reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(c){return this._lazyInitEmptyStyle(),c?"string"==typeof c&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const c=this.transform,t=c.projection.name;let a;"globe"===t&&c.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),a=!0):"mercator"===t&&c.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;if(t="globe"===c.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(c){return this.transform.locationPoint3D(u.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(u.Point.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,a){if("mouseenter"===c||"mouseover"===c){let d=!1;const g=E=>{const C=t.filter(U=>this.getLayer(U)),P=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];P.length?d||(d=!0,a.call(this,new Di(c,this,E.originalEvent,{features:P}))):d=!1},v=()=>{d=!1};return{layers:new Set(t),listener:a,delegates:{mousemove:g,mouseout:v}}}if("mouseleave"===c||"mouseout"===c){let d=!1;const g=E=>{const C=t.filter(P=>this.getLayer(P));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?d=!0:d&&(d=!1,a.call(this,new Di(c,this,E.originalEvent)))},v=E=>{d&&(d=!1,a.call(this,new Di(c,this,E.originalEvent)))};return{layers:new Set(t),listener:a,delegates:{mousemove:g,mouseout:v}}}{const d=g=>{const v=t.filter(C=>this.getLayer(C)),E=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];E.length&&(g.features=E,a.call(this,g),delete g.features)};return{layers:new Set(t),listener:a,delegates:{[c]:d}}}}on(c,t,a){if(void 0===a)return super.on(c,t);Array.isArray(t)||(t=[t]);const d=this._createDelegatedListener(c,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(c,t,a){if(void 0===a)return super.once(c,t);Array.isArray(t)||(t=[t]);const d=this._createDelegatedListener(c,t,a);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(c,t,a){if(void 0===a)return super.off(c,t);t=new Set(Array.isArray(t)?t:[t]);const d=(v,E)=>{if(v.size!==E.size)return!1;for(const C of v)if(!E.has(C))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[c]:void 0;return g&&(v=>{for(let E=0;E<v.length;E++){const C=v[E];if(C.listener===a&&d(C.layers,t)){for(const P in C.delegates)this.off(P,C.delegates[P]);return v.splice(E,1),this}}})(g),this}queryRenderedFeatures(c,t){return this.style?(void 0!==t||void 0===c||c instanceof u.Point||Array.isArray(c)||(t=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(c,t){return this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return"globe"!==t&&"mercator"!==t&&u.warnOnce(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(u.Point.convert(c))}setStyle(c,t){return!1!==(t=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(null==t)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new so(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof c?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new so(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,t){if("string"==typeof c){const a=this._requestManager.normalizeStyleURL(c),d=this._requestManager.transformRequest(a,u.ResourceType.Style);u.getJSON(d,(g,v)=>{g?this.fire(new u.ErrorEvent(g)):v&&this._updateDiff(v,t)})}else"object"==typeof c&&this._updateDiff(c,t)}_updateDiff(c,t){try{this.style.setState(c)&&this._update(!0)}catch(a){u.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(c,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(c,t){return this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const t in c){const a=c[t]._tiles;for(const d in a){const g=a[d];if("loaded"!==g.state&&"errored"!==g.state)return!1}}return!0}addSourceType(c,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,a)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,t,{pixelRatio:a=1,sdf:d=!1,stretchX:g,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap){const{width:C,height:P,data:U}=u.exported.getImageData(t);this.style.addImage(c,{data:new u.RGBAImage({width:C,height:P},U),pixelRatio:a,stretchX:g,stretchY:v,content:E,sdf:d,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:P}=t,U=t;this.style.addImage(c,{data:new u.RGBAImage({width:C,height:P},new Uint8Array(U.data)),pixelRatio:a,stretchX:g,stretchY:v,content:E,sdf:d,version:0,userImage:U}),U.onAdd&&U.onAdd(this,c)}}updateImage(c,t){const a=this.style.getImage(c);if(!a)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap?u.exported.getImageData(t):t,{width:g,height:v}=d;void 0!==g&&void 0!==v?g===a.data.width&&v===a.data.height?(a.data.replace(d.data,!(t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap)),this.style.updateImage(c,a)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${g}, ${v})\n                must be that same as the previous version of the image\n                (${a.data.width}, ${a.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,t){u.getImage(this._requestManager.transformRequest(c,u.ResourceType.Image),(a,d)=>{t(a,d instanceof u.window.HTMLImageElement?u.exported.getImageData(d):d)})}listImages(){return this.style.listImages()}addLayer(c,t){return this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)}moveLayer(c,t){return this.style.moveLayer(c,t),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,t,a){return this.style.setLayerZoomRange(c,t,a),this._update(!0)}setFilter(c,t,a={}){return this.style.setFilter(c,t,a),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,t,a,d={}){return this.style.setPaintProperty(c,t,a,d),this._update(!0)}getPaintProperty(c,t){return this.style.getPaintProperty(c,t)}setLayoutProperty(c,t,a,d={}){return this.style.setLayoutProperty(c,t,a,d),this._update(!0)}getLayoutProperty(c,t){return this.style.getLayoutProperty(c,t)}setLight(c,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(c),this.transform):0}setFeatureState(c,t){return this.style.setFeatureState(c,t),this._update()}removeFeatureState(c,t){return this.style.removeFeatureState(c,t),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,d,g,v=this._container;for(;v&&(!d||!g);){const E=u.window.getComputedStyle(v).transform;E&&"none"!==E&&(a=E.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&"0"!==a[0]&&"1"!==a[0]&&(d=a[0]),a[3]&&"0"!==a[3]&&"1"!==a[3]&&(g=a[3])),v=v.parentElement}this._containerWidth=d?Math.abs(c/d):c,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=gt("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=gt("div","mapboxgl-canvas-container",c);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=gt("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=gt("div","mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{d[g]=gt("div",`mapboxgl-ctrl-${g}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const a=u.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(c),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);-1!==t&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const c=u.extend({},Yt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._useWebGL2&&this._canvas.getContext("webgl2",c),a=t||this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);a?(this._useWebGL2&&!t&&u.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),u.storeAuthState(a,!0),this.painter=new Ri(a,this.transform,!!t),this.on("data",d=>{"source"===d.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(a)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;const a=this.painter.context.extTimerQuery,d=u.exported.now();if(this.listens("gpu-timing-frame")&&(t=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const C=this.transform.zoom,P=this.transform.pitch,U=u.exported.now(),V=new u.EvaluationParameters(C,{now:U,fadeDuration:g,pitch:P,transition:this.style.getTransition()});this.style.update(V)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(d),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(d),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const C=u.exported.now()-d;a.endQueryEXT(a.TIME_ELAPSED_EXT,t),setTimeout(()=>{const P=a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(t),this.fire(new u.Event("gpu-timing-frame",{cpuTime:C,gpuTime:P})),u.window.performance.mark("frame-gpu",{startTime:d,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const C=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(C);this.fire(new u.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(C);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{const C=!this.isMoving()&&this.loaded();if(C&&(v=this._updateAverageElevation(d,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const a=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&a(0);if((t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const d=this.transform.averageElevation;let g=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=c;const E=Math.abs(d-g);if(E>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(g),a(g);this._averageElevation.easeTo(g,c,300)}else if(E>1e-4)return this._averageElevation.jumpTo(g),a(g)}return!!this._averageElevation.isEasing(c)&&a(this._averageElevation.getValue(c))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===u.AUTH_ERR_MSG||401===c.status)){const t=this.painter.context.gl;u.storeAuthState(t,!1),this._logoControl instanceof Dc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function g(v){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,v,0);const E=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,E),E}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(g(c),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(c,t,a){let d=a[1]-a[0];const g=c.length/4;for(let v=0;v<t.length;v++){const E=t[v];let C=0;for(let P=0;P<E.length;P+=4)E[P]===c[P]&&E[P+1]===c[P+1]&&E[P+2]===c[P+2]&&E[P+3]===c[P+3]&&(C+=1);d+=(a[v+2]-a[v+1])*(1-C/g)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1),u.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=u.exported.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(c){const t=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(t,(a,d)=>a._preloadTiles(c,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){"hidden"===u.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,t){u.setCacheLimits(c,t)}get version(){return u.version}},NavigationControl:class{constructor(c){this.options=u.extend({},gh,c),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),gt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),gt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=gt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),a=t===c.getMaxZoom(),d=t===c.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cf(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const a=gt("button",c,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(c,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",a),c.firstElementChild&&c.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends u.Evented{constructor(c){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},M,c),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ss(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,c(a)};void 0!==this._supportsGeolocation?c(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(a=>t("denied"!==a.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),a=c.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(c),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",c)),this._finish()}}_updateCamera(c){const t=new u.LngLat(c.coords.longitude,c.coords.latitude),a=c.coords.accuracy,d=this._map.getBearing(),g=u.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),g,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new u.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=u.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(1===c.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===c.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=gt("button","mapboxgl-ctrl-geolocate",this._container),gt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===c){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt("div","mapboxgl-user-location"),this._dotElement.appendChild(gt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(gt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new qt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=gt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:!0===c.absolute&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Zt,ScaleControl:class{constructor(c){this.options=u.extend({},S,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,d=t._containerWidth/2-c/2,g=t.unproject([d,a]),v=t.unproject([d+c,a]),E=g.distanceTo(v);if("imperial"===this.options.unit){const C=3.2808*E;C>5280?this._setScale(c,C/5280,"mile"):this._setScale(c,C,"foot")}else"nautical"===this.options.unit?this._setScale(c,E/1852,"nautical-mile"):E>=1e3?this._setScale(c,E/1e3,"kilometer"):this._setScale(c,E,"meter")}_setScale(c,t,a){this._map._requestDomTask(()=>{const d=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/E;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(P){const U=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*U)/U}(C),E*C}(t),g=d/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==a?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${D[a]}`,this._container.style.width=c*g+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof u.window.HTMLElement?this._container=c.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=gt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);gt("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(c){super(),this.options=u.extend(Object.create(Ps),c),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=u.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(u.window.document.createTextNode(c))}setHTML(c){const t=u.window.document.createDocumentFragment(),a=u.window.document.createElement("body");let d;for(a.innerHTML=c;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=gt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const a=this._closeButton=gt("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,d=this._pos;if(!t||!a||!d)return"bottom";const g=a.offsetWidth,v=a.offsetHeight,E=d.x<g/2,C=d.x>t.transform.width-g/2;if(d.y+c<v)return E?"top-left":C?"top-right":"top";if(d.y>t.transform.height-v){if(E)return"bottom-left";if(C)return"bottom-right"}return E?"left":C?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=gt("div","mapboxgl-popup",t.getContainer()),this._tip=gt("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Wl(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const g=this._pos=this._trackPointer&&c?c:t.project(this._lngLat),v=Xl(this.options.offset),E=this._anchor=this._getAnchor(v.y),C=Xl(this.options.offset,E),P=g.add(C).round();t._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${nl[E]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&t._showingGlobe()){const g=u.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Iu);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:qt,Style:so,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.Point,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:yc,Evented:u.Evented,config:u.config,prewarm:function(){En().acquire(ge)},clearPrewarmedResources:function(){const c=at;c&&(c.isPreloaded()&&1===c.numActive()?(c.release(ge),at=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(c){u.config.ACCESS_TOKEN=c},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(c){u.config.API_URL=c},get workerCount(){return Ue.workerCount},set workerCount(c){Ue.workerCount=c},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){u.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){u.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return O}),W}()},9751:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{y:()=>Tt});var W=ye(2961),I=ye(727),nt=ye(8822),u=ye(9635),Te=ye(2416),Yt=ye(576),Vt=ye(2806);let Tt=(()=>{class Ht{constructor(bt){bt&&(this._subscribe=bt)}lift(bt){const nn=new Ht;return nn.source=this,nn.operator=bt,nn}subscribe(bt,nn,It){const pn=function dt(Ht){return Ht&&Ht instanceof W.Lv||function vt(Ht){return Ht&&(0,Yt.m)(Ht.next)&&(0,Yt.m)(Ht.error)&&(0,Yt.m)(Ht.complete)}(Ht)&&(0,I.Nn)(Ht)}(bt)?bt:new W.Hp(bt,nn,It);return(0,Vt.x)(()=>{const{operator:on,source:or}=this;pn.add(on?on.call(pn,or):or?this._subscribe(pn):this._trySubscribe(pn))}),pn}_trySubscribe(bt){try{return this._subscribe(bt)}catch(nn){bt.error(nn)}}forEach(bt,nn){return new(nn=gt(nn))((It,pn)=>{const on=new W.Hp({next:or=>{try{bt(or)}catch(sn){pn(sn),on.unsubscribe()}},error:pn,complete:It});this.subscribe(on)})}_subscribe(bt){var nn;return null===(nn=this.source)||void 0===nn?void 0:nn.subscribe(bt)}[nt.L](){return this}pipe(...bt){return(0,u.U)(bt)(this)}toPromise(bt){return new(bt=gt(bt))((nn,It)=>{let pn;this.subscribe(on=>pn=on,on=>It(on),()=>nn(pn))})}}return Ht.create=Cn=>new Ht(Cn),Ht})();function gt(Ht){var Cn;return null!==(Cn=Ht??Te.v.Promise)&&void 0!==Cn?Cn:Promise}},7579:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{x:()=>Vt});var W=ye(9751),I=ye(727);const u=(0,ye(3888).d)(gt=>function(){gt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Te=ye(8737),Yt=ye(2806);let Vt=(()=>{class gt extends W.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(dt){const Ht=new Tt(this,this);return Ht.operator=dt,Ht}_throwIfClosed(){if(this.closed)throw new u}next(dt){(0,Yt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Ht of this.currentObservers)Ht.next(dt)}})}error(dt){(0,Yt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=dt;const{observers:Ht}=this;for(;Ht.length;)Ht.shift().error(dt)}})}complete(){(0,Yt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:dt}=this;for(;dt.length;)dt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var dt;return(null===(dt=this.observers)||void 0===dt?void 0:dt.length)>0}_trySubscribe(dt){return this._throwIfClosed(),super._trySubscribe(dt)}_subscribe(dt){return this._throwIfClosed(),this._checkFinalizedStatuses(dt),this._innerSubscribe(dt)}_innerSubscribe(dt){const{hasError:Ht,isStopped:Cn,observers:bt}=this;return Ht||Cn?I.Lc:(this.currentObservers=null,bt.push(dt),new I.w0(()=>{this.currentObservers=null,(0,Te.P)(bt,dt)}))}_checkFinalizedStatuses(dt){const{hasError:Ht,thrownError:Cn,isStopped:bt}=this;Ht?dt.error(Cn):bt&&dt.complete()}asObservable(){const dt=new W.y;return dt.source=this,dt}}return gt.create=(vt,dt)=>new Tt(vt,dt),gt})();class Tt extends Vt{constructor(vt,dt){super(),this.destination=vt,this.source=dt}next(vt){var dt,Ht;null===(Ht=null===(dt=this.destination)||void 0===dt?void 0:dt.next)||void 0===Ht||Ht.call(dt,vt)}error(vt){var dt,Ht;null===(Ht=null===(dt=this.destination)||void 0===dt?void 0:dt.error)||void 0===Ht||Ht.call(dt,vt)}complete(){var vt,dt;null===(dt=null===(vt=this.destination)||void 0===vt?void 0:vt.complete)||void 0===dt||dt.call(vt)}_subscribe(vt){var dt,Ht;return null!==(Ht=null===(dt=this.source)||void 0===dt?void 0:dt.subscribe(vt))&&void 0!==Ht?Ht:I.Lc}}},2961:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{Hp:()=>It,Lv:()=>Ht});var W=ye(576),I=ye(727),nt=ye(2416),u=ye(7849);function Te(){}const Yt=gt("C",void 0,void 0);function gt(tn,Ge,kt){return{kind:tn,value:Ge,error:kt}}var vt=ye(3410),dt=ye(2806);class Ht extends I.w0{constructor(Ge){super(),this.isStopped=!1,Ge?(this.destination=Ge,(0,I.Nn)(Ge)&&Ge.add(this)):this.destination=sn}static create(Ge,kt,lr){return new It(Ge,kt,lr)}next(Ge){this.isStopped?or(function Tt(tn){return gt("N",tn,void 0)}(Ge),this):this._next(Ge)}error(Ge){this.isStopped?or(function Vt(tn){return gt("E",void 0,tn)}(Ge),this):(this.isStopped=!0,this._error(Ge))}complete(){this.isStopped?or(Yt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ge){this.destination.next(Ge)}_error(Ge){try{this.destination.error(Ge)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Cn=Function.prototype.bind;function bt(tn,Ge){return Cn.call(tn,Ge)}class nn{constructor(Ge){this.partialObserver=Ge}next(Ge){const{partialObserver:kt}=this;if(kt.next)try{kt.next(Ge)}catch(lr){pn(lr)}}error(Ge){const{partialObserver:kt}=this;if(kt.error)try{kt.error(Ge)}catch(lr){pn(lr)}else pn(Ge)}complete(){const{partialObserver:Ge}=this;if(Ge.complete)try{Ge.complete()}catch(kt){pn(kt)}}}class It extends Ht{constructor(Ge,kt,lr){let tt;if(super(),(0,W.m)(Ge)||!Ge)tt={next:Ge??void 0,error:kt??void 0,complete:lr??void 0};else{let ft;this&&nt.v.useDeprecatedNextContext?(ft=Object.create(Ge),ft.unsubscribe=()=>this.unsubscribe(),tt={next:Ge.next&&bt(Ge.next,ft),error:Ge.error&&bt(Ge.error,ft),complete:Ge.complete&&bt(Ge.complete,ft)}):tt=Ge}this.destination=new nn(tt)}}function pn(tn){nt.v.useDeprecatedSynchronousErrorHandling?(0,dt.O)(tn):(0,u.h)(tn)}function or(tn,Ge){const{onStoppedNotification:kt}=nt.v;kt&&vt.z.setTimeout(()=>kt(tn,Ge))}const sn={closed:!0,next:Te,error:function on(tn){throw tn},complete:Te}},727:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{Lc:()=>Yt,w0:()=>Te,Nn:()=>Vt});var W=ye(576);const nt=(0,ye(3888).d)(gt=>function(dt){gt(this),this.message=dt?`${dt.length} errors occurred during unsubscription:\n${dt.map((Ht,Cn)=>`${Cn+1}) ${Ht.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=dt});var u=ye(8737);class Te{constructor(vt){this.initialTeardown=vt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let vt;if(!this.closed){this.closed=!0;const{_parentage:dt}=this;if(dt)if(this._parentage=null,Array.isArray(dt))for(const bt of dt)bt.remove(this);else dt.remove(this);const{initialTeardown:Ht}=this;if((0,W.m)(Ht))try{Ht()}catch(bt){vt=bt instanceof nt?bt.errors:[bt]}const{_finalizers:Cn}=this;if(Cn){this._finalizers=null;for(const bt of Cn)try{Tt(bt)}catch(nn){vt=vt??[],nn instanceof nt?vt=[...vt,...nn.errors]:vt.push(nn)}}if(vt)throw new nt(vt)}}add(vt){var dt;if(vt&&vt!==this)if(this.closed)Tt(vt);else{if(vt instanceof Te){if(vt.closed||vt._hasParent(this))return;vt._addParent(this)}(this._finalizers=null!==(dt=this._finalizers)&&void 0!==dt?dt:[]).push(vt)}}_hasParent(vt){const{_parentage:dt}=this;return dt===vt||Array.isArray(dt)&&dt.includes(vt)}_addParent(vt){const{_parentage:dt}=this;this._parentage=Array.isArray(dt)?(dt.push(vt),dt):dt?[dt,vt]:vt}_removeParent(vt){const{_parentage:dt}=this;dt===vt?this._parentage=null:Array.isArray(dt)&&(0,u.P)(dt,vt)}remove(vt){const{_finalizers:dt}=this;dt&&(0,u.P)(dt,vt),vt instanceof Te&&vt._removeParent(this)}}Te.EMPTY=(()=>{const gt=new Te;return gt.closed=!0,gt})();const Yt=Te.EMPTY;function Vt(gt){return gt instanceof Te||gt&&"closed"in gt&&(0,W.m)(gt.remove)&&(0,W.m)(gt.add)&&(0,W.m)(gt.unsubscribe)}function Tt(gt){(0,W.m)(gt)?gt():gt.unsubscribe()}},2416:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{v:()=>W});const W={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{E:()=>I});const I=new(ye(9751).y)(Te=>Te.complete())},2076:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{D:()=>lr});var W=ye(8421),I=ye(9672),nt=ye(4482),u=ye(5403);function Te(tt,ft=0){return(0,nt.e)((rn,Xe)=>{rn.subscribe((0,u.x)(Xe,He=>(0,I.f)(Xe,tt,()=>Xe.next(He),ft),()=>(0,I.f)(Xe,tt,()=>Xe.complete(),ft),He=>(0,I.f)(Xe,tt,()=>Xe.error(He),ft)))})}function Yt(tt,ft=0){return(0,nt.e)((rn,Xe)=>{Xe.add(tt.schedule(()=>rn.subscribe(Xe),ft))})}var gt=ye(9751),dt=ye(2202),Ht=ye(576);function bt(tt,ft){if(!tt)throw new Error("Iterable cannot be null");return new gt.y(rn=>{(0,I.f)(rn,ft,()=>{const Xe=tt[Symbol.asyncIterator]();(0,I.f)(rn,ft,()=>{Xe.next().then(He=>{He.done?rn.complete():rn.next(He.value)})},0,!0)})})}var nn=ye(3670),It=ye(8239),pn=ye(1144),on=ye(6495),or=ye(2206),sn=ye(4532),tn=ye(3260);function lr(tt,ft){return ft?function kt(tt,ft){if(null!=tt){if((0,nn.c)(tt))return function Vt(tt,ft){return(0,W.Xf)(tt).pipe(Yt(ft),Te(ft))}(tt,ft);if((0,pn.z)(tt))return function vt(tt,ft){return new gt.y(rn=>{let Xe=0;return ft.schedule(function(){Xe===tt.length?rn.complete():(rn.next(tt[Xe++]),rn.closed||this.schedule())})})}(tt,ft);if((0,It.t)(tt))return function Tt(tt,ft){return(0,W.Xf)(tt).pipe(Yt(ft),Te(ft))}(tt,ft);if((0,or.D)(tt))return bt(tt,ft);if((0,on.T)(tt))return function Cn(tt,ft){return new gt.y(rn=>{let Xe;return(0,I.f)(rn,ft,()=>{Xe=tt[dt.h](),(0,I.f)(rn,ft,()=>{let He,lt;try{({value:He,done:lt}=Xe.next())}catch(Be){return void rn.error(Be)}lt?rn.complete():rn.next(He)},0,!0)}),()=>(0,Ht.m)(Xe?.return)&&Xe.return()})}(tt,ft);if((0,tn.L)(tt))return function Ge(tt,ft){return bt((0,tn.Q)(tt),ft)}(tt,ft)}throw(0,sn.z)(tt)}(tt,ft):(0,W.Xf)(tt)}},8421:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{Xf:()=>Cn});var W=ye(655),I=ye(1144),nt=ye(8239),u=ye(9751),Te=ye(3670),Yt=ye(2206),Vt=ye(4532),Tt=ye(6495),gt=ye(3260),vt=ye(576),dt=ye(7849),Ht=ye(8822);function Cn(tn){if(tn instanceof u.y)return tn;if(null!=tn){if((0,Te.c)(tn))return function bt(tn){return new u.y(Ge=>{const kt=tn[Ht.L]();if((0,vt.m)(kt.subscribe))return kt.subscribe(Ge);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(tn);if((0,I.z)(tn))return function nn(tn){return new u.y(Ge=>{for(let kt=0;kt<tn.length&&!Ge.closed;kt++)Ge.next(tn[kt]);Ge.complete()})}(tn);if((0,nt.t)(tn))return function It(tn){return new u.y(Ge=>{tn.then(kt=>{Ge.closed||(Ge.next(kt),Ge.complete())},kt=>Ge.error(kt)).then(null,dt.h)})}(tn);if((0,Yt.D)(tn))return on(tn);if((0,Tt.T)(tn))return function pn(tn){return new u.y(Ge=>{for(const kt of tn)if(Ge.next(kt),Ge.closed)return;Ge.complete()})}(tn);if((0,gt.L)(tn))return function or(tn){return on((0,gt.Q)(tn))}(tn)}throw(0,Vt.z)(tn)}function on(tn){return new u.y(Ge=>{(function sn(tn,Ge){var kt,lr,tt,ft;return(0,W.mG)(this,void 0,void 0,function*(){try{for(kt=(0,W.KL)(tn);!(lr=yield kt.next()).done;)if(Ge.next(lr.value),Ge.closed)return}catch(rn){tt={error:rn}}finally{try{lr&&!lr.done&&(ft=kt.return)&&(yield ft.call(kt))}finally{if(tt)throw tt.error}}Ge.complete()})})(tn,Ge).catch(kt=>Ge.error(kt))})}},9646:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{of:()=>nt});var W=ye(7669),I=ye(2076);function nt(...u){const Te=(0,W.yG)(u);return(0,I.D)(u,Te)}},5403:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{x:()=>I});var W=ye(2961);function I(u,Te,Yt,Vt,Tt){return new nt(u,Te,Yt,Vt,Tt)}class nt extends W.Lv{constructor(Te,Yt,Vt,Tt,gt,vt){super(Te),this.onFinalize=gt,this.shouldUnsubscribe=vt,this._next=Yt?function(dt){try{Yt(dt)}catch(Ht){Te.error(Ht)}}:super._next,this._error=Tt?function(dt){try{Tt(dt)}catch(Ht){Te.error(Ht)}finally{this.unsubscribe()}}:super._error,this._complete=Vt?function(){try{Vt()}catch(dt){Te.error(dt)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Te;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Yt}=this;super.unsubscribe(),!Yt&&(null===(Te=this.onFinalize)||void 0===Te||Te.call(this))}}}},262:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{K:()=>u});var W=ye(8421),I=ye(5403),nt=ye(4482);function u(Te){return(0,nt.e)((Yt,Vt)=>{let vt,Tt=null,gt=!1;Tt=Yt.subscribe((0,I.x)(Vt,void 0,void 0,dt=>{vt=(0,W.Xf)(Te(dt,u(Te)(Yt))),Tt?(Tt.unsubscribe(),Tt=null,vt.subscribe(Vt)):gt=!0})),gt&&(Tt.unsubscribe(),Tt=null,vt.subscribe(Vt))})}},4351:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{b:()=>nt});var W=ye(5577),I=ye(576);function nt(u,Te){return(0,I.m)(Te)?(0,W.z)(u,Te,1):(0,W.z)(u,1)}},9300:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{h:()=>nt});var W=ye(4482),I=ye(5403);function nt(u,Te){return(0,W.e)((Yt,Vt)=>{let Tt=0;Yt.subscribe((0,I.x)(Vt,gt=>u.call(Te,gt,Tt++)&&Vt.next(gt)))})}},4004:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{U:()=>nt});var W=ye(4482),I=ye(5403);function nt(u,Te){return(0,W.e)((Yt,Vt)=>{let Tt=0;Yt.subscribe((0,I.x)(Vt,gt=>{Vt.next(u.call(Te,gt,Tt++))}))})}},8189:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{J:()=>nt});var W=ye(5577),I=ye(4671);function nt(u=1/0){return(0,W.z)(I.y,u)}},5577:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{z:()=>Tt});var W=ye(4004),I=ye(8421),nt=ye(4482),u=ye(9672),Te=ye(5403),Vt=ye(576);function Tt(gt,vt,dt=1/0){return(0,Vt.m)(vt)?Tt((Ht,Cn)=>(0,W.U)((bt,nn)=>vt(Ht,bt,Cn,nn))((0,I.Xf)(gt(Ht,Cn))),dt):("number"==typeof vt&&(dt=vt),(0,nt.e)((Ht,Cn)=>function Yt(gt,vt,dt,Ht,Cn,bt,nn,It){const pn=[];let on=0,or=0,sn=!1;const tn=()=>{sn&&!pn.length&&!on&&vt.complete()},Ge=lr=>on<Ht?kt(lr):pn.push(lr),kt=lr=>{bt&&vt.next(lr),on++;let tt=!1;(0,I.Xf)(dt(lr,or++)).subscribe((0,Te.x)(vt,ft=>{Cn?.(ft),bt?Ge(ft):vt.next(ft)},()=>{tt=!0},void 0,()=>{if(tt)try{for(on--;pn.length&&on<Ht;){const ft=pn.shift();nn?(0,u.f)(vt,nn,()=>kt(ft)):kt(ft)}tn()}catch(ft){vt.error(ft)}}))};return gt.subscribe((0,Te.x)(vt,Ge,()=>{sn=!0,tn()})),()=>{It?.()}}(Ht,Cn,gt,dt)))}},3900:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{w:()=>u});var W=ye(8421),I=ye(4482),nt=ye(5403);function u(Te,Yt){return(0,I.e)((Vt,Tt)=>{let gt=null,vt=0,dt=!1;const Ht=()=>dt&&!gt&&Tt.complete();Vt.subscribe((0,nt.x)(Tt,Cn=>{gt?.unsubscribe();let bt=0;const nn=vt++;(0,W.Xf)(Te(Cn,nn)).subscribe(gt=(0,nt.x)(Tt,It=>Tt.next(Yt?Yt(Cn,It,nn,bt++):It),()=>{gt=null,Ht()}))},()=>{dt=!0,Ht()}))})}},8505:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{b:()=>Te});var W=ye(576),I=ye(4482),nt=ye(5403),u=ye(4671);function Te(Yt,Vt,Tt){const gt=(0,W.m)(Yt)||Vt||Tt?{next:Yt,error:Vt,complete:Tt}:Yt;return gt?(0,I.e)((vt,dt)=>{var Ht;null===(Ht=gt.subscribe)||void 0===Ht||Ht.call(gt);let Cn=!0;vt.subscribe((0,nt.x)(dt,bt=>{var nn;null===(nn=gt.next)||void 0===nn||nn.call(gt,bt),dt.next(bt)},()=>{var bt;Cn=!1,null===(bt=gt.complete)||void 0===bt||bt.call(gt),dt.complete()},bt=>{var nn;Cn=!1,null===(nn=gt.error)||void 0===nn||nn.call(gt,bt),dt.error(bt)},()=>{var bt,nn;Cn&&(null===(bt=gt.unsubscribe)||void 0===bt||bt.call(gt)),null===(nn=gt.finalize)||void 0===nn||nn.call(gt)}))}):u.y}},3410:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{z:()=>W});const W={setTimeout(I,nt,...u){const{delegate:Te}=W;return Te?.setTimeout?Te.setTimeout(I,nt,...u):setTimeout(I,nt,...u)},clearTimeout(I){const{delegate:nt}=W;return(nt?.clearTimeout||clearTimeout)(I)},delegate:void 0}},2202:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{h:()=>I});const I=function W(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{L:()=>W});const W="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{_6:()=>Yt,jO:()=>u,yG:()=>Te});var W=ye(576);function nt(Vt){return Vt[Vt.length-1]}function u(Vt){return(0,W.m)(nt(Vt))?Vt.pop():void 0}function Te(Vt){return function I(Vt){return Vt&&(0,W.m)(Vt.schedule)}(nt(Vt))?Vt.pop():void 0}function Yt(Vt,Tt){return"number"==typeof nt(Vt)?Vt.pop():Tt}},4742:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{D:()=>Te});const{isArray:W}=Array,{getPrototypeOf:I,prototype:nt,keys:u}=Object;function Te(Vt){if(1===Vt.length){const Tt=Vt[0];if(W(Tt))return{args:Tt,keys:null};if(function Yt(Vt){return Vt&&"object"==typeof Vt&&I(Vt)===nt}(Tt)){const gt=u(Tt);return{args:gt.map(vt=>Tt[vt]),keys:gt}}}return{args:Vt,keys:null}}},8737:(Hn,Gt,ye)=>{"use strict";function W(I,nt){if(I){const u=I.indexOf(nt);0<=u&&I.splice(u,1)}}ye.d(Gt,{P:()=>W})},3888:(Hn,Gt,ye)=>{"use strict";function W(I){const u=I(Te=>{Error.call(Te),Te.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}ye.d(Gt,{d:()=>W})},1810:(Hn,Gt,ye)=>{"use strict";function W(I,nt){return I.reduce((u,Te,Yt)=>(u[Te]=nt[Yt],u),{})}ye.d(Gt,{n:()=>W})},2806:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{O:()=>u,x:()=>nt});var W=ye(2416);let I=null;function nt(Te){if(W.v.useDeprecatedSynchronousErrorHandling){const Yt=!I;if(Yt&&(I={errorThrown:!1,error:null}),Te(),Yt){const{errorThrown:Vt,error:Tt}=I;if(I=null,Vt)throw Tt}}else Te()}function u(Te){W.v.useDeprecatedSynchronousErrorHandling&&I&&(I.errorThrown=!0,I.error=Te)}},9672:(Hn,Gt,ye)=>{"use strict";function W(I,nt,u,Te=0,Yt=!1){const Vt=nt.schedule(function(){u(),Yt?I.add(this.schedule(null,Te)):this.unsubscribe()},Te);if(I.add(Vt),!Yt)return Vt}ye.d(Gt,{f:()=>W})},4671:(Hn,Gt,ye)=>{"use strict";function W(I){return I}ye.d(Gt,{y:()=>W})},1144:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{z:()=>W});const W=I=>I&&"number"==typeof I.length&&"function"!=typeof I},2206:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{D:()=>I});var W=ye(576);function I(nt){return Symbol.asyncIterator&&(0,W.m)(nt?.[Symbol.asyncIterator])}},576:(Hn,Gt,ye)=>{"use strict";function W(I){return"function"==typeof I}ye.d(Gt,{m:()=>W})},3670:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{c:()=>nt});var W=ye(8822),I=ye(576);function nt(u){return(0,I.m)(u[W.L])}},6495:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{T:()=>nt});var W=ye(2202),I=ye(576);function nt(u){return(0,I.m)(u?.[W.h])}},8239:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{t:()=>I});var W=ye(576);function I(nt){return(0,W.m)(nt?.then)}},3260:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{L:()=>u,Q:()=>nt});var W=ye(655),I=ye(576);function nt(Te){return(0,W.FC)(this,arguments,function*(){const Vt=Te.getReader();try{for(;;){const{value:Tt,done:gt}=yield(0,W.qq)(Vt.read());if(gt)return yield(0,W.qq)(void 0);yield yield(0,W.qq)(Tt)}}finally{Vt.releaseLock()}})}function u(Te){return(0,I.m)(Te?.getReader)}},4482:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{A:()=>I,e:()=>nt});var W=ye(576);function I(u){return(0,W.m)(u?.lift)}function nt(u){return Te=>{if(I(Te))return Te.lift(function(Yt){try{return u(Yt,this)}catch(Vt){this.error(Vt)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{Z:()=>u});var W=ye(4004);const{isArray:I}=Array;function u(Te){return(0,W.U)(Yt=>function nt(Te,Yt){return I(Yt)?Te(...Yt):Te(Yt)}(Te,Yt))}},9635:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{U:()=>nt,z:()=>I});var W=ye(4671);function I(...u){return nt(u)}function nt(u){return 0===u.length?W.y:1===u.length?u[0]:function(Yt){return u.reduce((Vt,Tt)=>Tt(Vt),Yt)}}},7849:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{h:()=>nt});var W=ye(2416),I=ye(3410);function nt(u){I.z.setTimeout(()=>{const{onUnhandledError:Te}=W.v;if(!Te)throw u;Te(u)})}},4532:(Hn,Gt,ye)=>{"use strict";function W(I){return new TypeError(`You provided ${null!==I&&"object"==typeof I?"an invalid object":`'${I}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}ye.d(Gt,{z:()=>W})},655:(Hn,Gt,ye)=>{"use strict";function Tt(Xe,He,lt,Be){return new(lt||(lt=Promise))(function(ht,fn){function kn(vr){try{Dn(Be.next(vr))}catch(li){fn(li)}}function gr(vr){try{Dn(Be.throw(vr))}catch(li){fn(li)}}function Dn(vr){vr.done?ht(vr.value):function Wt(ht){return ht instanceof lt?ht:new lt(function(fn){fn(ht)})}(vr.value).then(kn,gr)}Dn((Be=Be.apply(Xe,He||[])).next())})}function pn(Xe){return this instanceof pn?(this.v=Xe,this):new pn(Xe)}function on(Xe,He,lt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Wt,Be=lt.apply(Xe,He||[]),ht=[];return Wt={},fn("next"),fn("throw"),fn("return"),Wt[Symbol.asyncIterator]=function(){return this},Wt;function fn(xr){Be[xr]&&(Wt[xr]=function(Mi){return new Promise(function(Zr,Ar){ht.push([xr,Mi,Zr,Ar])>1||kn(xr,Mi)})})}function kn(xr,Mi){try{!function gr(xr){xr.value instanceof pn?Promise.resolve(xr.value.v).then(Dn,vr):li(ht[0][2],xr)}(Be[xr](Mi))}catch(Zr){li(ht[0][3],Zr)}}function Dn(xr){kn("next",xr)}function vr(xr){kn("throw",xr)}function li(xr,Mi){xr(Mi),ht.shift(),ht.length&&kn(ht[0][0],ht[0][1])}}function sn(Xe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var lt,He=Xe[Symbol.asyncIterator];return He?He.call(Xe):(Xe=function Ht(Xe){var He="function"==typeof Symbol&&Symbol.iterator,lt=He&&Xe[He],Be=0;if(lt)return lt.call(Xe);if(Xe&&"number"==typeof Xe.length)return{next:function(){return Xe&&Be>=Xe.length&&(Xe=void 0),{value:Xe&&Xe[Be++],done:!Xe}}};throw new TypeError(He?"Object is not iterable.":"Symbol.iterator is not defined.")}(Xe),lt={},Be("next"),Be("throw"),Be("return"),lt[Symbol.asyncIterator]=function(){return this},lt);function Be(ht){lt[ht]=Xe[ht]&&function(fn){return new Promise(function(kn,gr){!function Wt(ht,fn,kn,gr){Promise.resolve(gr).then(function(Dn){ht({value:Dn,done:kn})},fn)}(kn,gr,(fn=Xe[ht](fn)).done,fn.value)})}}}ye.d(Gt,{FC:()=>on,KL:()=>sn,mG:()=>Tt,qq:()=>pn})},6895:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{Do:()=>sn,EM:()=>ls,HT:()=>Te,JF:()=>wa,JJ:()=>Pi,K0:()=>Vt,Mx:()=>rt,O5:()=>Rt,S$:()=>pn,V_:()=>vt,Ye:()=>tn,b0:()=>or,bD:()=>ws,ez:()=>ss,mk:()=>io,q:()=>nt,sg:()=>Ii,w_:()=>Yt});var W=ye(8256);let I=null;function nt(){return I}function Te(B){I||(I=B)}class Yt{}const Vt=new W.OlP("DocumentToken");let Tt=(()=>{class B{historyGo($){throw new Error("Not implemented")}}return B.\u0275fac=function($){return new($||B)},B.\u0275prov=W.Yz7({token:B,factory:function(){return function gt(){return(0,W.LFG)(dt)}()},providedIn:"platform"}),B})();const vt=new W.OlP("Location Initialized");let dt=(()=>{class B extends Tt{constructor($){super(),this._doc=$,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return nt().getBaseHref(this._doc)}onPopState($){const re=nt().getGlobalEventTarget(this._doc,"window");return re.addEventListener("popstate",$,!1),()=>re.removeEventListener("popstate",$)}onHashChange($){const re=nt().getGlobalEventTarget(this._doc,"window");return re.addEventListener("hashchange",$,!1),()=>re.removeEventListener("hashchange",$)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname($){this.location.pathname=$}pushState($,re,Ae){Ht()?this._history.pushState($,re,Ae):this.location.hash=Ae}replaceState($,re,Ae){Ht()?this._history.replaceState($,re,Ae):this.location.hash=Ae}forward(){this._history.forward()}back(){this._history.back()}historyGo($=0){this._history.go($)}getState(){return this._history.state}}return B.\u0275fac=function($){return new($||B)(W.LFG(Vt))},B.\u0275prov=W.Yz7({token:B,factory:function(){return function Cn(){return new dt((0,W.LFG)(Vt))}()},providedIn:"platform"}),B})();function Ht(){return!!window.history.pushState}function bt(B,J){if(0==B.length)return J;if(0==J.length)return B;let $=0;return B.endsWith("/")&&$++,J.startsWith("/")&&$++,2==$?B+J.substring(1):1==$?B+J:B+"/"+J}function nn(B){const J=B.match(/#|\?|$/),$=J&&J.index||B.length;return B.slice(0,$-("/"===B[$-1]?1:0))+B.slice($)}function It(B){return B&&"?"!==B[0]?"?"+B:B}let pn=(()=>{class B{historyGo($){throw new Error("Not implemented")}}return B.\u0275fac=function($){return new($||B)},B.\u0275prov=W.Yz7({token:B,factory:function(){return(0,W.f3M)(or)},providedIn:"root"}),B})();const on=new W.OlP("appBaseHref");let or=(()=>{class B extends pn{constructor($,re){super(),this._platformLocation=$,this._removeListenerFns=[],this._baseHref=re??this._platformLocation.getBaseHrefFromDOM()??(0,W.f3M)(Vt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState($){this._removeListenerFns.push(this._platformLocation.onPopState($),this._platformLocation.onHashChange($))}getBaseHref(){return this._baseHref}prepareExternalUrl($){return bt(this._baseHref,$)}path($=!1){const re=this._platformLocation.pathname+It(this._platformLocation.search),Ae=this._platformLocation.hash;return Ae&&$?`${re}${Ae}`:re}pushState($,re,Ae,it){const At=this.prepareExternalUrl(Ae+It(it));this._platformLocation.pushState($,re,At)}replaceState($,re,Ae,it){const At=this.prepareExternalUrl(Ae+It(it));this._platformLocation.replaceState($,re,At)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo($=0){this._platformLocation.historyGo?.($)}}return B.\u0275fac=function($){return new($||B)(W.LFG(Tt),W.LFG(on,8))},B.\u0275prov=W.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),B})(),sn=(()=>{class B extends pn{constructor($,re){super(),this._platformLocation=$,this._baseHref="",this._removeListenerFns=[],null!=re&&(this._baseHref=re)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState($){this._removeListenerFns.push(this._platformLocation.onPopState($),this._platformLocation.onHashChange($))}getBaseHref(){return this._baseHref}path($=!1){let re=this._platformLocation.hash;return null==re&&(re="#"),re.length>0?re.substring(1):re}prepareExternalUrl($){const re=bt(this._baseHref,$);return re.length>0?"#"+re:re}pushState($,re,Ae,it){let At=this.prepareExternalUrl(Ae+It(it));0==At.length&&(At=this._platformLocation.pathname),this._platformLocation.pushState($,re,At)}replaceState($,re,Ae,it){let At=this.prepareExternalUrl(Ae+It(it));0==At.length&&(At=this._platformLocation.pathname),this._platformLocation.replaceState($,re,At)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo($=0){this._platformLocation.historyGo?.($)}}return B.\u0275fac=function($){return new($||B)(W.LFG(Tt),W.LFG(on,8))},B.\u0275prov=W.Yz7({token:B,factory:B.\u0275fac}),B})(),tn=(()=>{class B{constructor($){this._subject=new W.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=$;const re=this._locationStrategy.getBaseHref();this._baseHref=nn(lr(re)),this._locationStrategy.onPopState(Ae=>{this._subject.emit({url:this.path(!0),pop:!0,state:Ae.state,type:Ae.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path($=!1){return this.normalize(this._locationStrategy.path($))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo($,re=""){return this.path()==this.normalize($+It(re))}normalize($){return B.stripTrailingSlash(function kt(B,J){return B&&J.startsWith(B)?J.substring(B.length):J}(this._baseHref,lr($)))}prepareExternalUrl($){return $&&"/"!==$[0]&&($="/"+$),this._locationStrategy.prepareExternalUrl($)}go($,re="",Ae=null){this._locationStrategy.pushState(Ae,"",$,re),this._notifyUrlChangeListeners(this.prepareExternalUrl($+It(re)),Ae)}replaceState($,re="",Ae=null){this._locationStrategy.replaceState(Ae,"",$,re),this._notifyUrlChangeListeners(this.prepareExternalUrl($+It(re)),Ae)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo($=0){this._locationStrategy.historyGo?.($)}onUrlChange($){return this._urlChangeListeners.push($),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(re=>{this._notifyUrlChangeListeners(re.url,re.state)})),()=>{const re=this._urlChangeListeners.indexOf($);this._urlChangeListeners.splice(re,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners($="",re){this._urlChangeListeners.forEach(Ae=>Ae($,re))}subscribe($,re,Ae){return this._subject.subscribe({next:$,error:re,complete:Ae})}}return B.normalizeQueryParams=It,B.joinWithSlash=bt,B.stripTrailingSlash=nn,B.\u0275fac=function($){return new($||B)(W.LFG(pn))},B.\u0275prov=W.Yz7({token:B,factory:function(){return function Ge(){return new tn((0,W.LFG)(pn))}()},providedIn:"root"}),B})();function lr(B){return B.replace(/\/index.html$/,"")}var ft=(()=>((ft=ft||{})[ft.Decimal=0]="Decimal",ft[ft.Percent=1]="Percent",ft[ft.Currency=2]="Currency",ft[ft.Scientific=3]="Scientific",ft))(),Be=(()=>((Be=Be||{})[Be.Decimal=0]="Decimal",Be[Be.Group=1]="Group",Be[Be.List=2]="List",Be[Be.PercentSign=3]="PercentSign",Be[Be.PlusSign=4]="PlusSign",Be[Be.MinusSign=5]="MinusSign",Be[Be.Exponential=6]="Exponential",Be[Be.SuperscriptingExponent=7]="SuperscriptingExponent",Be[Be.PerMille=8]="PerMille",Be[Be.Infinity=9]="Infinity",Be[Be.NaN=10]="NaN",Be[Be.TimeSeparator=11]="TimeSeparator",Be[Be.CurrencyDecimal=12]="CurrencyDecimal",Be[Be.CurrencyGroup=13]="CurrencyGroup",Be))();function Ar(B,J){const $=(0,W.cg1)(B),re=$[W.wAp.NumberSymbols][J];if(typeof re>"u"){if(J===Be.CurrencyDecimal)return $[W.wAp.NumberSymbols][Be.Decimal];if(J===Be.CurrencyGroup)return $[W.wAp.NumberSymbols][Be.Group]}return re}const Mr=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Or(B){const J=parseInt(B);if(isNaN(J))throw new Error("Invalid integer literal when parsing "+B);return J}function rt(B,J){J=encodeURIComponent(J);for(const $ of B.split(";")){const re=$.indexOf("="),[Ae,it]=-1==re?[$,""]:[$.slice(0,re),$.slice(re+1)];if(Ae.trim()===J)return decodeURIComponent(it)}return null}let io=(()=>{class B{constructor($,re,Ae,it){this._iterableDiffers=$,this._keyValueDiffers=re,this._ngEl=Ae,this._renderer=it,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass($){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof $?$.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass($){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof $?$.split(/\s+/):$,this._rawClass&&((0,W.sIi)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const $=this._iterableDiffer.diff(this._rawClass);$&&this._applyIterableChanges($)}else if(this._keyValueDiffer){const $=this._keyValueDiffer.diff(this._rawClass);$&&this._applyKeyValueChanges($)}}_applyKeyValueChanges($){$.forEachAddedItem(re=>this._toggleClass(re.key,re.currentValue)),$.forEachChangedItem(re=>this._toggleClass(re.key,re.currentValue)),$.forEachRemovedItem(re=>{re.previousValue&&this._toggleClass(re.key,!1)})}_applyIterableChanges($){$.forEachAddedItem(re=>{if("string"!=typeof re.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${(0,W.AaK)(re.item)}`);this._toggleClass(re.item,!0)}),$.forEachRemovedItem(re=>this._toggleClass(re.item,!1))}_applyClasses($){$&&(Array.isArray($)||$ instanceof Set?$.forEach(re=>this._toggleClass(re,!0)):Object.keys($).forEach(re=>this._toggleClass(re,!!$[re])))}_removeClasses($){$&&(Array.isArray($)||$ instanceof Set?$.forEach(re=>this._toggleClass(re,!1)):Object.keys($).forEach(re=>this._toggleClass(re,!1)))}_toggleClass($,re){($=$.trim())&&$.split(/\s+/g).forEach(Ae=>{re?this._renderer.addClass(this._ngEl.nativeElement,Ae):this._renderer.removeClass(this._ngEl.nativeElement,Ae)})}}return B.\u0275fac=function($){return new($||B)(W.Y36(W.ZZ4),W.Y36(W.aQg),W.Y36(W.SBq),W.Y36(W.Qsj))},B.\u0275dir=W.lG2({type:B,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),B})();class Ai{constructor(J,$,re,Ae){this.$implicit=J,this.ngForOf=$,this.index=re,this.count=Ae}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Ii=(()=>{class B{constructor($,re,Ae){this._viewContainer=$,this._template=re,this._differs=Ae,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf($){this._ngForOf=$,this._ngForOfDirty=!0}set ngForTrackBy($){this._trackByFn=$}get ngForTrackBy(){return this._trackByFn}set ngForTemplate($){$&&(this._template=$)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const $=this._ngForOf;!this._differ&&$&&(this._differ=this._differs.find($).create(this.ngForTrackBy))}if(this._differ){const $=this._differ.diff(this._ngForOf);$&&this._applyChanges($)}}_applyChanges($){const re=this._viewContainer;$.forEachOperation((Ae,it,At)=>{if(null==Ae.previousIndex)re.createEmbeddedView(this._template,new Ai(Ae.item,this._ngForOf,-1,-1),null===At?void 0:At);else if(null==At)re.remove(null===it?void 0:it);else if(null!==it){const un=re.get(it);re.move(un,At),Xo(un,Ae)}});for(let Ae=0,it=re.length;Ae<it;Ae++){const un=re.get(Ae).context;un.index=Ae,un.count=it,un.ngForOf=this._ngForOf}$.forEachIdentityChange(Ae=>{Xo(re.get(Ae.currentIndex),Ae)})}static ngTemplateContextGuard($,re){return!0}}return B.\u0275fac=function($){return new($||B)(W.Y36(W.s_b),W.Y36(W.Rgc),W.Y36(W.ZZ4))},B.\u0275dir=W.lG2({type:B,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),B})();function Xo(B,J){B.context.$implicit=J.item}let Rt=(()=>{class B{constructor($,re){this._viewContainer=$,this._context=new Gn,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=re}set ngIf($){this._context.$implicit=this._context.ngIf=$,this._updateView()}set ngIfThen($){Vn("ngIfThen",$),this._thenTemplateRef=$,this._thenViewRef=null,this._updateView()}set ngIfElse($){Vn("ngIfElse",$),this._elseTemplateRef=$,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard($,re){return!0}}return B.\u0275fac=function($){return new($||B)(W.Y36(W.s_b),W.Y36(W.Rgc))},B.\u0275dir=W.lG2({type:B,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),B})();class Gn{constructor(){this.$implicit=null,this.ngIf=null}}function Vn(B,J){if(J&&!J.createEmbeddedView)throw new Error(`${B} must be a TemplateRef, but received '${(0,W.AaK)(J)}'.`)}let Pi=(()=>{class B{constructor($){this._locale=$}transform($,re,Ae){if(!function os(B){return!(null==B||""===B||B!=B)}($))return null;Ae=Ae||this._locale;try{return function Sr(B,J,$){return function hr(B,J,$,re,Ae,it,At=!1){let un="",yr=!1;if(isFinite(B)){let wr=function Lr(B){let re,Ae,it,At,un,J=Math.abs(B)+"",$=0;for((Ae=J.indexOf("."))>-1&&(J=J.replace(".","")),(it=J.search(/e/i))>0?(Ae<0&&(Ae=it),Ae+=+J.slice(it+1),J=J.substring(0,it)):Ae<0&&(Ae=J.length),it=0;"0"===J.charAt(it);it++);if(it===(un=J.length))re=[0],Ae=1;else{for(un--;"0"===J.charAt(un);)un--;for(Ae-=it,re=[],At=0;it<=un;it++,At++)re[At]=Number(J.charAt(it))}return Ae>22&&(re=re.splice(0,21),$=Ae-1,Ae=1),{digits:re,exponent:$,integerLen:Ae}}(B);At&&(wr=function ro(B){if(0===B.digits[0])return B;const J=B.digits.length-B.integerLen;return B.exponent?B.exponent+=2:(0===J?B.digits.push(0,0):1===J&&B.digits.push(0),B.integerLen+=2),B}(wr));let Dr=J.minInt,dr=J.minFrac,nr=J.maxFrac;if(it){const co=it.match(Mr);if(null===co)throw new Error(`${it} is not a valid digit info`);const hs=co[1],ds=co[3],Xs=co[5];null!=hs&&(Dr=Or(hs)),null!=ds&&(dr=Or(ds)),null!=Xs?nr=Or(Xs):null!=ds&&dr>nr&&(nr=dr)}!function xi(B,J,$){if(J>$)throw new Error(`The minimum number of digits after fraction (${J}) is higher than the maximum (${$}).`);let re=B.digits,Ae=re.length-B.integerLen;const it=Math.min(Math.max(J,Ae),$);let At=it+B.integerLen,un=re[At];if(At>0){re.splice(Math.max(B.integerLen,At));for(let dr=At;dr<re.length;dr++)re[dr]=0}else{Ae=Math.max(0,Ae),B.integerLen=1,re.length=Math.max(1,At=it+1),re[0]=0;for(let dr=1;dr<At;dr++)re[dr]=0}if(un>=5)if(At-1<0){for(let dr=0;dr>At;dr--)re.unshift(0),B.integerLen++;re.unshift(1),B.integerLen++}else re[At-1]++;for(;Ae<Math.max(0,it);Ae++)re.push(0);let yr=0!==it;const wr=J+B.integerLen,Dr=re.reduceRight(function(dr,nr,br,ar){return ar[br]=(nr+=dr)<10?nr:nr-10,yr&&(0===ar[br]&&br>=wr?ar.pop():yr=!1),nr>=10?1:0},0);Dr&&(re.unshift(Dr),B.integerLen++)}(wr,dr,nr);let br=wr.digits,ar=wr.integerLen;const Oo=wr.exponent;let lo=[];for(yr=br.every(co=>!co);ar<Dr;ar++)br.unshift(0);for(;ar<0;ar++)br.unshift(0);ar>0?lo=br.splice(ar,br.length):(lo=br,br=[0]);const Ts=[];for(br.length>=J.lgSize&&Ts.unshift(br.splice(-J.lgSize,br.length).join(""));br.length>J.gSize;)Ts.unshift(br.splice(-J.gSize,br.length).join(""));br.length&&Ts.unshift(br.join("")),un=Ts.join(Ar($,re)),lo.length&&(un+=Ar($,Ae)+lo.join("")),Oo&&(un+=Ar($,Be.Exponential)+"+"+Oo)}else un=Ar($,Be.Infinity);return un=B<0&&!yr?J.negPre+un+J.negSuf:J.posPre+un+J.posSuf,un}(B,function _i(B,J="-"){const $={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},re=B.split(";"),Ae=re[0],it=re[1],At=-1!==Ae.indexOf(".")?Ae.split("."):[Ae.substring(0,Ae.lastIndexOf("0")+1),Ae.substring(Ae.lastIndexOf("0")+1)],un=At[0],yr=At[1]||"";$.posPre=un.substring(0,un.indexOf("#"));for(let Dr=0;Dr<yr.length;Dr++){const dr=yr.charAt(Dr);"0"===dr?$.minFrac=$.maxFrac=Dr+1:"#"===dr?$.maxFrac=Dr+1:$.posSuf+=dr}const wr=un.split(",");if($.gSize=wr[1]?wr[1].length:0,$.lgSize=wr[2]||wr[1]?(wr[2]||wr[1]).length:0,it){const Dr=Ae.length-$.posPre.length-$.posSuf.length,dr=it.indexOf("#");$.negPre=it.substring(0,dr).replace(/'/g,""),$.negSuf=it.slice(dr+Dr).replace(/'/g,"")}else $.negPre=J+$.posPre,$.negSuf=$.posSuf;return $}(function ln(B,J){return(0,W.cg1)(B)[W.wAp.NumberFormats][J]}(J,ft.Decimal),Ar(J,Be.MinusSign)),J,Be.Group,Be.Decimal,$)}(function yo(B){if("string"==typeof B&&!isNaN(Number(B)-parseFloat(B)))return Number(B);if("number"!=typeof B)throw new Error(`${B} is not a number`);return B}($),Ae,re)}catch(it){throw function Wr(B,J){return new W.vHH(2100,!1)}()}}}return B.\u0275fac=function($){return new($||B)(W.Y36(W.soG,16))},B.\u0275pipe=W.Yjl({name:"number",type:B,pure:!0,standalone:!0}),B})();let ss=(()=>{class B{}return B.\u0275fac=function($){return new($||B)},B.\u0275mod=W.oAB({type:B}),B.\u0275inj=W.cJS({}),B})();const ws="browser";let ls=(()=>{class B{}return B.\u0275prov=(0,W.Yz7)({token:B,providedIn:"root",factory:()=>new wi((0,W.LFG)(Vt),window)}),B})();class wi{constructor(J,$){this.document=J,this.window=$,this.offset=()=>[0,0]}setOffset(J){this.offset=Array.isArray(J)?()=>J:J}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(J){this.supportsScrolling()&&this.window.scrollTo(J[0],J[1])}scrollToAnchor(J){if(!this.supportsScrolling())return;const $=function $s(B,J){const $=B.getElementById(J)||B.getElementsByName(J)[0];if($)return $;if("function"==typeof B.createTreeWalker&&B.body&&(B.body.createShadowRoot||B.body.attachShadow)){const re=B.createTreeWalker(B.body,NodeFilter.SHOW_ELEMENT);let Ae=re.currentNode;for(;Ae;){const it=Ae.shadowRoot;if(it){const At=it.getElementById(J)||it.querySelector(`[name="${J}"]`);if(At)return At}Ae=re.nextNode()}}return null}(this.document,J);$&&(this.scrollToElement($),$.focus())}setHistoryScrollRestoration(J){if(this.supportScrollRestoration()){const $=this.window.history;$&&$.scrollRestoration&&($.scrollRestoration=J)}}scrollToElement(J){const $=J.getBoundingClientRect(),re=$.left+this.window.pageXOffset,Ae=$.top+this.window.pageYOffset,it=this.offset();this.window.scrollTo(re-it[0],Ae-it[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const J=Es(this.window.history)||Es(Object.getPrototypeOf(this.window.history));return!(!J||!J.writable&&!J.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Es(B){return Object.getOwnPropertyDescriptor(B,"scrollRestoration")}class wa{}},529:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{JF:()=>fo,LE:()=>on,eN:()=>ht});var W=ye(6895),I=ye(8256),nt=ye(9646),u=ye(9751),Te=ye(4351),Yt=ye(9300),Vt=ye(4004);class Tt{}class gt{}class vt{constructor(ve){this.normalizedNames=new Map,this.lazyUpdate=null,ve?this.lazyInit="string"==typeof ve?()=>{this.headers=new Map,ve.split("\n").forEach(we=>{const ct=we.indexOf(":");if(ct>0){const pt=we.slice(0,ct),mn=pt.toLowerCase(),In=we.slice(ct+1).trim();this.maybeSetNormalizedName(pt,mn),this.headers.has(mn)?this.headers.get(mn).push(In):this.headers.set(mn,[In])}})}:()=>{this.headers=new Map,Object.keys(ve).forEach(we=>{let ct=ve[we];const pt=we.toLowerCase();"string"==typeof ct&&(ct=[ct]),ct.length>0&&(this.headers.set(pt,ct),this.maybeSetNormalizedName(we,pt))})}:this.headers=new Map}has(ve){return this.init(),this.headers.has(ve.toLowerCase())}get(ve){this.init();const we=this.headers.get(ve.toLowerCase());return we&&we.length>0?we[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(ve){return this.init(),this.headers.get(ve.toLowerCase())||null}append(ve,we){return this.clone({name:ve,value:we,op:"a"})}set(ve,we){return this.clone({name:ve,value:we,op:"s"})}delete(ve,we){return this.clone({name:ve,value:we,op:"d"})}maybeSetNormalizedName(ve,we){this.normalizedNames.has(we)||this.normalizedNames.set(we,ve)}init(){this.lazyInit&&(this.lazyInit instanceof vt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(ve=>this.applyUpdate(ve)),this.lazyUpdate=null))}copyFrom(ve){ve.init(),Array.from(ve.headers.keys()).forEach(we=>{this.headers.set(we,ve.headers.get(we)),this.normalizedNames.set(we,ve.normalizedNames.get(we))})}clone(ve){const we=new vt;return we.lazyInit=this.lazyInit&&this.lazyInit instanceof vt?this.lazyInit:this,we.lazyUpdate=(this.lazyUpdate||[]).concat([ve]),we}applyUpdate(ve){const we=ve.name.toLowerCase();switch(ve.op){case"a":case"s":let ct=ve.value;if("string"==typeof ct&&(ct=[ct]),0===ct.length)return;this.maybeSetNormalizedName(ve.name,we);const pt=("a"===ve.op?this.headers.get(we):void 0)||[];pt.push(...ct),this.headers.set(we,pt);break;case"d":const mn=ve.value;if(mn){let In=this.headers.get(we);if(!In)return;In=In.filter(cr=>-1===mn.indexOf(cr)),0===In.length?(this.headers.delete(we),this.normalizedNames.delete(we)):this.headers.set(we,In)}else this.headers.delete(we),this.normalizedNames.delete(we)}}forEach(ve){this.init(),Array.from(this.normalizedNames.keys()).forEach(we=>ve(this.normalizedNames.get(we),this.headers.get(we)))}}class Ht{encodeKey(ve){return It(ve)}encodeValue(ve){return It(ve)}decodeKey(ve){return decodeURIComponent(ve)}decodeValue(ve){return decodeURIComponent(ve)}}const bt=/%(\d[a-f0-9])/gi,nn={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function It(Et){return encodeURIComponent(Et).replace(bt,(ve,we)=>nn[we]??ve)}function pn(Et){return`${Et}`}class on{constructor(ve={}){if(this.updates=null,this.cloneFrom=null,this.encoder=ve.encoder||new Ht,ve.fromString){if(ve.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Cn(Et,ve){const we=new Map;return Et.length>0&&Et.replace(/^\?/,"").split("&").forEach(pt=>{const mn=pt.indexOf("="),[In,cr]=-1==mn?[ve.decodeKey(pt),""]:[ve.decodeKey(pt.slice(0,mn)),ve.decodeValue(pt.slice(mn+1))],gn=we.get(In)||[];gn.push(cr),we.set(In,gn)}),we}(ve.fromString,this.encoder)}else ve.fromObject?(this.map=new Map,Object.keys(ve.fromObject).forEach(we=>{const ct=ve.fromObject[we],pt=Array.isArray(ct)?ct.map(pn):[pn(ct)];this.map.set(we,pt)})):this.map=null}has(ve){return this.init(),this.map.has(ve)}get(ve){this.init();const we=this.map.get(ve);return we?we[0]:null}getAll(ve){return this.init(),this.map.get(ve)||null}keys(){return this.init(),Array.from(this.map.keys())}append(ve,we){return this.clone({param:ve,value:we,op:"a"})}appendAll(ve){const we=[];return Object.keys(ve).forEach(ct=>{const pt=ve[ct];Array.isArray(pt)?pt.forEach(mn=>{we.push({param:ct,value:mn,op:"a"})}):we.push({param:ct,value:pt,op:"a"})}),this.clone(we)}set(ve,we){return this.clone({param:ve,value:we,op:"s"})}delete(ve,we){return this.clone({param:ve,value:we,op:"d"})}toString(){return this.init(),this.keys().map(ve=>{const we=this.encoder.encodeKey(ve);return this.map.get(ve).map(ct=>we+"="+this.encoder.encodeValue(ct)).join("&")}).filter(ve=>""!==ve).join("&")}clone(ve){const we=new on({encoder:this.encoder});return we.cloneFrom=this.cloneFrom||this,we.updates=(this.updates||[]).concat(ve),we}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(ve=>this.map.set(ve,this.cloneFrom.map.get(ve))),this.updates.forEach(ve=>{switch(ve.op){case"a":case"s":const we=("a"===ve.op?this.map.get(ve.param):void 0)||[];we.push(pn(ve.value)),this.map.set(ve.param,we);break;case"d":if(void 0===ve.value){this.map.delete(ve.param);break}{let ct=this.map.get(ve.param)||[];const pt=ct.indexOf(pn(ve.value));-1!==pt&&ct.splice(pt,1),ct.length>0?this.map.set(ve.param,ct):this.map.delete(ve.param)}}}),this.cloneFrom=this.updates=null)}}class sn{constructor(){this.map=new Map}set(ve,we){return this.map.set(ve,we),this}get(ve){return this.map.has(ve)||this.map.set(ve,ve.defaultValue()),this.map.get(ve)}delete(ve){return this.map.delete(ve),this}has(ve){return this.map.has(ve)}keys(){return this.map.keys()}}function Ge(Et){return typeof ArrayBuffer<"u"&&Et instanceof ArrayBuffer}function kt(Et){return typeof Blob<"u"&&Et instanceof Blob}function lr(Et){return typeof FormData<"u"&&Et instanceof FormData}class ft{constructor(ve,we,ct,pt){let mn;if(this.url=we,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=ve.toUpperCase(),function tn(Et){switch(Et){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||pt?(this.body=void 0!==ct?ct:null,mn=pt):mn=ct,mn&&(this.reportProgress=!!mn.reportProgress,this.withCredentials=!!mn.withCredentials,mn.responseType&&(this.responseType=mn.responseType),mn.headers&&(this.headers=mn.headers),mn.context&&(this.context=mn.context),mn.params&&(this.params=mn.params)),this.headers||(this.headers=new vt),this.context||(this.context=new sn),this.params){const In=this.params.toString();if(0===In.length)this.urlWithParams=we;else{const cr=we.indexOf("?");this.urlWithParams=we+(-1===cr?"?":cr<we.length-1?"&":"")+In}}else this.params=new on,this.urlWithParams=we}serializeBody(){return null===this.body?null:Ge(this.body)||kt(this.body)||lr(this.body)||function tt(Et){return typeof URLSearchParams<"u"&&Et instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof on?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||lr(this.body)?null:kt(this.body)?this.body.type||null:Ge(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof on?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(ve={}){const we=ve.method||this.method,ct=ve.url||this.url,pt=ve.responseType||this.responseType,mn=void 0!==ve.body?ve.body:this.body,In=void 0!==ve.withCredentials?ve.withCredentials:this.withCredentials,cr=void 0!==ve.reportProgress?ve.reportProgress:this.reportProgress;let gn=ve.headers||this.headers,Vr=ve.params||this.params;const Tr=ve.context??this.context;return void 0!==ve.setHeaders&&(gn=Object.keys(ve.setHeaders).reduce((_e,X)=>_e.set(X,ve.setHeaders[X]),gn)),ve.setParams&&(Vr=Object.keys(ve.setParams).reduce((_e,X)=>_e.set(X,ve.setParams[X]),Vr)),new ft(we,ct,mn,{params:Vr,headers:gn,context:Tr,reportProgress:cr,responseType:pt,withCredentials:In})}}var rn=(()=>((rn=rn||{})[rn.Sent=0]="Sent",rn[rn.UploadProgress=1]="UploadProgress",rn[rn.ResponseHeader=2]="ResponseHeader",rn[rn.DownloadProgress=3]="DownloadProgress",rn[rn.Response=4]="Response",rn[rn.User=5]="User",rn))();class Xe{constructor(ve,we=200,ct="OK"){this.headers=ve.headers||new vt,this.status=void 0!==ve.status?ve.status:we,this.statusText=ve.statusText||ct,this.url=ve.url||null,this.ok=this.status>=200&&this.status<300}}class He extends Xe{constructor(ve={}){super(ve),this.type=rn.ResponseHeader}clone(ve={}){return new He({headers:ve.headers||this.headers,status:void 0!==ve.status?ve.status:this.status,statusText:ve.statusText||this.statusText,url:ve.url||this.url||void 0})}}class lt extends Xe{constructor(ve={}){super(ve),this.type=rn.Response,this.body=void 0!==ve.body?ve.body:null}clone(ve={}){return new lt({body:void 0!==ve.body?ve.body:this.body,headers:ve.headers||this.headers,status:void 0!==ve.status?ve.status:this.status,statusText:ve.statusText||this.statusText,url:ve.url||this.url||void 0})}}class Be extends Xe{constructor(ve){super(ve,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${ve.url||"(unknown url)"}`:`Http failure response for ${ve.url||"(unknown url)"}: ${ve.status} ${ve.statusText}`,this.error=ve.error||null}}function Wt(Et,ve){return{body:ve,headers:Et.headers,context:Et.context,observe:Et.observe,params:Et.params,reportProgress:Et.reportProgress,responseType:Et.responseType,withCredentials:Et.withCredentials}}let ht=(()=>{class Et{constructor(we){this.handler=we}request(we,ct,pt={}){let mn;if(we instanceof ft)mn=we;else{let gn,Vr;gn=pt.headers instanceof vt?pt.headers:new vt(pt.headers),pt.params&&(Vr=pt.params instanceof on?pt.params:new on({fromObject:pt.params})),mn=new ft(we,ct,void 0!==pt.body?pt.body:null,{headers:gn,context:pt.context,params:Vr,reportProgress:pt.reportProgress,responseType:pt.responseType||"json",withCredentials:pt.withCredentials})}const In=(0,nt.of)(mn).pipe((0,Te.b)(gn=>this.handler.handle(gn)));if(we instanceof ft||"events"===pt.observe)return In;const cr=In.pipe((0,Yt.h)(gn=>gn instanceof lt));switch(pt.observe||"body"){case"body":switch(mn.responseType){case"arraybuffer":return cr.pipe((0,Vt.U)(gn=>{if(null!==gn.body&&!(gn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return gn.body}));case"blob":return cr.pipe((0,Vt.U)(gn=>{if(null!==gn.body&&!(gn.body instanceof Blob))throw new Error("Response is not a Blob.");return gn.body}));case"text":return cr.pipe((0,Vt.U)(gn=>{if(null!==gn.body&&"string"!=typeof gn.body)throw new Error("Response is not a string.");return gn.body}));default:return cr.pipe((0,Vt.U)(gn=>gn.body))}case"response":return cr;default:throw new Error(`Unreachable: unhandled observe type ${pt.observe}}`)}}delete(we,ct={}){return this.request("DELETE",we,ct)}get(we,ct={}){return this.request("GET",we,ct)}head(we,ct={}){return this.request("HEAD",we,ct)}jsonp(we,ct){return this.request("JSONP",we,{params:(new on).append(ct,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(we,ct={}){return this.request("OPTIONS",we,ct)}patch(we,ct,pt={}){return this.request("PATCH",we,Wt(pt,ct))}post(we,ct,pt={}){return this.request("POST",we,Wt(pt,ct))}put(we,ct,pt={}){return this.request("PUT",we,Wt(pt,ct))}}return Et.\u0275fac=function(we){return new(we||Et)(I.LFG(Tt))},Et.\u0275prov=I.Yz7({token:Et,factory:Et.\u0275fac}),Et})();class fn{constructor(ve,we){this.next=ve,this.interceptor=we}handle(ve){return this.interceptor.intercept(ve,this.next)}}const kn=new I.OlP("HTTP_INTERCEPTORS");let gr=(()=>{class Et{intercept(we,ct){return ct.handle(we)}}return Et.\u0275fac=function(we){return new(we||Et)},Et.\u0275prov=I.Yz7({token:Et,factory:Et.\u0275fac}),Et})();const Si=/^\)\]\}',?\n/;let Cr=(()=>{class Et{constructor(we){this.xhrFactory=we}handle(we){if("JSONP"===we.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new u.y(ct=>{const pt=this.xhrFactory.build();if(pt.open(we.method,we.urlWithParams),we.withCredentials&&(pt.withCredentials=!0),we.headers.forEach((ee,he)=>pt.setRequestHeader(ee,he.join(","))),we.headers.has("Accept")||pt.setRequestHeader("Accept","application/json, text/plain, */*"),!we.headers.has("Content-Type")){const ee=we.detectContentTypeHeader();null!==ee&&pt.setRequestHeader("Content-Type",ee)}if(we.responseType){const ee=we.responseType.toLowerCase();pt.responseType="json"!==ee?ee:"text"}const mn=we.serializeBody();let In=null;const cr=()=>{if(null!==In)return In;const ee=pt.statusText||"OK",he=new vt(pt.getAllResponseHeaders()),Ee=function Wo(Et){return"responseURL"in Et&&Et.responseURL?Et.responseURL:/^X-Request-URL:/m.test(Et.getAllResponseHeaders())?Et.getResponseHeader("X-Request-URL"):null}(pt)||we.url;return In=new He({headers:he,status:pt.status,statusText:ee,url:Ee}),In},gn=()=>{let{headers:ee,status:he,statusText:Ee,url:Ce}=cr(),Fe=null;204!==he&&(Fe=typeof pt.response>"u"?pt.responseText:pt.response),0===he&&(he=Fe?200:0);let Le=he>=200&&he<300;if("json"===we.responseType&&"string"==typeof Fe){const Ie=Fe;Fe=Fe.replace(Si,"");try{Fe=""!==Fe?JSON.parse(Fe):null}catch($e){Fe=Ie,Le&&(Le=!1,Fe={error:$e,text:Fe})}}Le?(ct.next(new lt({body:Fe,headers:ee,status:he,statusText:Ee,url:Ce||void 0})),ct.complete()):ct.error(new Be({error:Fe,headers:ee,status:he,statusText:Ee,url:Ce||void 0}))},Vr=ee=>{const{url:he}=cr(),Ee=new Be({error:ee,status:pt.status||0,statusText:pt.statusText||"Unknown Error",url:he||void 0});ct.error(Ee)};let Tr=!1;const _e=ee=>{Tr||(ct.next(cr()),Tr=!0);let he={type:rn.DownloadProgress,loaded:ee.loaded};ee.lengthComputable&&(he.total=ee.total),"text"===we.responseType&&!!pt.responseText&&(he.partialText=pt.responseText),ct.next(he)},X=ee=>{let he={type:rn.UploadProgress,loaded:ee.loaded};ee.lengthComputable&&(he.total=ee.total),ct.next(he)};return pt.addEventListener("load",gn),pt.addEventListener("error",Vr),pt.addEventListener("timeout",Vr),pt.addEventListener("abort",Vr),we.reportProgress&&(pt.addEventListener("progress",_e),null!==mn&&pt.upload&&pt.upload.addEventListener("progress",X)),pt.send(mn),ct.next({type:rn.Sent}),()=>{pt.removeEventListener("error",Vr),pt.removeEventListener("abort",Vr),pt.removeEventListener("load",gn),pt.removeEventListener("timeout",Vr),we.reportProgress&&(pt.removeEventListener("progress",_e),null!==mn&&pt.upload&&pt.upload.removeEventListener("progress",X)),pt.readyState!==pt.DONE&&pt.abort()}})}}return Et.\u0275fac=function(we){return new(we||Et)(I.LFG(W.JF))},Et.\u0275prov=I.Yz7({token:Et,factory:Et.\u0275fac}),Et})();const _r=new I.OlP("XSRF_COOKIE_NAME"),Mo=new I.OlP("XSRF_HEADER_NAME");class fi{}let Nr=(()=>{class Et{constructor(we,ct,pt){this.doc=we,this.platform=ct,this.cookieName=pt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const we=this.doc.cookie||"";return we!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,W.Mx)(we,this.cookieName),this.lastCookieString=we),this.lastToken}}return Et.\u0275fac=function(we){return new(we||Et)(I.LFG(W.K0),I.LFG(I.Lbi),I.LFG(_r))},Et.\u0275prov=I.Yz7({token:Et,factory:Et.\u0275fac}),Et})(),ho=(()=>{class Et{constructor(we,ct){this.tokenService=we,this.headerName=ct}intercept(we,ct){const pt=we.url.toLowerCase();if("GET"===we.method||"HEAD"===we.method||pt.startsWith("http://")||pt.startsWith("https://"))return ct.handle(we);const mn=this.tokenService.getToken();return null!==mn&&!we.headers.has(this.headerName)&&(we=we.clone({headers:we.headers.set(this.headerName,mn)})),ct.handle(we)}}return Et.\u0275fac=function(we){return new(we||Et)(I.LFG(fi),I.LFG(Mo))},Et.\u0275prov=I.Yz7({token:Et,factory:Et.\u0275fac}),Et})(),vn=(()=>{class Et{constructor(we,ct){this.backend=we,this.injector=ct,this.chain=null}handle(we){if(null===this.chain){const ct=this.injector.get(kn,[]);this.chain=ct.reduceRight((pt,mn)=>new fn(pt,mn),this.backend)}return this.chain.handle(we)}}return Et.\u0275fac=function(we){return new(we||Et)(I.LFG(gt),I.LFG(I.zs3))},Et.\u0275prov=I.Yz7({token:Et,factory:Et.\u0275fac}),Et})(),si=(()=>{class Et{static disable(){return{ngModule:Et,providers:[{provide:ho,useClass:gr}]}}static withOptions(we={}){return{ngModule:Et,providers:[we.cookieName?{provide:_r,useValue:we.cookieName}:[],we.headerName?{provide:Mo,useValue:we.headerName}:[]]}}}return Et.\u0275fac=function(we){return new(we||Et)},Et.\u0275mod=I.oAB({type:Et}),Et.\u0275inj=I.cJS({providers:[ho,{provide:kn,useExisting:ho,multi:!0},{provide:fi,useClass:Nr},{provide:_r,useValue:"XSRF-TOKEN"},{provide:Mo,useValue:"X-XSRF-TOKEN"}]}),Et})(),fo=(()=>{class Et{}return Et.\u0275fac=function(we){return new(we||Et)},Et.\u0275mod=I.oAB({type:Et}),Et.\u0275inj=I.cJS({providers:[ht,{provide:Tt,useClass:vn},Cr,{provide:gt,useExisting:Cr}],imports:[si.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),Et})()},8256:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{tb:()=>X0,AFp:()=>Z0,ip1:()=>H0,CZH:()=>zg,hGG:()=>Pw,z2F:()=>Ug,sBO:()=>mw,Sil:()=>Yb,_Vd:()=>ru,EJc:()=>Wb,Xts:()=>eu,SBq:()=>Nu,lqb:()=>Lc,qLn:()=>to,vpe:()=>Hc,XFs:()=>ve,OlP:()=>jr,zs3:()=>fu,ZZ4:()=>ky,aQg:()=>Oy,soG:()=>Vg,YKP:()=>Yv,h0i:()=>bf,PXZ:()=>cw,R0b:()=>Nl,FiY:()=>Lt,Lbi:()=>Hb,g9A:()=>W0,Qsj:()=>zf,FYo:()=>Mh,JOm:()=>qi,tp0:()=>ut,Rgc:()=>nm,dDg:()=>ow,eoX:()=>nx,GfV:()=>Uu,s_b:()=>Fg,ifc:()=>_e,MMx:()=>cy,Lck:()=>V1,eFA:()=>ox,G48:()=>pw,Gpc:()=>or,f3M:()=>ze,_c5:()=>Iw,c2e:()=>Zb,zSh:()=>vd,wAp:()=>tr,vHH:()=>kt,lri:()=>ex,rWj:()=>tx,D6c:()=>Rw,cg1:()=>ty,kL8:()=>bv,dqk:()=>X,Z0I:()=>ho,sIi:()=>ah,CqO:()=>k,QGY:()=>w,QP$:()=>En,F4k:()=>A,RDi:()=>Pu,AaK:()=>It,qOj:()=>Ll,TTD:()=>zo,_Bn:()=>Xv,jDz:()=>Jv,xp6:()=>ip,uIk:()=>ja,ekj:()=>Br,Suo:()=>b0,Xpm:()=>Tn,lG2:()=>je,Yz7:()=>_r,cJS:()=>fi,oAB:()=>Bn,Yjl:()=>ke,Y36:()=>Bc,_UZ:()=>s,qZA:()=>r,TgZ:()=>e,EpF:()=>b,n5z:()=>el,LFG:()=>De,$8M:()=>fa,$Z:()=>pp,NdJ:()=>z,CRH:()=>w0,O4$:()=>Oo,oxw:()=>be,ALo:()=>d0,lcZ:()=>f0,Q6J:()=>td,VKq:()=>s0,iGM:()=>v0,MAs:()=>ch,KtG:()=>zl,CHM:()=>cs,LSH:()=>bh,YNc:()=>df,W1O:()=>T0,_uU:()=>pl,Oqu:()=>mf,hij:()=>Bl,Gf:()=>x0});var W=ye(7579),I=ye(727),nt=ye(9751),u=ye(8189),Te=ye(8421),Yt=ye(515),Vt=ye(7669),Tt=ye(2076),vt=ye(2961),dt=ye(4482);function Cn(i,o,...l){if(!0===o)return void i();if(!1===o)return;const f=new vt.Hp({next:()=>{f.unsubscribe(),i()}});return o(...l).subscribe(f)}function bt(i){for(let o in i)if(i[o]===bt)return o;throw Error("Could not find renamed property on target object.")}function nn(i,o){for(const l in o)o.hasOwnProperty(l)&&!i.hasOwnProperty(l)&&(i[l]=o[l])}function It(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(It).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const l=o.indexOf("\n");return-1===l?o:o.substring(0,l)}function pn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const on=bt({__forward_ref__:bt});function or(i){return i.__forward_ref__=or,i.toString=function(){return It(this())},i}function sn(i){return tn(i)?i():i}function tn(i){return"function"==typeof i&&i.hasOwnProperty(on)&&i.__forward_ref__===or}class kt extends Error{constructor(o,l){super(function lr(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}(o,l)),this.code=o}}function tt(i){return"string"==typeof i?i:null==i?"":String(i)}function lt(i,o){throw new kt(-201,!1)}function ln(i,o){null==i&&function Zn(i,o,l,f){throw new Error(`ASSERTION ERROR: ${i}`+(null==f?"":` [Expected=> ${l} ${f} ${o} <=Actual]`))}(o,i,null,"!=")}function _r(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function fi(i){return{providers:i.providers||[],imports:i.imports||[]}}function Nr(i){return vn(i,fo)||vn(i,kr)}function ho(i){return null!==Nr(i)}function vn(i,o){return i.hasOwnProperty(o)?i[o]:null}function si(i){return i&&(i.hasOwnProperty(vs)||i.hasOwnProperty(Et))?i[vs]:null}const fo=bt({\u0275prov:bt}),vs=bt({\u0275inj:bt}),kr=bt({ngInjectableDef:bt}),Et=bt({ngInjectorDef:bt});var ve=(()=>((ve=ve||{})[ve.Default=0]="Default",ve[ve.Host=1]="Host",ve[ve.Self=2]="Self",ve[ve.SkipSelf=4]="SkipSelf",ve[ve.Optional=8]="Optional",ve))();let we;function pt(i){const o=we;return we=i,o}function mn(i,o,l){const f=Nr(i);return f&&"root"==f.providedIn?void 0===f.value?f.value=f.factory():f.value:l&ve.Optional?null:void 0!==o?o:void lt(It(i))}function cr(i){return{toString:i}.toString()}var gn=(()=>((gn=gn||{})[gn.OnPush=0]="OnPush",gn[gn.Default=1]="Default",gn))(),_e=(()=>{return(i=_e||(_e={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",_e;var i})();const X=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Ee={},Ce=[],Fe=bt({\u0275cmp:bt}),Le=bt({\u0275dir:bt}),Ie=bt({\u0275pipe:bt}),$e=bt({\u0275mod:bt}),xt=bt({\u0275fac:bt}),Ut=bt({__NG_ELEMENT_ID__:bt});let St=0;function Tn(i){return cr(()=>{const l=!0===i.standalone,f={},_={type:i.type,providersResolver:null,decls:i.decls,vars:i.vars,factory:null,template:i.template||null,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:f,inputs:null,outputs:null,exportAs:i.exportAs||null,onPush:i.changeDetection===gn.OnPush,directiveDefs:null,pipeDefs:null,standalone:l,dependencies:l&&i.dependencies||null,getStandaloneInjector:null,selectors:i.selectors||Ce,viewQuery:i.viewQuery||null,features:i.features||null,data:i.data||{},encapsulation:i.encapsulation||_e.Emulated,id:"c"+St++,styles:i.styles||Ce,_:null,setInput:null,schemas:i.schemas||null,tView:null},x=i.dependencies,T=i.features;return _.inputs=Ur(i.inputs,f),_.outputs=Ur(i.outputs),T&&T.forEach(L=>L(_)),_.directiveDefs=x?()=>("function"==typeof x?x():x).map(Mn).filter(Rn):null,_.pipeDefs=x?()=>("function"==typeof x?x():x).map(at).filter(Rn):null,_})}function Mn(i){return ge(i)||Ue(i)}function Rn(i){return null!==i}function Bn(i){return cr(()=>({type:i.type,bootstrap:i.bootstrap||Ce,declarations:i.declarations||Ce,imports:i.imports||Ce,exports:i.exports||Ce,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function Ur(i,o){if(null==i)return Ee;const l={};for(const f in i)if(i.hasOwnProperty(f)){let _=i[f],x=_;Array.isArray(_)&&(x=_[1],_=_[0]),l[_]=f,o&&(o[_]=x)}return l}const je=Tn;function ke(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function ge(i){return i[Fe]||null}function Ue(i){return i[Le]||null}function at(i){return i[Ie]||null}function En(i){const o=ge(i)||Ue(i)||at(i);return null!==o&&o.standalone}function Ln(i,o){const l=i[$e]||null;if(!l&&!0===o)throw new Error(`Type ${It(i)} does not have '\u0275mod' property.`);return l}function sr(i){return Array.isArray(i)&&"object"==typeof i[1]}function vi(i){return Array.isArray(i)&&!0===i[1]}function Ao(i){return 0!=(8&i.flags)}function Wr(i){return 2==(2&i.flags)}function _o(i){return 1==(1&i.flags)}function Yi(i){return null!==i.template}function Ga(i){return 0!=(256&i[2])}function ss(i,o){return i.hasOwnProperty(xt)?i[xt]:null}class ws{constructor(o,l,f){this.previousValue=o,this.currentValue=l,this.firstChange=f}isFirstChange(){return this.firstChange}}function zo(){return so}function so(i){return i.type.prototype.ngOnChanges&&(i.setInput=as),Us}function Us(){const i=js(this),o=i?.current;if(o){const l=i.previous;if(l===Ee)i.previous=o;else for(let f in o)l[f]=o[f];i.current=null,this.ngOnChanges(o)}}function as(i,o,l,f){const _=js(i)||function vo(i,o){return i[Po]=o}(i,{previous:Ee,current:null}),x=_.current||(_.current={}),T=_.previous,L=this.declaredInputs[l],N=T[L];x[L]=new ws(N&&N.currentValue,o,T===Ee),i[f]=o}zo.ngInherit=!0;const Po="__ngSimpleChanges__";function js(i){return i[Po]||null}function cn(i){for(;Array.isArray(i);)i=i[0];return i}function Ca(i,o){return cn(o[i])}function Bi(i,o){return cn(o[i.index])}function Hs(i,o){return i.data[o]}function Vo(i,o){return i[o]}function Ji(i,o){const l=o[i];return sr(l)?l:l[0]}function Lo(i){return 64==(64&i[2])}function ko(i,o){return null==o?null:i[o]}function Cs(i){i[18]=0}function Zs(i,o){i[5]+=o;let l=i,f=i[3];for(;null!==f&&(1===o&&1===l[5]||-1===o&&0===l[5]);)f[5]+=o,l=f,f=f[3]}const Nn={lFrame:At(null),bindingsEnabled:!0};function qs(){return Nn.bindingsEnabled}function Nt(){return Nn.lFrame.lView}function Wn(){return Nn.lFrame.tView}function cs(i){return Nn.lFrame.contextLView=i,i[8]}function zl(i){return Nn.lFrame.contextLView=null,i}function Xr(){let i=Yo();for(;null!==i&&64===i.type;)i=i.parent;return i}function Yo(){return Nn.lFrame.currentTNode}function Qi(i,o){const l=Nn.lFrame;l.currentTNode=i,l.isParent=o}function xo(){return Nn.lFrame.isParent}function ui(){const i=Nn.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function wo(){return Nn.lFrame.bindingIndex++}function Ws(i,o){const l=Nn.lFrame;l.bindingIndex=l.bindingRootIndex=i,Sa(o)}function Sa(i){Nn.lFrame.currentDirectiveIndex=i}function B(){return Nn.lFrame.currentQueryIndex}function J(i){Nn.lFrame.currentQueryIndex=i}function $(i){const o=i[1];return 2===o.type?o.declTNode:1===o.type?i[6]:null}function re(i,o,l){if(l&ve.SkipSelf){let _=o,x=i;for(;!(_=_.parent,null!==_||l&ve.Host||(_=$(x),null===_||(x=x[15],10&_.type))););if(null===_)return!1;o=_,i=x}const f=Nn.lFrame=it();return f.currentTNode=o,f.lView=i,!0}function Ae(i){const o=it(),l=i[1];Nn.lFrame=o,o.currentTNode=l.firstChild,o.lView=i,o.tView=l,o.contextLView=i,o.bindingIndex=l.bindingStartIndex,o.inI18n=!1}function it(){const i=Nn.lFrame,o=null===i?null:i.child;return null===o?At(i):o}function At(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function un(){const i=Nn.lFrame;return Nn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const yr=un;function wr(){const i=un();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function nr(){return Nn.lFrame.selectedIndex}function br(i){Nn.lFrame.selectedIndex=i}function ar(){const i=Nn.lFrame;return Hs(i.tView,i.selectedIndex)}function Oo(){Nn.lFrame.currentNamespace="svg"}function Xs(i,o){for(let l=o.directiveStart,f=o.directiveEnd;l<f;l++){const x=i.data[l].type.prototype,{ngAfterContentInit:T,ngAfterContentChecked:L,ngAfterViewInit:N,ngAfterViewChecked:Z,ngOnDestroy:ne}=x;T&&(i.contentHooks||(i.contentHooks=[])).push(-l,T),L&&((i.contentHooks||(i.contentHooks=[])).push(l,L),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(l,L)),N&&(i.viewHooks||(i.viewHooks=[])).push(-l,N),Z&&((i.viewHooks||(i.viewHooks=[])).push(l,Z),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(l,Z)),null!=ne&&(i.destroyHooks||(i.destroyHooks=[])).push(l,ne)}}function j(i,o,l){Q(i,o,3,l)}function F(i,o,l,f){(3&i[2])===l&&Q(i,o,l,f)}function R(i,o){let l=i[2];(3&l)===o&&(l&=2047,l+=1,i[2]=l)}function Q(i,o,l,f){const x=f??-1,T=o.length-1;let L=0;for(let N=void 0!==f?65535&i[18]:0;N<T;N++)if("number"==typeof o[N+1]){if(L=o[N],null!=f&&L>=f)break}else o[N]<0&&(i[18]+=65536),(L<x||-1==x)&&(Ve(i,l,o,N),i[18]=(4294901760&i[18])+N+2),N++}function Ve(i,o,l,f){const _=l[f]<0,x=l[f+1],L=i[_?-l[f]:l[f]];if(_){if(i[2]>>11<i[18]>>16&&(3&i[2])===o){i[2]+=2048;try{x.call(L)}finally{}}}else try{x.call(L)}finally{}}class fr{constructor(o,l,f){this.factory=o,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=f}}function vl(i,o,l){let f=0;for(;f<l.length;){const _=l[f];if("number"==typeof _){if(0!==_)break;f++;const x=l[f++],T=l[f++],L=l[f++];i.setAttribute(o,T,L,x)}else{const x=_,T=l[++f];Ms(x)?i.setProperty(o,x,T):i.setAttribute(o,x,T),f++}}return f}function xl(i){return 3===i||4===i||6===i}function Ms(i){return 64===i.charCodeAt(0)}function jl(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let l=-1;for(let f=0;f<o.length;f++){const _=o[f];"number"==typeof _?l=_:0===l||$l(i,l,_,null,-1===l||2===l?o[++f]:null)}}return i}function $l(i,o,l,f,_){let x=0,T=i.length;if(-1===o)T=-1;else for(;x<i.length;){const L=i[x++];if("number"==typeof L){if(L===o){T=-1;break}if(L>o){T=x-1;break}}}for(;x<i.length;){const L=i[x];if("number"==typeof L)break;if(L===l){if(null===f)return void(null!==_&&(i[x+1]=_));if(f===i[x+1])return void(i[x+2]=_)}x++,null!==f&&x++,null!==_&&x++}-1!==T&&(i.splice(T,0,o),x=T+1),i.splice(x++,0,l),null!==f&&i.splice(x++,0,f),null!==_&&i.splice(x++,0,_)}function Ka(i){return-1!==i}function Ss(i){return 32767&i}function Ks(i,o){let l=function qc(i){return i>>16}(i),f=o;for(;l>0;)f=f[15],l--;return f}let Aa=!0;function ua(i){const o=Aa;return Aa=i,o}let Cu=0;const $o={};function Di(i,o){const l=Ja(i,o);if(-1!==l)return l;const f=o[1];f.firstCreatePass&&(i.injectorIndex=o.length,Js(f.data,i),Js(o,null),Js(f.blueprint,null));const _=Ia(i,o),x=i.injectorIndex;if(Ka(_)){const T=Ss(_),L=Ks(_,o),N=L[1].data;for(let Z=0;Z<8;Z++)o[x+Z]=L[T+Z]|N[T+Z]}return o[x+8]=_,x}function Js(i,o){i.push(0,0,0,0,0,0,0,0,o)}function Ja(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function Ia(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let l=0,f=null,_=o;for(;null!==_;){if(f=Ec(_),null===f)return-1;if(l++,_=_[15],-1!==f.injectorIndex)return f.injectorIndex|l<<16}return-1}function ha(i,o,l){!function Gl(i,o,l){let f;"string"==typeof l?f=l.charCodeAt(0)||0:l.hasOwnProperty(Ut)&&(f=l[Ut]),null==f&&(f=l[Ut]=Cu++);const _=255&f;o.data[i+(_>>5)]|=1<<_}(i,o,l)}function Hl(i,o,l){if(l&ve.Optional||void 0!==i)return i;lt()}function Qs(i,o,l,f){if(l&ve.Optional&&void 0===f&&(f=null),0==(l&(ve.Self|ve.Host))){const _=i[9],x=pt(void 0);try{return _?_.get(o,f,l&ve.Optional):mn(o,f,l&ve.Optional)}finally{pt(x)}}return Hl(f,0,l)}function bc(i,o,l,f=ve.Default,_){if(null!==i){if(1024&o[2]){const T=function Wc(i,o,l,f,_){let x=i,T=o;for(;null!==x&&null!==T&&1024&T[2]&&!(256&T[2]);){const L=Tu(x,T,l,f|ve.Self,$o);if(L!==$o)return L;let N=x.parent;if(!N){const Z=T[21];if(Z){const ne=Z.get(l,$o,f);if(ne!==$o)return ne}N=Ec(T),T=T[15]}x=N}return _}(i,o,l,f,$o);if(T!==$o)return T}const x=Tu(i,o,l,f,$o);if(x!==$o)return x}return Qs(o,l,f,_)}function Tu(i,o,l,f,_){const x=function wc(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(Ut)?i[Ut]:void 0;return"number"==typeof o?o>=0?255&o:Pa:o}(l);if("function"==typeof x){if(!re(o,i,f))return f&ve.Host?Hl(_,0,f):Qs(o,l,f,_);try{const T=x(f);if(null!=T||f&ve.Optional)return T;lt()}finally{yr()}}else if("number"==typeof x){let T=null,L=Ja(i,o),N=-1,Z=f&ve.Host?o[16][6]:null;for((-1===L||f&ve.SkipSelf)&&(N=-1===L?Ia(i,o):o[L+8],-1!==N&&Zl(f,!1)?(T=o[1],L=Ss(N),o=Ks(N,o)):L=-1);-1!==L;){const ne=o[1];if(Li(x,L,ne.data)){const pe=Mu(L,o,l,T,f,Z);if(pe!==$o)return pe}N=o[L+8],-1!==N&&Zl(f,o[1].data[L+8]===Z)&&Li(x,L,o)?(T=ne,L=Ss(N),o=Ks(N,o)):L=-1}}return _}function Mu(i,o,l,f,_,x){const T=o[1],L=T.data[i+8],ne=da(L,T,l,null==f?Wr(L)&&Aa:f!=T&&0!=(3&L.type),_&ve.Host&&x===L);return null!==ne?Qa(o,T,ne,L):$o}function da(i,o,l,f,_){const x=i.providerIndexes,T=o.data,L=1048575&x,N=i.directiveStart,ne=x>>20,Oe=_?L+ne:i.directiveEnd;for(let Je=f?L:L+ne;Je<Oe;Je++){const Mt=T[Je];if(Je<N&&l===Mt||Je>=N&&Mt.type===l)return Je}if(_){const Je=T[N];if(Je&&Yi(Je)&&Je.type===l)return N}return null}function Qa(i,o,l,f){let _=i[l];const x=o.data;if(function Ri(i){return i instanceof fr}(_)){const T=_;T.resolving&&function rn(i,o){const l=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new kt(-200,`Circular dependency in DI detected for ${i}${l}`)}(function ft(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():tt(i)}(x[l]));const L=ua(T.canSeeViewProviders);T.resolving=!0;const N=T.injectImpl?pt(T.injectImpl):null;re(i,f,ve.Default);try{_=i[l]=T.factory(void 0,x,i,f),o.firstCreatePass&&l>=f.directiveStart&&function ds(i,o,l){const{ngOnChanges:f,ngOnInit:_,ngDoCheck:x}=o.type.prototype;if(f){const T=so(o);(l.preOrderHooks||(l.preOrderHooks=[])).push(i,T),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(i,T)}_&&(l.preOrderHooks||(l.preOrderHooks=[])).push(0-i,_),x&&((l.preOrderHooks||(l.preOrderHooks=[])).push(i,x),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(i,x))}(l,x[l],o)}finally{null!==N&&pt(N),ua(L),T.resolving=!1,yr()}}return _}function Li(i,o,l){return!!(l[o+(i>>5)]&1<<i)}function Zl(i,o){return!(i&ve.Self||i&ve.Host&&o)}class Is{constructor(o,l){this._tNode=o,this._lView=l}get(o,l,f){return bc(this._tNode,this._lView,o,f,l)}}function Pa(){return new Is(Xr(),Nt())}function el(i){return cr(()=>{const o=i.prototype.constructor,l=o[xt]||ql(o),f=Object.prototype;let _=Object.getPrototypeOf(i.prototype).constructor;for(;_&&_!==f;){const x=_[xt]||ql(_);if(x&&x!==l)return x;_=Object.getPrototypeOf(_)}return x=>new x})}function ql(i){return tn(i)?()=>{const o=ql(sn(i));return o&&o()}:ss(i)}function Ec(i){const o=i[1],l=o.type;return 2===l?o.declTNode:1===l?i[6]:null}function fa(i){return function Du(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const l=i.attrs;if(l){const f=l.length;let _=0;for(;_<f;){const x=l[_];if(xl(x))break;if(0===x)_+=2;else if("number"==typeof x)for(_++;_<f&&"string"==typeof l[_];)_++;else{if(x===o)return l[_+1];_+=2}}}return null}(Xr(),i)}const tl="__parameters__";function wl(i,o,l){return cr(()=>{const f=function La(i){return function(...l){if(i){const f=i(...l);for(const _ in f)this[_]=f[_]}}}(o);function _(...x){if(this instanceof _)return f.apply(this,x),this;const T=new _(...x);return L.annotation=T,L;function L(N,Z,ne){const pe=N.hasOwnProperty(tl)?N[tl]:Object.defineProperty(N,tl,{value:[]})[tl];for(;pe.length<=ne;)pe.push(null);return(pe[ne]=pe[ne]||[]).push(T),N}}return l&&(_.prototype=Object.create(l.prototype)),_.prototype.ngMetadataName=i,_.annotationCls=_,_})}class jr{constructor(o,l){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof l?this.__NG_ELEMENT_ID__=l:void 0!==l&&(this.\u0275prov=_r({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function qt(i,o){void 0===o&&(o=i);for(let l=0;l<i.length;l++){let f=i[l];Array.isArray(f)?(o===i&&(o=i.slice(0,l)),qt(f,o)):o!==i&&o.push(f)}return o}function Ps(i,o){i.forEach(l=>Array.isArray(l)?Ps(l,o):o(l))}function Iu(i,o,l){o>=i.length?i.push(l):i.splice(o,0,l)}function Xl(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function D(i,o,l){let f=c(i,o);return f>=0?i[1|f]=l:(f=~f,function gh(i,o,l,f){let _=i.length;if(_==o)i.push(l,f);else if(1===_)i.push(f,i[0]),i[0]=l;else{for(_--,i.push(i[_-1],i[_]);_>o;)i[_]=i[_-2],_--;i[o]=l,i[o+1]=f}}(i,f,o,l)),f}function O(i,o){const l=c(i,o);if(l>=0)return i[1|l]}function c(i,o){return function a(i,o,l){let f=0,_=i.length>>l;for(;_!==f;){const x=f+(_-f>>1),T=i[x<<l];if(o===T)return x<<l;T>o?_=x:f=x+1}return~(_<<l)}(i,o,1)}const te={},oe="__NG_DI_FLAG__",ae="ngTempTokenPath",ce=/\n/gm,se="__source";let fe;function me(i){const o=fe;return fe=i,o}function Pe(i,o=ve.Default){if(void 0===fe)throw new kt(-203,!1);return null===fe?mn(i,void 0,o):fe.get(i,o&ve.Optional?null:void 0,o)}function De(i,o=ve.Default){return(function ct(){return we}()||Pe)(sn(i),o)}function ze(i,o=ve.Default){return"number"!=typeof o&&(o=0|(o.optional&&8)|(o.host&&1)|(o.self&&2)|(o.skipSelf&&4)),De(i,o)}function Ne(i){const o=[];for(let l=0;l<i.length;l++){const f=sn(i[l]);if(Array.isArray(f)){if(0===f.length)throw new kt(900,!1);let _,x=ve.Default;for(let T=0;T<f.length;T++){const L=f[T],N=Bt(L);"number"==typeof N?-1===N?_=L.token:x|=N:_=L}o.push(De(_,x))}else o.push(De(f))}return o}function We(i,o){return i[oe]=o,i.prototype[oe]=o,i}function Bt(i){return i[oe]}const Lt=We(wl("Optional"),8),ut=We(wl("SkipSelf"),4);let Zo;function Pu(i){Zo=i}class _h{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Jl(i){return i instanceof _h?i.changingThisBreaksApplicationSecurity:i}const Kc=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var uo=(()=>((uo=uo||{})[uo.NONE=0]="NONE",uo[uo.HTML=1]="HTML",uo[uo.STYLE=2]="STYLE",uo[uo.SCRIPT=3]="SCRIPT",uo[uo.URL=4]="URL",uo[uo.RESOURCE_URL=5]="RESOURCE_URL",uo))();function bh(i){const o=function Qo(){const i=Nt();return i&&i[12]}();return o?o.sanitize(uo.URL,i)||"":function ku(i,o){const l=function Hg(i){return i instanceof _h&&i.getTypeName()||null}(i);if(null!=l&&l!==o){if("ResourceURL"===l&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${l} (see https://g.co/ng/security#xss)`)}return l===o}(i,"URL")?Jl(i):function Mf(i){return(i=String(i)).match(Kc)?i:"unsafe:"+i}(tt(i))}const eu=new jr("ENVIRONMENT_INITIALIZER"),es=new jr("INJECTOR",-1),ma=new jr("INJECTOR_DEF_TYPES");class _d{get(o,l=te){if(l===te){const f=new Error(`NullInjectorError: No provider for ${It(o)}!`);throw f.name="NullInjectorError",f}return l}}function zi(...i){return{\u0275providers:kf(0,i)}}function kf(i,...o){const l=[],f=new Set;let _;return Ps(o,x=>{const T=x;ga(T,l,[],f)&&(_||(_=[]),_.push(T))}),void 0!==_&&Fu(_,l),l}function Fu(i,o){for(let l=0;l<i.length;l++){const{providers:_}=i[l];Ps(_,x=>{o.push(x)})}}function ga(i,o,l,f){if(!(i=sn(i)))return!1;let _=null,x=si(i);const T=!x&&ge(i);if(x||T){if(T&&!T.standalone)return!1;_=i}else{const N=i.ngModule;if(x=si(N),!x)return!1;_=N}const L=f.has(_);if(T){if(L)return!1;if(f.add(_),T.dependencies){const N="function"==typeof T.dependencies?T.dependencies():T.dependencies;for(const Z of N)ga(Z,o,l,f)}}else{if(!x)return!1;{if(null!=x.imports&&!L){let Z;f.add(_);try{Ps(x.imports,ne=>{ga(ne,o,l,f)&&(Z||(Z=[]),Z.push(ne))})}finally{}void 0!==Z&&Fu(Z,o)}if(!L){const Z=ss(_)||(()=>new _);o.push({provide:_,useFactory:Z,deps:Ce},{provide:ma,useValue:_,multi:!0},{provide:eu,useValue:()=>De(_),multi:!0})}const N=x.providers;null==N||L||Ps(N,ne=>{o.push(ne)})}}return _!==i&&void 0!==i.providers}const qg=bt({provide:String,useValue:bt});function yd(i){return null!==i&&"object"==typeof i&&qg in i}function Rc(i){return"function"==typeof i}const vd=new jr("Set Injector scope."),Eh={},Wg={};let Ff;function Ch(){return void 0===Ff&&(Ff=new _d),Ff}class Lc{}class Bu extends Lc{constructor(o,l,f,_){super(),this.parent=l,this.source=f,this.scopes=_,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,nu(o,T=>this.processProvider(T)),this.records.set(es,kc(void 0,this)),_.has("environment")&&this.records.set(Lc,kc(void 0,this));const x=this.records.get(vd);null!=x&&"string"==typeof x.value&&this.scopes.add(x.value),this.injectorDefTypes=new Set(this.get(ma.multi,Ce,ve.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const l=me(this),f=pt(void 0);try{return o()}finally{me(l),pt(f)}}get(o,l=te,f=ve.Default){this.assertNotDestroyed();const _=me(this),x=pt(void 0);try{if(!(f&ve.SkipSelf)){let L=this.records.get(o);if(void 0===L){const N=function Xg(i){return"function"==typeof i||"object"==typeof i&&i instanceof jr}(o)&&Nr(o);L=N&&this.injectableDefInScope(N)?kc(Dh(o),Eh):null,this.records.set(o,L)}if(null!=L)return this.hydrate(o,L)}return(f&ve.Self?Ch():this.parent).get(o,l=f&ve.Optional&&l===te?null:l)}catch(T){if("NullInjectorError"===T.name){if((T[ae]=T[ae]||[]).unshift(It(o)),_)throw T;return function qe(i,o,l,f){const _=i[ae];throw o[se]&&_.unshift(o[se]),i.message=function mt(i,o,l,f=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let _=It(o);if(Array.isArray(o))_=o.map(It).join(" -> ");else if("object"==typeof o){let x=[];for(let T in o)if(o.hasOwnProperty(T)){let L=o[T];x.push(T+":"+("string"==typeof L?JSON.stringify(L):It(L)))}_=`{${x.join(", ")}}`}return`${l}${f?"("+f+")":""}[${_}]: ${i.replace(ce,"\n  ")}`}("\n"+i.message,_,l,f),i.ngTokenPath=_,i[ae]=null,i}(T,o,"R3InjectorError",this.source)}throw T}finally{pt(x),me(_)}}resolveInjectorInitializers(){const o=me(this),l=pt(void 0);try{const f=this.get(eu.multi,Ce,ve.Self);for(const _ of f)_()}finally{me(o),pt(l)}}toString(){const o=[],l=this.records;for(const f of l.keys())o.push(It(f));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new kt(205,!1)}processProvider(o){let l=Rc(o=sn(o))?o:sn(o&&o.provide);const f=function Nf(i){return yd(i)?kc(void 0,i.useValue):kc(ts(i),Eh)}(o);if(Rc(o)||!0!==o.multi)this.records.get(l);else{let _=this.records.get(l);_||(_=kc(void 0,Eh,!0),_.factory=()=>Ne(_.multi),this.records.set(l,_)),l=o,_.multi.push(o)}this.records.set(l,f)}hydrate(o,l){return l.value===Eh&&(l.value=Wg,l.value=l.factory()),"object"==typeof l.value&&l.value&&function Sl(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}injectableDefInScope(o){if(!o.providedIn)return!1;const l=sn(o.providedIn);return"string"==typeof l?"any"===l||this.scopes.has(l):this.injectorDefTypes.has(l)}}function Dh(i){const o=Nr(i),l=null!==o?o.factory:ss(i);if(null!==l)return l;if(i instanceof jr)throw new kt(204,!1);if(i instanceof Function)return function Bf(i){const o=i.length;if(o>0)throw function rl(i,o){const l=[];for(let f=0;f<i;f++)l.push(o);return l}(o,"?"),new kt(204,!1);const l=function Fi(i){const o=i&&(i[fo]||i[kr]);if(o){const l=function zr(i){if(i.hasOwnProperty("name"))return i.name;const o=(""+i).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(i);return console.warn(`DEPRECATED: DI is instantiating a token "${l}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${l}" class.`),o}return null}(i);return null!==l?()=>l.factory(i):()=>new i}(i);throw new kt(204,!1)}function ts(i,o,l){let f;if(Rc(i)){const _=sn(i);return ss(_)||Dh(_)}if(yd(i))f=()=>sn(i.useValue);else if(function Pc(i){return!(!i||!i.useFactory)}(i))f=()=>i.useFactory(...Ne(i.deps||[]));else if(function Of(i){return!(!i||!i.useExisting)}(i))f=()=>De(sn(i.useExisting));else{const _=sn(i&&(i.useClass||i.provide));if(!function fm(i){return!!i.deps}(i))return ss(_)||Dh(_);f=()=>new _(...Ne(i.deps))}return f}function kc(i,o,l=!1){return{factory:i,value:o,multi:l?[]:void 0}}function tu(i){return!!i.\u0275providers}function nu(i,o){for(const l of i)Array.isArray(l)?nu(l,o):tu(l)?nu(l.\u0275providers,o):o(l)}class _a{}class Jg{resolveComponentFactory(o){throw function Yg(i){const o=Error(`No component factory found for ${It(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let ru=(()=>{class i{}return i.NULL=new Jg,i})();function Al(){return Fa(Xr(),Nt())}function Fa(i,o){return new Nu(Bi(i,o))}let Nu=(()=>{class i{constructor(l){this.nativeElement=l}}return i.__NG_ELEMENT_ID__=Al,i})();function pm(i){return i instanceof Nu?i.nativeElement:i}class Mh{}let zf=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function zu(){const i=Nt(),l=Ji(Xr().index,i);return(sr(l)?l:i)[11]}(),i})(),Vu=(()=>{class i{}return i.\u0275prov=_r({token:i,providedIn:"root",factory:()=>null}),i})();class Uu{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const xd=new Uu("14.2.4"),bd={};function Cd(i){return i.ngOriginalError}class to{constructor(){this._console=console}handleError(o){const l=this._findOriginalError(o);this._console.error("ERROR",o),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(o){let l=o&&Cd(o);for(;l&&Cd(l);)l=Cd(l);return l||null}}const Hf=new Map;let tc=0;const Lh="__ngContext__";function fs(i,o){sr(o)?(i[Lh]=o[20],function Dd(i){Hf.set(i[20],i)}(o)):i[Lh]=o}function nc(i){return i instanceof Function?i():i}var qi=(()=>((qi=qi||{})[qi.Important=1]="Important",qi[qi.DashCase=2]="DashCase",qi))();function kh(i,o){return undefined(i,o)}function cu(i){const o=i[3];return vi(o)?o[3]:o}function rc(i){return Dm(i[13])}function uu(i){return Dm(i[4])}function Dm(i){for(;null!==i&&!vi(i);)i=i[4];return i}function $u(i,o,l,f,_){if(null!=f){let x,T=!1;vi(f)?x=f:sr(f)&&(T=!0,f=f[0]);const L=cn(f);0===i&&null!==l?null==_?Rd(o,l,L):ic(o,l,L,_||null,!0):1===i&&null!==l?ic(o,l,L,_||null,!0):2===i?function km(i,o,l){const f=kd(i,o);f&&function Im(i,o,l,f){i.removeChild(o,l,f)}(i,f,o,l)}(o,L,T):3===i&&o.destroyNode(L),null!=x&&function m_(i,o,l,f,_){const x=l[7];x!==cn(l)&&$u(o,i,f,x,_);for(let L=10;L<l.length;L++){const N=l[L];Fh(N[1],N,i,o,f,x)}}(o,i,x,l,_)}}function Jf(i,o,l){return i.createElement(o,l)}function ep(i,o){const l=i[9],f=l.indexOf(o),_=o[3];512&o[2]&&(o[2]&=-513,Zs(_,-1)),l.splice(f,1)}function Hu(i,o){if(i.length<=10)return;const l=10+o,f=i[l];if(f){const _=f[17];null!==_&&_!==i&&ep(_,f),o>0&&(i[l-1][4]=f[4]);const x=Xl(i,10+o);!function Qf(i,o){Fh(i,o,o[11],2,null,null),o[0]=null,o[6]=null}(f[1],f);const T=x[19];null!==T&&T.detachView(x[1]),f[3]=null,f[4]=null,f[2]&=-65}return f}function Oh(i,o){if(!(128&o[2])){const l=o[11];l.destroyNode&&Fh(i,o,l,3,null,null),function p_(i){let o=i[13];if(!o)return hu(i[1],i);for(;o;){let l=null;if(sr(o))l=o[13];else{const f=o[10];f&&(l=f)}if(!l){for(;o&&!o[4]&&o!==i;)sr(o)&&hu(o[1],o),o=o[3];null===o&&(o=i),sr(o)&&hu(o[1],o),l=o&&o[4]}o=l}}(o)}}function hu(i,o){if(!(128&o[2])){o[2]&=-65,o[2]|=128,function Sm(i,o){let l;if(null!=i&&null!=(l=i.destroyHooks))for(let f=0;f<l.length;f+=2){const _=o[l[f]];if(!(_ instanceof fr)){const x=l[f+1];if(Array.isArray(x))for(let T=0;T<x.length;T+=2){const L=_[x[T]],N=x[T+1];try{N.call(L)}finally{}}else try{x.call(_)}finally{}}}}(i,o),function Mm(i,o){const l=i.cleanup,f=o[7];let _=-1;if(null!==l)for(let x=0;x<l.length-1;x+=2)if("string"==typeof l[x]){const T=l[x+1],L="function"==typeof T?T(o):cn(o[T]),N=f[_=l[x+2]],Z=l[x+3];"boolean"==typeof Z?L.removeEventListener(l[x],N,Z):Z>=0?f[_=Z]():f[_=-Z].unsubscribe(),x+=2}else{const T=f[_=l[x+1]];l[x].call(T)}if(null!==f){for(let x=_+1;x<f.length;x++)(0,f[x])();o[7]=null}}(i,o),1===o[1].type&&o[11].destroy();const l=o[17];if(null!==l&&vi(o[3])){l!==o[3]&&ep(l,o);const f=o[19];null!==f&&f.detachView(i)}!function Zf(i){Hf.delete(i[20])}(o)}}function Zu(i,o,l){return function Pd(i,o,l){let f=o;for(;null!==f&&40&f.type;)f=(o=f).parent;if(null===f)return l[0];if(2&f.flags){const _=i.data[f.directiveStart].encapsulation;if(_===_e.None||_===_e.Emulated)return null}return Bi(f,l)}(i,o.parent,l)}function ic(i,o,l,f,_){i.insertBefore(o,l,f,_)}function Rd(i,o,l){i.appendChild(o,l)}function Am(i,o,l,f,_){null!==f?ic(i,o,l,f,_):Rd(i,o,l)}function kd(i,o){return i.parentNode(o)}let Fd=function Od(i,o,l){return 40&i.type?Bi(i,l):null};function Bd(i,o,l,f){const _=Zu(i,f,o),x=o[11],L=function Pm(i,o,l){return Fd(i,o,l)}(f.parent||o[6],f,o);if(null!=_)if(Array.isArray(l))for(let N=0;N<l.length;N++)Am(x,_,l[N],L,!1);else Am(x,_,l,L,!1)}function Nd(i,o){if(null!==o){const l=o.type;if(3&l)return Bi(o,i);if(4&l)return np(-1,i[o.index]);if(8&l){const f=o.child;if(null!==f)return Nd(i,f);{const _=i[o.index];return vi(_)?np(-1,_):cn(_)}}if(32&l)return kh(o,i)()||cn(i[o.index]);{const f=Lm(i,o);return null!==f?Array.isArray(f)?f[0]:Nd(cu(i[16]),f):Nd(i,o.next)}}return null}function Lm(i,o){return null!==o?i[16][6].projection[o.projection]:null}function np(i,o){const l=10+i+1;if(l<o.length){const f=o[l],_=f[1].firstChild;if(null!==_)return Nd(f,_)}return o[7]}function Wu(i,o,l,f,_,x,T){for(;null!=l;){const L=f[l.index],N=l.type;if(T&&0===o&&(L&&fs(cn(L),f),l.flags|=4),64!=(64&l.flags))if(8&N)Wu(i,o,l.child,f,_,x,!1),$u(o,i,_,L,x);else if(32&N){const Z=kh(l,f);let ne;for(;ne=Z();)$u(o,i,_,ne,x);$u(o,i,_,L,x)}else 16&N?du(i,o,f,l,_,x):$u(o,i,_,L,x);l=T?l.projectionNext:l.next}}function Fh(i,o,l,f,_,x){Wu(l,f,i.firstChild,o,_,x,!1)}function du(i,o,l,f,_,x){const T=l[16],N=T[6].projection[f.projection];if(Array.isArray(N))for(let Z=0;Z<N.length;Z++)$u(o,i,_,N[Z],x);else Wu(i,o,N,T[3],_,x,!0)}function Fm(i,o,l){i.setAttribute(o,"style",l)}function zd(i,o,l){""===l?i.removeAttribute(o,"class"):i.setAttribute(o,"class",l)}function rp(i,o,l){let f=i.length;for(;;){const _=i.indexOf(o,l);if(-1===_)return _;if(0===_||i.charCodeAt(_-1)<=32){const x=o.length;if(_+x===f||i.charCodeAt(_+x)<=32)return _}l=_+1}}const Bm="ng-template";function __(i,o,l){let f=0;for(;f<i.length;){let _=i[f++];if(l&&"class"===_){if(_=i[f],-1!==rp(_.toLowerCase(),o,0))return!0}else if(1===_){for(;f<i.length&&"string"==typeof(_=i[f++]);)if(_.toLowerCase()===o)return!0;return!1}}return!1}function Vd(i){return 4===i.type&&i.value!==Bm}function Ud(i,o,l){return o===(4!==i.type||l?i.value:Bm)}function jd(i,o,l){let f=4;const _=i.attrs||[],x=function Nm(i){for(let o=0;o<i.length;o++)if(xl(i[o]))return o;return i.length}(_);let T=!1;for(let L=0;L<o.length;L++){const N=o[L];if("number"!=typeof N){if(!T)if(4&f){if(f=2|1&f,""!==N&&!Ud(i,N,l)||""===N&&1===o.length){if(ll(f))return!1;T=!0}}else{const Z=8&f?N:o[++L];if(8&f&&null!==i.attrs){if(!__(i.attrs,Z,l)){if(ll(f))return!1;T=!0}continue}const pe=y_(8&f?"class":N,_,Vd(i),l);if(-1===pe){if(ll(f))return!1;T=!0;continue}if(""!==Z){let Oe;Oe=pe>x?"":_[pe+1].toLowerCase();const Je=8&f?Oe:null;if(Je&&-1!==rp(Je,Z,0)||2&f&&Z!==Oe){if(ll(f))return!1;T=!0}}}}else{if(!T&&!ll(f)&&!ll(N))return!1;if(T&&ll(N))continue;T=!1,f=N|1&f}}return ll(f)||T}function ll(i){return 0==(1&i)}function y_(i,o,l,f){if(null===o)return-1;let _=0;if(f||!l){let x=!1;for(;_<o.length;){const T=o[_];if(T===i)return _;if(3===T||6===T)x=!0;else{if(1===T||2===T){let L=o[++_];for(;"string"==typeof L;)L=o[++_];continue}if(4===T)break;if(0===T){_+=4;continue}}_+=x?1:2}return-1}return function Nh(i,o){let l=i.indexOf(4);if(l>-1)for(l++;l<i.length;){const f=i[l];if("number"==typeof f)return-1;if(f===o)return l;l++}return-1}(o,i)}function Xu(i,o,l=!1){for(let f=0;f<o.length;f++)if(jd(i,o[f],l))return!0;return!1}function Vm(i,o){return i?":not("+o.trim()+")":o}function Um(i){let o=i[0],l=1,f=2,_="",x=!1;for(;l<i.length;){let T=i[l];if("string"==typeof T)if(2&f){const L=i[++l];_+="["+T+(L.length>0?'="'+L+'"':"")+"]"}else 8&f?_+="."+T:4&f&&(_+=" "+T);else""!==_&&!ll(T)&&(o+=Vm(x,_),_=""),f=T,x=x||!ll(f);l++}return""!==_&&(o+=Vm(x,_)),o}const pr={};function ip(i){op(Wn(),Nt(),nr()+i,!1)}function op(i,o,l,f){if(!f)if(3==(3&o[2])){const x=i.preOrderCheckHooks;null!==x&&j(o,x,l)}else{const x=i.preOrderHooks;null!==x&&F(o,x,0,l)}br(l)}function sp(i,o=null,l=null,f){const _=ap(i,o,l,f);return _.resolveInjectorInitializers(),_}function ap(i,o=null,l=null,f,_=new Set){const x=[l||Ce,zi(i)];return f=f||("object"==typeof i?void 0:It(i)),new Bu(x,o||Ch(),f||null,_)}let fu=(()=>{class i{static create(l,f){if(Array.isArray(l))return sp({name:""},f,l,"");{const _=l.name??"";return sp({name:_},l.parent,l.providers,_)}}}return i.THROW_IF_NOT_FOUND=te,i.NULL=new _d,i.\u0275prov=_r({token:i,providedIn:"any",factory:()=>De(es)}),i.__NG_ELEMENT_ID__=-1,i})();function Bc(i,o=ve.Default){const l=Nt();return null===l?De(i,o):bc(Xr(),l,sn(i),o)}function pp(){throw new Error("invalid")}function Na(i,o){return i<<17|o<<2}function ps(i){return i>>17&32767}function _p(i){return 2|i}function oc(i){return(131068&i)>>2}function yp(i,o){return-131069&i|o<<2}function vp(i){return 1|i}function Mp(i,o){const l=i.contentQueries;if(null!==l)for(let f=0;f<l.length;f+=2){const _=l[f],x=l[f+1];if(-1!==x){const T=i.data[x];J(_),T.contentQueries(2,o[x],x)}}}function cc(i,o,l,f,_,x,T,L,N,Z,ne){const pe=o.blueprint.slice();return pe[0]=_,pe[2]=76|f,(null!==ne||i&&1024&i[2])&&(pe[2]|=1024),Cs(pe),pe[3]=pe[15]=i,pe[8]=l,pe[10]=T||i&&i[10],pe[11]=L||i&&i[11],pe[12]=N||i&&i[12]||null,pe[9]=Z||i&&i[9]||null,pe[6]=x,pe[20]=function iu(){return tc++}(),pe[21]=ne,pe[16]=2==o.type?i[16]:pe,pe}function dl(i,o,l,f,_){let x=i.data[o];if(null===x)x=function Xd(i,o,l,f,_){const x=Yo(),T=xo(),N=i.data[o]=function hg(i,o,l,f,_,x){return{type:l,index:f,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:_,attrs:x,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,T?x:x&&x.parent,l,o,f,_);return null===i.firstChild&&(i.firstChild=N),null!==x&&(T?null==x.child&&null!==N.parent&&(x.child=N):null===x.next&&(x.next=N)),N}(i,o,l,f,_),function Ma(){return Nn.lFrame.inI18n}()&&(x.flags|=64);else if(64&x.type){x.type=l,x.value=f,x.attrs=_;const T=function Ni(){const i=Nn.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();x.injectorIndex=null===T?-1:T.injectorIndex}return Qi(x,!0),x}function uc(i,o,l,f){if(0===l)return-1;const _=o.length;for(let x=0;x<l;x++)o.push(f),i.blueprint.push(f),i.data.push(null);return _}function Yd(i,o,l){Ae(o);try{const f=i.viewQuery;null!==f&&sh(1,f,l);const _=i.template;null!==_&&Gh(i,o,_,1,l),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Mp(i,o),i.staticViewQueries&&sh(2,i.viewQuery,l);const x=i.components;null!==x&&function Sp(i,o){for(let l=0;l<o.length;l++)H_(i,o[l])}(o,x)}catch(f){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),f}finally{o[2]&=-5,wr()}}function mu(i,o,l,f){const _=o[2];if(128!=(128&_)){Ae(o);try{Cs(o),function Ko(i){return Nn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==l&&Gh(i,o,l,2,f);const T=3==(3&_);if(T){const Z=i.preOrderCheckHooks;null!==Z&&j(o,Z,null)}else{const Z=i.preOrderHooks;null!==Z&&F(o,Z,0,null),R(o,0)}if(function gg(i){for(let o=rc(i);null!==o;o=uu(o)){if(!o[2])continue;const l=o[9];for(let f=0;f<l.length;f++){const _=l[f],x=_[3];0==(512&_[2])&&Zs(x,1),_[2]|=512}}}(o),function $_(i){for(let o=rc(i);null!==o;o=uu(o))for(let l=10;l<o.length;l++){const f=o[l],_=f[1];Lo(f)&&mu(_,f,_.template,f[8])}}(o),null!==i.contentQueries&&Mp(i,o),T){const Z=i.contentCheckHooks;null!==Z&&j(o,Z)}else{const Z=i.contentHooks;null!==Z&&F(o,Z,1),R(o,1)}!function ag(i,o){const l=i.hostBindingOpCodes;if(null!==l)try{for(let f=0;f<l.length;f++){const _=l[f];if(_<0)br(~_);else{const x=_,T=l[++f],L=l[++f];Ws(T,x),L(2,o[x])}}}finally{br(-1)}}(i,o);const L=i.components;null!==L&&function hl(i,o){for(let l=0;l<o.length;l++)G_(i,o[l])}(o,L);const N=i.viewQuery;if(null!==N&&sh(2,N,f),T){const Z=i.viewCheckHooks;null!==Z&&j(o,Z)}else{const Z=i.viewHooks;null!==Z&&F(o,Z,2),R(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[2]&=-41,512&o[2]&&(o[2]&=-513,Zs(o[3],-1))}finally{wr()}}}function Gh(i,o,l,f,_){const x=nr(),T=2&f;try{br(-1),T&&o.length>22&&op(i,o,22,!1),l(f,_)}finally{br(x)}}function Ap(i,o,l){!qs()||(function gu(i,o,l,f){const _=l.directiveStart,x=l.directiveEnd;i.firstCreatePass||Di(l,o),fs(f,o);const T=l.initialInputs;for(let L=_;L<x;L++){const N=i.data[L],Z=Yi(N);Z&&V_(o,l,N);const ne=Qa(o,i,L,l);fs(ne,o),null!==T&&Qd(0,L-_,ne,N,0,T),Z&&(Ji(l.index,o)[8]=ne)}}(i,o,l,Bi(l,o)),128==(128&l.flags)&&function N_(i,o,l){const f=l.directiveStart,_=l.directiveEnd,x=l.index,T=function Ul(){return Nn.lFrame.currentDirectiveIndex}();try{br(x);for(let L=f;L<_;L++){const N=i.data[L],Z=o[L];Sa(L),(null!==N.hostBindings||0!==N.hostVars||null!==N.hostAttrs)&&dc(N,Z)}}finally{br(-1),Sa(T)}}(i,o,l))}function Ip(i,o,l=Bi){const f=o.localNames;if(null!==f){let _=o.index+1;for(let x=0;x<f.length;x+=2){const T=f[x+1],L=-1===T?l(o,i):i[T];i[_++]=L}}}function cg(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=Pp(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function Pp(i,o,l,f,_,x,T,L,N,Z){const ne=22+f,pe=ne+_,Oe=function rh(i,o){const l=[];for(let f=0;f<o;f++)l.push(f<i?null:pr);return l}(ne,pe),Je="function"==typeof Z?Z():Z;return Oe[1]={type:i,blueprint:Oe,template:l,queries:null,viewQuery:L,declTNode:o,data:Oe.slice().fill(null,ne),bindingStartIndex:ne,expandoStartIndex:pe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof x?x():x,pipeRegistry:"function"==typeof T?T():T,firstChild:null,schemas:N,consts:Je,incompleteFirstPass:!1}}function ug(i,o,l,f){const _=nf(o);null===l?_.push(f):(_.push(l),i.firstCreatePass&&rf(i).push(f,_.length-1))}function dg(i,o,l){for(let f in i)if(i.hasOwnProperty(f)){const _=i[f];(l=null===l?{}:l).hasOwnProperty(f)?l[f].push(o,_):l[f]=[o,_]}return l}function Kd(i,o){const f=o.directiveEnd,_=i.data,x=o.attrs,T=[];let L=null,N=null;for(let Z=o.directiveStart;Z<f;Z++){const ne=_[Z],pe=ne.inputs,Oe=null===x||Vd(o)?null:U_(pe,x);T.push(Oe),L=dg(pe,Z,L),N=dg(ne.outputs,Z,N)}null!==L&&(L.hasOwnProperty("class")&&(o.flags|=16),L.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=T,o.inputs=L,o.outputs=N}function hc(i,o){const l=Ji(o,i);16&l[2]||(l[2]|=32)}function Zh(i,o,l,f){let _=!1;if(qs()){const x=function z_(i,o,l){const f=i.directiveRegistry;let _=null;if(f)for(let x=0;x<f.length;x++){const T=f[x];Xu(l,T.selectors,!1)&&(_||(_=[]),ha(Di(l,o),i,T.type),Yi(T)?(ih(i,l),_.unshift(T)):_.push(T))}return _}(i,o,l),T=null===f?null:{"":-1};if(null!==x){_=!0,oh(l,i.data.length,x.length);for(let ne=0;ne<x.length;ne++){const pe=x[ne];pe.providersResolver&&pe.providersResolver(pe)}let L=!1,N=!1,Z=uc(i,o,x.length,null);for(let ne=0;ne<x.length;ne++){const pe=x[ne];l.mergedAttrs=jl(l.mergedAttrs,pe.hostAttrs),Xh(i,l,o,Z,pe),Wh(Z,pe,T),null!==pe.contentQueries&&(l.flags|=8),(null!==pe.hostBindings||null!==pe.hostAttrs||0!==pe.hostVars)&&(l.flags|=128);const Oe=pe.type.prototype;!L&&(Oe.ngOnChanges||Oe.ngOnInit||Oe.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(l.index),L=!0),!N&&(Oe.ngOnChanges||Oe.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(l.index),N=!0),Z++}Kd(i,l)}T&&function qh(i,o,l){if(o){const f=i.localNames=[];for(let _=0;_<o.length;_+=2){const x=l[o[_+1]];if(null==x)throw new kt(-301,!1);f.push(o[_],x)}}}(l,f,T)}return l.mergedAttrs=jl(l.mergedAttrs,l.attrs),_}function pg(i,o,l,f,_,x){const T=x.hostBindings;if(T){let L=i.hostBindingOpCodes;null===L&&(L=i.hostBindingOpCodes=[]);const N=~o.index;(function mg(i){let o=i.length;for(;o>0;){const l=i[--o];if("number"==typeof l&&l<0)return l}return 0})(L)!=N&&L.push(N),L.push(f,_,T)}}function dc(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function ih(i,o){o.flags|=2,(i.components||(i.components=[])).push(o.index)}function Wh(i,o,l){if(l){if(o.exportAs)for(let f=0;f<o.exportAs.length;f++)l[o.exportAs[f]]=i;Yi(o)&&(l[""]=i)}}function oh(i,o,l){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+l,i.providerIndexes=o}function Xh(i,o,l,f,_){i.data[f]=_;const x=_.factory||(_.factory=ss(_.type)),T=new fr(x,Yi(_),Bc);i.blueprint[f]=T,l[f]=T,pg(i,o,0,f,uc(i,l,_.hostVars,pr),_)}function V_(i,o,l){const f=Bi(o,i),_=cg(l),x=i[10],T=tf(i,cc(i,_,null,l.onPush?32:16,f,o,x,x.createRenderer(f,l),null,null,null));i[o.index]=T}function Il(i,o,l,f,_,x){const T=Bi(i,o);!function Nc(i,o,l,f,_,x,T){if(null==x)i.removeAttribute(o,_,l);else{const L=null==T?tt(x):T(x,f||"",_);i.setAttribute(o,_,L,l)}}(o[11],T,x,i.value,l,f,_)}function Qd(i,o,l,f,_,x){const T=x[o];if(null!==T){const L=f.setInput;for(let N=0;N<T.length;){const Z=T[N++],ne=T[N++],pe=T[N++];null!==L?f.setInput(l,pe,Z,ne):l[ne]=pe}}}function U_(i,o){let l=null,f=0;for(;f<o.length;){const _=o[f];if(0!==_)if(5!==_){if("number"==typeof _)break;i.hasOwnProperty(_)&&(null===l&&(l=[]),l.push(_,i[_],o[f+1])),f+=2}else f+=2;else f+=4}return l}function Lp(i,o,l,f){return new Array(i,!0,!1,o,null,0,f,l,null,null)}function G_(i,o){const l=Ji(o,i);if(Lo(l)){const f=l[1];48&l[2]?mu(f,l,f.template,l[8]):l[5]>0&&ef(l)}}function ef(i){for(let f=rc(i);null!==f;f=uu(f))for(let _=10;_<f.length;_++){const x=f[_];if(Lo(x))if(512&x[2]){const T=x[1];mu(T,x,T.template,x[8])}else x[5]>0&&ef(x)}const l=i[1].components;if(null!==l)for(let f=0;f<l.length;f++){const _=Ji(l[f],i);Lo(_)&&_[5]>0&&ef(_)}}function H_(i,o){const l=Ji(o,i),f=l[1];(function _g(i,o){for(let l=o.length;l<i.blueprint.length;l++)o.push(i.blueprint[l])})(f,l),Yd(f,l,l[8])}function tf(i,o){return i[13]?i[14][4]=o:i[13]=o,i[14]=o,o}function kp(i){for(;i;){i[2]|=32;const o=cu(i);if(Ga(i)&&!o)return i;i=o}return null}function _u(i,o,l,f=!0){const _=o[10];_.begin&&_.begin();try{mu(i,o,i.template,l)}catch(T){throw f&&yg(o,T),T}finally{_.end&&_.end()}}function sh(i,o,l){J(0),o(i,l)}function nf(i){return i[7]||(i[7]=[])}function rf(i){return i.cleanup||(i.cleanup=[])}function yg(i,o){const l=i[9],f=l?l.get(to,null):null;f&&f.handleError(o)}function Yh(i,o,l,f,_){for(let x=0;x<l.length;){const T=l[x++],L=l[x++],N=o[T],Z=i.data[T];null!==Z.setInput?Z.setInput(N,_,f,L):N[L]=_}}function yu(i,o,l){let f=l?i.styles:null,_=l?i.classes:null,x=0;if(null!==o)for(let T=0;T<o.length;T++){const L=o[T];"number"==typeof L?x=L:1==x?_=pn(_,L):2==x&&(f=pn(f,L+": "+o[++T]+";"))}l?i.styles=f:i.stylesWithoutHost=f,l?i.classes=_:i.classesWithoutHost=_}function sf(i,o,l,f,_=!1){for(;null!==l;){const x=o[l.index];if(null!==x&&f.push(cn(x)),vi(x))for(let L=10;L<x.length;L++){const N=x[L],Z=N[1].firstChild;null!==Z&&sf(N[1],N,Z,f)}const T=l.type;if(8&T)sf(i,o,l.child,f);else if(32&T){const L=kh(l,o);let N;for(;N=L();)f.push(N)}else if(16&T){const L=Lm(o,l);if(Array.isArray(L))f.push(...L);else{const N=cu(o[16]);sf(N[1],N,L,f,!0)}}l=_?l.projectionNext:l.next}return f}class Kh{constructor(o,l){this._lView=o,this._cdRefInjectingView=l,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,l=o[1];return sf(l,o,l.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(vi(o)){const l=o[8],f=l?l.indexOf(this):-1;f>-1&&(Hu(o,f),Xl(l,f))}this._attachedToViewContainer=!1}Oh(this._lView[1],this._lView)}onDestroy(o){ug(this._lView[1],this._lView,null,o)}markForCheck(){kp(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){_u(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new kt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Gu(i,o){Fh(i,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new kt(902,!1);this._appRef=o}}class Z_ extends Kh{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;_u(o[1],o,o[8],!1)}checkNoChanges(){}get context(){return null}}class Fp extends ru{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const l=ge(o);return new Qh(l,this.ngModule)}}function af(i){const o=[];for(let l in i)i.hasOwnProperty(l)&&o.push({propName:i[l],templateName:l});return o}class Jh{constructor(o,l){this.injector=o,this.parentInjector=l}get(o,l,f){const _=this.injector.get(o,bd,f);return _!==bd||l===bd?_:this.parentInjector.get(o,l,f)}}class Qh extends _a{constructor(o,l){super(),this.componentDef=o,this.ngModule=l,this.componentType=o.type,this.selector=function jm(i){return i.map(Um).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!l}get inputs(){return af(this.componentDef.inputs)}get outputs(){return af(this.componentDef.outputs)}create(o,l,f,_){let x=(_=_||this.ngModule)instanceof Lc?_:_?.injector;x&&null!==this.componentDef.getStandaloneInjector&&(x=this.componentDef.getStandaloneInjector(x)||x);const T=x?new Jh(o,x):o,L=T.get(Mh,null);if(null===L)throw new kt(407,!1);const N=T.get(Vu,null),Z=L.createRenderer(null,this.componentDef),ne=this.componentDef.selectors[0][0]||"div",pe=f?function Rp(i,o,l){return i.selectRootElement(o,l===_e.ShadowDom)}(Z,f,this.componentDef.encapsulation):Jf(L.createRenderer(null,this.componentDef),ne,function q_(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(ne)),Oe=this.componentDef.onPush?288:272,Je=Pp(0,null,null,1,0,null,null,null,null,null),Mt=cc(null,Je,null,Oe,null,null,L,Z,N,T,null);let Xt,an;Ae(Mt);try{const wn=function Va(i,o,l,f,_,x){const T=l[1];l[22]=i;const N=dl(T,22,2,"#host",null),Z=N.mergedAttrs=o.hostAttrs;null!==Z&&(yu(N,Z,!0),null!==i&&(vl(_,i,Z),null!==N.classes&&zd(_,i,N.classes),null!==N.styles&&Fm(_,i,N.styles)));const ne=f.createRenderer(i,o),pe=cc(l,cg(o),null,o.onPush?32:16,l[22],N,f,ne,x||null,null,null);return T.firstCreatePass&&(ha(Di(N,l),T,o.type),ih(T,N),oh(N,l.length,1)),tf(l,pe),l[22]=pe}(pe,this.componentDef,Mt,L,Z);if(pe)if(f)vl(Z,pe,["ng-version",xd.full]);else{const{attrs:Fn,classes:$t}=function $m(i){const o=[],l=[];let f=1,_=2;for(;f<i.length;){let x=i[f];if("string"==typeof x)2===_?""!==x&&o.push(x,i[++f]):8===_&&l.push(x);else{if(!ll(_))break;_=x}f++}return{attrs:o,classes:l}}(this.componentDef.selectors[0]);Fn&&vl(Z,pe,Fn),$t&&$t.length>0&&zd(Z,pe,$t.join(" "))}if(an=Hs(Je,22),void 0!==l){const Fn=an.projection=[];for(let $t=0;$t<this.ngContentSelectors.length;$t++){const ir=l[$t];Fn.push(null!=ir?Array.from(ir):null)}}Xt=function Rl(i,o,l,f){const _=l[1],x=function Jd(i,o,l){const f=Xr();i.firstCreatePass&&(l.providersResolver&&l.providersResolver(l),Xh(i,f,o,uc(i,o,1,null),l),Kd(i,f));const _=Qa(o,i,f.directiveStart,f);fs(_,o);const x=Bi(f,o);return x&&fs(x,o),_}(_,l,o);if(i[8]=l[8]=x,null!==f)for(const L of f)L(x,o);if(o.contentQueries){const L=Xr();o.contentQueries(1,x,L.directiveStart)}const T=Xr();return!_.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(br(T.index),pg(l[1],T,0,T.directiveStart,T.directiveEnd,o),dc(o,x)),x}(wn,this.componentDef,Mt,[zc]),Yd(Je,Mt,null)}finally{wr()}return new Y_(this.componentType,Xt,Fa(an,Mt),Mt,an)}}class Y_ extends class Oa{}{constructor(o,l,f,_,x){super(),this.location=f,this._rootLView=_,this._tNode=x,this.instance=l,this.hostView=this.changeDetectorRef=new Z_(_),this.componentType=o}setInput(o,l){const f=this._tNode.inputs;let _;if(null!==f&&(_=f[o])){const x=this._rootLView;Yh(x[1],x,_,o,l),hc(x,this._tNode.index)}}get injector(){return new Is(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function zc(){const i=Xr();Xs(Nt()[1],i)}function Ll(i){let o=function fl(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),l=!0;const f=[i];for(;o;){let _;if(Yi(i))_=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new kt(903,!1);_=o.\u0275dir}if(_){if(l){f.push(_);const T=i;T.inputs=cf(i.inputs),T.declaredInputs=cf(i.declaredInputs),T.outputs=cf(i.outputs);const L=_.hostBindings;L&&Bp(i,L);const N=_.viewQuery,Z=_.contentQueries;if(N&&vg(i,N),Z&&xg(i,Z),nn(i.inputs,_.inputs),nn(i.declaredInputs,_.declaredInputs),nn(i.outputs,_.outputs),Yi(_)&&_.data.animation){const ne=i.data;ne.animation=(ne.animation||[]).concat(_.data.animation)}}const x=_.features;if(x)for(let T=0;T<x.length;T++){const L=x[T];L&&L.ngInherit&&L(i),L===Ll&&(l=!1)}}o=Object.getPrototypeOf(o)}!function lf(i){let o=0,l=null;for(let f=i.length-1;f>=0;f--){const _=i[f];_.hostVars=o+=_.hostVars,_.hostAttrs=jl(_.hostAttrs,l=jl(l,_.hostAttrs))}}(f)}function cf(i){return i===Ee?{}:i===Ce?[]:i}function vg(i,o){const l=i.viewQuery;i.viewQuery=l?(f,_)=>{o(f,_),l(f,_)}:o}function xg(i,o){const l=i.contentQueries;i.contentQueries=l?(f,_,x)=>{o(f,_,x),l(f,_,x)}:o}function Bp(i,o){const l=i.hostBindings;i.hostBindings=l?(f,_)=>{o(f,_),l(f,_)}:o}let ed=null;function Vc(){if(!ed){const i=X.Symbol;if(i&&i.iterator)ed=i.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let l=0;l<o.length;++l){const f=o[l];"entries"!==f&&"size"!==f&&Map.prototype[f]===Map.prototype.entries&&(ed=f)}}}return ed}function ah(i){return!!uf(i)&&(Array.isArray(i)||!(i instanceof Map)&&Vc()in i)}function uf(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function gs(i,o,l){return!Object.is(i[o],l)&&(i[o]=l,!0)}function ja(i,o,l,f){const _=Nt();return gs(_,wo(),o)&&(Wn(),Il(ar(),_,i,o,l,f)),ja}function df(i,o,l,f,_,x,T,L){const N=Nt(),Z=Wn(),ne=i+22,pe=Z.firstCreatePass?function Gp(i,o,l,f,_,x,T,L,N){const Z=o.consts,ne=dl(o,i,4,T||null,ko(Z,L));Zh(o,l,ne,ko(Z,N)),Xs(o,ne);const pe=ne.tViews=Pp(2,ne,f,_,x,o.directiveRegistry,o.pipeRegistry,null,o.schemas,Z);return null!==o.queries&&(o.queries.template(o,ne),pe.queries=o.queries.embeddedTView(ne)),ne}(ne,Z,N,o,l,f,_,x,T):Z.data[ne];Qi(pe,!1);const Oe=N[11].createComment("");Bd(Z,N,Oe,pe),fs(Oe,N),tf(N,N[ne]=Lp(Oe,N,Oe,pe)),_o(pe)&&Ap(Z,N,pe),null!=T&&Ip(N,pe,L)}function ch(i){return Vo(function Vl(){return Nn.lFrame.contextLView}(),22+i)}function td(i,o,l){const f=Nt();return gs(f,wo(),o)&&function rs(i,o,l,f,_,x,T,L){const N=Bi(o,l);let ne,Z=o.inputs;!L&&null!=Z&&(ne=Z[f])?(Yh(i,l,ne,f,_),Wr(o)&&hc(l,o.index)):3&o.type&&(f=function F_(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(f),_=null!=T?T(_,o.value||"",f):_,x.setProperty(N,f,_))}(Wn(),ar(),f,i,o,f[11],l,!1),td}function ff(i,o,l,f,_){const T=_?"class":"style";Yh(i,l,o.inputs[T],T,f)}function e(i,o,l,f){const _=Nt(),x=Wn(),T=22+i,L=_[11],N=_[T]=Jf(L,o,function hs(){return Nn.lFrame.currentNamespace}()),Z=x.firstCreatePass?function n(i,o,l,f,_,x,T){const L=o.consts,Z=dl(o,i,2,_,ko(L,x));return Zh(o,l,Z,ko(L,T)),null!==Z.attrs&&yu(Z,Z.attrs,!1),null!==Z.mergedAttrs&&yu(Z,Z.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,Z),Z}(T,x,_,0,o,l,f):x.data[T];Qi(Z,!0);const ne=Z.mergedAttrs;null!==ne&&vl(L,N,ne);const pe=Z.classes;null!==pe&&zd(L,N,pe);const Oe=Z.styles;return null!==Oe&&Fm(L,N,Oe),64!=(64&Z.flags)&&Bd(x,_,N,Z),0===function Ds(){return Nn.lFrame.elementDepthCount}()&&fs(N,_),function gl(){Nn.lFrame.elementDepthCount++}(),_o(Z)&&(Ap(x,_,Z),function lg(i,o,l){if(Ao(o)){const _=o.directiveEnd;for(let x=o.directiveStart;x<_;x++){const T=i.data[x];T.contentQueries&&T.contentQueries(1,l[x],x)}}}(x,Z,_)),null!==f&&Ip(_,Z),e}function r(){let i=Xr();xo()?function us(){Nn.lFrame.isParent=!1}():(i=i.parent,Qi(i,!1));const o=i;!function mr(){Nn.lFrame.elementDepthCount--}();const l=Wn();return l.firstCreatePass&&(Xs(l,i),Ao(i)&&l.queries.elementEnd(i)),null!=o.classesWithoutHost&&function Ys(i){return 0!=(16&i.flags)}(o)&&ff(l,o,Nt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function yc(i){return 0!=(32&i.flags)}(o)&&ff(l,o,Nt(),o.stylesWithoutHost,!1),r}function s(i,o,l,f){return e(i,o,l,f),r(),s}function b(){return Nt()}function w(i){return!!i&&"function"==typeof i.then}function A(i){return!!i&&"function"==typeof i.subscribe}const k=A;function z(i,o,l,f){const _=Nt(),x=Wn(),T=Xr();return function K(i,o,l,f,_,x,T,L){const N=_o(f),ne=i.firstCreatePass&&rf(i),pe=o[8],Oe=nf(o);let Je=!0;if(3&f.type||L){const an=Bi(f,o),wn=L?L(an):an,Fn=Oe.length,$t=L?di=>L(cn(di[f.index])):f.index;let ir=null;if(!L&&N&&(ir=function H(i,o,l,f){const _=i.cleanup;if(null!=_)for(let x=0;x<_.length-1;x+=2){const T=_[x];if(T===l&&_[x+1]===f){const L=o[7],N=_[x+2];return L.length>N?L[N]:null}"string"==typeof T&&(x+=2)}return null}(i,o,_,f.index)),null!==ir)(ir.__ngLastListenerFn__||ir).__ngNextListenerFn__=x,ir.__ngLastListenerFn__=x,Je=!1;else{x=ue(f,o,pe,x,!1);const di=l.listen(wn,_,x);Oe.push(x,di),ne&&ne.push(_,$t,Fn,Fn+1)}}else x=ue(f,o,pe,x,!1);const Mt=f.outputs;let Xt;if(Je&&null!==Mt&&(Xt=Mt[_])){const an=Xt.length;if(an)for(let wn=0;wn<an;wn+=2){const no=o[Xt[wn]][Xt[wn+1]].subscribe(x),sd=Oe.length;Oe.push(x,no),ne&&ne.push(_,f.index,sd,-(sd+1))}}}(x,_,_[11],T,i,o,0,f),z}function ie(i,o,l,f){try{return!1!==l(f)}catch(_){return yg(i,_),!1}}function ue(i,o,l,f,_){return function x(T){if(T===Function)return f;kp(2&i.flags?Ji(i.index,o):o);let N=ie(o,0,f,T),Z=x.__ngNextListenerFn__;for(;Z;)N=ie(o,0,Z,T)&&N,Z=Z.__ngNextListenerFn__;return _&&!1===N&&(T.preventDefault(),T.returnValue=!1),N}}function be(i=1){return function Dr(i){return(Nn.lFrame.contextLView=function dr(i,o){for(;i>0;)o=o[15],i--;return o}(i,Nn.lFrame.contextLView))[8]}(i)}function Qt(i,o,l,f,_){const x=i[l+1],T=null===o;let L=f?ps(x):oc(x),N=!1;for(;0!==L&&(!1===N||T);){const ne=i[L+1];Xn(i[L],o)&&(N=!0,i[L+1]=f?vp(ne):_p(ne)),L=f?ps(ne):oc(ne)}N&&(i[l+1]=f?_p(x):vp(x))}function Xn(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&c(i,o)>=0}function Br(i,o){return function Hr(i,o,l,f){const _=Nt(),x=Wn(),T=function Ei(i){const o=Nn.lFrame,l=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,l}(2);x.firstUpdatePass&&function ji(i,o,l,f){const _=i.data;if(null===_[l+1]){const x=_[nr()],T=function is(i,o){return o>=i.expandoStartIndex}(i,l);(function pf(i,o){return 0!=(i.flags&(o?16:32))})(x,f)&&null===o&&!T&&(o=!1),o=function No(i,o,l,f){const _=function Ya(i){const o=Nn.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let x=f?o.residualClasses:o.residualStyles;if(null===_)0===(f?o.classBindings:o.styleBindings)&&(l=Fl(l=ya(null,i,o,l,f),o.attrs,f),x=null);else{const T=o.directiveStylingLast;if(-1===T||i[T]!==_)if(l=ya(_,i,o,l,f),null===x){let N=function Co(i,o,l){const f=l?o.classBindings:o.styleBindings;if(0!==oc(f))return i[ps(f)]}(i,o,f);void 0!==N&&Array.isArray(N)&&(N=ya(null,i,o,N[1],f),N=Fl(N,o.attrs,f),function ys(i,o,l,f){i[ps(l?o.classBindings:o.styleBindings)]=f}(i,o,f,N))}else x=function Do(i,o,l){let f;const _=o.directiveEnd;for(let x=1+o.directiveStylingLast;x<_;x++)f=Fl(f,i[x].hostAttrs,l);return Fl(f,o.attrs,l)}(i,o,f)}return void 0!==x&&(f?o.residualClasses=x:o.residualStyles=x),l}(_,x,o,f),function Kt(i,o,l,f,_,x){let T=x?o.classBindings:o.styleBindings,L=ps(T),N=oc(T);i[f]=l;let ne,Z=!1;if(Array.isArray(l)){const pe=l;ne=pe[1],(null===ne||c(pe,ne)>0)&&(Z=!0)}else ne=l;if(_)if(0!==N){const Oe=ps(i[L+1]);i[f+1]=Na(Oe,L),0!==Oe&&(i[Oe+1]=yp(i[Oe+1],f)),i[L+1]=function M_(i,o){return 131071&i|o<<17}(i[L+1],f)}else i[f+1]=Na(L,0),0!==L&&(i[L+1]=yp(i[L+1],f)),L=f;else i[f+1]=Na(N,0),0===L?L=f:i[N+1]=yp(i[N+1],f),N=f;Z&&(i[f+1]=_p(i[f+1])),Qt(i,ne,f,!0),Qt(i,ne,f,!1),function dn(i,o,l,f,_){const x=_?i.residualClasses:i.residualStyles;null!=x&&"string"==typeof o&&c(x,o)>=0&&(l[f+1]=vp(l[f+1]))}(o,ne,i,f,x),T=Na(L,N),x?o.classBindings=T:o.styleBindings=T}(_,x,o,l,T,f)}}(x,i,T,f),o!==pr&&gs(_,T,o)&&function Hp(i,o,l,f,_,x,T,L){if(!(3&o.type))return;const N=i.data,Z=N[L+1];rd(function eg(i){return 1==(1&i)}(Z)?Zp(N,o,l,_,oc(Z),T):void 0)||(rd(x)||function gp(i){return 2==(2&i)}(Z)&&(x=Zp(N,null,l,_,L,T)),function g_(i,o,l,f,_){if(o)_?i.addClass(l,f):i.removeClass(l,f);else{let x=-1===f.indexOf("-")?void 0:qi.DashCase;null==_?i.removeStyle(l,f,x):("string"==typeof _&&_.endsWith("!important")&&(_=_.slice(0,-10),x|=qi.Important),i.setStyle(l,f,_,x))}}(f,T,Ca(nr(),l),_,x))}(x,x.data[nr()],_,_[11],i,_[T+1]=function qp(i,o){return null==i||("string"==typeof o?i+=o:"object"==typeof i&&(i=It(Jl(i)))),i}(o,l),f,T)}(i,o,null,!0),Br}function ya(i,o,l,f,_){let x=null;const T=l.directiveEnd;let L=l.directiveStylingLast;for(-1===L?L=l.directiveStart:L++;L<T&&(x=o[L],f=Fl(f,x.hostAttrs,_),x!==i);)L++;return null!==i&&(l.directiveStylingLast=L),f}function Fl(i,o,l){const f=l?1:2;let _=-1;if(null!==o)for(let x=0;x<o.length;x++){const T=o[x];"number"==typeof T?_=T:_===f&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),D(i,T,!!l||o[++x]))}return void 0===i?null:i}function Zp(i,o,l,f,_,x){const T=null===o;let L;for(;_>0;){const N=i[_],Z=Array.isArray(N),ne=Z?N[1]:N,pe=null===ne;let Oe=l[_+1];Oe===pr&&(Oe=pe?Ce:void 0);let Je=pe?O(Oe,f):ne===f?Oe:void 0;if(Z&&!rd(Je)&&(Je=O(N,f)),rd(Je)&&(L=Je,T))return L;const Mt=i[_+1];_=T?ps(Mt):oc(Mt)}if(null!==o){let N=x?o.residualClasses:o.residualStyles;null!=N&&(L=O(N,f))}return L}function rd(i){return void 0!==i}function pl(i,o=""){const l=Nt(),f=Wn(),_=i+22,x=f.firstCreatePass?dl(f,_,1,o,null):f.data[_],T=l[_]=function Kf(i,o){return i.createText(o)}(l[11],o);Bd(f,l,T,x),Qi(x,!1)}function mf(i){return Bl("",i,""),mf}function Bl(i,o,l){const f=Nt(),_=function Gc(i,o,l,f){return gs(i,wo(),l)?o+tt(l)+f:pr}(f,i,o,l);return _!==pr&&function Pl(i,o,l){const f=Ca(o,i);!function Tm(i,o,l){i.setValue(o,l)}(i[11],f,l)}(f,nr(),_),Bl}const id=void 0;var Ux=["en",[["a","p"],["AM","PM"],id],[["AM","PM"],id,id],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],id,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],id,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",id,"{1} 'at' {0}",id],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Vx(i){const l=Math.floor(Math.abs(i)),f=i.toString().replace(/^[^.]*\.?/,"").length;return 1===l&&0===f?1:5}];let vf={};function ty(i){const o=function jx(i){return i.toLowerCase().replace(/_/g,"-")}(i);let l=wv(o);if(l)return l;const f=o.split("-")[0];if(l=wv(f),l)return l;if("en"===f)return Ux;throw new kt(701,!1)}function bv(i){return ty(i)[tr.PluralCase]}function wv(i){return i in vf||(vf[i]=X.ng&&X.ng.common&&X.ng.common.locales&&X.ng.common.locales[i]),vf[i]}var tr=(()=>((tr=tr||{})[tr.LocaleId=0]="LocaleId",tr[tr.DayPeriodsFormat=1]="DayPeriodsFormat",tr[tr.DayPeriodsStandalone=2]="DayPeriodsStandalone",tr[tr.DaysFormat=3]="DaysFormat",tr[tr.DaysStandalone=4]="DaysStandalone",tr[tr.MonthsFormat=5]="MonthsFormat",tr[tr.MonthsStandalone=6]="MonthsStandalone",tr[tr.Eras=7]="Eras",tr[tr.FirstDayOfWeek=8]="FirstDayOfWeek",tr[tr.WeekendRange=9]="WeekendRange",tr[tr.DateFormat=10]="DateFormat",tr[tr.TimeFormat=11]="TimeFormat",tr[tr.DateTimeFormat=12]="DateTimeFormat",tr[tr.NumberSymbols=13]="NumberSymbols",tr[tr.NumberFormats=14]="NumberFormats",tr[tr.CurrencyCode=15]="CurrencyCode",tr[tr.CurrencySymbol=16]="CurrencySymbol",tr[tr.CurrencyName=17]="CurrencyName",tr[tr.Currencies=18]="Currencies",tr[tr.Directionality=19]="Directionality",tr[tr.PluralCase=20]="PluralCase",tr[tr.ExtraData=21]="ExtraData",tr))();const xf="en-US";let Ev=xf;function iy(i,o,l,f,_){if(i=sn(i),Array.isArray(i))for(let x=0;x<i.length;x++)iy(i[x],o,l,f,_);else{const x=Wn(),T=Nt();let L=Rc(i)?i:sn(i.provide),N=ts(i);const Z=Xr(),ne=1048575&Z.providerIndexes,pe=Z.directiveStart,Oe=Z.providerIndexes>>20;if(Rc(i)||!i.multi){const Je=new fr(N,_,Bc),Mt=sy(L,o,_?ne:ne+Oe,pe);-1===Mt?(ha(Di(Z,T),x,L),oy(x,i,o.length),o.push(L),Z.directiveStart++,Z.directiveEnd++,_&&(Z.providerIndexes+=1048576),l.push(Je),T.push(Je)):(l[Mt]=Je,T[Mt]=Je)}else{const Je=sy(L,o,ne+Oe,pe),Mt=sy(L,o,ne,ne+Oe),Xt=Je>=0&&l[Je],an=Mt>=0&&l[Mt];if(_&&!an||!_&&!Xt){ha(Di(Z,T),x,L);const wn=function z1(i,o,l,f,_){const x=new fr(i,l,Bc);return x.multi=[],x.index=o,x.componentProviders=0,Wv(x,_,f&&!l),x}(_?N1:B1,l.length,_,f,N);!_&&an&&(l[Mt].providerFactory=wn),oy(x,i,o.length,0),o.push(L),Z.directiveStart++,Z.directiveEnd++,_&&(Z.providerIndexes+=1048576),l.push(wn),T.push(wn)}else oy(x,i,Je>-1?Je:Mt,Wv(l[_?Mt:Je],N,!_&&f));!_&&f&&an&&l[Mt].componentProviders++}}}function oy(i,o,l,f){const _=Rc(o),x=function dm(i){return!!i.useClass}(o);if(_||x){const N=(x?sn(o.useClass):o).prototype.ngOnDestroy;if(N){const Z=i.destroyHooks||(i.destroyHooks=[]);if(!_&&o.multi){const ne=Z.indexOf(l);-1===ne?Z.push(l,[f,N]):Z[ne+1].push(f,N)}else Z.push(l,N)}}}function Wv(i,o,l){return l&&i.componentProviders++,i.multi.push(o)-1}function sy(i,o,l,f){for(let _=l;_<f;_++)if(o[_]===i)return _;return-1}function B1(i,o,l,f){return ay(this.multi,[])}function N1(i,o,l,f){const _=this.multi;let x;if(this.providerFactory){const T=this.providerFactory.componentProviders,L=Qa(l,l[1],this.providerFactory.index,f);x=L.slice(0,T),ay(_,x);for(let N=T;N<L.length;N++)x.push(L[N])}else x=[],ay(_,x);return x}function ay(i,o){for(let l=0;l<i.length;l++)o.push((0,i[l])());return o}function Xv(i,o=[]){return l=>{l.providersResolver=(f,_)=>function F1(i,o,l){const f=Wn();if(f.firstCreatePass){const _=Yi(i);iy(l,f.data,f.blueprint,_,!0),iy(o,f.data,f.blueprint,_,!1)}}(f,_?_(i):i,o)}}class bf{}class Yv{}function V1(i,o){return new Kv(i,o??null)}class Kv extends bf{constructor(o,l){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Fp(this);const f=Ln(o);this._bootstrapComponents=nc(f.bootstrap),this._r3Injector=ap(o,l,[{provide:bf,useValue:this},{provide:ru,useValue:this.componentFactoryResolver}],It(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ly extends Yv{constructor(o){super(),this.moduleType=o}create(o){return new Kv(this.moduleType,o)}}class U1 extends bf{constructor(o,l,f){super(),this.componentFactoryResolver=new Fp(this),this.instance=null;const _=new Bu([...o,{provide:bf,useValue:this},{provide:ru,useValue:this.componentFactoryResolver}],l||Ch(),f,new Set(["environment"]));this.injector=_,_.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function cy(i,o,l=null){return new U1(i,o,l).injector}let j1=(()=>{class i{constructor(l){this._injector=l,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(l){if(!l.standalone)return null;if(!this.cachedInjectors.has(l.id)){const f=kf(0,l.type),_=f.length>0?cy([f],this._injector,`Standalone[${l.type.name}]`):null;this.cachedInjectors.set(l.id,_)}return this.cachedInjectors.get(l.id)}ngOnDestroy(){try{for(const l of this.cachedInjectors.values())null!==l&&l.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=_r({token:i,providedIn:"environment",factory:()=>new i(De(Lc))}),i})();function Jv(i){i.getStandaloneInjector=o=>o.get(j1).getOrCreateStandaloneInjector(i)}function s0(i,o,l,f){return a0(Nt(),ui(),i,o,l,f)}function a0(i,o,l,f,_,x){const T=o+l;return gs(i,T,_)?function kl(i,o,l){return i[o]=l}(i,T+1,x?f.call(x,_):f(_)):function em(i,o){const l=i[o];return l===pr?void 0:l}(i,T+1)}function d0(i,o){const l=Wn();let f;const _=i+22;l.firstCreatePass?(f=function sb(i,o){if(o)for(let l=o.length-1;l>=0;l--){const f=o[l];if(i===f.name)return f}}(o,l.pipeRegistry),l.data[_]=f,f.onDestroy&&(l.destroyHooks||(l.destroyHooks=[])).push(_,f.onDestroy)):f=l.data[_];const x=f.factory||(f.factory=ss(f.type)),T=pt(Bc);try{const L=ua(!1),N=x();return ua(L),function Mg(i,o,l,f){l>=i.data.length&&(i.data[l]=null,i.blueprint[l]=null),o[l]=f}(l,Nt(),_,N),N}finally{pt(T)}}function f0(i,o,l){const f=i+22,_=Nt(),x=Vo(_,f);return function tm(i,o){return i[1].data[o].pure}(_,f)?a0(_,ui(),o,x.transform,l,x):x.transform(l)}function hy(i){return o=>{setTimeout(i,void 0,o)}}const Hc=class hb extends W.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,l,f){let _=o,x=l||(()=>null),T=f;if(o&&"object"==typeof o){const N=o;_=N.next?.bind(N),x=N.error?.bind(N),T=N.complete?.bind(N)}this.__isAsync&&(x=hy(x),_&&(_=hy(_)),T&&(T=hy(T)));const L=super.subscribe({next:_,error:x,complete:T});return o instanceof I.w0&&o.add(L),L}};function db(){return this._results[Vc()]()}class dy{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const l=Vc(),f=dy.prototype;f[l]||(f[l]=db)}get changes(){return this._changes||(this._changes=new Hc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,l){return this._results.reduce(o,l)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,l){const f=this;f.dirty=!1;const _=qt(o);(this._changesDetected=!function nl(i,o,l){if(i.length!==o.length)return!1;for(let f=0;f<i.length;f++){let _=i[f],x=o[f];if(l&&(_=l(_),x=l(x)),x!==_)return!1}return!0}(f._results,_,l))&&(f._results=_,f.length=_.length,f.last=_[this.length-1],f.first=_[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let nm=(()=>{class i{}return i.__NG_ELEMENT_ID__=mb,i})();const fb=nm,pb=class extends fb{constructor(o,l,f){super(),this._declarationLView=o,this._declarationTContainer=l,this.elementRef=f}createEmbeddedView(o,l){const f=this._declarationTContainer.tViews,_=cc(this._declarationLView,f,o,16,null,f.declTNode,null,null,null,null,l||null);_[17]=this._declarationLView[this._declarationTContainer.index];const T=this._declarationLView[19];return null!==T&&(_[19]=T.createEmbeddedView(f)),Yd(f,_,o),new Kh(_)}};function mb(){return Og(Xr(),Nt())}function Og(i,o){return 4&i.type?new pb(o,i,Fa(i,o)):null}let Fg=(()=>{class i{}return i.__NG_ELEMENT_ID__=gb,i})();function gb(){return g0(Xr(),Nt())}const _b=Fg,p0=class extends _b{constructor(o,l,f){super(),this._lContainer=o,this._hostTNode=l,this._hostLView=f}get element(){return Fa(this._hostTNode,this._hostLView)}get injector(){return new Is(this._hostTNode,this._hostLView)}get parentInjector(){const o=Ia(this._hostTNode,this._hostLView);if(Ka(o)){const l=Ks(o,this._hostLView),f=Ss(o);return new Is(l[1].data[f+8],l)}return new Is(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const l=m0(this._lContainer);return null!==l&&l[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,l,f){let _,x;"number"==typeof f?_=f:null!=f&&(_=f.index,x=f.injector);const T=o.createEmbeddedView(l||{},x);return this.insert(T,_),T}createComponent(o,l,f,_,x){const T=o&&!function ka(i){return"function"==typeof i}(o);let L;if(T)L=l;else{const pe=l||{};L=pe.index,f=pe.injector,_=pe.projectableNodes,x=pe.environmentInjector||pe.ngModuleRef}const N=T?o:new Qh(ge(o)),Z=f||this.parentInjector;if(!x&&null==N.ngModule){const Oe=(T?Z:this.parentInjector).get(Lc,null);Oe&&(x=Oe)}const ne=N.create(Z,_,void 0,x);return this.insert(ne.hostView,L),ne}insert(o,l){const f=o._lView,_=f[1];if(function Uo(i){return vi(i[3])}(f)){const ne=this.indexOf(o);if(-1!==ne)this.detach(ne);else{const pe=f[3],Oe=new p0(pe,pe[6],pe[3]);Oe.detach(Oe.indexOf(o))}}const x=this._adjustIndex(l),T=this._lContainer;!function Wi(i,o,l,f){const _=10+f,x=l.length;f>0&&(l[_-1][4]=o),f<x-10?(o[4]=l[_],Iu(l,10+f,o)):(l.push(o),o[4]=null),o[3]=l;const T=o[17];null!==T&&l!==T&&function Id(i,o){const l=i[9];o[16]!==o[3][3][16]&&(i[2]=!0),null===l?i[9]=[o]:l.push(o)}(T,o);const L=o[19];null!==L&&L.insertView(i),o[2]|=64}(_,f,T,x);const L=np(x,T),N=f[11],Z=kd(N,T[7]);return null!==Z&&function f_(i,o,l,f,_,x){f[0]=_,f[6]=o,Fh(i,f,l,1,_,x)}(_,T[6],N,f,Z,L),o.attachToViewContainerRef(),Iu(fy(T),x,o),o}move(o,l){return this.insert(o,l)}indexOf(o){const l=m0(this._lContainer);return null!==l?l.indexOf(o):-1}remove(o){const l=this._adjustIndex(o,-1),f=Hu(this._lContainer,l);f&&(Xl(fy(this._lContainer),l),Oh(f[1],f))}detach(o){const l=this._adjustIndex(o,-1),f=Hu(this._lContainer,l);return f&&null!=Xl(fy(this._lContainer),l)?new Kh(f):null}_adjustIndex(o,l=0){return o??this.length+l}};function m0(i){return i[8]}function fy(i){return i[8]||(i[8]=[])}function g0(i,o){let l;const f=o[i.index];if(vi(f))l=f;else{let _;if(8&i.type)_=cn(f);else{const x=o[11];_=x.createComment("");const T=Bi(i,o);ic(x,kd(x,T),_,function tp(i,o){return i.nextSibling(o)}(x,T),!1)}o[i.index]=l=Lp(f,o,_,i),tf(o,l)}return new p0(l,i,o)}class py{constructor(o){this.queryList=o,this.matches=null}clone(){return new py(this.queryList)}setDirty(){this.queryList.setDirty()}}class my{constructor(o=[]){this.queries=o}createEmbeddedView(o){const l=o.queries;if(null!==l){const f=null!==o.contentQueries?o.contentQueries[0]:l.length,_=[];for(let x=0;x<f;x++){const T=l.getByIndex(x);_.push(this.queries[T.indexInDeclarationView].clone())}return new my(_)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let l=0;l<this.queries.length;l++)null!==D0(o,l).matches&&this.queries[l].setDirty()}}class _0{constructor(o,l,f=null){this.predicate=o,this.flags=l,this.read=f}}class gy{constructor(o=[]){this.queries=o}elementStart(o,l){for(let f=0;f<this.queries.length;f++)this.queries[f].elementStart(o,l)}elementEnd(o){for(let l=0;l<this.queries.length;l++)this.queries[l].elementEnd(o)}embeddedTView(o){let l=null;for(let f=0;f<this.length;f++){const _=null!==l?l.length:0,x=this.getByIndex(f).embeddedTView(o,_);x&&(x.indexInDeclarationView=f,null!==l?l.push(x):l=[x])}return null!==l?new gy(l):null}template(o,l){for(let f=0;f<this.queries.length;f++)this.queries[f].template(o,l)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class _y{constructor(o,l=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=l}elementStart(o,l){this.isApplyingToNode(l)&&this.matchTNode(o,l)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,l){this.elementStart(o,l)}embeddedTView(o,l){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,l),new _y(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const l=this._declarationNodeIndex;let f=o.parent;for(;null!==f&&8&f.type&&f.index!==l;)f=f.parent;return l===(null!==f?f.index:-1)}return this._appliesToNextNode}matchTNode(o,l){const f=this.metadata.predicate;if(Array.isArray(f))for(let _=0;_<f.length;_++){const x=f[_];this.matchTNodeWithReadOption(o,l,xb(l,x)),this.matchTNodeWithReadOption(o,l,da(l,o,x,!1,!1))}else f===nm?4&l.type&&this.matchTNodeWithReadOption(o,l,-1):this.matchTNodeWithReadOption(o,l,da(l,o,f,!1,!1))}matchTNodeWithReadOption(o,l,f){if(null!==f){const _=this.metadata.read;if(null!==_)if(_===Nu||_===Fg||_===nm&&4&l.type)this.addMatch(l.index,-2);else{const x=da(l,o,_,!1,!1);null!==x&&this.addMatch(l.index,x)}else this.addMatch(l.index,f)}}addMatch(o,l){null===this.matches?this.matches=[o,l]:this.matches.push(o,l)}}function xb(i,o){const l=i.localNames;if(null!==l)for(let f=0;f<l.length;f+=2)if(l[f]===o)return l[f+1];return null}function wb(i,o,l,f){return-1===l?function bb(i,o){return 11&i.type?Fa(i,o):4&i.type?Og(i,o):null}(o,i):-2===l?function Eb(i,o,l){return l===Nu?Fa(o,i):l===nm?Og(o,i):l===Fg?g0(o,i):void 0}(i,o,f):Qa(i,i[1],l,o)}function y0(i,o,l,f){const _=o[19].queries[f];if(null===_.matches){const x=i.data,T=l.matches,L=[];for(let N=0;N<T.length;N+=2){const Z=T[N];L.push(Z<0?null:wb(o,x[Z],T[N+1],l.metadata.read))}_.matches=L}return _.matches}function yy(i,o,l,f){const _=i.queries.getByIndex(l),x=_.matches;if(null!==x){const T=y0(i,o,_,l);for(let L=0;L<x.length;L+=2){const N=x[L];if(N>0)f.push(T[L/2]);else{const Z=x[L+1],ne=o[-N];for(let pe=10;pe<ne.length;pe++){const Oe=ne[pe];Oe[17]===Oe[3]&&yy(Oe[1],Oe,Z,f)}if(null!==ne[9]){const pe=ne[9];for(let Oe=0;Oe<pe.length;Oe++){const Je=pe[Oe];yy(Je[1],Je,Z,f)}}}}}return f}function v0(i){const o=Nt(),l=Wn(),f=B();J(f+1);const _=D0(l,f);if(i.dirty&&function ca(i){return 4==(4&i[2])}(o)===(2==(2&_.metadata.flags))){if(null===_.matches)i.reset([]);else{const x=_.crossesNgTemplate?yy(l,o,f,[]):y0(l,o,_,f);i.reset(x,pm),i.notifyOnChanges()}return!0}return!1}function x0(i,o,l){const f=Wn();f.firstCreatePass&&(C0(f,new _0(i,o,l),-1),2==(2&o)&&(f.staticViewQueries=!0)),E0(f,Nt(),o)}function b0(i,o,l,f){const _=Wn();if(_.firstCreatePass){const x=Xr();C0(_,new _0(o,l,f),x.index),function Db(i,o){const l=i.contentQueries||(i.contentQueries=[]);o!==(l.length?l[l.length-1]:-1)&&l.push(i.queries.length-1,o)}(_,i),2==(2&l)&&(_.staticContentQueries=!0)}E0(_,Nt(),l)}function w0(){return function Cb(i,o){return i[19].queries[o].queryList}(Nt(),B())}function E0(i,o,l){const f=new dy(4==(4&l));ug(i,o,f,f.destroy),null===o[19]&&(o[19]=new my),o[19].queries.push(new py(f))}function C0(i,o,l){null===i.queries&&(i.queries=new gy),i.queries.track(new _y(o,l))}function D0(i,o){return i.queries.getByIndex(o)}function T0(i,o){return Og(i,o)}function Ng(...i){}const H0=new jr("Application Initializer");let zg=(()=>{class i{constructor(l){this.appInits=l,this.resolve=Ng,this.reject=Ng,this.initialized=!1,this.done=!1,this.donePromise=new Promise((f,_)=>{this.resolve=f,this.reject=_})}runInitializers(){if(this.initialized)return;const l=[],f=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let _=0;_<this.appInits.length;_++){const x=this.appInits[_]();if(w(x))l.push(x);else if(k(x)){const T=new Promise((L,N)=>{x.subscribe({complete:L,error:N})});l.push(T)}}Promise.all(l).then(()=>{f()}).catch(_=>{this.reject(_)}),0===l.length&&f(),this.initialized=!0}}return i.\u0275fac=function(l){return new(l||i)(De(H0,8))},i.\u0275prov=_r({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Z0=new jr("AppId",{providedIn:"root",factory:function q0(){return`${Ey()}${Ey()}${Ey()}`}});function Ey(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const W0=new jr("Platform Initializer"),Hb=new jr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),X0=new jr("appBootstrapListener");let Zb=(()=>{class i{log(l){console.log(l)}warn(l){console.warn(l)}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=_r({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Vg=new jr("LocaleId",{providedIn:"root",factory:()=>ze(Vg,ve.Optional|ve.SkipSelf)||function qb(){return typeof $localize<"u"&&$localize.locale||xf}()}),Wb=new jr("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class Xb{constructor(o,l){this.ngModuleFactory=o,this.componentFactories=l}}let Yb=(()=>{class i{compileModuleSync(l){return new ly(l)}compileModuleAsync(l){return Promise.resolve(this.compileModuleSync(l))}compileModuleAndAllComponentsSync(l){const f=this.compileModuleSync(l),x=nc(Ln(l).declarations).reduce((T,L)=>{const N=ge(L);return N&&T.push(new Qh(N)),T},[]);return new Xb(f,x)}compileModuleAndAllComponentsAsync(l){return Promise.resolve(this.compileModuleAndAllComponentsSync(l))}clearCache(){}clearCacheFor(l){}getModuleId(l){}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=_r({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Qb=(()=>Promise.resolve(0))();function Cy(i){typeof Zone>"u"?Qb.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Nl{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:f=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Hc(!1),this.onMicrotaskEmpty=new Hc(!1),this.onStable=new Hc(!1),this.onError=new Hc(!1),typeof Zone>"u")throw new kt(908,!1);Zone.assertZonePatched();const _=this;if(_._nesting=0,_._outer=_._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const x=Zone.AsyncStackTaggingZoneSpec;_._inner=_._inner.fork(new x("Angular"))}Zone.TaskTrackingZoneSpec&&(_._inner=_._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(_._inner=_._inner.fork(Zone.longStackTraceZoneSpec)),_.shouldCoalesceEventChangeDetection=!f&&l,_.shouldCoalesceRunChangeDetection=f,_.lastRequestAnimationFrameId=-1,_.nativeRequestAnimationFrame=function ew(){let i=X.requestAnimationFrame,o=X.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const l=i[Zone.__symbol__("OriginalDelegate")];l&&(i=l);const f=o[Zone.__symbol__("OriginalDelegate")];f&&(o=f)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function rw(i){const o=()=>{!function nw(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(X,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Ty(i),i.isCheckStableRunning=!0,Dy(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Ty(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,f,_,x,T,L)=>{try{return J0(i),l.invokeTask(_,x,T,L)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===x.type||i.shouldCoalesceRunChangeDetection)&&o(),Q0(i)}},onInvoke:(l,f,_,x,T,L,N)=>{try{return J0(i),l.invoke(_,x,T,L,N)}finally{i.shouldCoalesceRunChangeDetection&&o(),Q0(i)}},onHasTask:(l,f,_,x)=>{l.hasTask(_,x),f===_&&("microTask"==x.change?(i._hasPendingMicrotasks=x.microTask,Ty(i),Dy(i)):"macroTask"==x.change&&(i.hasPendingMacrotasks=x.macroTask))},onHandleError:(l,f,_,x)=>(l.handleError(_,x),i.runOutsideAngular(()=>i.onError.emit(x)),!1)})}(_)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Nl.isInAngularZone())throw new kt(909,!1)}static assertNotInAngularZone(){if(Nl.isInAngularZone())throw new kt(909,!1)}run(o,l,f){return this._inner.run(o,l,f)}runTask(o,l,f,_){const x=this._inner,T=x.scheduleEventTask("NgZoneEvent: "+_,o,tw,Ng,Ng);try{return x.runTask(T,l,f)}finally{x.cancelTask(T)}}runGuarded(o,l,f){return this._inner.runGuarded(o,l,f)}runOutsideAngular(o){return this._outer.run(o)}}const tw={};function Dy(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Ty(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function J0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function Q0(i){i._nesting--,Dy(i)}class iw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Hc,this.onMicrotaskEmpty=new Hc,this.onStable=new Hc,this.onError=new Hc}run(o,l,f){return o.apply(l,f)}runGuarded(o,l,f){return o.apply(l,f)}runOutsideAngular(o){return o()}runTask(o,l,f,_){return o.apply(l,f)}}const ex=new jr(""),tx=new jr("");let My,ow=(()=>{class i{constructor(l,f,_){this._ngZone=l,this.registry=f,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,My||(function sw(i){My=i}(_),_.addToWindow(f)),this._watchAngularEvents(),l.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Nl.assertNotInAngularZone(),Cy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Cy(()=>{for(;0!==this._callbacks.length;){let l=this._callbacks.pop();clearTimeout(l.timeoutId),l.doneCb(this._didWork)}this._didWork=!1});else{let l=this.getPendingTasks();this._callbacks=this._callbacks.filter(f=>!f.updateCb||!f.updateCb(l)||(clearTimeout(f.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(l=>({source:l.source,creationLocation:l.creationLocation,data:l.data})):[]}addCallback(l,f,_){let x=-1;f&&f>0&&(x=setTimeout(()=>{this._callbacks=this._callbacks.filter(T=>T.timeoutId!==x),l(this._didWork,this.getPendingTasks())},f)),this._callbacks.push({doneCb:l,timeoutId:x,updateCb:_})}whenStable(l,f,_){if(_&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(l,f,_),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(l){this.registry.registerApplication(l,this)}unregisterApplication(l){this.registry.unregisterApplication(l)}findProviders(l,f,_){return[]}}return i.\u0275fac=function(l){return new(l||i)(De(Nl),De(nx),De(tx))},i.\u0275prov=_r({token:i,factory:i.\u0275fac}),i})(),nx=(()=>{class i{constructor(){this._applications=new Map}registerApplication(l,f){this._applications.set(l,f)}unregisterApplication(l){this._applications.delete(l)}unregisterAllApplications(){this._applications.clear()}getTestability(l){return this._applications.get(l)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(l,f=!0){return My?.findTestabilityInTree(this,l,f)??null}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=_r({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})(),dh=null;const rx=new jr("AllowMultipleToken"),Sy=new jr("PlatformDestroyListeners");class cw{constructor(o,l){this.name=o,this.token=l}}function ox(i,o,l=[]){const f=`Platform: ${o}`,_=new jr(f);return(x=[])=>{let T=Ay();if(!T||T.injector.get(rx,!1)){const L=[...l,...x,{provide:_,useValue:!0}];i?i(L):function uw(i){if(dh&&!dh.get(rx,!1))throw new kt(400,!1);dh=i;const o=i.get(ax);(function ix(i){const o=i.get(W0,null);o&&o.forEach(l=>l())})(i)}(function sx(i=[],o){return fu.create({name:o,providers:[{provide:vd,useValue:"platform"},{provide:Sy,useValue:new Set([()=>dh=null])},...i]})}(L,f))}return function dw(i){const o=Ay();if(!o)throw new kt(401,!1);return o}()}}function Ay(){return dh?.get(ax)??null}let ax=(()=>{class i{constructor(l){this._injector=l,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(l,f){const _=function cx(i,o){let l;return l="noop"===i?new iw:("zone.js"===i?void 0:i)||new Nl(o),l}(f?.ngZone,function lx(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(f)),x=[{provide:Nl,useValue:_}];return _.run(()=>{const T=fu.create({providers:x,parent:this.injector,name:l.moduleType.name}),L=l.create(T),N=L.injector.get(to,null);if(!N)throw new kt(402,!1);return _.runOutsideAngular(()=>{const Z=_.onError.subscribe({next:ne=>{N.handleError(ne)}});L.onDestroy(()=>{jg(this._modules,L),Z.unsubscribe()})}),function ux(i,o,l){try{const f=l();return w(f)?f.catch(_=>{throw o.runOutsideAngular(()=>i.handleError(_)),_}):f}catch(f){throw o.runOutsideAngular(()=>i.handleError(f)),f}}(N,_,()=>{const Z=L.injector.get(zg);return Z.runInitializers(),Z.donePromise.then(()=>(function Cv(i){ln(i,"Expected localeId to be defined"),"string"==typeof i&&(Ev=i.toLowerCase().replace(/_/g,"-"))}(L.injector.get(Vg,xf)||xf),this._moduleDoBootstrap(L),L))})})}bootstrapModule(l,f=[]){const _=hx({},f);return function aw(i,o,l){const f=new ly(l);return Promise.resolve(f)}(0,0,l).then(x=>this.bootstrapModuleFactory(x,_))}_moduleDoBootstrap(l){const f=l.injector.get(Ug);if(l._bootstrapComponents.length>0)l._bootstrapComponents.forEach(_=>f.bootstrap(_));else{if(!l.instance.ngDoBootstrap)throw new kt(403,!1);l.instance.ngDoBootstrap(f)}this._modules.push(l)}onDestroy(l){this._destroyListeners.push(l)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new kt(404,!1);this._modules.slice().forEach(f=>f.destroy()),this._destroyListeners.forEach(f=>f());const l=this._injector.get(Sy,null);l&&(l.forEach(f=>f()),l.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(l){return new(l||i)(De(fu))},i.\u0275prov=_r({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function hx(i,o){return Array.isArray(o)?o.reduce(hx,i):{...i,...o}}let Ug=(()=>{class i{constructor(l,f,_){this._zone=l,this._injector=f,this._exceptionHandler=_,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const x=new nt.y(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),T=new nt.y(L=>{let N;this._zone.runOutsideAngular(()=>{N=this._zone.onStable.subscribe(()=>{Nl.assertNotInAngularZone(),Cy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const Z=this._zone.onUnstable.subscribe(()=>{Nl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{N.unsubscribe(),Z.unsubscribe()}});this.isStable=function gt(...i){const o=(0,Vt.yG)(i),l=(0,Vt._6)(i,1/0),f=i;return f.length?1===f.length?(0,Te.Xf)(f[0]):(0,u.J)(l)((0,Tt.D)(f,o)):Yt.E}(x,T.pipe(function Ht(i={}){const{connector:o=(()=>new W.x),resetOnError:l=!0,resetOnComplete:f=!0,resetOnRefCountZero:_=!0}=i;return x=>{let T,L,N,Z=0,ne=!1,pe=!1;const Oe=()=>{L?.unsubscribe(),L=void 0},Je=()=>{Oe(),T=N=void 0,ne=pe=!1},Mt=()=>{const Xt=T;Je(),Xt?.unsubscribe()};return(0,dt.e)((Xt,an)=>{Z++,!pe&&!ne&&Oe();const wn=N=N??o();an.add(()=>{Z--,0===Z&&!pe&&!ne&&(L=Cn(Mt,_))}),wn.subscribe(an),!T&&Z>0&&(T=new vt.Hp({next:Fn=>wn.next(Fn),error:Fn=>{pe=!0,Oe(),L=Cn(Je,l,Fn),wn.error(Fn)},complete:()=>{ne=!0,Oe(),L=Cn(Je,f),wn.complete()}}),(0,Te.Xf)(Xt).subscribe(T))})(x)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(l,f){const _=l instanceof _a;if(!this._injector.get(zg).done)throw!_&&En(l),new kt(405,false);let T;T=_?l:this._injector.get(ru).resolveComponentFactory(l),this.componentTypes.push(T.componentType);const L=function lw(i){return i.isBoundToModule}(T)?void 0:this._injector.get(bf),Z=T.create(fu.NULL,[],f||T.selector,L),ne=Z.location.nativeElement,pe=Z.injector.get(ex,null);return pe?.registerApplication(ne),Z.onDestroy(()=>{this.detachView(Z.hostView),jg(this.components,Z),pe?.unregisterApplication(ne)}),this._loadComponent(Z),Z}tick(){if(this._runningTick)throw new kt(101,!1);try{this._runningTick=!0;for(let l of this._views)l.detectChanges()}catch(l){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(l))}finally{this._runningTick=!1}}attachView(l){const f=l;this._views.push(f),f.attachToAppRef(this)}detachView(l){const f=l;jg(this._views,f),f.detachFromAppRef()}_loadComponent(l){this.attachView(l.hostView),this.tick(),this.components.push(l),this._injector.get(X0,[]).concat(this._bootstrapListeners).forEach(_=>_(l))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(l=>l()),this._views.slice().forEach(l=>l.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(l){return this._destroyListeners.push(l),()=>jg(this._destroyListeners,l)}destroy(){if(this._destroyed)throw new kt(406,!1);const l=this._injector;l.destroy&&!l.destroyed&&l.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(l){return new(l||i)(De(Nl),De(Lc),De(to))},i.\u0275prov=_r({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function jg(i,o){const l=i.indexOf(o);l>-1&&i.splice(l,1)}let fx=!0;function pw(){fx=!1}let mw=(()=>{class i{}return i.__NG_ELEMENT_ID__=gw,i})();function gw(i){return function _w(i,o,l){if(Wr(i)&&!l){const f=Ji(i.index,o);return new Kh(f,f)}return 47&i.type?new Kh(o[16],o):null}(Xr(),Nt(),16==(16&i))}class yx{constructor(){}supports(o){return ah(o)}create(o){return new Ew(o)}}const ww=(i,o)=>o;class Ew{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||ww}forEachItem(o){let l;for(l=this._itHead;null!==l;l=l._next)o(l)}forEachOperation(o){let l=this._itHead,f=this._removalsHead,_=0,x=null;for(;l||f;){const T=!f||l&&l.currentIndex<xx(f,_,x)?l:f,L=xx(T,_,x),N=T.currentIndex;if(T===f)_--,f=f._nextRemoved;else if(l=l._next,null==T.previousIndex)_++;else{x||(x=[]);const Z=L-_,ne=N-_;if(Z!=ne){for(let Oe=0;Oe<Z;Oe++){const Je=Oe<x.length?x[Oe]:x[Oe]=0,Mt=Je+Oe;ne<=Mt&&Mt<Z&&(x[Oe]=Je+1)}x[T.previousIndex]=ne-Z}}L!==N&&o(T,L,N)}}forEachPreviousItem(o){let l;for(l=this._previousItHead;null!==l;l=l._nextPrevious)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachMovedItem(o){let l;for(l=this._movesHead;null!==l;l=l._nextMoved)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}forEachIdentityChange(o){let l;for(l=this._identityChangesHead;null!==l;l=l._nextIdentityChange)o(l)}diff(o){if(null==o&&(o=[]),!ah(o))throw new kt(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let _,x,T,l=this._itHead,f=!1;if(Array.isArray(o)){this.length=o.length;for(let L=0;L<this.length;L++)x=o[L],T=this._trackByFn(L,x),null!==l&&Object.is(l.trackById,T)?(f&&(l=this._verifyReinsertion(l,x,T,L)),Object.is(l.item,x)||this._addIdentityChange(l,x)):(l=this._mismatch(l,x,T,L),f=!0),l=l._next}else _=0,function Uc(i,o){if(Array.isArray(i))for(let l=0;l<i.length;l++)o(i[l]);else{const l=i[Vc()]();let f;for(;!(f=l.next()).done;)o(f.value)}}(o,L=>{T=this._trackByFn(_,L),null!==l&&Object.is(l.trackById,T)?(f&&(l=this._verifyReinsertion(l,L,T,_)),Object.is(l.item,L)||this._addIdentityChange(l,L)):(l=this._mismatch(l,L,T,_),f=!0),l=l._next,_++}),this.length=_;return this._truncate(l),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,l,f,_){let x;return null===o?x=this._itTail:(x=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._reinsertAfter(o,x,_)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(f,_))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._moveAfter(o,x,_)):o=this._addAfter(new Cw(l,f),x,_),o}_verifyReinsertion(o,l,f,_){let x=null===this._unlinkedRecords?null:this._unlinkedRecords.get(f,null);return null!==x?o=this._reinsertAfter(x,o._prev,_):o.currentIndex!=_&&(o.currentIndex=_,this._addToMoves(o,_)),o}_truncate(o){for(;null!==o;){const l=o._next;this._addToRemovals(this._unlink(o)),o=l}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,l,f){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const _=o._prevRemoved,x=o._nextRemoved;return null===_?this._removalsHead=x:_._nextRemoved=x,null===x?this._removalsTail=_:x._prevRemoved=_,this._insertAfter(o,l,f),this._addToMoves(o,f),o}_moveAfter(o,l,f){return this._unlink(o),this._insertAfter(o,l,f),this._addToMoves(o,f),o}_addAfter(o,l,f){return this._insertAfter(o,l,f),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,l,f){const _=null===l?this._itHead:l._next;return o._next=_,o._prev=l,null===_?this._itTail=o:_._prev=o,null===l?this._itHead=o:l._next=o,null===this._linkedRecords&&(this._linkedRecords=new vx),this._linkedRecords.put(o),o.currentIndex=f,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const l=o._prev,f=o._next;return null===l?this._itHead=f:l._next=f,null===f?this._itTail=l:f._prev=l,o}_addToMoves(o,l){return o.previousIndex===l||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new vx),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,l){return o.item=l,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Cw{constructor(o,l){this.item=o,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Dw{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,l){let f;for(f=this._head;null!==f;f=f._nextDup)if((null===l||l<=f.currentIndex)&&Object.is(f.trackById,o))return f;return null}remove(o){const l=o._prevDup,f=o._nextDup;return null===l?this._head=f:l._nextDup=f,null===f?this._tail=l:f._prevDup=l,null===this._head}}class vx{constructor(){this.map=new Map}put(o){const l=o.trackById;let f=this.map.get(l);f||(f=new Dw,this.map.set(l,f)),f.add(o)}get(o,l){const _=this.map.get(o);return _?_.get(o,l):null}remove(o){const l=o.trackById;return this.map.get(l).remove(o)&&this.map.delete(l),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function xx(i,o,l){const f=i.previousIndex;if(null===f)return f;let _=0;return l&&f<l.length&&(_=l[f]),f+o+_}class bx{constructor(){}supports(o){return o instanceof Map||uf(o)}create(){return new Tw}}class Tw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let l;for(l=this._mapHead;null!==l;l=l._next)o(l)}forEachPreviousItem(o){let l;for(l=this._previousMapHead;null!==l;l=l._nextPrevious)o(l)}forEachChangedItem(o){let l;for(l=this._changesHead;null!==l;l=l._nextChanged)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}diff(o){if(o){if(!(o instanceof Map||uf(o)))throw new kt(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(o,(f,_)=>{if(l&&l.key===_)this._maybeAddToChanges(l,f),this._appendAfter=l,l=l._next;else{const x=this._getOrCreateRecordForKey(_,f);l=this._insertBeforeOrAppend(l,x)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let f=l;null!==f;f=f._nextRemoved)f===this._mapHead&&(this._mapHead=null),this._records.delete(f.key),f._nextRemoved=f._next,f.previousValue=f.currentValue,f.currentValue=null,f._prev=null,f._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,l){if(o){const f=o._prev;return l._next=o,l._prev=f,o._prev=l,f&&(f._next=l),o===this._mapHead&&(this._mapHead=l),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(o,l){if(this._records.has(o)){const _=this._records.get(o);this._maybeAddToChanges(_,l);const x=_._prev,T=_._next;return x&&(x._next=T),T&&(T._prev=x),_._next=null,_._prev=null,_}const f=new Mw(o);return this._records.set(o,f),f.currentValue=l,this._addToAdditions(f),f}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,l){Object.is(l,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=l,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,l){o instanceof Map?o.forEach(l):Object.keys(o).forEach(f=>l(o[f],f))}}class Mw{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function wx(){return new ky([new yx])}let ky=(()=>{class i{constructor(l){this.factories=l}static create(l,f){if(null!=f){const _=f.factories.slice();l=l.concat(_)}return new i(l)}static extend(l){return{provide:i,useFactory:f=>i.create(l,f||wx()),deps:[[i,new ut,new Lt]]}}find(l){const f=this.factories.find(_=>_.supports(l));if(null!=f)return f;throw new kt(901,!1)}}return i.\u0275prov=_r({token:i,providedIn:"root",factory:wx}),i})();function Ex(){return new Oy([new bx])}let Oy=(()=>{class i{constructor(l){this.factories=l}static create(l,f){if(f){const _=f.factories.slice();l=l.concat(_)}return new i(l)}static extend(l){return{provide:i,useFactory:f=>i.create(l,f||Ex()),deps:[[i,new ut,new Lt]]}}find(l){const f=this.factories.find(_=>_.supports(l));if(f)return f;throw new kt(901,!1)}}return i.\u0275prov=_r({token:i,providedIn:"root",factory:Ex}),i})();const Iw=ox(null,"core",[]);let Pw=(()=>{class i{constructor(l){}}return i.\u0275fac=function(l){return new(l||i)(De(Ug))},i.\u0275mod=Bn({type:i}),i.\u0275inj=fi({}),i})();function Rw(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},1481:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{Dx:()=>Et,b2:()=>zr,q6:()=>Nr});var W=ye(6895),I=ye(8256);class nt extends W.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends nt{static makeCurrent(){(0,W.HT)(new u)}onAndCancel(ke,ge,Ue){return ke.addEventListener(ge,Ue,!1),()=>{ke.removeEventListener(ge,Ue,!1)}}dispatchEvent(ke,ge){ke.dispatchEvent(ge)}remove(ke){ke.parentNode&&ke.parentNode.removeChild(ke)}createElement(ke,ge){return(ge=ge||this.getDefaultDocument()).createElement(ke)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ke){return ke.nodeType===Node.ELEMENT_NODE}isShadowRoot(ke){return ke instanceof DocumentFragment}getGlobalEventTarget(ke,ge){return"window"===ge?window:"document"===ge?ke:"body"===ge?ke.body:null}getBaseHref(ke){const ge=function Yt(){return Te=Te||document.querySelector("base"),Te?Te.getAttribute("href"):null}();return null==ge?null:function Tt(je){Vt=Vt||document.createElement("a"),Vt.setAttribute("href",je);const ke=Vt.pathname;return"/"===ke.charAt(0)?ke:`/${ke}`}(ge)}resetBaseElement(){Te=null}getUserAgent(){return window.navigator.userAgent}getCookie(ke){return(0,W.Mx)(document.cookie,ke)}}let Vt,Te=null;const gt=new I.OlP("TRANSITION_ID"),dt=[{provide:I.ip1,useFactory:function vt(je,ke,ge){return()=>{ge.get(I.CZH).donePromise.then(()=>{const Ue=(0,W.q)(),at=ke.querySelectorAll(`style[ng-transition="${je}"]`);for(let En=0;En<at.length;En++)Ue.remove(at[En])})}},deps:[gt,W.K0,I.zs3],multi:!0}];let Cn=(()=>{class je{build(){return new XMLHttpRequest}}return je.\u0275fac=function(ge){return new(ge||je)},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})();const bt=new I.OlP("EventManagerPlugins");let nn=(()=>{class je{constructor(ge,Ue){this._zone=Ue,this._eventNameToPlugin=new Map,ge.forEach(at=>at.manager=this),this._plugins=ge.slice().reverse()}addEventListener(ge,Ue,at){return this._findPluginFor(Ue).addEventListener(ge,Ue,at)}addGlobalEventListener(ge,Ue,at){return this._findPluginFor(Ue).addGlobalEventListener(ge,Ue,at)}getZone(){return this._zone}_findPluginFor(ge){const Ue=this._eventNameToPlugin.get(ge);if(Ue)return Ue;const at=this._plugins;for(let En=0;En<at.length;En++){const Ln=at[En];if(Ln.supports(ge))return this._eventNameToPlugin.set(ge,Ln),Ln}throw new Error(`No event manager plugin found for event ${ge}`)}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(bt),I.LFG(I.R0b))},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})();class It{constructor(ke){this._doc=ke}addGlobalEventListener(ke,ge,Ue){const at=(0,W.q)().getGlobalEventTarget(this._doc,ke);if(!at)throw new Error(`Unsupported event target ${at} for event ${ge}`);return this.addEventListener(at,ge,Ue)}}let pn=(()=>{class je{constructor(){this._stylesSet=new Set}addStyles(ge){const Ue=new Set;ge.forEach(at=>{this._stylesSet.has(at)||(this._stylesSet.add(at),Ue.add(at))}),this.onStylesAdded(Ue)}onStylesAdded(ge){}getAllStyles(){return Array.from(this._stylesSet)}}return je.\u0275fac=function(ge){return new(ge||je)},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})(),on=(()=>{class je extends pn{constructor(ge){super(),this._doc=ge,this._hostNodes=new Map,this._hostNodes.set(ge.head,[])}_addStylesToHost(ge,Ue,at){ge.forEach(En=>{const Ln=this._doc.createElement("style");Ln.textContent=En,at.push(Ue.appendChild(Ln))})}addHost(ge){const Ue=[];this._addStylesToHost(this._stylesSet,ge,Ue),this._hostNodes.set(ge,Ue)}removeHost(ge){const Ue=this._hostNodes.get(ge);Ue&&Ue.forEach(or),this._hostNodes.delete(ge)}onStylesAdded(ge){this._hostNodes.forEach((Ue,at)=>{this._addStylesToHost(ge,at,Ue)})}ngOnDestroy(){this._hostNodes.forEach(ge=>ge.forEach(or))}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(W.K0))},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})();function or(je){(0,W.q)().remove(je)}const sn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},tn=/%COMP%/g;function Xe(je,ke,ge){for(let Ue=0;Ue<ke.length;Ue++){let at=ke[Ue];Array.isArray(at)?Xe(je,at,ge):(at=at.replace(tn,je),ge.push(at))}return ge}function He(je){return ke=>{if("__ngUnwrap__"===ke)return je;!1===je(ke)&&(ke.preventDefault(),ke.returnValue=!1)}}let Be=(()=>{class je{constructor(ge,Ue,at){this.eventManager=ge,this.sharedStylesHost=Ue,this.appId=at,this.rendererByCompId=new Map,this.defaultRenderer=new Wt(ge)}createRenderer(ge,Ue){if(!ge||!Ue)return this.defaultRenderer;switch(Ue.encapsulation){case I.ifc.Emulated:{let at=this.rendererByCompId.get(Ue.id);return at||(at=new gr(this.eventManager,this.sharedStylesHost,Ue,this.appId),this.rendererByCompId.set(Ue.id,at)),at.applyToHost(ge),at}case 1:case I.ifc.ShadowDom:return new Dn(this.eventManager,this.sharedStylesHost,ge,Ue);default:if(!this.rendererByCompId.has(Ue.id)){const at=Xe(Ue.id,Ue.styles,[]);this.sharedStylesHost.addStyles(at),this.rendererByCompId.set(Ue.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(nn),I.LFG(on),I.LFG(I.AFp))},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})();class Wt{constructor(ke){this.eventManager=ke,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ke,ge){return ge?document.createElementNS(sn[ge]||ge,ke):document.createElement(ke)}createComment(ke){return document.createComment(ke)}createText(ke){return document.createTextNode(ke)}appendChild(ke,ge){(kn(ke)?ke.content:ke).appendChild(ge)}insertBefore(ke,ge,Ue){ke&&(kn(ke)?ke.content:ke).insertBefore(ge,Ue)}removeChild(ke,ge){ke&&ke.removeChild(ge)}selectRootElement(ke,ge){let Ue="string"==typeof ke?document.querySelector(ke):ke;if(!Ue)throw new Error(`The selector "${ke}" did not match any elements`);return ge||(Ue.textContent=""),Ue}parentNode(ke){return ke.parentNode}nextSibling(ke){return ke.nextSibling}setAttribute(ke,ge,Ue,at){if(at){ge=at+":"+ge;const En=sn[at];En?ke.setAttributeNS(En,ge,Ue):ke.setAttribute(ge,Ue)}else ke.setAttribute(ge,Ue)}removeAttribute(ke,ge,Ue){if(Ue){const at=sn[Ue];at?ke.removeAttributeNS(at,ge):ke.removeAttribute(`${Ue}:${ge}`)}else ke.removeAttribute(ge)}addClass(ke,ge){ke.classList.add(ge)}removeClass(ke,ge){ke.classList.remove(ge)}setStyle(ke,ge,Ue,at){at&(I.JOm.DashCase|I.JOm.Important)?ke.style.setProperty(ge,Ue,at&I.JOm.Important?"important":""):ke.style[ge]=Ue}removeStyle(ke,ge,Ue){Ue&I.JOm.DashCase?ke.style.removeProperty(ge):ke.style[ge]=""}setProperty(ke,ge,Ue){ke[ge]=Ue}setValue(ke,ge){ke.nodeValue=ge}listen(ke,ge,Ue){return"string"==typeof ke?this.eventManager.addGlobalEventListener(ke,ge,He(Ue)):this.eventManager.addEventListener(ke,ge,He(Ue))}}function kn(je){return"TEMPLATE"===je.tagName&&void 0!==je.content}class gr extends Wt{constructor(ke,ge,Ue,at){super(ke),this.component=Ue;const En=Xe(at+"-"+Ue.id,Ue.styles,[]);ge.addStyles(En),this.contentAttr=function ft(je){return"_ngcontent-%COMP%".replace(tn,je)}(at+"-"+Ue.id),this.hostAttr=function rn(je){return"_nghost-%COMP%".replace(tn,je)}(at+"-"+Ue.id)}applyToHost(ke){super.setAttribute(ke,this.hostAttr,"")}createElement(ke,ge){const Ue=super.createElement(ke,ge);return super.setAttribute(Ue,this.contentAttr,""),Ue}}class Dn extends Wt{constructor(ke,ge,Ue,at){super(ke),this.sharedStylesHost=ge,this.hostEl=Ue,this.shadowRoot=Ue.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const En=Xe(at.id,at.styles,[]);for(let Ln=0;Ln<En.length;Ln++){const hr=document.createElement("style");hr.textContent=En[Ln],this.shadowRoot.appendChild(hr)}}nodeOrShadowRoot(ke){return ke===this.hostEl?this.shadowRoot:ke}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(ke,ge){return super.appendChild(this.nodeOrShadowRoot(ke),ge)}insertBefore(ke,ge,Ue){return super.insertBefore(this.nodeOrShadowRoot(ke),ge,Ue)}removeChild(ke,ge){return super.removeChild(this.nodeOrShadowRoot(ke),ge)}parentNode(ke){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ke)))}}let vr=(()=>{class je extends It{constructor(ge){super(ge)}supports(ge){return!0}addEventListener(ge,Ue,at){return ge.addEventListener(Ue,at,!1),()=>this.removeEventListener(ge,Ue,at)}removeEventListener(ge,Ue,at){return ge.removeEventListener(Ue,at)}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(W.K0))},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})();const li=["alt","control","meta","shift"],xr={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Mi={alt:je=>je.altKey,control:je=>je.ctrlKey,meta:je=>je.metaKey,shift:je=>je.shiftKey};let Zr=(()=>{class je extends It{constructor(ge){super(ge)}supports(ge){return null!=je.parseEventName(ge)}addEventListener(ge,Ue,at){const En=je.parseEventName(Ue),Ln=je.eventCallback(En.fullKey,at,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,W.q)().onAndCancel(ge,En.domEventName,Ln))}static parseEventName(ge){const Ue=ge.toLowerCase().split("."),at=Ue.shift();if(0===Ue.length||"keydown"!==at&&"keyup"!==at)return null;const En=je._normalizeKey(Ue.pop());let Ln="",hr=Ue.indexOf("code");if(hr>-1&&(Ue.splice(hr,1),Ln="code."),li.forEach(On=>{const Sr=Ue.indexOf(On);Sr>-1&&(Ue.splice(Sr,1),Ln+=On+".")}),Ln+=En,0!=Ue.length||0===En.length)return null;const wt={};return wt.domEventName=at,wt.fullKey=Ln,wt}static matchEventFullKeyCode(ge,Ue){let at=xr[ge.key]||ge.key,En="";return Ue.indexOf("code.")>-1&&(at=ge.code,En="code."),!(null==at||!at)&&(at=at.toLowerCase()," "===at?at="space":"."===at&&(at="dot"),li.forEach(Ln=>{Ln!==at&&(0,Mi[Ln])(ge)&&(En+=Ln+".")}),En+=at,En===Ue)}static eventCallback(ge,Ue,at){return En=>{je.matchEventFullKeyCode(En,ge)&&at.runGuarded(()=>Ue(En))}}static _normalizeKey(ge){return"esc"===ge?"escape":ge}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(W.K0))},je.\u0275prov=I.Yz7({token:je,factory:je.\u0275fac}),je})();const Nr=(0,I.eFA)(I._c5,"browser",[{provide:I.Lbi,useValue:W.bD},{provide:I.g9A,useValue:function Cr(){u.makeCurrent()},multi:!0},{provide:W.K0,useFactory:function Mo(){return(0,I.RDi)(document),document},deps:[]}]),ho=new I.OlP(""),vn=[{provide:I.rWj,useClass:class Ht{addToWindow(ke){I.dqk.getAngularTestability=(Ue,at=!0)=>{const En=ke.findTestabilityInTree(Ue,at);if(null==En)throw new Error("Could not find testability for element.");return En},I.dqk.getAllAngularTestabilities=()=>ke.getAllTestabilities(),I.dqk.getAllAngularRootElements=()=>ke.getAllRootElements(),I.dqk.frameworkStabilizers||(I.dqk.frameworkStabilizers=[]),I.dqk.frameworkStabilizers.push(Ue=>{const at=I.dqk.getAllAngularTestabilities();let En=at.length,Ln=!1;const hr=function(wt){Ln=Ln||wt,En--,0==En&&Ue(Ln)};at.forEach(function(wt){wt.whenStable(hr)})})}findTestabilityInTree(ke,ge,Ue){return null==ge?null:ke.getTestability(ge)??(Ue?(0,W.q)().isShadowRoot(ge)?this.findTestabilityInTree(ke,ge.host,!0):this.findTestabilityInTree(ke,ge.parentElement,!0):null)}},deps:[]},{provide:I.lri,useClass:I.dDg,deps:[I.R0b,I.eoX,I.rWj]},{provide:I.dDg,useClass:I.dDg,deps:[I.R0b,I.eoX,I.rWj]}],Fi=[{provide:I.zSh,useValue:"root"},{provide:I.qLn,useFactory:function _r(){return new I.qLn},deps:[]},{provide:bt,useClass:vr,multi:!0,deps:[W.K0,I.R0b,I.Lbi]},{provide:bt,useClass:Zr,multi:!0,deps:[W.K0]},{provide:Be,useClass:Be,deps:[nn,on,I.AFp]},{provide:I.FYo,useExisting:Be},{provide:pn,useExisting:on},{provide:on,useClass:on,deps:[W.K0]},{provide:nn,useClass:nn,deps:[bt,I.R0b]},{provide:W.JF,useClass:Cn,deps:[]},[]];let zr=(()=>{class je{constructor(ge){}static withServerTransition(ge){return{ngModule:je,providers:[{provide:I.AFp,useValue:ge.appId},{provide:gt,useExisting:I.AFp},dt]}}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(ho,12))},je.\u0275mod=I.oAB({type:je}),je.\u0275inj=I.cJS({providers:[...Fi,...vn],imports:[W.ez,I.hGG]}),je})(),Et=(()=>{class je{constructor(ge){this._doc=ge}getTitle(){return this._doc.title}setTitle(ge){this._doc.title=ge||""}}return je.\u0275fac=function(ge){return new(ge||je)(I.LFG(W.K0))},je.\u0275prov=I.Yz7({token:je,factory:function(ge){let Ue=null;return Ue=ge?new ge:function kr(){return new Et((0,I.LFG)(W.K0))}(),Ue},providedIn:"root"}),je})();typeof window<"u"&&window},5649:(Hn,Gt,ye)=>{"use strict";ye.d(Gt,{gz:()=>Zi,F0:()=>Li,rH:()=>Pa,Od:()=>ql,yS:()=>el,Bz:()=>qt,lC:()=>Gs});var W=ye(8256),I=ye(2076),nt=ye(9646),u=ye(7579);class Te extends u.x{constructor(S){super(),this._value=S}get value(){return this.getValue()}_subscribe(S){const D=super._subscribe(S);return!D.closed&&S.next(this._value),D}getValue(){const{hasError:S,thrownError:D,_value:O}=this;if(S)throw D;return this._throwIfClosed(),O}next(S){super.next(this._value=S)}}const Vt=(0,ye(3888).d)(M=>function(){M(this),this.name="EmptyError",this.message="no elements in sequence"});var Tt=ye(9751),gt=ye(4742),vt=ye(4671),dt=ye(3268),Ht=ye(7669),Cn=ye(1810),bt=ye(5403),nn=ye(9672);function It(...M){const S=(0,Ht.yG)(M),D=(0,Ht.jO)(M),{args:O,keys:c}=(0,gt.D)(M);if(0===O.length)return(0,I.D)([],S);const t=new Tt.y(function pn(M,S,D=vt.y){return O=>{on(S,()=>{const{length:c}=M,t=new Array(c);let a=c,d=c;for(let g=0;g<c;g++)on(S,()=>{const v=(0,I.D)(M[g],S);let E=!1;v.subscribe((0,bt.x)(O,C=>{t[g]=C,E||(E=!0,d--),d||O.next(D(t.slice()))},()=>{--a||O.complete()}))},O)},O)}}(O,S,c?a=>(0,Cn.n)(c,a):vt.y));return D?t.pipe((0,dt.Z)(D)):t}function on(M,S,D){M?(0,nn.f)(D,M,S):S()}var or=ye(8189);function tn(...M){return function sn(){return(0,or.J)(1)}()((0,I.D)(M,(0,Ht.yG)(M)))}var Ge=ye(8421);function kt(M){return new Tt.y(S=>{(0,Ge.Xf)(M()).subscribe(S)})}var lr=ye(9635),tt=ye(576);function ft(M,S){const D=(0,tt.m)(M)?M:()=>M,O=c=>c.error(D());return new Tt.y(S?c=>S.schedule(O,0,c):O)}var rn=ye(515),Xe=ye(727),He=ye(4482);function lt(){return(0,He.e)((M,S)=>{let D=null;M._refCount++;const O=(0,bt.x)(S,void 0,void 0,void 0,()=>{if(!M||M._refCount<=0||0<--M._refCount)return void(D=null);const c=M._connection,t=D;D=null,c&&(!t||c===t)&&c.unsubscribe(),S.unsubscribe()});M.subscribe(O),O.closed||(D=M.connect())})}class Be extends Tt.y{constructor(S,D){super(),this.source=S,this.subjectFactory=D,this._subject=null,this._refCount=0,this._connection=null,(0,He.A)(S)&&(this.lift=S.lift)}_subscribe(S){return this.getSubject().subscribe(S)}getSubject(){const S=this._subject;return(!S||S.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:S}=this;this._subject=this._connection=null,S?.unsubscribe()}connect(){let S=this._connection;if(!S){S=this._connection=new Xe.w0;const D=this.getSubject();S.add(this.source.subscribe((0,bt.x)(D,void 0,()=>{this._teardown(),D.complete()},O=>{this._teardown(),D.error(O)},()=>this._teardown()))),S.closed&&(this._connection=null,S=Xe.w0.EMPTY)}return S}refCount(){return lt()(this)}}var Wt=ye(6895),ht=ye(4004),fn=ye(3900);function kn(M){return M<=0?()=>rn.E:(0,He.e)((S,D)=>{let O=0;S.subscribe((0,bt.x)(D,c=>{++O<=M&&(D.next(c),M<=O&&D.complete())}))})}var Dn=ye(9300),vr=ye(5577);function li(M){return(0,He.e)((S,D)=>{let O=!1;S.subscribe((0,bt.x)(D,c=>{O=!0,D.next(c)},()=>{O||D.next(M),D.complete()}))})}function xr(M=Mi){return(0,He.e)((S,D)=>{let O=!1;S.subscribe((0,bt.x)(D,c=>{O=!0,D.next(c)},()=>O?D.complete():D.error(M())))})}function Mi(){return new Vt}function Zr(M,S){const D=arguments.length>=2;return O=>O.pipe(M?(0,Dn.h)((c,t)=>M(c,t,O)):vt.y,kn(1),D?li(S):xr(()=>new Vt))}var Ar=ye(4351),ln=ye(8505),Zn=ye(262);function Si(M,S,D,O,c){return(t,a)=>{let d=D,g=S,v=0;t.subscribe((0,bt.x)(a,E=>{const C=v++;g=d?M(g,E,C):(d=!0,E),O&&a.next(g)},c&&(()=>{d&&a.next(g),a.complete()})))}}function Wo(M,S){return(0,He.e)(Si(M,S,arguments.length>=2,!0))}function Cr(M){return M<=0?()=>rn.E:(0,He.e)((S,D)=>{let O=[];S.subscribe((0,bt.x)(D,c=>{O.push(c),M<O.length&&O.shift()},()=>{for(const c of O)D.next(c);D.complete()},void 0,()=>{O=null}))})}function _r(M,S){const D=arguments.length>=2;return O=>O.pipe(M?(0,Dn.h)((c,t)=>M(c,t,O)):vt.y,Cr(1),D?li(S):xr(()=>new Vt))}function Nr(M){return(0,He.e)((S,D)=>{try{S.subscribe(D)}finally{D.add(M)}})}var ho=ye(1481);const vn="primary",Fi=Symbol("RouteTitle");class zr{constructor(S){this.params=S||{}}has(S){return Object.prototype.hasOwnProperty.call(this.params,S)}get(S){if(this.has(S)){const D=this.params[S];return Array.isArray(D)?D[0]:D}return null}getAll(S){if(this.has(S)){const D=this.params[S];return Array.isArray(D)?D:[D]}return[]}get keys(){return Object.keys(this.params)}}function si(M){return new zr(M)}function fo(M,S,D){const O=D.path.split("/");if(O.length>M.length||"full"===D.pathMatch&&(S.hasChildren()||O.length<M.length))return null;const c={};for(let t=0;t<O.length;t++){const a=O[t],d=M[t];if(a.startsWith(":"))c[a.substring(1)]=d;else if(a!==d.path)return null}return{consumed:M.slice(0,O.length),posParams:c}}function kr(M,S){const D=M?Object.keys(M):void 0,O=S?Object.keys(S):void 0;if(!D||!O||D.length!=O.length)return!1;let c;for(let t=0;t<D.length;t++)if(c=D[t],!Et(M[c],S[c]))return!1;return!0}function Et(M,S){if(Array.isArray(M)&&Array.isArray(S)){if(M.length!==S.length)return!1;const D=[...M].sort(),O=[...S].sort();return D.every((c,t)=>O[t]===c)}return M===S}function ve(M){return Array.prototype.concat.apply([],M)}function we(M){return M.length>0?M[M.length-1]:null}function pt(M,S){for(const D in M)M.hasOwnProperty(D)&&S(M[D],D)}function mn(M){return(0,W.CqO)(M)?M:(0,W.QGY)(M)?(0,I.D)(Promise.resolve(M)):(0,nt.of)(M)}const gn={exact:function X(M,S,D){if(!xt(M.segments,S.segments)||!Ce(M.segments,S.segments,D)||M.numberOfChildren!==S.numberOfChildren)return!1;for(const O in S.children)if(!M.children[O]||!X(M.children[O],S.children[O],D))return!1;return!0},subset:he},Vr={exact:function _e(M,S){return kr(M,S)},subset:function ee(M,S){return Object.keys(S).length<=Object.keys(M).length&&Object.keys(S).every(D=>Et(M[D],S[D]))},ignored:()=>!0};function Tr(M,S,D){return gn[D.paths](M.root,S.root,D.matrixParams)&&Vr[D.queryParams](M.queryParams,S.queryParams)&&!("exact"===D.fragment&&M.fragment!==S.fragment)}function he(M,S,D){return Ee(M,S,S.segments,D)}function Ee(M,S,D,O){if(M.segments.length>D.length){const c=M.segments.slice(0,D.length);return!(!xt(c,D)||S.hasChildren()||!Ce(c,D,O))}if(M.segments.length===D.length){if(!xt(M.segments,D)||!Ce(M.segments,D,O))return!1;for(const c in S.children)if(!M.children[c]||!he(M.children[c],S.children[c],O))return!1;return!0}{const c=D.slice(0,M.segments.length),t=D.slice(M.segments.length);return!!(xt(M.segments,c)&&Ce(M.segments,c,O)&&M.children[vn])&&Ee(M.children[vn],S,t,O)}}function Ce(M,S,D){return S.every((O,c)=>Vr[D](M[c].parameters,O.parameters))}class Fe{constructor(S,D,O){this.root=S,this.queryParams=D,this.fragment=O}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=si(this.queryParams)),this._queryParamMap}toString(){return $n.serialize(this)}}class Le{constructor(S,D){this.segments=S,this.children=D,this.parent=null,pt(D,(O,c)=>O.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Mn(this)}}class Ie{constructor(S,D){this.path=S,this.parameters=D}get parameterMap(){return this._parameterMap||(this._parameterMap=si(this.parameters)),this._parameterMap}toString(){return Ue(this)}}function xt(M,S){return M.length===S.length&&M.every((D,O)=>D.path===S[O].path)}let St=(()=>{class M{}return M.\u0275fac=function(D){return new(D||M)},M.\u0275prov=W.Yz7({token:M,factory:function(){return new Tn},providedIn:"root"}),M})();class Tn{parse(S){const D=new ro(S);return new Fe(D.parseRootSegment(),D.parseQueryParams(),D.parseFragment())}serialize(S){const D=`/${Rn(S.root,!0)}`,O=function En(M){const S=Object.keys(M).map(D=>{const O=M[D];return Array.isArray(O)?O.map(c=>`${Mr(D)}=${Mr(c)}`).join("&"):`${Mr(D)}=${Mr(O)}`}).filter(D=>!!D);return S.length?`?${S.join("&")}`:""}(S.queryParams);return`${D}${O}${"string"==typeof S.fragment?`#${function Ur(M){return encodeURI(M)}(S.fragment)}`:""}`}}const $n=new Tn;function Mn(M){return M.segments.map(S=>Ue(S)).join("/")}function Rn(M,S){if(!M.hasChildren())return Mn(M);if(S){const D=M.children[vn]?Rn(M.children[vn],!1):"",O=[];return pt(M.children,(c,t)=>{t!==vn&&O.push(`${t}:${Rn(c,!1)}`)}),O.length>0?`${D}(${O.join("//")})`:D}{const D=function Ut(M,S){let D=[];return pt(M.children,(O,c)=>{c===vn&&(D=D.concat(S(O,c)))}),pt(M.children,(O,c)=>{c!==vn&&(D=D.concat(S(O,c)))}),D}(M,(O,c)=>c===vn?[Rn(M.children[vn],!1)]:[`${c}:${Rn(O,!1)}`]);return 1===Object.keys(M.children).length&&null!=M.children[vn]?`${Mn(M)}/${D[0]}`:`${Mn(M)}/(${D.join("//")})`}}function Bn(M){return encodeURIComponent(M).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Mr(M){return Bn(M).replace(/%3B/gi,";")}function je(M){return Bn(M).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ke(M){return decodeURIComponent(M)}function ge(M){return ke(M.replace(/\+/g,"%20"))}function Ue(M){return`${je(M.path)}${function at(M){return Object.keys(M).map(S=>`;${je(S)}=${je(M[S])}`).join("")}(M.parameters)}`}const Ln=/^[^\/()?;=#]+/;function hr(M){const S=M.match(Ln);return S?S[0]:""}const wt=/^[^=?&#]+/,Sr=/^[^&#]+/;class ro{constructor(S){this.url=S,this.remaining=S}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Le([],{}):new Le([],this.parseChildren())}parseQueryParams(){const S={};if(this.consumeOptional("?"))do{this.parseQueryParam(S)}while(this.consumeOptional("&"));return S}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const S=[];for(this.peekStartsWith("(")||S.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),S.push(this.parseSegment());let D={};this.peekStartsWith("/(")&&(this.capture("/"),D=this.parseParens(!0));let O={};return this.peekStartsWith("(")&&(O=this.parseParens(!1)),(S.length>0||Object.keys(D).length>0)&&(O[vn]=new Le(S,D)),O}parseSegment(){const S=hr(this.remaining);if(""===S&&this.peekStartsWith(";"))throw new W.vHH(4009,!1);return this.capture(S),new Ie(ke(S),this.parseMatrixParams())}parseMatrixParams(){const S={};for(;this.consumeOptional(";");)this.parseParam(S);return S}parseParam(S){const D=hr(this.remaining);if(!D)return;this.capture(D);let O="";if(this.consumeOptional("=")){const c=hr(this.remaining);c&&(O=c,this.capture(O))}S[ke(D)]=ke(O)}parseQueryParam(S){const D=function On(M){const S=M.match(wt);return S?S[0]:""}(this.remaining);if(!D)return;this.capture(D);let O="";if(this.consumeOptional("=")){const a=function _i(M){const S=M.match(Sr);return S?S[0]:""}(this.remaining);a&&(O=a,this.capture(O))}const c=ge(D),t=ge(O);if(S.hasOwnProperty(c)){let a=S[c];Array.isArray(a)||(a=[a],S[c]=a),a.push(t)}else S[c]=t}parseParens(S){const D={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const O=hr(this.remaining),c=this.remaining[O.length];if("/"!==c&&")"!==c&&";"!==c)throw new W.vHH(4010,!1);let t;O.indexOf(":")>-1?(t=O.slice(0,O.indexOf(":")),this.capture(t),this.capture(":")):S&&(t=vn);const a=this.parseChildren();D[t]=1===Object.keys(a).length?a[vn]:new Le([],a),this.consumeOptional("//")}return D}peekStartsWith(S){return this.remaining.startsWith(S)}consumeOptional(S){return!!this.peekStartsWith(S)&&(this.remaining=this.remaining.substring(S.length),!0)}capture(S){if(!this.consumeOptional(S))throw new W.vHH(4011,!1)}}function Lr(M){return M.segments.length>0?new Le([],{[vn]:M}):M}function xi(M){const S={};for(const O of Object.keys(M.children)){const t=xi(M.children[O]);(t.segments.length>0||t.hasChildren())&&(S[O]=t)}return function Or(M){if(1===M.numberOfChildren&&M.children[vn]){const S=M.children[vn];return new Le(M.segments.concat(S.segments),S.children)}return M}(new Le(M.segments,S))}function $i(M){return M instanceof Fe}function io(M,S,D,O,c){if(0===D.length)return po(S.root,S.root,S.root,O,c);const t=function Xo(M){if("string"==typeof M[0]&&1===M.length&&"/"===M[0])return new Ii(!0,0,M);let S=0,D=!1;const O=M.reduce((c,t,a)=>{if("object"==typeof t&&null!=t){if(t.outlets){const d={};return pt(t.outlets,(g,v)=>{d[v]="string"==typeof g?g.split("/"):g}),[...c,{outlets:d}]}if(t.segmentPath)return[...c,t.segmentPath]}return"string"!=typeof t?[...c,t]:0===a?(t.split("/").forEach((d,g)=>{0==g&&"."===d||(0==g&&""===d?D=!0:".."===d?S++:""!=d&&c.push(d))}),c):[...c,t]},[]);return new Ii(D,S,O)}(D);return t.toRoot()?po(S.root,S.root,new Le([],{}),O,c):function a(g){const v=function Gn(M,S,D,O){if(M.isAbsolute)return new So(S.root,!0,0);if(-1===O)return new So(D,D===S.root,0);return function Vn(M,S,D){let O=M,c=S,t=D;for(;t>c;){if(t-=c,O=O.parent,!O)throw new W.vHH(4005,!1);c=O.segments.length}return new So(O,!1,c-t)}(D,O+(Ir(M.commands[0])?0:1),M.numberOfDoubleDots)}(t,S,M.snapshot?._urlSegment,g),E=v.processChildren?Pn(v.segmentGroup,v.index,t.commands):bi(v.segmentGroup,v.index,t.commands);return po(S.root,v.segmentGroup,E,O,c)}(M.snapshot?._lastPathIndex)}function Ir(M){return"object"==typeof M&&null!=M&&!M.outlets&&!M.segmentPath}function rr(M){return"object"==typeof M&&null!=M&&M.outlets}function po(M,S,D,O,c){let a,t={};O&&pt(O,(g,v)=>{t[v]=Array.isArray(g)?g.map(E=>`${E}`):`${g}`}),a=M===S?D:Ai(M,S,D);const d=Lr(xi(a));return new Fe(d,t,c)}function Ai(M,S,D){const O={};return pt(M.children,(c,t)=>{O[t]=c===S?D:Ai(c,S,D)}),new Le(M.segments,O)}class Ii{constructor(S,D,O){if(this.isAbsolute=S,this.numberOfDoubleDots=D,this.commands=O,S&&O.length>0&&Ir(O[0]))throw new W.vHH(4003,!1);const c=O.find(rr);if(c&&c!==we(O))throw new W.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class So{constructor(S,D,O){this.segmentGroup=S,this.processChildren=D,this.index=O}}function bi(M,S,D){if(M||(M=new Le([],{})),0===M.segments.length&&M.hasChildren())return Pn(M,S,D);const O=function Hi(M,S,D){let O=0,c=S;const t={match:!1,pathIndex:0,commandIndex:0};for(;c<M.segments.length;){if(O>=D.length)return t;const a=M.segments[c],d=D[O];if(rr(d))break;const g=`${d}`,v=O<D.length-1?D[O+1]:null;if(c>0&&void 0===g)break;if(g&&v&&"object"==typeof v&&void 0===v.outlets){if(!sr(g,v,a))return t;O+=2}else{if(!sr(g,{},a))return t;O++}c++}return{match:!0,pathIndex:c,commandIndex:O}}(M,S,D),c=D.slice(O.commandIndex);if(O.match&&O.pathIndex<M.segments.length){const t=new Le(M.segments.slice(0,O.pathIndex),{});return t.children[vn]=new Le(M.segments.slice(O.pathIndex),M.children),Pn(t,0,c)}return O.match&&0===c.length?new Le(M.segments,{}):O.match&&!M.hasChildren()?mo(M,S,D):O.match?Pn(M,0,c):mo(M,S,D)}function Pn(M,S,D){if(0===D.length)return new Le(M.segments,{});{const O=function yi(M){return rr(M[0])?M[0].outlets:{[vn]:M}}(D),c={};return pt(O,(t,a)=>{"string"==typeof t&&(t=[t]),null!==t&&(c[a]=bi(M.children[a],S,t))}),pt(M.children,(t,a)=>{void 0===O[a]&&(c[a]=t)}),new Le(M.segments,c)}}function mo(M,S,D){const O=M.segments.slice(0,S);let c=0;for(;c<D.length;){const t=D[c];if(rr(t)){const g=qr(t.outlets);return new Le(O,g)}if(0===c&&Ir(D[0])){O.push(new Ie(M.segments[S].path,go(D[0]))),c++;continue}const a=rr(t)?t.outlets[vn]:`${t}`,d=c<D.length-1?D[c+1]:null;a&&d&&Ir(d)?(O.push(new Ie(a,go(d))),c+=2):(O.push(new Ie(a,{})),c++)}return new Le(O,{})}function qr(M){const S={};return pt(M,(D,O)=>{"string"==typeof D&&(D=[D]),null!==D&&(S[O]=mo(new Le([],{}),0,D))}),S}function go(M){const S={};return pt(M,(D,O)=>S[O]=`${D}`),S}function sr(M,S,D){return M==D.path&&kr(S,D.parameters)}class vi{constructor(S,D){this.id=S,this.url=D}}class Ao extends vi{constructor(S,D,O="imperative",c=null){super(S,D),this.type=0,this.navigationTrigger=O,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Wr extends vi{constructor(S,D,O){super(S,D),this.urlAfterRedirects=O,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class _o extends vi{constructor(S,D,O,c){super(S,D),this.reason=O,this.code=c,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Yi extends vi{constructor(S,D,O,c){super(S,D),this.error=O,this.target=c,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Ga extends vi{constructor(S,D,O,c){super(S,D),this.urlAfterRedirects=O,this.state=c,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ra extends vi{constructor(S,D,O,c){super(S,D),this.urlAfterRedirects=O,this.state=c,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ia extends vi{constructor(S,D,O,c,t){super(S,D),this.urlAfterRedirects=O,this.state=c,this.shouldActivate=t,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class xa extends vi{constructor(S,D,O,c){super(S,D),this.urlAfterRedirects=O,this.state=c,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Vs extends vi{constructor(S,D,O,c){super(S,D),this.urlAfterRedirects=O,this.state=c,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class oo{constructor(S){this.route=S,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class pi{constructor(S){this.route=S,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Ha{constructor(S){this.snapshot=S,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ml{constructor(S){this.snapshot=S,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ki{constructor(S){this.snapshot=S,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Io{constructor(S){this.snapshot=S,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Za{constructor(S,D,O){this.routerEvent=S,this.position=D,this.anchor=O,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class ti{constructor(S){this._root=S}get root(){return this._root.value}parent(S){const D=this.pathFromRoot(S);return D.length>1?D[D.length-2]:null}children(S){const D=xs(S,this._root);return D?D.children.map(O=>O.value):[]}firstChild(S){const D=xs(S,this._root);return D&&D.children.length>0?D.children[0].value:null}siblings(S){const D=sa(S,this._root);return D.length<2?[]:D[D.length-2].children.map(c=>c.value).filter(c=>c!==S)}pathFromRoot(S){return sa(S,this._root).map(D=>D.value)}}function xs(M,S){if(M===S.value)return S;for(const D of S.children){const O=xs(M,D);if(O)return O}return null}function sa(M,S){if(M===S.value)return[S];for(const D of S.children){const O=sa(M,D);if(O.length)return O.unshift(S),O}return[]}class Pi{constructor(S,D){this.value=S,this.children=D}toString(){return`TreeNode(${this.value})`}}function ci(M){const S={};return M&&M.children.forEach(D=>S[D.value.outlet]=D),S}class bs extends ti{constructor(S,D){super(S),this.snapshot=D,so(this,S)}toString(){return this.snapshot.toString()}}function os(M,S){const D=function yo(M,S){const a=new ws([],{},{},"",{},vn,S,null,M.root,-1,{});return new zo("",new Pi(a,[]))}(M,S),O=new Te([new Ie("",{})]),c=new Te({}),t=new Te({}),a=new Te({}),d=new Te(""),g=new Zi(O,c,a,d,t,vn,S,D.root);return g.snapshot=D.root,new bs(new Pi(g,[]),D)}class Zi{constructor(S,D,O,c,t,a,d,g){this.url=S,this.params=D,this.queryParams=O,this.fragment=c,this.data=t,this.outlet=a,this.component=d,this.title=this.data?.pipe((0,ht.U)(v=>v[Fi]))??(0,nt.of)(void 0),this._futureSnapshot=g}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,ht.U)(S=>si(S)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,ht.U)(S=>si(S)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function qa(M,S="emptyOnly"){const D=M.pathFromRoot;let O=0;if("always"!==S)for(O=D.length-1;O>=1;){const c=D[O],t=D[O-1];if(c.routeConfig&&""===c.routeConfig.path)O--;else{if(t.component)break;O--}}return function ss(M){return M.reduce((S,D)=>({params:{...S.params,...D.params},data:{...S.data,...D.data},resolve:{...D.data,...S.resolve,...D.routeConfig?.data,...D._resolvedData}}),{params:{},data:{},resolve:{}})}(D.slice(O))}class ws{constructor(S,D,O,c,t,a,d,g,v,E,C,P){this.url=S,this.params=D,this.queryParams=O,this.fragment=c,this.data=t,this.outlet=a,this.component=d,this.title=this.data?.[Fi],this.routeConfig=g,this._urlSegment=v,this._lastPathIndex=E,this._correctedLastPathIndex=P??E,this._resolve=C}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=si(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=si(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(O=>O.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class zo extends ti{constructor(S,D){super(D),this.url=S,so(this,D)}toString(){return Us(this._root)}}function so(M,S){S.value._routerState=M,S.children.forEach(D=>so(M,D))}function Us(M){const S=M.children.length>0?` { ${M.children.map(Us).join(", ")} } `:"";return`${M.value}${S}`}function as(M){if(M.snapshot){const S=M.snapshot,D=M._futureSnapshot;M.snapshot=D,kr(S.queryParams,D.queryParams)||M.queryParams.next(D.queryParams),S.fragment!==D.fragment&&M.fragment.next(D.fragment),kr(S.params,D.params)||M.params.next(D.params),function vs(M,S){if(M.length!==S.length)return!1;for(let D=0;D<M.length;++D)if(!kr(M[D],S[D]))return!1;return!0}(S.url,D.url)||M.url.next(D.url),kr(S.data,D.data)||M.data.next(D.data)}else M.snapshot=M._futureSnapshot,M.data.next(M._futureSnapshot.data)}function Po(M,S){const D=kr(M.params,S.params)&&function $e(M,S){return xt(M,S)&&M.every((D,O)=>kr(D.parameters,S[O].parameters))}(M.url,S.url);return D&&!(!M.parent!=!S.parent)&&(!M.parent||Po(M.parent,S.parent))}function vo(M,S,D){if(D&&M.shouldReuseRoute(S.value,D.value.snapshot)){const O=D.value;O._futureSnapshot=S.value;const c=function ba(M,S,D){return S.children.map(O=>{for(const c of D.children)if(M.shouldReuseRoute(O.value,c.value.snapshot))return vo(M,O,c);return vo(M,O)})}(M,S,D);return new Pi(O,c)}{if(M.shouldAttach(S.value)){const t=M.retrieve(S.value);if(null!==t){const a=t.route;return a.value._futureSnapshot=S.value,a.children=S.children.map(d=>vo(M,d)),a}}const O=function ls(M){return new Zi(new Te(M.url),new Te(M.params),new Te(M.queryParams),new Te(M.fragment),new Te(M.data),M.outlet,M.component,M)}(S.value),c=S.children.map(t=>vo(M,t));return new Pi(O,c)}}const wi="ngNavigationCancelingError";function Es(M,S){const{redirectTo:D,navigationBehaviorOptions:O}=$i(S)?{redirectTo:S,navigationBehaviorOptions:void 0}:S,c=$s(!1,0,S);return c.url=D,c.navigationBehaviorOptions=O,c}function $s(M,S,D){const O=new Error("NavigationCancelingError: "+(M||""));return O[wi]=!0,O.cancellationCode=S,D&&(O.url=D),O}function Ro(M){return wa(M)&&$i(M.url)}function wa(M){return M&&M[wi]}class aa{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new cn,this.attachRef=null}}let cn=(()=>{class M{constructor(){this.contexts=new Map}onChildOutletCreated(D,O){const c=this.getOrCreateContext(D);c.outlet=O,this.contexts.set(D,c)}onChildOutletDestroyed(D){const O=this.getContext(D);O&&(O.outlet=null,O.attachRef=null)}onOutletDeactivated(){const D=this.contexts;return this.contexts=new Map,D}onOutletReAttached(D){this.contexts=D}getOrCreateContext(D){let O=this.getContext(D);return O||(O=new aa,this.contexts.set(D,O)),O}getContext(D){return this.contexts.get(D)||null}}return M.\u0275fac=function(D){return new(D||M)},M.\u0275prov=W.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();const Ea=!1;let Gs=(()=>{class M{constructor(D,O,c,t,a){this.parentContexts=D,this.location=O,this.changeDetector=t,this.environmentInjector=a,this.activated=null,this._activatedRoute=null,this.activateEvents=new W.vpe,this.deactivateEvents=new W.vpe,this.attachEvents=new W.vpe,this.detachEvents=new W.vpe,this.name=c||vn,D.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const D=this.parentContexts.getContext(this.name);D&&D.route&&(D.attachRef?this.attach(D.attachRef,D.route):this.activateWith(D.route,D.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new W.vHH(4012,Ea);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new W.vHH(4012,Ea);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new W.vHH(4012,Ea);this.location.detach();const D=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(D.instance),D}attach(D,O){this.activated=D,this._activatedRoute=O,this.location.insert(D.hostView),this.attachEvents.emit(D.instance)}deactivate(){if(this.activated){const D=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(D)}}activateWith(D,O){if(this.isActivated)throw new W.vHH(4013,Ea);this._activatedRoute=D;const c=this.location,a=D._futureSnapshot.component,d=this.parentContexts.getOrCreateContext(this.name).children,g=new Ca(D,d,c.injector);if(O&&function Bi(M){return!!M.resolveComponentFactory}(O)){const v=O.resolveComponentFactory(a);this.activated=c.createComponent(v,c.length,g)}else this.activated=c.createComponent(a,{index:c.length,injector:g,environmentInjector:O??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return M.\u0275fac=function(D){return new(D||M)(W.Y36(cn),W.Y36(W.s_b),W.$8M("name"),W.Y36(W.sBO),W.Y36(W.lqb))},M.\u0275dir=W.lG2({type:M,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),M})();class Ca{constructor(S,D,O){this.route=S,this.childContexts=D,this.parent=O}get(S,D){return S===Zi?this.route:S===cn?this.childContexts:this.parent.get(S,D)}}let la=(()=>{class M{}return M.\u0275fac=function(D){return new(D||M)},M.\u0275cmp=W.Xpm({type:M,selectors:[["ng-component"]],standalone:!0,features:[W.jDz],decls:1,vars:0,template:function(D,O){1&D&&W._UZ(0,"router-outlet")},dependencies:[Gs],encapsulation:2}),M})();function Hs(M,S){return M.providers&&!M._injector&&(M._injector=(0,W.MMx)(M.providers,S,`Route: ${M.path}`)),M._injector??S}function Nn(M){const S=M.children&&M.children.map(Nn),D=S?{...M,children:S}:{...M};return!D.component&&!D.loadComponent&&(S||D.loadChildren)&&D.outlet&&D.outlet!==vn&&(D.component=la),D}function ao(M){return M.outlet||vn}function Da(M,S){const D=M.filter(O=>ao(O)===S);return D.push(...M.filter(O=>ao(O)!==S)),D}function Ds(M){if(!M)return null;if(M.routeConfig?._injector)return M.routeConfig._injector;for(let S=M.parent;S;S=S.parent){const D=S.routeConfig;if(D?._loadedInjector)return D._loadedInjector;if(D?._injector)return D._injector}return null}class mr{constructor(S,D,O,c){this.routeReuseStrategy=S,this.futureState=D,this.currState=O,this.forwardEvent=c}activate(S){const D=this.futureState._root,O=this.currState?this.currState._root:null;this.deactivateChildRoutes(D,O,S),as(this.futureState.root),this.activateChildRoutes(D,O,S)}deactivateChildRoutes(S,D,O){const c=ci(D);S.children.forEach(t=>{const a=t.value.outlet;this.deactivateRoutes(t,c[a],O),delete c[a]}),pt(c,(t,a)=>{this.deactivateRouteAndItsChildren(t,O)})}deactivateRoutes(S,D,O){const c=S.value,t=D?D.value:null;if(c===t)if(c.component){const a=O.getContext(c.outlet);a&&this.deactivateChildRoutes(S,D,a.children)}else this.deactivateChildRoutes(S,D,O);else t&&this.deactivateRouteAndItsChildren(D,O)}deactivateRouteAndItsChildren(S,D){S.value.component&&this.routeReuseStrategy.shouldDetach(S.value.snapshot)?this.detachAndStoreRouteSubtree(S,D):this.deactivateRouteAndOutlet(S,D)}detachAndStoreRouteSubtree(S,D){const O=D.getContext(S.value.outlet),c=O&&S.value.component?O.children:D,t=ci(S);for(const a of Object.keys(t))this.deactivateRouteAndItsChildren(t[a],c);if(O&&O.outlet){const a=O.outlet.detach(),d=O.children.onOutletDeactivated();this.routeReuseStrategy.store(S.value.snapshot,{componentRef:a,route:S,contexts:d})}}deactivateRouteAndOutlet(S,D){const O=D.getContext(S.value.outlet),c=O&&S.value.component?O.children:D,t=ci(S);for(const a of Object.keys(t))this.deactivateRouteAndItsChildren(t[a],c);O&&O.outlet&&(O.outlet.deactivate(),O.children.onOutletDeactivated(),O.attachRef=null,O.resolver=null,O.route=null)}activateChildRoutes(S,D,O){const c=ci(D);S.children.forEach(t=>{this.activateRoutes(t,c[t.value.outlet],O),this.forwardEvent(new Io(t.value.snapshot))}),S.children.length&&this.forwardEvent(new ml(S.value.snapshot))}activateRoutes(S,D,O){const c=S.value,t=D?D.value:null;if(as(c),c===t)if(c.component){const a=O.getOrCreateContext(c.outlet);this.activateChildRoutes(S,D,a.children)}else this.activateChildRoutes(S,D,O);else if(c.component){const a=O.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const d=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),a.children.onOutletReAttached(d.contexts),a.attachRef=d.componentRef,a.route=d.route.value,a.outlet&&a.outlet.attach(d.componentRef,d.route.value),as(d.route.value),this.activateChildRoutes(S,null,a.children)}else{const d=Ds(c.snapshot),g=d?.get(W._Vd)??null;a.attachRef=null,a.route=c,a.resolver=g,a.injector=d,a.outlet&&a.outlet.activateWith(c,a.injector),this.activateChildRoutes(S,null,a.children)}}else this.activateChildRoutes(S,null,O)}}class qs{constructor(S){this.path=S,this.route=this.path[this.path.length-1]}}class Wa{constructor(S,D){this.component=S,this.route=D}}function _l(M,S,D){const O=M._root;return cs(O,S?S._root:null,D,[O.value])}function Wn(M,S){const D=Symbol(),O=S.get(M,D);return O===D?"function"!=typeof M||(0,W.Z0I)(M)?S.get(M):M:O}function cs(M,S,D,O,c={canDeactivateChecks:[],canActivateChecks:[]}){const t=ci(S);return M.children.forEach(a=>{(function zl(M,S,D,O,c={canDeactivateChecks:[],canActivateChecks:[]}){const t=M.value,a=S?S.value:null,d=D?D.getContext(M.value.outlet):null;if(a&&t.routeConfig===a.routeConfig){const g=function Xr(M,S,D){if("function"==typeof D)return D(M,S);switch(D){case"pathParamsChange":return!xt(M.url,S.url);case"pathParamsOrQueryParamsChange":return!xt(M.url,S.url)||!kr(M.queryParams,S.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Po(M,S)||!kr(M.queryParams,S.queryParams);default:return!Po(M,S)}}(a,t,t.routeConfig.runGuardsAndResolvers);g?c.canActivateChecks.push(new qs(O)):(t.data=a.data,t._resolvedData=a._resolvedData),cs(M,S,t.component?d?d.children:null:D,O,c),g&&d&&d.outlet&&d.outlet.isActivated&&c.canDeactivateChecks.push(new Wa(d.outlet.component,a))}else a&&Yo(S,d,c),c.canActivateChecks.push(new qs(O)),cs(M,null,t.component?d?d.children:null:D,O,c)})(a,t[a.value.outlet],D,O.concat([a.value]),c),delete t[a.value.outlet]}),pt(t,(a,d)=>Yo(a,D.getContext(d),c)),c}function Yo(M,S,D){const O=ci(M),c=M.value;pt(O,(t,a)=>{Yo(t,c.component?S?S.children.getContext(a):null:S,D)}),D.canDeactivateChecks.push(new Wa(c.component&&S&&S.outlet&&S.outlet.isActivated?S.outlet.component:null,c))}function Ni(M){return"function"==typeof M}function bo(M){return M instanceof Vt||"EmptyError"===M?.name}const Ko=Symbol("INITIAL_VALUE");function wo(){return(0,fn.w)(M=>It(M.map(S=>S.pipe(kn(1),function gr(...M){const S=(0,Ht.yG)(M);return(0,He.e)((D,O)=>{(S?tn(M,D,S):tn(M,D)).subscribe(O)})}(Ko)))).pipe((0,ht.U)(S=>{for(const D of S)if(!0!==D){if(D===Ko)return Ko;if(!1===D||D instanceof Fe)return D}return!0}),(0,Dn.h)(S=>S!==Ko),kn(1)))}function $(M){return(0,lr.z)((0,ln.b)(S=>{if($i(S))throw Es(0,S)}),(0,ht.U)(S=>!0===S))}const Ae={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function it(M,S,D,O,c){const t=At(M,S,D);return t.matched?function re(M,S,D,O){const c=S.canMatch;if(!c||0===c.length)return(0,nt.of)(!0);const t=c.map(a=>{const d=Wn(a,M);return mn(function Zc(M){return M&&Ni(M.canMatch)}(d)?d.canMatch(S,D):M.runInContext(()=>d(S,D)))});return(0,nt.of)(t).pipe(wo(),$())}(O=Hs(S,O),S,D).pipe((0,ht.U)(a=>!0===a?t:{...Ae})):(0,nt.of)(t)}function At(M,S,D){if(""===S.path)return"full"===S.pathMatch&&(M.hasChildren()||D.length>0)?{...Ae}:{matched:!0,consumedSegments:[],remainingSegments:D,parameters:{},positionalParamSegments:{}};const c=(S.matcher||fo)(D,M,S);if(!c)return{...Ae};const t={};pt(c.posParams,(d,g)=>{t[g]=d.path});const a=c.consumed.length>0?{...t,...c.consumed[c.consumed.length-1].parameters}:t;return{matched:!0,consumedSegments:c.consumed,remainingSegments:D.slice(c.consumed.length),parameters:a,positionalParamSegments:c.posParams??{}}}function un(M,S,D,O,c="corrected"){if(D.length>0&&function Dr(M,S,D){return D.some(O=>nr(M,S,O)&&ao(O)!==vn)}(M,D,O)){const a=new Le(S,function wr(M,S,D,O){const c={};c[vn]=O,O._sourceSegment=M,O._segmentIndexShift=S.length;for(const t of D)if(""===t.path&&ao(t)!==vn){const a=new Le([],{});a._sourceSegment=M,a._segmentIndexShift=S.length,c[ao(t)]=a}return c}(M,S,O,new Le(D,M.children)));return a._sourceSegment=M,a._segmentIndexShift=S.length,{segmentGroup:a,slicedSegments:[]}}if(0===D.length&&function dr(M,S,D){return D.some(O=>nr(M,S,O))}(M,D,O)){const a=new Le(M.segments,function yr(M,S,D,O,c,t){const a={};for(const d of O)if(nr(M,D,d)&&!c[ao(d)]){const g=new Le([],{});g._sourceSegment=M,g._segmentIndexShift="legacy"===t?M.segments.length:S.length,a[ao(d)]=g}return{...c,...a}}(M,S,D,O,M.children,c));return a._sourceSegment=M,a._segmentIndexShift=S.length,{segmentGroup:a,slicedSegments:D}}const t=new Le(M.segments,M.children);return t._sourceSegment=M,t._segmentIndexShift=S.length,{segmentGroup:t,slicedSegments:D}}function nr(M,S,D){return(!(M.hasChildren()||S.length>0)||"full"!==D.pathMatch)&&""===D.path}function br(M,S,D,O){return!!(ao(M)===O||O!==vn&&nr(S,D,M))&&("**"===M.path||At(S,M,D).matched)}function ar(M,S,D){return 0===S.length&&!M.children[D]}const Oo=!1;class lo{constructor(S){this.segmentGroup=S||null}}class Ts{constructor(S){this.urlTree=S}}function co(M){return ft(new lo(M))}function hs(M){return ft(new Ts(M))}class F{constructor(S,D,O,c,t){this.injector=S,this.configLoader=D,this.urlSerializer=O,this.urlTree=c,this.config=t,this.allowRedirects=!0}apply(){const S=un(this.urlTree.root,[],[],this.config).segmentGroup,D=new Le(S.segments,S.children);return this.expandSegmentGroup(this.injector,this.config,D,vn).pipe((0,ht.U)(t=>this.createUrlTree(xi(t),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,Zn.K)(t=>{if(t instanceof Ts)return this.allowRedirects=!1,this.match(t.urlTree);throw t instanceof lo?this.noMatchError(t):t}))}match(S){return this.expandSegmentGroup(this.injector,this.config,S.root,vn).pipe((0,ht.U)(c=>this.createUrlTree(xi(c),S.queryParams,S.fragment))).pipe((0,Zn.K)(c=>{throw c instanceof lo?this.noMatchError(c):c}))}noMatchError(S){return new W.vHH(4002,Oo)}createUrlTree(S,D,O){const c=Lr(S);return new Fe(c,D,O)}expandSegmentGroup(S,D,O,c){return 0===O.segments.length&&O.hasChildren()?this.expandChildren(S,D,O).pipe((0,ht.U)(t=>new Le([],t))):this.expandSegment(S,O,D,O.segments,c,!0)}expandChildren(S,D,O){const c=[];for(const t of Object.keys(O.children))"primary"===t?c.unshift(t):c.push(t);return(0,I.D)(c).pipe((0,Ar.b)(t=>{const a=O.children[t],d=Da(D,t);return this.expandSegmentGroup(S,d,a,t).pipe((0,ht.U)(g=>({segment:g,outlet:t})))}),Wo((t,a)=>(t[a.outlet]=a.segment,t),{}),_r())}expandSegment(S,D,O,c,t,a){return(0,I.D)(O).pipe((0,Ar.b)(d=>this.expandSegmentAgainstRoute(S,D,O,d,c,t,a).pipe((0,Zn.K)(v=>{if(v instanceof lo)return(0,nt.of)(null);throw v}))),Zr(d=>!!d),(0,Zn.K)((d,g)=>{if(bo(d))return ar(D,c,t)?(0,nt.of)(new Le([],{})):co(D);throw d}))}expandSegmentAgainstRoute(S,D,O,c,t,a,d){return br(c,D,t,a)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(S,D,c,t,a):d&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(S,D,O,c,t,a):co(D):co(D)}expandSegmentAgainstRouteUsingRedirect(S,D,O,c,t,a){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(S,O,c,a):this.expandRegularSegmentAgainstRouteUsingRedirect(S,D,O,c,t,a)}expandWildCardWithParamsAgainstRouteUsingRedirect(S,D,O,c){const t=this.applyRedirectCommands([],O.redirectTo,{});return O.redirectTo.startsWith("/")?hs(t):this.lineralizeSegments(O,t).pipe((0,vr.z)(a=>{const d=new Le(a,{});return this.expandSegment(S,d,D,a,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(S,D,O,c,t,a){const{matched:d,consumedSegments:g,remainingSegments:v,positionalParamSegments:E}=At(D,c,t);if(!d)return co(D);const C=this.applyRedirectCommands(g,c.redirectTo,E);return c.redirectTo.startsWith("/")?hs(C):this.lineralizeSegments(c,C).pipe((0,vr.z)(P=>this.expandSegment(S,D,O,P.concat(v),a,!1)))}matchSegmentAgainstRoute(S,D,O,c,t){return"**"===O.path?(S=Hs(O,S),O.loadChildren?(O._loadedRoutes?(0,nt.of)({routes:O._loadedRoutes,injector:O._loadedInjector}):this.configLoader.loadChildren(S,O)).pipe((0,ht.U)(d=>(O._loadedRoutes=d.routes,O._loadedInjector=d.injector,new Le(c,{})))):(0,nt.of)(new Le(c,{}))):it(D,O,c,S).pipe((0,fn.w)(({matched:a,consumedSegments:d,remainingSegments:g})=>a?this.getChildConfig(S=O._injector??S,O,c).pipe((0,vr.z)(E=>{const C=E.injector??S,P=E.routes,{segmentGroup:U,slicedSegments:V}=un(D,d,g,P),q=new Le(U.segments,U.children);if(0===V.length&&q.hasChildren())return this.expandChildren(C,P,q).pipe((0,ht.U)(le=>new Le(d,le)));if(0===P.length&&0===V.length)return(0,nt.of)(new Le(d,{}));const te=ao(O)===t;return this.expandSegment(C,q,P,V,te?vn:t,!0).pipe((0,ht.U)(ae=>new Le(d.concat(ae.segments),ae.children)))})):co(D)))}getChildConfig(S,D,O){return D.children?(0,nt.of)({routes:D.children,injector:S}):D.loadChildren?void 0!==D._loadedRoutes?(0,nt.of)({routes:D._loadedRoutes,injector:D._loadedInjector}):function J(M,S,D,O){const c=S.canLoad;if(void 0===c||0===c.length)return(0,nt.of)(!0);const t=c.map(a=>{const d=Wn(a,M);return mn(function xo(M){return M&&Ni(M.canLoad)}(d)?d.canLoad(S,D):M.runInContext(()=>d(S,D)))});return(0,nt.of)(t).pipe(wo(),$())}(S,D,O).pipe((0,vr.z)(c=>c?this.configLoader.loadChildren(S,D).pipe((0,ln.b)(t=>{D._loadedRoutes=t.routes,D._loadedInjector=t.injector})):function Xs(M){return ft($s(Oo,3))}())):(0,nt.of)({routes:[],injector:S})}lineralizeSegments(S,D){let O=[],c=D.root;for(;;){if(O=O.concat(c.segments),0===c.numberOfChildren)return(0,nt.of)(O);if(c.numberOfChildren>1||!c.children[vn])return ft(new W.vHH(4e3,Oo));c=c.children[vn]}}applyRedirectCommands(S,D,O){return this.applyRedirectCreateUrlTree(D,this.urlSerializer.parse(D),S,O)}applyRedirectCreateUrlTree(S,D,O,c){const t=this.createSegmentGroup(S,D.root,O,c);return new Fe(t,this.createQueryParams(D.queryParams,this.urlTree.queryParams),D.fragment)}createQueryParams(S,D){const O={};return pt(S,(c,t)=>{if("string"==typeof c&&c.startsWith(":")){const d=c.substring(1);O[t]=D[d]}else O[t]=c}),O}createSegmentGroup(S,D,O,c){const t=this.createSegments(S,D.segments,O,c);let a={};return pt(D.children,(d,g)=>{a[g]=this.createSegmentGroup(S,d,O,c)}),new Le(t,a)}createSegments(S,D,O,c){return D.map(t=>t.path.startsWith(":")?this.findPosParam(S,t,c):this.findOrReturn(t,O))}findPosParam(S,D,O){const c=O[D.path.substring(1)];if(!c)throw new W.vHH(4001,Oo);return c}findOrReturn(S,D){let O=0;for(const c of D){if(c.path===S.path)return D.splice(O),c;O++}return S}}class Ve{}class Ri{constructor(S,D,O,c,t,a,d,g){this.injector=S,this.rootComponentType=D,this.config=O,this.urlTree=c,this.url=t,this.paramsInheritanceStrategy=a,this.relativeLinkResolution=d,this.urlSerializer=g}recognize(){const S=un(this.urlTree.root,[],[],this.config.filter(D=>void 0===D.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,S,vn).pipe((0,ht.U)(D=>{if(null===D)return null;const O=new ws([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},vn,this.rootComponentType,null,this.urlTree.root,-1,{}),c=new Pi(O,D),t=new zo(this.url,c);return this.inheritParamsAndData(t._root),t}))}inheritParamsAndData(S){const D=S.value,O=qa(D,this.paramsInheritanceStrategy);D.params=Object.freeze(O.params),D.data=Object.freeze(O.data),S.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(S,D,O,c){return 0===O.segments.length&&O.hasChildren()?this.processChildren(S,D,O):this.processSegment(S,D,O,O.segments,c)}processChildren(S,D,O){return(0,I.D)(Object.keys(O.children)).pipe((0,Ar.b)(c=>{const t=O.children[c],a=Da(D,c);return this.processSegmentGroup(S,a,t,c)}),Wo((c,t)=>c&&t?(c.push(...t),c):null),function Mo(M,S=!1){return(0,He.e)((D,O)=>{let c=0;D.subscribe((0,bt.x)(O,t=>{const a=M(t,c++);(a||S)&&O.next(t),!a&&O.complete()}))})}(c=>null!==c),li(null),_r(),(0,ht.U)(c=>{if(null===c)return null;const t=Ys(c);return function jo(M){M.sort((S,D)=>S.value.outlet===vn?-1:D.value.outlet===vn?1:S.value.outlet.localeCompare(D.value.outlet))}(t),t}))}processSegment(S,D,O,c,t){return(0,I.D)(D).pipe((0,Ar.b)(a=>this.processSegmentAgainstRoute(a._injector??S,a,O,c,t)),Zr(a=>!!a),(0,Zn.K)(a=>{if(bo(a))return ar(O,c,t)?(0,nt.of)([]):(0,nt.of)(null);throw a}))}processSegmentAgainstRoute(S,D,O,c,t){if(D.redirectTo||!br(D,O,c,t))return(0,nt.of)(null);let a;if("**"===D.path){const d=c.length>0?we(c).parameters:{},g=yl(O)+c.length,v=new ws(c,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,xl(D),ao(D),D.component??D._loadedComponent??null,D,vc(O),g,Ms(D),g);a=(0,nt.of)({snapshot:v,consumedSegments:[],remainingSegments:[]})}else a=it(O,D,c,S).pipe((0,ht.U)(({matched:d,consumedSegments:g,remainingSegments:v,parameters:E})=>{if(!d)return null;const C=yl(O)+g.length;return{snapshot:new ws(g,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,xl(D),ao(D),D.component??D._loadedComponent??null,D,vc(O),C,Ms(D),C),consumedSegments:g,remainingSegments:v}}));return a.pipe((0,fn.w)(d=>{if(null===d)return(0,nt.of)(null);const{snapshot:g,consumedSegments:v,remainingSegments:E}=d;S=D._injector??S;const C=D._loadedInjector??S,P=function Ci(M){return M.children?M.children:M.loadChildren?M._loadedRoutes:[]}(D),{segmentGroup:U,slicedSegments:V}=un(O,v,E,P.filter(te=>void 0===te.redirectTo),this.relativeLinkResolution);if(0===V.length&&U.hasChildren())return this.processChildren(C,P,U).pipe((0,ht.U)(te=>null===te?null:[new Pi(g,te)]));if(0===P.length&&0===V.length)return(0,nt.of)([new Pi(g,[])]);const q=ao(D)===t;return this.processSegment(C,P,U,V,q?vn:t).pipe((0,ht.U)(te=>null===te?null:[new Pi(g,te)]))}))}}function Jn(M){const S=M.value.routeConfig;return S&&""===S.path&&void 0===S.redirectTo}function Ys(M){const S=[],D=new Set;for(const O of M){if(!Jn(O)){S.push(O);continue}const c=S.find(t=>O.value.routeConfig===t.value.routeConfig);void 0!==c?(c.children.push(...O.children),D.add(c)):S.push(O)}for(const O of D){const c=Ys(O.children);S.push(new Pi(O.value,c))}return S.filter(O=>!D.has(O))}function vc(M){let S=M;for(;S._sourceSegment;)S=S._sourceSegment;return S}function yl(M){let S=M,D=S._segmentIndexShift??0;for(;S._sourceSegment;)S=S._sourceSegment,D+=S._segmentIndexShift??0;return D-1}function xl(M){return M.data||{}}function Ms(M){return M.resolve||{}}function Aa(M){return"string"==typeof M.title||null===M.title}function ua(M){return(0,fn.w)(S=>{const D=M(S);return D?(0,I.D)(D).pipe((0,ht.U)(()=>S)):(0,nt.of)(S)})}let xc=(()=>{class M{buildTitle(D){let O,c=D.root;for(;void 0!==c;)O=this.getResolvedTitleForRoute(c)??O,c=c.children.find(t=>t.outlet===vn);return O}getResolvedTitleForRoute(D){return D.data[Fi]}}return M.\u0275fac=function(D){return new(D||M)},M.\u0275prov=W.Yz7({token:M,factory:function(){return(0,W.f3M)(en)},providedIn:"root"}),M})(),en=(()=>{class M extends xc{constructor(D){super(),this.title=D}updateTitle(D){const O=this.buildTitle(D);void 0!==O&&this.title.setTitle(O)}}return M.\u0275fac=function(D){return new(D||M)(W.LFG(ho.Dx))},M.\u0275prov=W.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();class Cu{}class Gl extends class $o{shouldDetach(S){return!1}store(S,D){}shouldAttach(S){return!1}retrieve(S){return null}shouldReuseRoute(S,D){return S.routeConfig===D.routeConfig}}{}const Js=new W.OlP("",{providedIn:"root",factory:()=>({})}),Ia=new W.OlP("ROUTES");let ha=(()=>{class M{constructor(D,O){this.injector=D,this.compiler=O,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(D){if(this.componentLoaders.get(D))return this.componentLoaders.get(D);if(D._loadedComponent)return(0,nt.of)(D._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(D);const O=mn(D.loadComponent()).pipe((0,ln.b)(t=>{this.onLoadEndListener&&this.onLoadEndListener(D),D._loadedComponent=t}),Nr(()=>{this.componentLoaders.delete(D)})),c=new Be(O,()=>new u.x).pipe(lt());return this.componentLoaders.set(D,c),c}loadChildren(D,O){if(this.childrenLoaders.get(O))return this.childrenLoaders.get(O);if(O._loadedRoutes)return(0,nt.of)({routes:O._loadedRoutes,injector:O._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(O);const t=this.loadModuleFactoryOrRoutes(O.loadChildren).pipe((0,ht.U)(d=>{this.onLoadEndListener&&this.onLoadEndListener(O);let g,v,E=!1;Array.isArray(d)?v=d:(g=d.create(D).injector,v=ve(g.get(Ia,[],W.XFs.Self|W.XFs.Optional)));return{routes:v.map(Nn),injector:g}}),Nr(()=>{this.childrenLoaders.delete(O)})),a=new Be(t,()=>new u.x).pipe(lt());return this.childrenLoaders.set(O,a),a}loadModuleFactoryOrRoutes(D){return mn(D()).pipe((0,vr.z)(O=>O instanceof W.YKP||Array.isArray(O)?(0,nt.of)(O):(0,I.D)(this.compiler.compileModuleAsync(O))))}}return M.\u0275fac=function(D){return new(D||M)(W.LFG(W.zs3),W.LFG(W.Sil))},M.\u0275prov=W.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();class Du{}class Hl{shouldProcessUrl(S){return!0}extract(S){return S}merge(S,D){return S}}function bc(M){throw M}function Tu(M,S,D){return S.parse("/")}const Mu={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},da={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function wc(){const M=(0,W.f3M)(St),S=(0,W.f3M)(cn),D=(0,W.f3M)(Wt.Ye),O=(0,W.f3M)(W.zs3),c=(0,W.f3M)(W.Sil),t=(0,W.f3M)(Ia,{optional:!0})??[],a=(0,W.f3M)(Js,{optional:!0})??{},d=(0,W.f3M)(en),g=(0,W.f3M)(xc,{optional:!0}),v=(0,W.f3M)(Du,{optional:!0}),E=(0,W.f3M)(Cu,{optional:!0}),C=new Li(null,M,S,D,O,c,ve(t));return v&&(C.urlHandlingStrategy=v),E&&(C.routeReuseStrategy=E),C.titleStrategy=g??d,function Qa(M,S){M.errorHandler&&(S.errorHandler=M.errorHandler),M.malformedUriErrorHandler&&(S.malformedUriErrorHandler=M.malformedUriErrorHandler),M.onSameUrlNavigation&&(S.onSameUrlNavigation=M.onSameUrlNavigation),M.paramsInheritanceStrategy&&(S.paramsInheritanceStrategy=M.paramsInheritanceStrategy),M.relativeLinkResolution&&(S.relativeLinkResolution=M.relativeLinkResolution),M.urlUpdateStrategy&&(S.urlUpdateStrategy=M.urlUpdateStrategy),M.canceledNavigationResolution&&(S.canceledNavigationResolution=M.canceledNavigationResolution)}(a,C),C}let Li=(()=>{class M{constructor(D,O,c,t,a,d,g){this.rootComponentType=D,this.urlSerializer=O,this.rootContexts=c,this.location=t,this.config=g,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new u.x,this.errorHandler=bc,this.malformedUriErrorHandler=Tu,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>(0,nt.of)(void 0),this.urlHandlingStrategy=new Hl,this.routeReuseStrategy=new Gl,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=a.get(ha),this.configLoader.onLoadEndListener=P=>this.triggerEvent(new pi(P)),this.configLoader.onLoadStartListener=P=>this.triggerEvent(new oo(P)),this.ngModule=a.get(W.h0i),this.console=a.get(W.c2e);const C=a.get(W.R0b);this.isNgZoneEnabled=C instanceof W.R0b&&W.R0b.isInAngularZone(),this.resetConfig(g),this.currentUrlTree=function cr(){return new Fe(new Le([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=os(this.currentUrlTree,this.rootComponentType),this.transitions=new Te({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(D){const O=this.events;return D.pipe((0,Dn.h)(c=>0!==c.id),(0,ht.U)(c=>({...c,extractedUrl:this.urlHandlingStrategy.extract(c.rawUrl)})),(0,fn.w)(c=>{let t=!1,a=!1;return(0,nt.of)(c).pipe((0,ln.b)(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,fn.w)(d=>{const g=this.browserUrlTree.toString(),v=!this.navigated||d.extractedUrl.toString()!==g||g!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||v)&&this.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return Is(d.source)&&(this.browserUrlTree=d.extractedUrl),(0,nt.of)(d).pipe((0,fn.w)(C=>{const P=this.transitions.getValue();return O.next(new Ao(C.id,this.serializeUrl(C.extractedUrl),C.source,C.restoredState)),P!==this.transitions.getValue()?rn.E:Promise.resolve(C)}),function R(M,S,D,O){return(0,fn.w)(c=>function j(M,S,D,O,c){return new F(M,S,D,O,c).apply()}(M,S,D,c.extractedUrl,O).pipe((0,ht.U)(t=>({...c,urlAfterRedirects:t}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),(0,ln.b)(C=>{this.currentNavigation={...this.currentNavigation,finalUrl:C.urlAfterRedirects},c.urlAfterRedirects=C.urlAfterRedirects}),function jl(M,S,D,O,c,t){return(0,vr.z)(a=>function fr(M,S,D,O,c,t,a="emptyOnly",d="legacy"){return new Ri(M,S,D,O,c,a,d,t).recognize().pipe((0,fn.w)(g=>null===g?function Jt(M){return new Tt.y(S=>S.error(M))}(new Ve):(0,nt.of)(g)))}(M,S,D,a.urlAfterRedirects,O.serialize(a.urlAfterRedirects),O,c,t).pipe((0,ht.U)(d=>({...a,targetSnapshot:d}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),(0,ln.b)(C=>{if(c.targetSnapshot=C.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!C.extras.skipLocationChange){const U=this.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl);this.setBrowserUrl(U,C)}this.browserUrlTree=C.urlAfterRedirects}const P=new Ga(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(C.urlAfterRedirects),C.targetSnapshot);O.next(P)}));if(v&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:P,extractedUrl:U,source:V,restoredState:q,extras:te}=d,oe=new Ao(P,this.serializeUrl(U),V,q);O.next(oe);const ae=os(U,this.rootComponentType).snapshot;return c={...d,targetSnapshot:ae,urlAfterRedirects:U,extras:{...te,skipLocationChange:!1,replaceUrl:!1}},(0,nt.of)(c)}return this.rawUrlTree=d.rawUrl,d.resolve(null),rn.E}),(0,ln.b)(d=>{const g=new ra(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);this.triggerEvent(g)}),(0,ht.U)(d=>c={...d,guards:_l(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function Ei(M,S){return(0,vr.z)(D=>{const{targetSnapshot:O,currentSnapshot:c,guards:{canActivateChecks:t,canDeactivateChecks:a}}=D;return 0===a.length&&0===t.length?(0,nt.of)({...D,guardsResult:!0}):function Ma(M,S,D,O){return(0,I.D)(M).pipe((0,vr.z)(c=>function B(M,S,D,O,c){const t=S&&S.routeConfig?S.routeConfig.canDeactivate:null;if(!t||0===t.length)return(0,nt.of)(!0);const a=t.map(d=>{const g=Ds(S)??c,v=Wn(d,g);return mn(function Vl(M){return M&&Ni(M.canDeactivate)}(v)?v.canDeactivate(M,S,D,O):g.runInContext(()=>v(M,S,D,O))).pipe(Zr())});return(0,nt.of)(a).pipe(wo())}(c.component,c.route,D,S,O)),Zr(c=>!0!==c,!0))}(a,O,c,M).pipe((0,vr.z)(d=>d&&function Qi(M){return"boolean"==typeof M}(d)?function Xa(M,S,D,O){return(0,I.D)(S).pipe((0,Ar.b)(c=>tn(function Ul(M,S){return null!==M&&S&&S(new Ha(M)),(0,nt.of)(!0)}(c.route.parent,O),function Ws(M,S){return null!==M&&S&&S(new Ki(M)),(0,nt.of)(!0)}(c.route,O),function Ya(M,S,D){const O=S[S.length-1],t=S.slice(0,S.length-1).reverse().map(a=>function Nt(M){const S=M.routeConfig?M.routeConfig.canActivateChild:null;return S&&0!==S.length?{node:M,guards:S}:null}(a)).filter(a=>null!==a).map(a=>kt(()=>{const d=a.guards.map(g=>{const v=Ds(a.node)??D,E=Wn(g,v);return mn(function _c(M){return M&&Ni(M.canActivateChild)}(E)?E.canActivateChild(O,M):v.runInContext(()=>E(O,M))).pipe(Zr())});return(0,nt.of)(d).pipe(wo())}));return(0,nt.of)(t).pipe(wo())}(M,c.path,D),function Sa(M,S,D){const O=S.routeConfig?S.routeConfig.canActivate:null;if(!O||0===O.length)return(0,nt.of)(!0);const c=O.map(t=>kt(()=>{const a=Ds(S)??D,d=Wn(t,a);return mn(function us(M){return M&&Ni(M.canActivate)}(d)?d.canActivate(S,M):a.runInContext(()=>d(S,M))).pipe(Zr())}));return(0,nt.of)(c).pipe(wo())}(M,c.route,D))),Zr(c=>!0!==c,!0))}(O,t,M,S):(0,nt.of)(d)),(0,ht.U)(d=>({...D,guardsResult:d})))})}(this.ngModule.injector,d=>this.triggerEvent(d)),(0,ln.b)(d=>{if(c.guardsResult=d.guardsResult,$i(d.guardsResult))throw Es(0,d.guardsResult);const g=new ia(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.triggerEvent(g)}),(0,Dn.h)(d=>!!d.guardsResult||(this.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),ua(d=>{if(d.guards.canActivateChecks.length)return(0,nt.of)(d).pipe((0,ln.b)(g=>{const v=new xa(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot);this.triggerEvent(v)}),(0,fn.w)(g=>{let v=!1;return(0,nt.of)(g).pipe(function $l(M,S){return(0,vr.z)(D=>{const{targetSnapshot:O,guards:{canActivateChecks:c}}=D;if(!c.length)return(0,nt.of)(D);let t=0;return(0,I.D)(c).pipe((0,Ar.b)(a=>function Ka(M,S,D,O){const c=M.routeConfig,t=M._resolve;return void 0!==c?.title&&!Aa(c)&&(t[Fi]=c.title),function Ss(M,S,D,O){const c=function qc(M){return[...Object.keys(M),...Object.getOwnPropertySymbols(M)]}(M);if(0===c.length)return(0,nt.of)({});const t={};return(0,I.D)(c).pipe((0,vr.z)(a=>function Ks(M,S,D,O){const c=Ds(S)??O,t=Wn(M,c);return mn(t.resolve?t.resolve(S,D):c.runInContext(()=>t(S,D)))}(M[a],S,D,O).pipe(Zr(),(0,ln.b)(d=>{t[a]=d}))),Cr(1),function fi(M){return(0,ht.U)(()=>M)}(t),(0,Zn.K)(a=>bo(a)?rn.E:ft(a)))}(t,M,S,O).pipe((0,ht.U)(a=>(M._resolvedData=a,M.data=qa(M,D).resolve,c&&Aa(c)&&(M.data[Fi]=c.title),null)))}(a.route,O,M,S)),(0,ln.b)(()=>t++),Cr(1),(0,vr.z)(a=>t===c.length?(0,nt.of)(D):rn.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),(0,ln.b)({next:()=>v=!0,complete:()=>{v||(this.restoreHistory(g),this.cancelNavigationTransition(g,"",2))}}))}),(0,ln.b)(g=>{const v=new Vs(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot);this.triggerEvent(v)}))}),ua(d=>{const g=v=>{const E=[];v.routeConfig?.loadComponent&&!v.routeConfig._loadedComponent&&E.push(this.configLoader.loadComponent(v.routeConfig).pipe((0,ln.b)(C=>{v.component=C}),(0,ht.U)(()=>{})));for(const C of v.children)E.push(...g(C));return E};return It(g(d.targetSnapshot.root)).pipe(li(),kn(1))}),ua(()=>this.afterPreactivation()),(0,ht.U)(d=>{const g=function js(M,S,D){const O=vo(M,S._root,D?D._root:void 0);return new bs(O,S)}(this.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return c={...d,targetRouterState:g}}),(0,ln.b)(d=>{this.currentUrlTree=d.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),this.routerState=d.targetRouterState,"deferred"===this.urlUpdateStrategy&&(d.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,d),this.browserUrlTree=d.urlAfterRedirects)}),((M,S,D)=>(0,ht.U)(O=>(new mr(S,O.targetRouterState,O.currentRouterState,D).activate(M),O)))(this.rootContexts,this.routeReuseStrategy,d=>this.triggerEvent(d)),(0,ln.b)({next(){t=!0},complete(){t=!0}}),Nr(()=>{t||a||this.cancelNavigationTransition(c,"",1),this.currentNavigation?.id===c.id&&(this.currentNavigation=null)}),(0,Zn.K)(d=>{if(a=!0,wa(d)){Ro(d)||(this.navigated=!0,this.restoreHistory(c,!0));const g=new _o(c.id,this.serializeUrl(c.extractedUrl),d.message,d.cancellationCode);if(O.next(g),Ro(d)){const v=this.urlHandlingStrategy.merge(d.url,this.rawUrlTree),E={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Is(c.source)};this.scheduleNavigation(v,"imperative",null,E,{resolve:c.resolve,reject:c.reject,promise:c.promise})}else c.resolve(!1)}else{this.restoreHistory(c,!0);const g=new Yi(c.id,this.serializeUrl(c.extractedUrl),d,c.targetSnapshot??void 0);O.next(g);try{c.resolve(this.errorHandler(d))}catch(v){c.reject(v)}}return rn.E}))}))}resetRootComponentType(D){this.rootComponentType=D,this.routerState.root.component=this.rootComponentType}setTransition(D){this.transitions.next({...this.transitions.value,...D})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(D=>{const O="popstate"===D.type?"popstate":"hashchange";"popstate"===O&&setTimeout(()=>{const c={replaceUrl:!0},t=D.state?.navigationId?D.state:null;if(t){const d={...t};delete d.navigationId,delete d.\u0275routerPageId,0!==Object.keys(d).length&&(c.state=d)}const a=this.parseUrl(D.url);this.scheduleNavigation(a,O,t,c)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(D){this.events.next(D)}resetConfig(D){this.config=D.map(Nn),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(D,O={}){const{relativeTo:c,queryParams:t,fragment:a,queryParamsHandling:d,preserveFragment:g}=O,v=c||this.routerState.root,E=g?this.currentUrlTree.fragment:a;let C=null;switch(d){case"merge":C={...this.currentUrlTree.queryParams,...t};break;case"preserve":C=this.currentUrlTree.queryParams;break;default:C=t||null}return null!==C&&(C=this.removeEmptyProps(C)),io(v,this.currentUrlTree,D,C,E??null)}navigateByUrl(D,O={skipLocationChange:!1}){const c=$i(D)?D:this.parseUrl(D),t=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(t,"imperative",null,O)}navigate(D,O={skipLocationChange:!1}){return function Zl(M){for(let S=0;S<M.length;S++){if(null==M[S])throw new W.vHH(4008,false)}}(D),this.navigateByUrl(this.createUrlTree(D,O),O)}serializeUrl(D){return this.urlSerializer.serialize(D)}parseUrl(D){let O;try{O=this.urlSerializer.parse(D)}catch(c){O=this.malformedUriErrorHandler(c,this.urlSerializer,D)}return O}isActive(D,O){let c;if(c=!0===O?{...Mu}:!1===O?{...da}:O,$i(D))return Tr(this.currentUrlTree,D,c);const t=this.parseUrl(D);return Tr(this.currentUrlTree,t,c)}removeEmptyProps(D){return Object.keys(D).reduce((O,c)=>{const t=D[c];return null!=t&&(O[c]=t),O},{})}processNavigations(){this.navigations.subscribe(D=>{this.navigated=!0,this.lastSuccessfulId=D.id,this.currentPageId=D.targetPageId,this.events.next(new Wr(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),D.resolve(!0)},D=>{this.console.warn(`Unhandled Navigation Error: ${D}`)})}scheduleNavigation(D,O,c,t,a){if(this.disposed)return Promise.resolve(!1);let d,g,v;a?(d=a.resolve,g=a.reject,v=a.promise):v=new Promise((P,U)=>{d=P,g=U});const E=++this.navigationId;let C;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(c=this.location.getState()),C=c&&c.\u0275routerPageId?c.\u0275routerPageId:t.replaceUrl||t.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):C=0,this.setTransition({id:E,targetPageId:C,source:O,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:D,extras:t,resolve:d,reject:g,promise:v,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),v.catch(P=>Promise.reject(P))}setBrowserUrl(D,O){const c=this.urlSerializer.serialize(D),t={...O.extras.state,...this.generateNgRouterState(O.id,O.targetPageId)};this.location.isCurrentPathEqualTo(c)||O.extras.replaceUrl?this.location.replaceState(c,"",t):this.location.go(c,"",t)}restoreHistory(D,O=!1){if("computed"===this.canceledNavigationResolution){const c=this.currentPageId-D.targetPageId;"popstate"!==D.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===c?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===c&&(this.resetState(D),this.browserUrlTree=D.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(c)}else"replace"===this.canceledNavigationResolution&&(O&&this.resetState(D),this.resetUrlToCurrentUrlTree())}resetState(D){this.routerState=D.currentRouterState,this.currentUrlTree=D.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,D.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(D,O,c){const t=new _o(D.id,this.serializeUrl(D.extractedUrl),O,c);this.triggerEvent(t),D.resolve(!1)}generateNgRouterState(D,O){return"computed"===this.canceledNavigationResolution?{navigationId:D,\u0275routerPageId:O}:{navigationId:D}}}return M.\u0275fac=function(D){W.$Z()},M.\u0275prov=W.Yz7({token:M,factory:function(){return wc()},providedIn:"root"}),M})();function Is(M){return"imperative"!==M}let Pa=(()=>{class M{constructor(D,O,c,t,a){this.router=D,this.route=O,this.tabIndexAttribute=c,this.renderer=t,this.el=a,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.onChanges=new u.x,this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(D){this._preserveFragment=(0,W.D6c)(D)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(D){this._skipLocationChange=(0,W.D6c)(D)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(D){this._replaceUrl=(0,W.D6c)(D)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(D){if(null!=this.tabIndexAttribute)return;const O=this.renderer,c=this.el.nativeElement;null!==D?O.setAttribute(c,"tabindex",D):O.removeAttribute(c,"tabindex")}ngOnChanges(D){this.onChanges.next(this)}set routerLink(D){null!=D?(this.commands=Array.isArray(D)?D:[D],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){return null===this.urlTree||this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return M.\u0275fac=function(D){return new(D||M)(W.Y36(Li),W.Y36(Zi),W.$8M("tabindex"),W.Y36(W.Qsj),W.Y36(W.SBq))},M.\u0275dir=W.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(D,O){1&D&&W.NdJ("click",function(){return O.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[W.TTD]}),M})(),el=(()=>{class M{constructor(D,O,c){this.router=D,this.route=O,this.locationStrategy=c,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new u.x,this.subscription=D.events.subscribe(t=>{t instanceof Wr&&this.updateTargetUrlAndHref()})}set preserveFragment(D){this._preserveFragment=(0,W.D6c)(D)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(D){this._skipLocationChange=(0,W.D6c)(D)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(D){this._replaceUrl=(0,W.D6c)(D)}get replaceUrl(){return this._replaceUrl}set routerLink(D){this.commands=null!=D?Array.isArray(D)?D:[D]:null}ngOnChanges(D){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(D,O,c,t,a){return!!(0!==D||O||c||t||a||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return M.\u0275fac=function(D){return new(D||M)(W.Y36(Li),W.Y36(Zi),W.Y36(Wt.S$))},M.\u0275dir=W.lG2({type:M,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(D,O){1&D&&W.NdJ("click",function(t){return O.onClick(t.button,t.ctrlKey,t.shiftKey,t.altKey,t.metaKey)}),2&D&&W.uIk("target",O.target)("href",O.href,W.LSH)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[W.TTD]}),M})(),ql=(()=>{class M{constructor(D,O,c,t,a,d){this.router=D,this.element=O,this.renderer=c,this.cdr=t,this.link=a,this.linkWithHref=d,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new W.vpe,this.routerEventsSubscription=D.events.subscribe(g=>{g instanceof Wr&&this.update()})}ngAfterContentInit(){(0,nt.of)(this.links.changes,this.linksWithHrefs.changes,(0,nt.of)(null)).pipe((0,or.J)()).subscribe(D=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const D=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(O=>!!O).map(O=>O.onChanges);this.linkInputChangesSubscription=(0,I.D)(D).pipe((0,or.J)()).subscribe(O=>{this.isActive!==this.isLinkActive(this.router)(O)&&this.update()})}set routerLinkActive(D){const O=Array.isArray(D)?D:D.split(" ");this.classes=O.filter(c=>!!c)}ngOnChanges(D){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const D=this.hasActiveLinks();this.isActive!==D&&(this.isActive=D,this.cdr.markForCheck(),this.classes.forEach(O=>{D?this.renderer.addClass(this.element.nativeElement,O):this.renderer.removeClass(this.element.nativeElement,O)}),D&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(D))})}isLinkActive(D){const O=function Wc(M){return!!M.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return c=>!!c.urlTree&&D.isActive(c.urlTree,O)}hasActiveLinks(){const D=this.isLinkActive(this.router);return this.link&&D(this.link)||this.linkWithHref&&D(this.linkWithHref)||this.links.some(D)||this.linksWithHrefs.some(D)}}return M.\u0275fac=function(D){return new(D||M)(W.Y36(Li),W.Y36(W.SBq),W.Y36(W.Qsj),W.Y36(W.sBO),W.Y36(Pa,8),W.Y36(el,8))},M.\u0275dir=W.lG2({type:M,selectors:[["","routerLinkActive",""]],contentQueries:function(D,O,c){if(1&D&&(W.Suo(c,Pa,5),W.Suo(c,el,5)),2&D){let t;W.iGM(t=W.CRH())&&(O.links=t),W.iGM(t=W.CRH())&&(O.linksWithHrefs=t)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[W.TTD]}),M})();class Ec{}let tl=(()=>{class M{constructor(D,O,c,t,a){this.router=D,this.injector=c,this.preloadingStrategy=t,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe((0,Dn.h)(D=>D instanceof Wr),(0,Ar.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(D,O){const c=[];for(const t of O){t.providers&&!t._injector&&(t._injector=(0,W.MMx)(t.providers,D,`Route: ${t.path}`));const a=t._injector??D,d=t._loadedInjector??a;t.loadChildren&&!t._loadedRoutes&&void 0===t.canLoad||t.loadComponent&&!t._loadedComponent?c.push(this.preloadConfig(a,t)):(t.children||t._loadedRoutes)&&c.push(this.processRoutes(d,t.children??t._loadedRoutes))}return(0,I.D)(c).pipe((0,or.J)())}preloadConfig(D,O){return this.preloadingStrategy.preload(O,()=>{let c;c=O.loadChildren&&void 0===O.canLoad?this.loader.loadChildren(D,O):(0,nt.of)(null);const t=c.pipe((0,vr.z)(a=>null===a?(0,nt.of)(void 0):(O._loadedRoutes=a.routes,O._loadedInjector=a.injector,this.processRoutes(a.injector??D,a.routes))));if(O.loadComponent&&!O._loadedComponent){const a=this.loader.loadComponent(O);return(0,I.D)([t,a]).pipe((0,or.J)())}return t})}}return M.\u0275fac=function(D){return new(D||M)(W.LFG(Li),W.LFG(W.Sil),W.LFG(W.lqb),W.LFG(Ec),W.LFG(ha))},M.\u0275prov=W.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"}),M})();const Ra=new W.OlP("");let Cc=(()=>{class M{constructor(D,O,c={}){this.router=D,this.viewportScroller=O,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(D=>{D instanceof Ao?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=D.navigationTrigger,this.restoredId=D.restoredState?D.restoredState.navigationId:0):D instanceof Wr&&(this.lastId=D.id,this.scheduleScrollEvent(D,this.router.parseUrl(D.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(D=>{D instanceof Za&&(D.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(D.position):D.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(D.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(D,O){this.router.triggerEvent(new Za(D,"popstate"===this.lastSource?this.store[this.restoredId]:null,O))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return M.\u0275fac=function(D){W.$Z()},M.\u0275prov=W.Yz7({token:M,factory:M.\u0275fac}),M})();function ki(M,S){return{\u0275kind:M,\u0275providers:S}}function jr(M){return[{provide:Ia,multi:!0,useValue:M}]}function fh(){const M=(0,W.f3M)(W.zs3);return S=>{const D=M.get(W.z2F);if(S!==D.components[0])return;const O=M.get(Li),c=M.get(ph);1===M.get(Jo)&&O.initialNavigation(),M.get(Fo,null,W.XFs.Optional)?.setUpPreloading(),M.get(Ra,null,W.XFs.Optional)?.init(),O.resetRootComponentType(D.componentTypes[0]),c.next(),c.complete()}}const ph=new W.OlP("",{factory:()=>new u.x}),Jo=new W.OlP("",{providedIn:"root",factory:()=>1});const Fo=new W.OlP("");function El(M){return ki(0,[{provide:Fo,useExisting:tl},{provide:Ec,useExisting:M}])}const ka=new W.OlP("ROUTER_FORROOT_GUARD"),Wl=[Wt.Ye,{provide:St,useClass:Tn},{provide:Li,useFactory:wc},cn,{provide:Zi,useFactory:function Su(M){return M.routerState.root},deps:[Li]},ha];function nl(){return new W.PXZ("Router",Li)}let qt=(()=>{class M{constructor(D){}static forRoot(D,O){return{ngModule:M,providers:[Wl,[],jr(D),{provide:ka,useFactory:rl,deps:[[Li,new W.FiY,new W.tp0]]},{provide:Js,useValue:O||{}},O?.useHash?{provide:Wt.S$,useClass:Wt.Do}:{provide:Wt.S$,useClass:Wt.b0},{provide:Ra,useFactory:()=>{const M=(0,W.f3M)(Li),S=(0,W.f3M)(Wt.EM),D=(0,W.f3M)(Js);return D.scrollOffset&&S.setOffset(D.scrollOffset),new Cc(M,S,D)}},O?.preloadingStrategy?El(O.preloadingStrategy).\u0275providers:[],{provide:W.PXZ,multi:!0,useFactory:nl},O?.initialNavigation?Xc(O):[],[{provide:Yc,useFactory:fh},{provide:W.tb,multi:!0,useExisting:Yc}]]}}static forChild(D){return{ngModule:M,providers:[jr(D)]}}}return M.\u0275fac=function(D){return new(D||M)(W.LFG(ka,8))},M.\u0275mod=W.oAB({type:M}),M.\u0275inj=W.cJS({imports:[la]}),M})();function rl(M){return"guarded"}function Xc(M){return["disabled"===M.initialNavigation?ki(3,[{provide:W.ip1,multi:!0,useFactory:()=>{const S=(0,W.f3M)(Li);return()=>{S.setUpLocationChangeListener()}}},{provide:Jo,useValue:2}]).\u0275providers:[],"enabledBlocking"===M.initialNavigation?ki(2,[{provide:Jo,useValue:0},{provide:W.ip1,multi:!0,deps:[W.zs3],useFactory:S=>{const D=S.get(Wt.V_,Promise.resolve());let O=!1;return()=>D.then(()=>new Promise(t=>{const a=S.get(Li),d=S.get(ph);(function c(t){S.get(Li).events.pipe((0,Dn.h)(d=>d instanceof Wr||d instanceof _o||d instanceof Yi),(0,ht.U)(d=>d instanceof Wr||d instanceof _o&&(0===d.code||1===d.code)&&null),(0,Dn.h)(d=>null!==d),kn(1)).subscribe(()=>{t()})})(()=>{t(!0),O=!0}),a.afterPreactivation=()=>(t(!0),O||d.closed?(0,nt.of)(void 0):d),a.initialNavigation()}))}}]).\u0275providers:[]]}const Yc=new W.OlP("")}},Hn=>{Hn(Hn.s=8914)}]);